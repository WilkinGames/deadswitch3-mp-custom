const Settings={BATCH_MAX:8,FLAMES_MAX:40,SCAVENGER_PACKS_MAX:5,CRATES_MAX:5,TURRETS_MAX:2,INFECTED_INTERMISSION_TIMER:3,SURVIVAL_WAVE_START:0,SURVIVAL_MONEY_START:0,SURVIVAL_MULTIPLIER_MAX:5,SANDBOX_MAX_PAWNS_PER_TEAM:10,SANDBOX_MAX_SPAWNERS:6,LOG_PREFIX:"[GameInstance]",LOG_SUFFIX:"color: mediumslateblue"},Battlezone={TEAM_AIRDROPS:97,TEAM_ENEMIES:98,TEAM_MERCENARIES:99,CRATE_INTERACT_TIME:3,MAX_XP:1e6,MAX_SHARDS:10,MAX_MERCS:5,MAX_HELIS:2},Rocket={TYPE_DEFAULT:"TYPE_DEFAULT",TYPE_HELLFIRE:"TYPE_HELLFIRE",TYPE_NAPALM:"TYPE_NAPALM"},GameServer={INV_CLASS_DATA:1,INV_CURRENT_INVENTORY_INDEX:2,INV_FIRE:3,INV_PERK_ADD:4,INV_PERKS:5,INV_PERKS_SET:6,INV_MOD_SET:7,INV_EQUIPMENT_SET:8,INV_EQUIPMENT_ADD:9,INV_AMMO:10,INV_AMMO_ADD:11,INV_MAG:12,INV_MAG_ADD:13,INV_BURSTS:14,INV_BURSTS_ADD:15,INV_ITEM:16,INV_ITEM_ADD:17,INV_ITEM_REPLACE:18,INV_INVENTORY_REPLACE:19,INV_INVENTORY:21,INV_EQUIPMENT:22,EVENT_ERROR:99,EVENT_BATCH:0,EVENT_GAME_INIT:1,EVENT_GAME_TIMER:2,EVENT_GAME_PRE_TIMER:3,EVENT_GAME_START:4,EVENT_GAME_END:5,EVENT_GAME_UPDATE:6,EVENT_STORE_BUY:7,EVENT_GAME_MONEY_ADD:8,EVENT_GAME_WAVE_START:9,EVENT_GAME_WAVE_COMPLETE:10,EVENT_GAME_PAUSE:11,EVENT_REQUEST_RANKED_CHARACTER:13,EVENT_CREATE_RANKED_CHARACTER:14,EVENT_CREATE_GENERIC_CHARACTER:15,EVENT_CREATE_INFESTOR:16,EVENT_OBJECT_UPDATE:17,EVENT_OBJECT_HIT:18,EVENT_PAWN_DAMAGE:19,EVENT_PAWN_DIE:20,EVENT_PAWN_ACTION:21,EVENT_SET_PLAYER_CONTROLLER_ID:22,EVENT_CREATE_AI_CONTROLLER:23,EVENT_PLAYER_JOIN:24,EVENT_PLAYER_LEAVE:25,EVENT_PLAYER_UPDATE:26,EVENT_PLAYER_RESPAWN:27,EVENT_PLAYER_EARN_KILLSTREAK:28,EVENT_PLAYER_USE_KILLSTREAK:29,EVENT_PLAYER_OPEN_WORLD_MENU:30,EVENT_PLAYER_CLOSE_WORLD_MENU:31,EVENT_PLAYER_SET_WORLD_POSITION:32,EVENT_PLAYER_EXECUTE_KILLSTREAK:33,EVENT_PLAYER_FLAG:34,EVENT_PLAYER_MULTI_KILL:35,EVENT_PLAYER_UPDATE_CONTROLLABLE:36,EVENT_PLAYER_INPUT:37,EVENT_PLAYER_INTERACT:38,EVENT_PLAYER_UPDATE_INVENTORY:39,EVENT_PLAYER_TRIGGER_WEAPON:40,EVENT_PLAYER_TRIGGER_EQUIPMENT:41,EVENT_PLAYER_TRIGGER_MELEE:42,EVENT_KILLSTREAKS_UPDATE:43,EVENT_ANNOUNCER_MESSAGE:44,EVENT_KILLFEED_ADD:45,EVENT_MESSAGE_ADD:46,EVENT_SPAWN_OBJECT:47,EVENT_SPAWN_BULLET:48,EVENT_SPAWN_EXPLOSION:49,EVENT_SPAWN_GRENADE:50,EVENT_SPAWN_PROJECTILE:51,EVENT_SPAWN_ROCKET:52,EVENT_SPAWN_DROPPED_WEAPON:53,EVENT_SPAWN_CRATE:54,EVENT_SPAWN_FLAG:55,EVENT_SPAWN_EQUIPMENT:56,EVENT_SPAWN_HELICOPTER:57,EVENT_SPAWN_TURRET:58,EVENT_SPAWN_REVIVER:59,EVENT_INTERACTABLE_USED:60,EVENT_REMOVE_OBJECT:61,EVENT_SANDBOX:62,EVENT_ROUND_END:63,EVENT_ROUND_START:64,EVENT_BATTLEZONE:65,PAWN_FIRE_WEAPON:1,PAWN_HIT_SHIELD:2,PAWN_START_REVIVE:3,PAWN_END_REVIVE:4,PAWN_SHARED_CRATE:5,PAWN_STOLE_CRATE:6,PAWN_START_INTERACTION:7,PAWN_NO_AMMO:8,PAWN_OPEN_LAPTOP:9,PAWN_ON_FIRE:10,PAWN_STUN:11,PAWN_FLASH:12,PAWN_FREEZE:13,PAWN_SET_JAMMED:14,PAWN_UPDATE_DOOR:15,PAWN_INVESTIGATE:16,PAWN_TROPHY_HIT:17,PAWN_START_SHIELD_COOLDOWN:18,PAWN_END_SHIELD_COOLDOWN:19,PAWN_END_FIRE_DELAY:20,PAWN_END_BOLT_DELAY:21,PAWN_END_THROW_DELAY:22,PAWN_END_EQUIPMENT_DELAY:23,PAWN_END_MELEE_DELAY:24,PAWN_RELOAD_COMPLETE:25,PAWN_CLOSE_LAPTOP:26,PAWN_START_FLAME:27,PAWN_END_FLAME:28,PAWN_RELOAD:29,PAWN_PULL_BOLT:30,PAWN_CANCEL_RELOAD:31,PAWN_CANCEL_BOLT_PULL:32,PAWN_THROW_GRENADE:33,PAWN_USE_STIM:34,PAWN_RECEIVE_STIM:35,PAWN_PLACE_EQUIPMENT:36,PAWN_MELEE_ATTACK:37,PAWN_FIRE_MELEE:38,PAWN_FIRE_ROCKET:39,PAWN_TRIGGER_MINE:40,PAWN_END_INTERACTION:41,PAWN_JUMP:42,PAWN_ON_BOOST:43,PAWN_START_LADDER_CLIMB:44,PAWN_LEAVE_LADDER:45,PAWN_DROP_CRATE:46,PAWN_FLAG:47,PAWN_HIT:48},GameMode={SANDBOX:"sandbox",BATTLEZONE:"battlezone",DEATHMATCH:"deathmatch",TEAM_DEATHMATCH:"team_deathmatch",DOMINATION:"domination",CAPTURE_THE_FLAG:"capture_the_flag",DEFENDER:"defender",DEMOLITION:"demolition",HEADQUARTERS:"headquarters",ASSASSINATION:"escort",RESCUE:"rescue",GUN_GAME:"gun_game",INFECTED:"infected",OP_ELIMINATION:"op_elimination",OP_BOMB:"op_bomb",OP_HOSTAGE:"op_hostage",SURVIVAL_BASIC:"survival_basic",SURVIVAL_UNDEAD:"survival_undead",SURVIVAL_CHAOS:"survival_chaos",SURVIVAL_STAKEOUT:"survival_stakeout",SURVIVAL_PRO:"survival_pro"},Character={HAIR_COLOUR_BROWN:"HAIR_COLOUR_BROWN",HAIR_COLOUR_BROWN_LIGHT:"HAIR_COLOUR_BROWN_LIGHT",HAIR_COLOUR_BLACK:"HAIR_COLOUR_BLACK",HAIR_COLOUR_BLONDE:"HAIR_COLOUR_BLONDE",HAIR_COLOUR_GINGER:"HAIR_COLOUR_GINGER",HAIR_COLOUR_GREY:"HAIR_COLOUR_GREY",HAIR_COLOUR_WHITE:"HAIR_COLOUR_WHITE",HAIR_COLOUR_RED:"HAIR_COLOUR_RED",HAIR_COLOUR_BLUE:"HAIR_COLOUR_BLUE",HAIR_COLOUR_GREEN:"HAIR_COLOUR_GREEN",FACE_DEFAULT:"face0000",FACE_FEMALE:"face0009",FACE_ZOMBIE_1:"face0001",FACE_ZOMBIE_2:"face0002",FACE_ZOMBIE_3:"face0003",FACE_ZOMBIE_4:"face0004",FACE_ZOMBIE_FAT:"face0005",FACE_ZOMBIE_EXPLODER:"face0006",FACE_ZOMBIE_SPITTER:"face0007",FACE_ZOMBIE_SPITTER_BOSS:"face0007",FACE_ZOMBIE_SPRINTER:"face0008",FACE_INFESTOR:"face00012",FACE_ZOMBIE_SPRINTER_BOSS:"face0013",HAIR_SHORT:"hair0000",HAIR_BALD:"hair0008",HAIR_LONG:"hair0002",HAIR_PONYTAIL:"hair0003",HAIR_UNDERCUT:"hair0006",HAIR_SPIKES:"hair0005",HAIR_BUZZED:"hair0004",HAIR_FLAT:"hair0001",HAIR_STYLED:"hair0007",HAIR_HORSESHOE:"hair0009",HAIR_MOHAWK:"hair0010",BEARD_NONE:"beard0000",BEARD_STUBBLE:"beard0001",BEARD_FULL:"beard0002",BEARD_CIRCLE:"beard0003",BEARD_GOATEE:"beard0004",BEARD_MOUSTACHE:"beard0005",BEARD_SIDEBURNS:"beard0006",EYEWEAR_NONE:"eyewear0000",EYEWEAR_SHADES:"eyewear0001",EYEWEAR_GLASSES:"eyewear0002",EYEWEAR_GOGGLES_YELLOW:"eyewear0003",EYEWEAR_GOGGLES_ORANGE:"eyewear0004",EYEWEAR_GOGGLES_WHITE:"eyewear0005",EYEWEAR_GOGGLES_BLACK:"eyewear0006",FACEWEAR_NONE:"facewear0000",FACEWEAR_MASK:"facewear0001",FACEWEAR_SKULLMASK:"facewear0002",FACEWEAR_GHILLIE:"facewear0003",FACEWEAR_SCARF_OPFOR:"facewear0004",FACEWEAR_BALACLAVA:"facewear0005",FACEWEAR_SCARF_SPETSNAZ:"facewear0006",FACEWEAR_BANDANA:"facewear0007",FACEWEAR_GAS_MASK:"facewear0008",FACEWEAR_BANDANA_GENERIC:"facewear0009",FACEWEAR_GAITER:"facewear0010",FACEWEAR_TWOPLAYER:"facewear0019",HEAD_ERIC_HELMET:"head0082",HEAD_NONE:"head0000",HEAD_MASK:"head0001",HEAD_GAS_MASK:"head0002",HEAD_RADIO:"head0003",HEAD_USMC_MASK:"head0004",HEAD_USMC_CAP:"head0005",HEAD_USMC_CAP_BACKWARDS:"head0006",HEAD_USMC_SPEC_OPS:"head0007",HEAD_USMC_HELMET:"head0008",HEAD_USMC_HELMET_TACTICAL:"head0009",HEAD_USMC_BOONIE:"head0010",HEAD_USMC_GHILLIE:"head0011",HEAD_GIGN_HELMET:"head0012",HEAD_GIGN_HELMET_2:"head0013",HEAD_GIGN_CAP:"head0014",HEAD_GSG9_HELMET:"head0015",HEAD_GSG9_HELMET_2:"head0016",HEAD_GSG9_HELMET_3:"head0017",HEAD_OPFOR_SCARF:"head0018",HEAD_OPFOR_HELMET:"head0019",HEAD_OPFOR_HELMET_2:"head0020",HEAD_OPFOR_BERET:"head0021",HEAD_OPFOR_SHADES:"head0022",HEAD_OPFOR_COMMANDER:"head0023",HEAD_RUS_MASK:"head0024",HEAD_RUS_HAT:"head0025",HEAD_RUS_SCARF:"head0026",HEAD_RUS_TOQUE:"head0027",HEAD_RUS_BERET:"head0028",HEAD_RUS_CAP:"head0029",HEAD_RUS_RECON:"head0030",HEAD_RUS_HELMET:"head0031",HEAD_MILITIA_RADIO:"head0032",HEAD_MILITIA_BAND:"head0033",HEAD_MILITIA_BANDANA:"head0034",HEAD_MILITIA_CAP:"head0035",HEAD_MILITIA_SNIPER:"head0036",HEAD_JUGGERNAUT_HELMET:"head0037",HEAD_RIOT_HELMET:"head0055",HEAD_RIOT_HELMET_VISOR_UP:"head0056",HEAD_UN_BERET:"head0057",HEAD_UN_HELMET:"head0058",HEAD_NIGHTVISION:"head0059",HEAD_ALTYN_HELMET:"head0060",HEAD_ALTYN_HELMET_VISOR_UP:"head0061",HEAD_HOOD:"head0062",HEAD_BALLISTIC_MASK_BLACK:"head0045",HEAD_BALLISTIC_MASK_WHITE:"head0046",BODY_VIP:"vip",BODY_HOSTAGE:"hostage",BODY_USMC_STANDARD:"usmc",BODY_USMC_GHILLIE:"usmc_ghillie",BODY_USMC_HEAVY:"usmc_heavy",BODY_USMC_PARA:"usmc_para",BODY_USMC_RECON:"usmc_recon",BODY_GIGN_STANDARD:"gign",BODY_GIGN_HEAVY:"gign_heavy",BODY_GIGN_PARA:"gign_para",BODY_GIGN_RECON:"gign_recon",BODY_GIGN_TACTICAL:"gign_tactical",BODY_GSG9_STANDARD:"gsg9",BODY_GSG9_HEAVY:"gsg9_heavy",BODY_GSG9_PARA:"gsg9_para",BODY_GSG9_RECON:"gsg9_recon",BODY_GSG9_TACTICAL:"gsg9_tactical",BODY_OPFOR_STANDARD:"opfor",BODY_OPFOR_ROCKETIER:"opfor_rocketier",BODY_OPFOR_HEAVY:"opfor_heavy",BODY_OPFOR_PARA:"opfor_para",BODY_OPFOR_RECON:"opfor_recon",BODY_RUS_STANDARD:"rus",BODY_RUS_BARE:"rus_bare",BODY_RUS_HEAVY:"rus_heavy",BODY_RUS_PARA:"rus_para",BODY_RUS_RECON:"rus_recon",BODY_RUS_ROCKETIER:"rus_rocketier",BODY_JUGGERNAUT:"rus_juggernaut",BODY_MILITIA_STANDARD:"militia",BODY_MILITIA_HEAVY:"militia_heavy",BODY_MILITIA_PARA:"militia_para",BODY_MILITIA_RECON:"militia_recon",BODY_MILITIA_TACTICAL:"militia_tactical",BODY_USMC_KEVLAR:"usmc_kevlar",BODY_GIGN_KEVLAR:"gign_kevlar",BODY_GSG9_KEVLAR:"gsg9_kevlar",BODY_OPFOR_KEVLAR:"opfor_kevlar",BODY_RUS_KEVLAR:"rus_kevlar",BODY_MILITIA_KEVLAR:"militia_kevlar",BODY_ZOMBIE:"zombie",BODY_ZOMBIE_2:"zombie_2",BODY_ZOMBIE_3:"zombie_3",BODY_ZOMBIE_FAT:"zombie_fat",BODY_ZOMBIE_EXPLODER:"zombie_exploder",BODY_ZOMBIE_EXPLODER_BOSS:"zombie_exploder_boss",BODY_ZOMBIE_SPITTER:"zombie_spitter",BODY_ZOMBIE_SPITTER_BOSS:"zombie_spitter_boss",BODY_ZOMBIE_SPRINTER:"zombie_sprinter",BODY_ZOMBIE_SPRINTER_BOSS:"zombie_sprinter_boss"},MatchState={STATE_ENTERING_MAP:"entering_map",STATE_PRE_GAME:"pre_game",STATE_IN_PROGRESS:"in_progress",STATE_POST_ROUND:"post_round",STATE_POST_GAME:"post_game",END_RESULT_WIN:"end_result_win",END_RESULT_LOSS:"end_result_loss",END_RESULT_DRAW:"end_result_draw",END_CONDITION_TIME:"end_condition_time",END_CONDITION_SCORE:"end_condition_score",END_CONDITION_BOMB:"end_condition_bomb",END_CONDITION_DEFUSE:"end_condition_defuse",END_CONDITION_DEAD:"end_condition_dead",END_CONDITION_DEAD_ALLY:"end_condition_dead_ally",END_CONDITION_FORFEIT:"end_condition_forfeit",END_CONDITION_OBJECTIVE:"end_condition_objective",END_CONDITION_INFECTED:"end_condition_infected",END_CONDITION_NUKE:"end_condition_nuke",END_CONDITION_HEADQUARTERS:"end_condition_headquarters",END_CONDITION_VIP_KILLED:"end_condition_vip_killed",END_CONDITION_HOSTAGES_RESCUED:"end_condition_hostages_rescued",END_CONDITION_HOSTAGE_KILLED:"end_condition_hostage_killed"},Perks={PERK_TYPE_PLAYER:"PERK_TYPE_PLAYER",PERK_TYPE_WEAPON:"PERK_TYPE_WEAPON",PERK_PLAYER_LIGHTWEIGHT:"perk_lightweight",PERK_PLAYER_JUGGERNAUT:"perk_health",PERK_PLAYER_GHOST:"perk_ghost",PERK_PLAYER_COLD_BLOODED:"perk_cold_blooded",PERK_PLAYER_SPECIALIST:"perk_recovery",PERK_PLAYER_SITREP:"perk_sitrep",PERK_PLAYER_MARTYRDOM:"perk_martyrdom",PERK_PLAYER_HELMET:"perk_helmet",PERK_PLAYER_NINJA:"perk_ninja",PERK_PLAYER_SCAVENGER:"perk_scavenger",PERK_PLAYER_ANTI_SNIPER:"perk_anti_sniper",PERK_WEAPON_RELOAD:"perk_reload",PERK_WEAPON_QUICKDRAW:"perk_aim",PERK_WEAPON_ACCURACY:"perk_accuracy",PERK_WEAPON_AMMO:"perk_ammo",PERK_WEAPON_OVERKILL:"perk_overkill",PERK_WEAPON_AGGRESSION:"perk_power",PERK_WEAPON_RECON:"perk_recon",PERK_WEAPON_STOPPING_POWER:"perk_freeze",PERK_WEAPON_SHRAPNEL:"perk_shrapnel",PERK_WEAPON_VAMPIRE:"perk_vampire"},Mods={TYPE_BASE:"base",TYPE_AMMO:"ammo",TYPE_BARREL:"barrel",BASE_DEADEYE:"base_marksman",BASE_RAPID_FIRE:"base_rapid_fire",BASE_LOCK_ON:"base_lock_on",BASE_DAMPER:"base_damper",BASE_SPEED:"base_speed",BASE_RANGE:"base_range",BASE_BURST_FIRE:"base_burst_fire",BASE_MODE_SELECTOR:"base_mode_selector",BASE_FULL_AUTO:"base_full_auto",BASE_SINGLE_FIRE:"base_single_fire",BASE_SHIELD_DAMAGE:"base_shield_damage",BASE_SHIELD_RAPID_FIRE:"base_shield_alloy",AMMO_FMJ:"ammo_fmj",AMMO_PIERCING:"ammo_ap",AMMO_IMPACT:"ammo_impact",AMMO_EXTENDED:"ammo_extended",AMMO_HOLLOW_POINT:"ammo_hollow_point",AMMO_LAUNCHER_RADIUS:"ammo_radius",AMMO_LAUNCHER_EXPLOSIVE:"ammo_explosive",AMMO_SLUG:"ammo_slug",AMMO_SPEED_LOADER:"ammo_speed_loader",AMMO_HIGH_CALIBER:"ammo_range",AMMO_NAPALM:"ammo_napalm",BARREL_SILENCER:"barrel_silencer",BARREL_LASER:"barrel_laser",BARREL_GRIP:"barrel_grip",BARREL_COMPENSATOR:"barrel_compensator",BARREL_BOOSTER:"barrel_booster",BARREL_ACCELERATOR:"barrel_range",BARREL_M203:"barrel_m203",BARREL_GP25:"barrel_gp25",BARREL_MASTERKEY:"barrel_masterkey"},DamageType={DAMAGE_BULLET:1,DAMAGE_MELEE:2,DAMAGE_EXPLOSIVE:3,DAMAGE_FIRE:4,DAMAGE_WORLD:5},Weapon={TYPE_MELEE:"TYPE_MELEE",TYPE_PISTOL:"TYPE_PISTOL",TYPE_MACHINE_PISTOL:"TYPE_MACHINE_PISTOL",TYPE_SMG:"TYPE_SMG",TYPE_SHOTGUN:"TYPE_SHOTGUN",TYPE_SNIPER:"TYPE_SNIPER",TYPE_RIFLE:"TYPE_RIFLE",TYPE_LMG:"TYPE_LMG",TYPE_LAUNCHER:"TYPE_LAUNCHER",TYPE_GRENADE:"TYPE_GRENADE",TYPE_EXPLOSIVE:"TYPE_EXPLOSIVE",TYPE_TACTICAL:"TYPE_TACTICAL",TYPE_WEAPON_TACTICAL:"TYPE_WEAPON_TACTICAL",MODE_AUTO:"MODE_AUTO",MODE_BURST:"MODE_BURST",MODE_SEMI:"MODE_SEMI"},BotSkill={SKILL_EASY:0,SKILL_NORMAL:1,SKILL_HARD:2,SKILL_INSANE:3,SKILL_GOD:4},Helicopter={TYPE_MH6:"mh6",TYPE_MH6_ATTACK:"mh6_attack",TYPE_MH6_GRENADE:"mh6_grenade",TYPE_COBRA:"cobra",TYPE_COBRA_CONTROLLABLE:"cobra_controllable",TYPE_BLACKHAWK:"blackhawk",TYPE_BLACKHAWK_SNIPER:"blackhawk_sniper",TYPE_PAVE_LOW:"pavelow",TYPE_OSPREY:"osprey",TYPE_REAPER:"reaper",TYPE_DRAGONFIRE:"dragonfire",TYPE_SCOUT:"scout"},Turret={TYPE_SAM:"sam",TYPE_SENTRY:"sentry",TYPE_REMOTE:"remote_sentry",TYPE_BALLISTIC:"advanced_sentry",TYPE_GRENADE:"grenade_sentry"},Crate={CRATE_STORE:"CRATE_STORE",CRATE_AMMO:"CRATE_AMMO",CRATE_DECOY:"CRATE_DECOY",CRATE_KILLSTREAK:"CRATE_KILLSTREAK",CRATE_WEAPON:"CRATE_WEAPON",CRATE_PERK:"CRATE_PERK",CRATE_BOMB:"CRATE_BOMB",CRATE_BOMB_GENERIC:"CRATE_BOMB_GENERIC",CRATE_SHARD:"CRATE_SHARD",CRATE_XP:"CRATE_XP",CRATE_LIFE:"CRATE_LIFE"},Zombie={TYPE_DEFAULT:"zombie_default",TYPE_FAT:"zombie_fat",TYPE_EXPLODER:"zombie_exploder",TYPE_EXPLODER_BOSS:"zombie_exploder_boss",TYPE_SPITTER:"zombie_spitter",TYPE_SPITTER_BOSS:"zombie_spitter_boss",TYPE_SPRINTER:"zombie_sprinter",TYPE_SPRINTER_BOSS:"zombie_sprinter_boss"},Heroes={XWILKINX:"HERO_XWILKINX",MOUSSA:"HERO_MOUSSA",OBSV32:"HERO_OBSV32",GHOSTMIAMI:"HERO_GHOSTMIAMI",ARI:"HERO_ARI",CARMELFIRE:"HERO_CARMELFIRE",VALIANT25:"HERO_VALIANT25",KARAMBITGUY:"HERO_KARAMBITGUY",CHRIST:"HERO_CHRIST",TWOPLAYER:"HERO_TWOPLAYER",ERIC:"HERO_ERIC"},SurvivalEnemyType={HELI_MH6:"HELI_MH6",HELI_COBRA:"HELI_COBRA",HELI_PAVE_LOW:"HELI_PAVE_LOW",HELI_SCOUT:"HELI_SCOUT",HELI_OSPREY:"HELI_OSPREY",HELI_CHOPPER_GUNNER:"HELI_CHOPPER_GUNNER",HELI_SNIPER:"HELI_SNIPER",HELI_DRAGONFIRE:"HELI_DRAGONFIRE",HELI_REAPER:"HELI_REAPER",INFESTOR:"INFESTOR",INFESTOR_KING:"INFESTOR_KING",ZOMBIE_DEFAULT:"ZOMBIE_DEFAULT",ZOMBIE_MELEE:"ZOMBIE_MELEE",ZOMBIE_SPRINTER:"ZOMBIE_SPRINTER",ZOMBIE_SPRINTER_MELEE:"ZOMBIE_SPRINTER_MELEE",ZOMBIE_SPRINTER_BOSS:"ZOMBIE_SPRINTER_BOSS",ZOMBIE_FAT:"ZOMBIE_FAT",ZOMBIE_FAT_THUMPER:"ZOMBIE_FAT_THUMPER",ZOMBIE_JUGGERNAUT:"ZOMBIE_JUGGERNAUT",ZOMBIE_JUGGERNAUT_MERC:"ZOMBIE_JUGGERNAUT_MERC",ZOMBIE_EXPLODER:"ZOMBIE_EXPLODER",ZOMBIE_EXPLODER_BOSS:"ZOMBIE_EXPLODER_BOSS",ZOMBIE_SPITTER:"ZOMBIE_SPITTER",ZOMBIE_SPITTER_BOSS:"ZOMBIE_SPITTER_BOSS",ZOMBIE_RPG:"ZOMBIE_RPG",ZOMBIE_RIFLE:"ZOMBIE_RIFLE",ZOMBIE_SHIELD:"ZOMBIE_SHIELD",OPFOR_PISTOL:"OPFOR_PISTOL",OPFOR_BASIC:"OPFOR_BASIC",OPFOR_HEAVY:"OPFOR_HEAVY",OPFOR_RPG:"OPFOR_RPG",RUS_BASIC:"RUS_BASIC",RUS_HARD:"RUS_HARD",RUS_EXPERT:"RUS_EXPERT",RUS_SNIPER:"RUS_SNIPER",RUS_CLAYMORE:"RUS_CLAYMORE",RUS_MERC:"RUS_MERC",RUS_RPG:"RUS_RPG",RUS_SHIELD:"RUS_SHIELD",RUS_MELEE:"RUS_MELEE",RUS_EXPLOSIVES:"RUS_EXPLOSIVES",USMC_BASIC:"USMC_BASIC",USMC_HARD:"USMC_HARD",USMC_HEAVY:"USMC_HEAVY",USMC_SNIPER:"USMC_SNIPER",GSG9_BASIC:"GSG9_BASIC",GSG9_HARD:"GSG9_HARD",GSG9_HEAVY:"GSG9_HEAVY",GSG9_SNIPER:"GSG9_SNIPER",GIGN_BASIC:"GIGN_BASIC",GIGN_HARD:"GIGN_HARD",GIGN_HEAVY:"GIGN_HEAVY",GIGN_SNIPER:"GIGN_SNIPER",JUGGERNAUT:"JUGGERNAUT",JUGGERNAUT_JAVELIN:"JUGGERNAUT_JAVELIN",JUGGERNAUT_COMMANDER:"JUGGERNAUT_COMMANDER",JUGGERNAUT_MERC:"JUGGERNAUT_MERC",TURRET_SENTRY:"TURRET_SENTRY",TURRET_SAM:"TURRET_SAM",HOSTAGE:"HOSTAGE",VIP:"VIP"},SurvivalEnemyInfo={HERO_XWILKINX:{pawnName:"XWILKINX",health:400,weapons:["sr25"],mods:{base:Mods.BASE_RANGE,barrel:Mods.BARREL_LASER,ammo:Mods.AMMO_HOLLOW_POINT},secondaryWeapons:["m202"],equipment:"frag",damageMultipliers:{2:.5,1:.1,3:.5,4:.5},perks:[Perks.PERK_PLAYER_SPECIALIST,Perks.PERK_WEAPON_RELOAD],eyewear:Character.EYEWEAR_GOGGLES_ORANGE,facewear:Character.FACEWEAR_MASK,heads:[Character.HEAD_NIGHTVISION],body:Character.BODY_USMC_KEVLAR,botSkill:BotSkill.SKILL_GOD,killReward:2e3,bHero:!0},HERO_ARI:{pawnName:"Ari",health:400,damageMultipliers:{2:1,1:.5,3:1},weapons:["pgm"],mods:{base:Mods.BASE_RANGE,barrel:Mods.BARREL_ACCELERATOR,ammo:Mods.AMMO_HIGH_CALIBER},secondaryWeapons:["fal"],equipment:"knife",perks:[Perks.PERK_PLAYER_ANTI_SNIPER],faces:[Character.FACE_FEMALE],heads:[Character.HEAD_RUS_TOQUE],body:Character.BODY_GIGN_STANDARD,hair:Character.HAIR_PONYTAIL,hairColour:Character.HAIR_COLOUR_BLUE,botSkill:BotSkill.SKILL_INSANE,killReward:1e3,bHero:!0},HERO_MOUSSA:{pawnName:"Moussa",health:400,damageMultipliers:{2:1,1:.5,3:1},weapons:["acr"],mods:{base:Mods.BASE_RANGE,barrel:Mods.BARREL_LASER,ammo:Mods.AMMO_FMJ},secondaryWeapons:["l115a3"],equipment:"knife",perks:[Perks.PERK_PLAYER_LIGHTWEIGHT],heads:[Character.HEAD_GSG9_HELMET_2],body:Character.BODY_GSG9_HEAVY,botSkill:BotSkill.SKILL_INSANE,killReward:1e3,bHero:!0},HERO_OBSV32:{pawnName:"Peacekeeper",health:400,damageMultipliers:{2:1,1:.5,3:1},weapons:["ump45"],mods:{base:Mods.BASE_RAPID_FIRE,barrel:Mods.BARREL_GRIP,ammo:Mods.AMMO_HOLLOW_POINT},perks:[Perks.PERK_PLAYER_SPECIALIST,Perks.PERK_WEAPON_AGGRESSION],secondaryWeapons:["mgl"],equipment:"semtex",heads:[Character.HEAD_RADIO],body:Character.BODY_GIGN_HEAVY,botSkill:BotSkill.SKILL_INSANE,killReward:1e3,bHero:!0},HERO_GHOSTMIAMI:{pawnName:"GhostMiami",health:400,damageMultipliers:{2:1,1:.5,3:1},weapons:["l115a3"],mods:{base:Mods.BASE_RANGE,barrel:Mods.BARREL_LASER,ammo:Mods.AMMO_HOLLOW_POINT},secondaryWeapons:["tazer"],equipment:"stim",perks:[Perks.PERK_PLAYER_COLD_BLOODED,Perks.PERK_WEAPON_RECON],heads:[Character.HEAD_MILITIA_SNIPER],body:Character.BODY_MILITIA_STANDARD,botSkill:BotSkill.SKILL_INSANE,killReward:1e3,hair:Character.HAIR_LONG,hairColour:Character.HAIR_COLOUR_BLONDE,bHero:!0},HERO_CARMELFIRE:{pawnName:"Carmelfire",health:400,damageMultipliers:{2:1,1:.5,3:1},weapons:["hk416"],mods:{base:Mods.BASE_RANGE,barrel:Mods.BARREL_LASER,ammo:Mods.AMMO_FMJ},secondaryWeapons:["p320"],equipment:"c4",perks:[Perks.PERK_PLAYER_MARTYRDOM,Perks.PERK_WEAPON_VAMPIRE],heads:[Character.HEAD_GSG9_HELMET],body:Character.BODY_GSG9_RECON,botSkill:BotSkill.SKILL_INSANE,killReward:1e3,bHero:!0},HERO_VALIANT25:{pawnName:"Touhou Hijack",health:400,damageMultipliers:{2:1,1:.5,3:1},weapons:["famas"],secondaryWeapons:["mgl"],mods:{base:Mods.BASE_FULL_AUTO,barrel:Mods.BARREL_LASER,ammo:Mods.AMMO_FMJ},equipment:"semtex",heads:[Character.HEAD_RADIO],body:Character.BODY_GSG9_HEAVY,botSkill:BotSkill.SKILL_INSANE,killReward:1e3,bHero:!0},HERO_KARAMBITGUY:{pawnName:"Yung Wulf",health:400,damageMultipliers:{2:1,1:.5,3:1},weapons:["fal"],secondaryWeapons:["rhino"],mods:{base:Mods.BASE_RANGE,barrel:Mods.BARREL_LASER,ammo:Mods.AMMO_FMJ},equipment:"knife",perks:[Perks.PERK_PLAYER_JUGGERNAUT,Perks.PERK_WEAPON_VAMPIRE],heads:[Character.HEAD_RUS_HAT],body:Character.BODY_RUS_STANDARD,botSkill:BotSkill.SKILL_INSANE,killReward:1e3,bHero:!0},HERO_CHRIST:{pawnName:"Wild West Wrangler",health:400,damageMultipliers:{2:1,1:.5,3:1},weapons:["db"],secondaryWeapons:["magnum"],mods:{base:Mods.BASE_SPEED,barrel:Mods.BARREL_LASER,ammo:Mods.AMMO_FMJ},equipment:"smoke",heads:[Character.HEAD_MILITIA_BANDANA],body:Character.BODY_MILITIA_STANDARD,botSkill:BotSkill.SKILL_INSANE,killReward:1e3,bHero:!0},HERO_TWOPLAYER:{pawnName:"Arachnid",health:400,damageMultipliers:{2:1,1:.5,3:1},weapons:["intervention"],secondaryWeapons:["deagle"],mods:{base:Mods.BASE_RANGE,barrel:Mods.BARREL_ACCELERATOR,ammo:Mods.AMMO_HIGH_CALIBER},perks:[Perks.PERK_PLAYER_JUGGERNAUT,Perks.PERK_WEAPON_VAMPIRE],equipment:"stim",heads:[Character.HEAD_NONE],faces:[Character.FACE_DEFAULT],facewear:Character.FACEWEAR_TWOPLAYER,hair:Character.HAIR_STYLED,hairColour:Character.HAIR_COLOUR_BROWN,beard:Character.BEARD_NONE,body:Character.BODY_GSG9_STANDARD,botSkill:BotSkill.SKILL_INSANE,killReward:1e3,bHero:!0},HERO_ERIC:{pawnName:"Eric",health:400,damageMultipliers:{2:1,1:.5,3:1},weapons:["sr25"],secondaryWeapons:["stinger"],mods:{base:Mods.BASE_RANGE,barrel:Mods.BARREL_LASER,ammo:Mods.AMMO_FMJ},equipment:"trophy",heads:[Character.HEAD_ERIC_HELMET],faces:[Character.FACE_DEFAULT],perks:[Perks.PERK_PLAYER_SPECIALIST,Perks.PERK_WEAPON_SHRAPNEL],hair:Character.HAIR_SHORT,hairColour:Character.HAIR_COLOUR_BLACK,beard:Character.BEARD_STUBBLE,body:Character.BODY_JUGGERNAUT,botSkill:BotSkill.SKILL_INSANE,killReward:1e3,bHero:!0},TURRET_SENTRY:{type:"turret",turretType:Turret.TYPE_SENTRY,killReward:100},TURRET_SAM:{type:"turret",turretType:Turret.TYPE_SAM,killReward:100},HELI_MH6:{type:"helicopter",helicopterType:Helicopter.TYPE_MH6_ATTACK,killReward:250},HELI_MH6_UPGRADED:{type:"helicopter",helicopterType:Helicopter.TYPE_MH6_GRENADE,killReward:500},HELI_COBRA:{type:"helicopter",helicopterType:Helicopter.TYPE_COBRA,killReward:500},HELI_COBRA_UPGRADED:{type:"helicopter",helicopterType:Helicopter.TYPE_COBRA_CONTROLLABLE,killReward:500},HELI_PAVE_LOW:{type:"helicopter",helicopterType:Helicopter.TYPE_PAVE_LOW,killReward:1e3},HELI_SCOUT:{type:"helicopter",helicopterType:Helicopter.TYPE_SCOUT,killReward:500},HELI_OSPREY:{type:"helicopter",helicopterType:Helicopter.TYPE_OSPREY,killReward:1e3},HELI_CHOPPER_GUNNER:{type:"helicopter",helicopterType:Helicopter.TYPE_BLACKHAWK,killReward:500},HELI_SNIPER:{type:"helicopter",helicopterType:Helicopter.TYPE_BLACKHAWK_SNIPER,killReward:500},HELI_DRAGONFIRE:{type:"helicopter",helicopterType:Helicopter.TYPE_DRAGONFIRE,killReward:200},HELI_REAPER:{type:"helicopter",helicopterType:Helicopter.TYPE_REAPER,killReward:1e3},INFESTOR:{type:"infestor",infestorType:"infestor",health:300,botSkill:BotSkill.SKILL_HARD,killReward:150,damageMultipliers:{1:.75,4:.5}},INFESTOR_KING:{type:"infestor",infestorType:"infestor_king",health:1e3,botSkill:BotSkill.SKILL_INSANE,killReward:500,damageMultipliers:{1:.1,4:.5}},ZOMBIE_DEFAULT:{zombieType:Zombie.TYPE_DEFAULT,health:80,weapons:["zombie"],faces:[Character.FACE_ZOMBIE_1,Character.FACE_ZOMBIE_2,Character.FACE_ZOMBIE_3,Character.FACE_ZOMBIE_4],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE,botSkill:BotSkill.SKILL_NORMAL,killReward:50,baseSpeedMultiplier:.6},ZOMBIE_MELEE:{zombieType:Zombie.TYPE_DEFAULT,health:100,weapons:["melee_machete","melee_bowie","melee_hatchet"],faces:[Character.FACE_ZOMBIE_1,Character.FACE_ZOMBIE_2,Character.FACE_ZOMBIE_3,Character.FACE_ZOMBIE_4],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE,botSkill:BotSkill.SKILL_INSANE,killReward:100,baseSpeedMultiplier:.6},ZOMBIE_SPRINTER:{zombieType:Zombie.TYPE_SPRINTER,health:50,weapons:["zombie_sprinter"],faces:[Character.FACE_ZOMBIE_SPRINTER],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE_SPRINTER,botSkill:BotSkill.SKILL_HARD,killReward:100},ZOMBIE_SPRINTER_MELEE:{zombieType:Zombie.TYPE_SPRINTER,health:50,weapons:["melee_knife","melee_bowie","melee_machete","melee_katana"],faces:[Character.FACE_ZOMBIE_SPRINTER],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE_SPRINTER,botSkill:BotSkill.SKILL_INSANE,killReward:200},ZOMBIE_SPRINTER_BOSS:{zombieType:Zombie.TYPE_SPRINTER_BOSS,health:350,weapons:["zombie_sprinter_boss"],faces:[Character.FACE_ZOMBIE_SPRINTER_BOSS],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE_SPRINTER_BOSS,botSkill:BotSkill.SKILL_INSANE,killReward:200},ZOMBIE_FAT:{zombieType:Zombie.TYPE_FAT,health:700,weapons:["zombie_fat","melee_machete","melee_hatchet","melee_shovel"],faces:[Character.FACE_ZOMBIE_FAT],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE_FAT,botSkill:BotSkill.SKILL_NORMAL,killReward:200,baseSpeedMultiplier:.5,damageMultipliers:{2:.5}},ZOMBIE_FAT_THUMPER:{zombieType:Zombie.TYPE_FAT,health:700,weapons:["thumper","m1014","m3","jackhammer"],faces:[Character.FACE_ZOMBIE_FAT],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE_FAT,botSkill:BotSkill.SKILL_INSANE,killReward:200,baseSpeedMultiplier:.5,damageMultipliers:{2:.5}},ZOMBIE_JUGGERNAUT:{zombieType:Zombie.TYPE_FAT,health:500,weapons:["striker","spas12","m240","m82"],secondaryWeapons:["smaw"],equipment:"knife",heads:[Character.HEAD_NONE],faces:[Character.FACE_ZOMBIE_FAT],body:Character.BODY_JUGGERNAUT,botSkill:BotSkill.SKILL_INSANE,damageMultipliers:{1:.35,2:.5,4:.5},killReward:500,maxSpeed:150},ZOMBIE_EXPLODER:{zombieType:Zombie.TYPE_EXPLODER,health:120,weapons:["zombie_exploder"],faces:[Character.FACE_ZOMBIE_EXPLODER],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE_EXPLODER,botSkill:BotSkill.SKILL_INSANE,killReward:100},ZOMBIE_EXPLODER_BOSS:{zombieType:Zombie.TYPE_EXPLODER_BOSS,health:300,weapons:["zombie_exploder_boss"],faces:[Character.FACE_ZOMBIE_EXPLODER],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE_EXPLODER_BOSS,botSkill:BotSkill.SKILL_INSANE,killReward:250},ZOMBIE_SPITTER:{zombieType:Zombie.TYPE_SPITTER,health:80,weapons:["zombie_spitter"],faces:[Character.FACE_ZOMBIE_SPITTER],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE_SPITTER,botSkill:BotSkill.SKILL_NORMAL,killReward:100},ZOMBIE_SPITTER_BOSS:{zombieType:Zombie.TYPE_SPITTER_BOSS,health:400,weapons:["zombie_spitter_boss"],faces:[Character.FACE_ZOMBIE_SPITTER_BOSS],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE_SPITTER_BOSS,botSkill:BotSkill.SKILL_HARD,killReward:250,baseSpeedMultiplier:.7},ZOMBIE_RPG:{zombieType:Zombie.TYPE_DEFAULT,health:100,weapons:["rpg"],faces:[Character.FACE_ZOMBIE_1,Character.FACE_ZOMBIE_2,Character.FACE_ZOMBIE_3,Character.FACE_ZOMBIE_4],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE,botSkill:BotSkill.SKILL_INSANE,killReward:100,baseSpeedMultiplier:.6},ZOMBIE_RIFLE:{zombieType:Zombie.TYPE_DEFAULT,health:100,weapons:["ak47","rpk","dragunov"],faces:[Character.FACE_ZOMBIE_1,Character.FACE_ZOMBIE_2,Character.FACE_ZOMBIE_3,Character.FACE_ZOMBIE_4],heads:[Character.HEAD_NONE],body:Character.BODY_ZOMBIE,botSkill:BotSkill.SKILL_NORMAL,killReward:100,baseSpeedMultiplier:.6},ZOMBIE_SHIELD:{zombieType:Zombie.TYPE_DEFAULT,health:200,weapons:["riot_shield"],faces:[Character.FACE_ZOMBIE_1,Character.FACE_ZOMBIE_2,Character.FACE_ZOMBIE_3,Character.FACE_ZOMBIE_4],heads:[Character.HEAD_RIOT_HELMET],body:Character.BODY_ZOMBIE,botSkill:BotSkill.SKILL_INSANE,killReward:200,baseSpeedMultiplier:.6},OPFOR_PISTOL:{health:50,weapons:["g17","m9"],heads:[Character.HEAD_OPFOR_SCARF],body:Character.BODY_OPFOR_STANDARD,botSkill:BotSkill.SKILL_EASY,killReward:50},OPFOR_BASIC:{health:50,weapons:["mp5","mpa57","ak74u","g18","mac11","uzi"],heads:[Character.HEAD_OPFOR_SCARF],body:Character.BODY_OPFOR_RECON,botSkill:BotSkill.SKILL_EASY,killReward:50},OPFOR_HEAVY:{health:100,weapons:["mg4","rpk","ak47","m47","m1014"],heads:[Character.HEAD_OPFOR_HELMET,Character.HEAD_OPFOR_HELMET_2],body:Character.BODY_OPFOR_HEAVY,botSkill:BotSkill.SKILL_NORMAL,killReward:100},OPFOR_RPG:{health:100,weapons:["rpg"],heads:[Character.HEAD_OPFOR_COMMANDER],body:Character.BODY_OPFOR_ROCKETIER,botSkill:BotSkill.SKILL_INSANE,killReward:200},RUS_BASIC:{health:100,weapons:["fiveseven","fmg9","mp9","ak74u","mp5","uzi","micro_uzi"],heads:[Character.HEAD_RUS_TOQUE],body:Character.BODY_RUS_STANDARD,botSkill:BotSkill.SKILL_EASY,killReward:50},RUS_HARD:{health:125,weapons:["mp7","ak47","tar21","pecheneg","qbb95","bizon","m240"],heads:[Character.HEAD_RUS_MASK],body:Character.BODY_RUS_RECON,botSkill:BotSkill.SKILL_NORMAL,killReward:100},RUS_EXPERT:{health:150,weapons:["scarh","hk416","aughbar","msg90","samr","m16a4","ak47","hamr","acr","aug","fal","lvoa"],equipment:"stun",heads:[Character.HEAD_RUS_HELMET],body:Character.BODY_RUS_HEAVY,botSkill:BotSkill.SKILL_HARD,killReward:150},RUS_SNIPER:{health:100,weapons:["m40a3"],heads:[Character.HEAD_RUS_RECON],facewear:Character.FACEWEAR_MASK,body:Character.BODY_RUS_PARA,botSkill:BotSkill.SKILL_INSANE,killReward:200},RUS_CLAYMORE:{health:100,weapons:["usp45"],equipment:"claymore",heads:[Character.HEAD_RUS_SCARF],body:Character.BODY_RUS_STANDARD,botSkill:BotSkill.SKILL_HARD,killReward:150},RUS_MERC:{health:200,weapons:["g36c","an94","pdr","sg550","sr25","ultimax","ak47","rsass","lvoa"],heads:[Character.HEAD_ALTYN_HELMET],facewear:Character.FACEWEAR_MASK,body:Character.BODY_RUS_HEAVY,botSkill:BotSkill.SKILL_INSANE,killReward:200},RUS_RPG:{health:200,weapons:["rpg","m202"],heads:[Character.HEAD_RUS_BERET],facewear:Character.FACEWEAR_BALACLAVA,body:Character.BODY_RUS_ROCKETIER,botSkill:BotSkill.SKILL_INSANE,killReward:200},RUS_SHIELD:{health:100,weapons:["riot_shield"],heads:[Character.HEAD_RIOT_HELMET],facewear:Character.FACEWEAR_MASK,body:Character.BODY_RUS_STANDARD,botSkill:BotSkill.SKILL_INSANE,killReward:200,damageMultipliers:{4:.5}},RUS_MELEE:{health:300,weapons:["melee_machete"],secondaryWeapons:["melee_machete"],heads:[Character.HEAD_BALLISTIC_MASK_WHITE],facewear:Character.FACEWEAR_MASK,body:Character.BODY_RUS_BARE,botSkill:BotSkill.SKILL_INSANE,killReward:200},JUGGERNAUT_COMMANDER:{health:600,weapons:["r700","msg90","msr","deagle","magnum","m82","rhino","intervention"],secondaryWeapons:["smaw"],equipment:"flashbang",heads:[Character.HEAD_RUS_BERET],body:Character.BODY_JUGGERNAUT,botSkill:BotSkill.SKILL_INSANE,damageMultipliers:{1:.35,2:.5,4:.5},killReward:500,maxSpeed:150},RUS_EXPLOSIVES:{health:200,weapons:["xm25","m202"],equipment:"frag",heads:[Character.HEAD_JUGGERNAUT_HELMET],body:Character.BODY_RUS_STANDARD,botSkill:BotSkill.SKILL_INSANE,killReward:200},JUGGERNAUT:{health:500,weapons:["m60e4","m1014","m3","l115a3","m240"],secondaryWeapons:["smaw"],equipment:"frag",heads:[Character.HEAD_JUGGERNAUT_HELMET],body:Character.BODY_JUGGERNAUT,botSkill:BotSkill.SKILL_HARD,damageMultipliers:{1:.35,2:.5,4:.5},killReward:500,maxSpeed:140},JUGGERNAUT_MERC:{health:500,weapons:["m60e4","m249","m240","striker","m1014","m3","l115a3","msg90","rpk","lvoa"],secondaryWeapons:["riot_shield"],equipment:"frag",heads:[Character.HEAD_JUGGERNAUT_HELMET],body:Character.BODY_JUGGERNAUT,botSkill:BotSkill.SKILL_INSANE,damageMultipliers:{1:.5,2:1,4:.5},killReward:1e3,maxSpeed:160},ZOMBIE_JUGGERNAUT_MERC:{zombieType:Zombie.TYPE_FAT,health:500,weapons:["melee_katana"],heads:[Character.HEAD_NONE],faces:[Character.FACE_ZOMBIE_FAT],body:Character.BODY_JUGGERNAUT,botSkill:BotSkill.SKILL_INSANE,damageMultipliers:{1:.5,2:1,4:.5},killReward:1e3,maxSpeed:220},JUGGERNAUT_JAVELIN:{health:500,weapons:["javelin"],equipment:"trophy",heads:[Character.HEAD_JUGGERNAUT_HELMET],body:Character.BODY_JUGGERNAUT,botSkill:BotSkill.SKILL_HARD,damageMultipliers:{1:.35,2:.5,4:.5},killReward:500,maxSpeed:140},USMC_BASIC:{health:100,weapons:["m16a4","m4a1","tar21","mp5","m9","p320","m1911","m93r"],heads:[Character.HEAD_USMC_HELMET_TACTICAL],body:Character.BODY_USMC_STANDARD,botSkill:BotSkill.SKILL_NORMAL,killReward:100},USMC_HARD:{health:150,weapons:["acr","samr","sr25","honeybadger","arp"],heads:[Character.HEAD_RADIO],body:Character.BODY_USMC_RECON,botSkill:BotSkill.SKILL_HARD,killReward:200},USMC_HEAVY:{health:300,weapons:["m249","m60e4","m1014","ksg"],heads:[Character.HEAD_USMC_HELMET_TACTICAL],body:Character.BODY_USMC_HEAVY,botSkill:BotSkill.SKILL_HARD,killReward:200},USMC_SNIPER:{health:100,weapons:["r700","m40a3"],heads:[Character.HEAD_USMC_GHILLIE],body:Character.BODY_USMC_GHILLIE,botSkill:BotSkill.SKILL_INSANE,facewear:Character.FACEWEAR_MASK,killReward:200},GSG9_BASIC:{health:100,weapons:["mp5","ump45","fiveseven","g17","usp45","m9","p320"],heads:[Character.HEAD_GSG9_HELMET,Character.HEAD_GSG9_HELMET_2,Character.HEAD_GSG9_HELMET_3],body:Character.BODY_GSG9_STANDARD,botSkill:BotSkill.SKILL_NORMAL,killReward:100},GSG9_HARD:{health:150,weapons:["mp7","evo3","p90","hk416","scarh","aug","fal"],heads:[Character.HEAD_GSG9_HELMET,Character.HEAD_GSG9_HELMET_2,Character.HEAD_GSG9_HELMET_3],body:Character.BODY_GSG9_TACTICAL,botSkill:BotSkill.SKILL_HARD,killReward:200},GSG9_HEAVY:{health:300,weapons:["m249","m60e4","m1014","ksg"],heads:[Character.HEAD_GSG9_HELMET,Character.HEAD_GSG9_HELMET_2,Character.HEAD_GSG9_HELMET_3],body:Character.BODY_GSG9_HEAVY,botSkill:BotSkill.SKILL_HARD,killReward:200},GSG9_SNIPER:{health:100,weapons:["msg90","r700","msr"],heads:[Character.HEAD_RADIO],body:Character.BODY_GSG9_RECON,botSkill:BotSkill.SKILL_INSANE,killReward:200},GIGN_BASIC:{health:100,weapons:["mp5","ump45","fiveseven","g17","usp45","m9","p320","famas"],heads:[Character.HEAD_GIGN_HELMET,Character.HEAD_GIGN_HELMET_2],body:Character.BODY_GIGN_STANDARD,botSkill:BotSkill.SKILL_NORMAL,killReward:100},GIGN_HARD:{health:150,weapons:["mp7","evo3","p90","hk416","scarh","aug","fal","famas"],heads:[Character.HEAD_GIGN_HELMET,Character.HEAD_GIGN_HELMET_2],body:Character.BODY_GIGN_TACTICAL,botSkill:BotSkill.SKILL_HARD,killReward:200},GIGN_HEAVY:{health:300,weapons:["m249","m60e4","m1014","spas12","hamr"],heads:[Character.HEAD_GIGN_HELMET,Character.HEAD_GIGN_HELMET_2],body:Character.BODY_GIGN_HEAVY,botSkill:BotSkill.SKILL_HARD,killReward:200},GIGN_SNIPER:{health:100,weapons:["l115a3","r700","msr"],heads:[Character.HEAD_RADIO],body:Character.BODY_GIGN_RECON,botSkill:BotSkill.SKILL_INSANE,killReward:200},HOSTAGE:{health:200,weapons:["none"],heads:[Character.HEAD_NONE],body:Character.BODY_HOSTAGE,botSkill:BotSkill.SKILL_NORMAL,killReward:0,bRegenHealth:!0,bHostage:!0,maxSpeed:200},VIP:{pawnName:"VIP",health:200,weapons:["p320"],heads:[Character.HEAD_NONE],hairColour:Character.HAIR_COLOUR_BROWN,body:Character.BODY_VIP,botSkill:BotSkill.SKILL_HARD,killReward:200,bRegenHealth:!0},DUMMY:{pawnName:"Dummy",health:200,weapons:["m40a3","m4a1","mp5","m9","riot_shield"],heads:[Character.HEAD_NONE],body:Character.BODY_MILITIA_STANDARD,botSkill:BotSkill.SKILL_HARD,killReward:100,bRegenHealth:!0,bDummy:!0},DUMMY_JUGGERNAUT:{pawnName:"Dummy (Juggernaut)",health:300,perks:[Perks.PERK_PLAYER_JUGGERNAUT],weapons:["m40a3","m4a1","mp5","m9","riot_shield"],heads:[Character.HEAD_NONE],body:Character.BODY_MILITIA_STANDARD,botSkill:BotSkill.SKILL_HARD,killReward:100,bRegenHealth:!0,bDummy:!0},DUMMY_HELMET:{pawnName:"Dummy (Hard-Headed)",health:200,perks:[Perks.PERK_PLAYER_HELMET],weapons:["m40a3","m4a1","mp5","m9","riot_shield"],heads:[Character.HEAD_NONE],body:Character.BODY_MILITIA_STANDARD,botSkill:BotSkill.SKILL_HARD,killReward:100,bRegenHealth:!0,bDummy:!0},DUMMY_SPECIALIST:{pawnName:"Dummy (Specialist)",health:200,perks:[Perks.PERK_PLAYER_SPECIALIST],weapons:["m40a3","m4a1","mp5","m9","riot_shield"],heads:[Character.HEAD_NONE],body:Character.BODY_MILITIA_STANDARD,botSkill:BotSkill.SKILL_HARD,killReward:100,bRegenHealth:!0,bDummy:!0},DUMMY_ANTI_SNIPER:{pawnName:"Dummy (Anti-Sniper)",health:200,perks:[Perks.PERK_PLAYER_ANTI_SNIPER],weapons:["m40a3","m4a1","mp5","m9","riot_shield"],heads:[Character.HEAD_NONE],body:Character.BODY_MILITIA_STANDARD,botSkill:BotSkill.SKILL_HARD,killReward:100,bRegenHealth:!0,bDummy:!0},DUMMY_SITREP:{pawnName:"Dummy (SitRep)",health:200,perks:[Perks.PERK_PLAYER_SITREP],weapons:["m40a3","m4a1","mp5","m9","riot_shield"],heads:[Character.HEAD_NONE],body:Character.BODY_MILITIA_STANDARD,botSkill:BotSkill.SKILL_HARD,killReward:100,bRegenHealth:!0,bDummy:!0}},FeedItem={TYPE_MESSAGE:"message",TYPE_KILL:"kill",TYPE_CHAT:"chat"},Killstreaks={TYPE_ASSAULT:"TYPE_ASSAULT",TYPE_SUPPORT:"TYPE_SUPPORT",TYPE_PERKS:"TYPE_SPECIALIST",KILLSTREAK_SAM_TURRET_PLACE:"sam_turret_place",KILLSTREAK_SENTRY_GUN_PLACE:"sentry_gun_place",KILLSTREAK_UAV:"uav",KILLSTREAK_UAV_SUPPORT:"uav_support",KILLSTREAK_COUNTER_UAV:"counter_uav",KILLSTREAK_CARE_PACKAGE:"care_package",KILLSTREAK_SUPPORT_AIRDROP:"support_airdrop",KILLSTREAK_WEAPON:"weapon",KILLSTREAK_WEAPON_M202:"weapon_m202",KILLSTREAK_PERK:"perk",KILLSTREAK_AMMO:"ammo",KILLSTREAK_SENTRY_GUN:"sentry_gun",KILLSTREAK_SAM_TURRET:"sam_turret",KILLSTREAK_HELLFIRE:"hellfire",KILLSTREAK_AIRSTRIKE:"airstrike",KILLSTREAK_BOMBARDMENT:"airstrike_survival",KILLSTREAK_NAPALM:"airstrike_napalm",KILLSTREAK_REMOTE_TURRET:"remote_turret_place",KILLSTREAK_ADVANCED_TURRET:"advanced_turret_place",KILLSTREAK_GRENADE_TURRET:"grenade_turret_place",KILLSTREAK_COBRA:"cobra",KILLSTREAK_COBRA_CONTROLLABLE:"cobra_controllable",KILLSTREAK_MH6:"mh6",KILLSTREAK_MH6_GRENADE:"mh6_grenade",KILLSTREAK_PAVE_LOW:"pave_low",KILLSTREAK_CHOPPER_GUNNER:"chopper_gunner",KILLSTREAK_REAPER:"reaper",KILLSTREAK_DRAGONFIRE:"dragonfire",KILLSTREAK_SCOUT:"scout",KILLSTREAK_DECOY:"decoy",KILLSTREAK_HELI_SNIPER:"heli_sniper",KILLSTREAK_STEALTH_BOMBER:"stealth_bomber",KILLSTREAK_EMP:"emp",KILLSTREAK_ESCORT_AIRDROP:"escort_airdrop",KILLSTREAK_ESCORT_AIRDROP_SURVIVAL:"escort_airdrop_survival",KILLSTREAK_DEADSWITCH:"deadswitch",KILLSTREAK_JUGGERNAUT:"juggernaut",KILLSTREAK_JUGGERNAUT_RECON:"juggernaut_recon",KILLSTREAK_JUGGERNAUT_USE:"juggernaut_use",KILLSTREAK_JUGGERNAUT_RECON_USE:"juggernaut_recon_use"},CollisionGroups={PAWN:Math.pow(2,0),PAWN_AIR:Math.pow(2,1),GROUND:Math.pow(2,2),PROJECTILE:Math.pow(2,3),PROJECTILE_AIR:Math.pow(2,4),PLATFORM:Math.pow(2,5),SHIELD:Math.pow(2,6),DRONE:Math.pow(2,7),FLAME:Math.pow(2,8)};var p2;class GameInstance{init(e,a,t){this.log("Initialize"),p2=t,this.onEventFunc=a,this.lobbyId=e.lobbyId,this.data=e.data,this.batchData=[],this.localData={settings:{fps:30,fps_mult:.5,fixed_timestep:1/30,fixed_timestep_mult:.5,update_counter_max:5},bPaused:!1,bMultiplayer:!!e.bMultiplayer,bPrivate:!!e.bPrivate,bPerformanceMode:!!e.bPerformanceMode,bFriendlyFire:!e.bSurvival&&e.gameModeId!=GameMode.SANDBOX,bSurvival:!!e.bSurvival,bUseMoneyMultiplier:!1,bRanked:!!e.bRanked,bOperation:!!e.bOperation,bModeGame:e.bRanked&&!e.bOperation&&e.gameModeId!=GameMode.BATTLEZONE,bSandbox:e.gameModeId==GameMode.SANDBOX,bBattlezone:e.gameModeId==GameMode.BATTLEZONE,bCustomGame:!!e.bCustomGame,bKillstreaks:!!e.settings.bKillstreaks,bAutoBalance:!1,bDroppedWeapons:null==e.settings.bDroppedWeapons||e.settings.bDroppedWeapons,bNoSandbags:e.settings.bNoSandbags,factions:e.settings.factions,maxPlayers:e.maxPlayers,mapId:e.mapId,preGameTimer:void 0!==e.settings.preGameTimer?e.settings.preGameTimer:10,matchState:MatchState.STATE_PRE_GAME,playerStates:[],killstreaks:[],toRemove:[],objectsToUpdate:null,world:null,gameModeData:null},this.localData.bPerformanceMode&&!this.localData.bOperation&&this.setLogicFPS(20),this.localData.settings.update_counter_max=Math.ceil(this.localData.settings.update_counter_max*this.localData.settings.fps_mult),console.log(this.localData.settings),this.createWorld(),this.generateMapNodes();var r=this.localData,i=e.settings;void 0!==i.bFriendlyFire&&(this.localData.bFriendlyFire=i.bFriendlyFire);var s={id:e.gameModeId,timeLimit:i.timeLimit?60*i.timeLimit:null,scoreLimit:i.scoreLimit,bUseRoundThreshold:i.bUseRoundThreshold,numRounds:i.numRounds,bAllowRespawns:i.bAllowRespawns,bNoClasses:i.bNoClasses,respawnTime:void 0!==i.respawnTime?i.respawnTime:3,bSpawnProtection:i.bSpawnProtection,bHardcore:i.bHardcore},o=this.getCurrentMapData();switch(this.localData.gameModeData=s,e.gameModeId){case GameMode.INFECTED:s.survivorWeaponId=this.getRandomInfectedWeapon().id;var l=["frag","c4","claymore","betty"];s.survivorEquipmentId=l[this.Random(0,l.length-1)],s.infectedWeapon={id:"zombie_sprinter",mods:{base:Mods.BASE_RAPID_FIRE,ammo:Mods.AMMO_FMJ}},s.infectedEquipment="tac_insert",s.infectedPerks=[Perks.PERK_PLAYER_LIGHTWEIGHT,Perks.PERK_PLAYER_JUGGERNAUT,Perks.PERK_WEAPON_VAMPIRE];break;case GameMode.GUN_GAME:s.killsPerGun=i.killsPerGun,s.weapons=[{id:this.RandomBoolean()?"g17":"m9"},{id:this.RandomBoolean()?"m1911":"usp45"},{id:this.RandomBoolean()?"magnum":"deagle"},{id:this.RandomBoolean()?"m93r":"kard"},{id:this.RandomBoolean()?"g18":"fmg9"},{id:this.RandomBoolean()?"mp5":"mp7"},{id:this.RandomBoolean()?"ak74u":"ump45"},{id:this.RandomBoolean()?"m4a1":"ak47"},{id:this.RandomBoolean()?"famas":"m16a4"},{id:this.RandomBoolean()?"r700":"m40a3"},{id:this.RandomBoolean()?"rsass":"sr25"},{id:this.RandomBoolean()?"m3":"ksg"},{id:this.RandomBoolean()?"m1014":"striker"},{id:this.RandomBoolean()?"m249":"qbb95"},{id:this.RandomBoolean()?"m60e4":"m240"},{id:"thumper"},{id:"rpg"},{id:"riot_shield",mods:{base:Mods.BASE_SPEED}}],i.bReverse&&s.weapons.reverse();break;case GameMode.TEAM_DEATHMATCH:s.scores=[0,0];break;case GameMode.DOMINATION:s.scores=[0,0],this.createFlagDomination(0,5),this.createFlagDomination(1,5),this.createFlagDomination(2,5);break;case GameMode.CAPTURE_THE_FLAG:s.scores=[0,0],this.createFlagCTF(0),this.createFlagCTF(1);break;case GameMode.DEFENDER:s.scores=[0,0],s.flagTeam=null,this.createFlagDefender();break;case GameMode.DEMOLITION:s.round=0,s.scores=[0,0],s.scoreLimit=s.numRounds,s.plantTime=3*this.localData.settings.fps,s.defuseTime=6*this.localData.settings.fps,s.bombTeam=1,s.bBombPlanted=!1,this.createBombCrate(s.bombTeam),s.bombTimerMax=i.bombTimerMax;break;case GameMode.HEADQUARTERS:s.round=0,s.scores=[0,0],s.hqTeam=null,this.createFlagDomination(1,15);break;case GameMode.ASSASSINATION:s.round=0,s.scores=[0,0],s.scoreLimit=s.numRounds,s.vipTeam=0;break;case GameMode.RESCUE:s.round=0,s.scores=[0,0],s.scoreLimit=s.numRounds,s.rescueTeam=0,s.numHostages=2;break;case GameMode.SURVIVAL_CHAOS:this.localData.bUseMoneyMultiplier=!0;var n=100,d=[this.getWeaponData("magnum"),this.getWeaponData("mp7"),this.getWeaponData("m16a4"),this.getWeaponData("m1014"),this.getWeaponData("m40a3"),this.getWeaponData("thumper",{ammo:10})];this.shuffleArray(d);for(var E=0;E<3;E++)this.createDroppedWeapon(this.getRandomUniqueId(),[o.spawn_store[0]-n-E*n,o.spawn_store[1]-50],0,this.RandomBoolean()?1:-1,{weaponData:d[E]});for(E=0;E<3;E++)this.createDroppedWeapon(this.getRandomUniqueId(),[o.spawn_store[0]+n+E*n,o.spawn_store[1]-50],0,this.RandomBoolean()?1:-1,{weaponData:d[E+3]});break;case GameMode.SURVIVAL_PRO:this.localData.bUseMoneyMultiplier=!0;n=100,d=[this.getWeaponData("rhino",{mods:{barrel:Mods.BARREL_LASER}}),this.getWeaponData("bizon",{mods:{ammo:Mods.AMMO_FMJ}}),this.getWeaponData("aug",{mods:{ammo:Mods.AMMO_HOLLOW_POINT}}),this.getWeaponData("saiga12",{mods:{ammo:Mods.AMMO_EXTENDED}}),this.getWeaponData("intervention",{mods:{base:Mods.BASE_DEADEYE,ammo:Mods.AMMO_PIERCING}}),this.getWeaponData("rpg",{ammo:10,mods:{base:Mods.BASE_SPEED}})];this.shuffleArray(d);for(E=0;E<3;E++)this.createDroppedWeapon(this.getRandomUniqueId(),[o.spawn_store[0]-n-E*n,o.spawn_store[1]-50],0,this.RandomBoolean()?1:-1,{weaponData:d[E]});for(E=0;E<3;E++)this.createDroppedWeapon(this.getRandomUniqueId(),[o.spawn_store[0]+n+E*n,o.spawn_store[1]-50],0,this.RandomBoolean()?1:-1,{weaponData:d[E+3]});break;case GameMode.SURVIVAL_BASIC:case GameMode.SURVIVAL_UNDEAD:this.localData.bUseMoneyMultiplier=!0;break;case GameMode.SURVIVAL_STAKEOUT:break;case GameMode.OP_ELIMINATION:s.enemiesRemaining=e.operation.data.enemies.length;break;case GameMode.OP_HOSTAGE:s.numHostages=i.numHostages,s.rescueZone=i.rescueZone,s.bHostageHeli=!i.bSpawnHostageHeli;break;case GameMode.OP_BOMB:s.numBombs=i.numBombs;break;case GameMode.SANDBOX:this.createStoreCrate(o.spawn_store[0],o.spawn_store[1]+24)}if(r.bSurvival){if(s.wave=Settings.SURVIVAL_WAVE_START,s.enemies=0,s.enemiesRemaining=0,s.kills=0,s.waveHeadshots=0,s.waveMelees=0,s.waveKills=0,e.gameModeId!==GameMode.SURVIVAL_STAKEOUT){o=this.getCurrentMapData();this.createStoreCrate(o.spawn_store[0],o.spawn_store[1]+24)}}else r.bOperation?(r.operation={data:e.operation.data,info:e.operation.info},r.difficulty=null!=i.difficulty?i.difficulty:1):s.bFirstBlood=!1;if(this.onEvent({eventId:GameServer.EVENT_GAME_INIT,mapId:e.mapId,gameModeId:e.gameModeId,settings:this.localData.settings}),r.gameModeData.timeLimit){r.gameTimer=r.gameModeData.timeLimit;var h=setInterval(this.onGameTimer.bind(this),1e3);r.timer_game=h}var c=e.players;if(c){for(E=0;E<c.length;E++)this.addPlayer(c[E]);switch(r.gameModeData.id){case GameMode.DEATHMATCH:case GameMode.INFECTED:case GameMode.GUN_GAME:o=this.getCurrentMapData();var m=this.clone(o.spawns);for(this.shuffleArray(m),E=0;E<c.length;E++){var p=c[E],_=this.getObjectById(p.id);if(_){var A=m[E];A&&(_.position[0]=A[0],_.position[1]=A[1])}}}}switch(e.gameModeId){case GameMode.BATTLEZONE:for(E=0;E<2;E++){for(var I=[],T=0;T<3;T++){var R=this.getRandomWeapon(!0),S=this.getRandomMods(R);this.applyWeaponMods(R,S),null!=R.ammo&&R.magSize,I.push(R)}this.createItemCrate(this.Random(500,o.width-500),800,null,I,Battlezone.TEAM_AIRDROPS)}this.createXPCrate(this.Random(500,o.width-500),800,25e3),this.createShardCrate(this.Random(500,o.width-500),800,1)}if(r.preGameTimer>0){var v=setInterval(this.onPreGameTimer.bind(this),1e3);r.timer_preGame=v,this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:r.gameModeData}),this.onEvent({eventId:GameServer.EVENT_GAME_PRE_TIMER,timer:r.preGameTimer})}else this.localData.matchState=MatchState.STATE_IN_PROGRESS,this.requestEvent({eventId:GameServer.EVENT_GAME_START,timer:r.gameTimer}),this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:r.gameModeData});r.bSurvival&&this.startWaveIntermission(),r.updateCounter=1,r.updateCounterMax=r.bMultiplayer?this.localData.settings.update_counter_max:1,r.interval=setInterval(this.updateContainer.bind(this),1e3/this.localData.settings.fps),null!=s.round&&this.onRoundStart(),this.bInit=!0}setLogicFPS(e){this.localData.settings.fps=e,this.localData.settings.fps_mult=e/60,this.localData.settings.fixed_timestep=1/e,this.localData.settings.fixed_timestep_mult=e/60}addPlayer(e){if((l=e).id||console.warn("Invalid player id",l),l.bBot)l.bAutoRespawn=!0,l.desiredClassData=this.GetBotDesiredClassData(l.botSkill),l.desiredKillstreaks=this.GetBotDesiredKillstreaks(l.botSkill);else{var a=this.clone(this.getSharedData("classes"));l.classes?l.allClasses=a.concat(this.clone(l.classes)):(console.warn("Invalid classes reference"),l.allClasses=a),l.desiredClassData=l.allClasses[0],l.desiredKillstreaks=l.killstreaks}l.bRanked=!0;var t=this.addPlayerState(l);if(t.bHasPawn=!1,t.bCanRespawn=!1,t.bWaitingToRespawn=this.localData.gameModeData.bAllowRespawns,t.respawnTimer=-1,t.bSpawnProtection=!1,this.localData.bSandbox)t.money=1e6;else if(this.localData.bSurvival)this.localData.bUseMoneyMultiplier&&(t.money=Settings.SURVIVAL_MONEY_START,t.moneyMultiplier=1);else switch(this.localData.bOperation?!this.localData.operation.data.bTutorial&&this.localData.difficulty<3&&(t.killstreaks=[Killstreaks.KILLSTREAK_UAV]):t.killedBy=[],this.localData.gameModeData.id){case GameMode.BATTLEZONE:t.lives=3,t.shards=0,t.xp=0;break;case GameMode.INFECTED:t.bInfected=this.matchInProgress()||1==t.team;break;case GameMode.GUN_GAME:t.gunIndex=0,t.gunKills=0;break;case GameMode.HEADQUARTERS:case GameMode.DOMINATION:t.captures=0;break;case GameMode.CAPTURE_THE_FLAG:t.captures=0,t.returns=0;break;case GameMode.ASSASSINATION:case GameMode.RESCUE:case GameMode.DEFENDER:case GameMode.OP_HOSTAGE:t.score=0;break;case GameMode.DEMOLITION:t.plants=0,t.defuses=0;break;case GameMode.OP_BOMB:t.plants=0}if(this.localData.playerStates.push(t),this.requestEvent({eventId:GameServer.EVENT_PLAYER_JOIN,playerId:t.id,data:t}),this.matchInProgress()){t.bInfected&&this.makePlayerInfected(t.id);var r=t;if(r.bHasPawn=!1,this.localData.gameModeData.bAllowRespawns)r.bCanRespawn=!1,r.bWaitingToRespawn=!0,r.respawnTimer<=0&&(null==r.timer_respawn&&(r.respawnTimer=this.localData.gameModeData.respawnTime,r.timer_respawn=this.localData.settings.fps),this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:r.id,data:{bCanRespawn:r.bCanRespawn,bWaitingToRespawn:r.bWaitingToRespawn,bHasPawn:r.bHasPawn,respawnTimer:r.respawnTimer}}));else if(this.localData.bSurvival){if(this.localData.gameModeData.id===GameMode.SURVIVAL_STAKEOUT)var i="frag",s=2;this.requestEvent({eventId:GameServer.EVENT_REQUEST_RANKED_CHARACTER,playerId:r.id,avatarData:r.avatarData,data:{x:0,y:0,inventory:this.getSurvivalInventory(),perks:[],equipment:i,equipmentAmmo:s}})}else this.requestEvent({eventId:GameServer.EVENT_REQUEST_RANKED_CHARACTER,playerId:r.id,avatarData:r.avatarData,data:{x:0,y:0,inventory:[{id:"m9"}],perks:[]}})}else{if(this.localData.bBattlezone)for(var o=0;o<this.localData.playerStates.length;o++){var l=this.localData.playerStates[o];this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:l.id,data:{shards:l.shards,xp:l.xp,lives:l.lives}})}this.localData.gameModeData.bAllowRespawns&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_RESPAWN,playerId:l.id})}}isTutorial(){return!!this.localData.bOperation&&this.localData.operation.data.bTutorial}getSurvivalInventory(){switch(this.localData.gameModeData.id){case GameMode.SURVIVAL_STAKEOUT:return[{id:"mp5",ammo:300},{id:"m9",ammo:150}];default:return[{id:"m9",ammo:150}]}}setEndCallback(e){this.onEndCallback=e}onEvent(e){this.lobbyId&&(e.lobbyId=this.lobbyId),this.batchData.push(e)}requestEvent(e){if(e){var a=this.localData;switch(e.eventId){case GameServer.EVENT_SANDBOX:this.localData.bSandbox&&e&&this.handleSandboxEvent(e.data);break;case GameServer.EVENT_BATTLEZONE:if(this.localData.bBattlezone)if(console.log(e),m=this.getPlayerStateById(e.playerId))switch(e.data.type){case"respawn":m.bHasPawn=!0,m.lives=3,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:m.id,data:{lives:m.lives}})}break;case GameServer.EVENT_GAME_START:if(this.localData.bOperation){var t=a.playerStates,r=a.operation.data,i=r.objects;if(this.localData.gameModeData.id,i)for(var s=0;s<i.length;s++){var o=i[s],l=o.id?o.id:this.getRandomUniqueId();switch(o.type){case"hostage":this.createSandboxUnit({unitId:SurvivalEnemyType.HOSTAGE,pos:o.position,team:o.team});break;case"arrow_marker":this.requestEvent({eventId:GameServer.EVENT_SPAWN_OBJECT,data:{id:this.getRandomUniqueId(),type:o.type,rotation:o.rotation,position:o.position}});break;case"helicopter":var n=this.createHelicopter(o.position,o.team,o.heliData);o.heliData&&(void 0!==o.heliData.defendTimer&&(n.data.dropTimerMax=this.localData.settings.fps*o.heliData.dropTimerMax),void 0!==o.heliData.defendTimer&&(n.data.defendTimer=this.localData.settings.fps*o.heliData.defendTimer)),0==o.team&&(n.data.ammo=0);break;case"info":this.createInfo(o.position,o.messageData);break;case"equipment":this.createEquipment(o.position,o.team,o.scale,null,this.getWeaponData(o.weaponId));break;case"destructableObject":switch(o.destructableType){case"box_small":this.createSmallBox(l,o.position);break;case"box_large":this.createLargeBox(l,o.position)}break;case"obstacle":this.createObstacle(o);break;case"droppedWeapon":(K=this.getWeaponData(o.weaponId,o.options))&&this.createDroppedWeapon(l,o.position,0,1,{weaponData:K});break;case"turret":this.createTurret(l,o.position,o.scale,o.team,o.turretData);break;case"crate_ammo":this.createAmmoCrate(o.position[0],o.position[1],null,o.team?o.team:0);break;case"crate_bomb":this.createGenericBombCrate(o.id,o.position[0],o.position[1],o.team,o.interactTeam);break;case"crate_item":if(o.items)for(var d=[],E=0;E<o.items.length;E++){var h=this.getWeaponData(o.items[E].id,o.items[E].options);this.applyWeaponMods(h,o.items[E].mods),d.push(h)}else d=[this.getWeaponData(o.itemId)];this.createItemCrate(o.position[0],o.position[1],null,d,o.team?o.team:0);break;case"crate_killstreak":this.createKillstreakCrate(o.position[0],o.position[1],o.killstreakId,null,o.team?o.team:0);break;case"crate_perk":this.createPerkCrate(o.position[0],o.position[1],null,o.perkId,o.team?o.team:0)}}var c=r.player;for(s=0;s<t.length;s++){var m=t[s],p=4;3==this.localData.difficulty&&(p=1),this.requestEvent({eventId:GameServer.EVENT_REQUEST_RANKED_CHARACTER,playerId:m.id,avatarData:m.avatarData,data:{x:c.position[0]+50*s,y:c.position[1],inventory:c.inventory,equipment:c.equipment,equipmentAmmo:Math.min(c.equipmentAmmo,p),perks:[]}})}var _=r.enemies;if(_){var A=0;switch(a.difficulty){case 1:A=0;break;case 2:A=2;break;case 3:A=3}for(s=0;s<_.length;s++){var I=!1,T=this.clone(_[s]);l=T.id?T.id:this.getRandomUniqueId();switch(T.type){case"helicopter":(n=this.createHelicopter(T.position,1,{type:T.helicopterType,destination:T.destination?T.destination:T.position})).data.health+=250*A,n.data.maxHealth=n.data.health,n.data.maxRange+=300*A,n.data.bControllable=!1,n.data.bBot=!0,n.data.bPlayerControlled=!1,n.data.bAirdrop=!1,n.data.bUnlimitedAmmo=!0;break;case"turret":this.createTurret(l,T.position,T.scale,T.team,T.turretData);break;case"infestor":case"character":var R={bLOS:!0,bUseActivityTimer:!1,bObjectiveTakesPriority:!1,bIgnoreOutOfSight:"character"==T.type,bCanCamp:!1,bCanInteract:!1,hearRange:1500+150*A,maxRange:1200+250*A,bCanInvestigate:!0};T.ai&&(null!=T.ai.bCanInvestigate&&(R.bCanInvestigate=T.ai.bCanInvestigate),null!=T.ai.bCampUntilLOS&&(T.ai.bCamp=!0,R.bCampUntilLOS=T.ai.bCampUntilLOS),null!=T.ai.bCamp&&(R.bCamp=T.ai.bCamp,R.campPosition=this.clone(T.position)),null!=T.ai.bCanInvestigate&&(R.bCanInvestigate=T.ai.bCanInvestigate),null!=T.ai.patrolPoints&&(R.bPatrol=!0,R.patrolPoints=this.clone(T.ai.patrolPoints)),null!=T.ai.bDisabled&&(R.bDisabled=T.ai.bDisabled));var S=null;if(T.heroId){var v=SurvivalEnemyInfo[T.heroId];if(v){var u=v.weapons[this.Random(0,v.weapons.length-1)],b=this.getWeaponData(u),y=[{id:u,mods:v.bHero?v.mods:this.getRandomMods(b)}];v.secondaryWeapons&&y.push({id:v.secondaryWeapons[this.Random(0,v.secondaryWeapons.length-1)]});var D=Object.keys(v);for(E=0;E<D.length;E++)T[D[E]]=v[D[E]];T.inventory=y,T.health*=2,T.style="hero",T.type="character",S=T.damageMultipliers}else console.warn("Invalid hero id:",T.heroId)}else if(T.preset)switch(T.preset){case"infestor":T.health=500,T.inventory=["infestor"],T.infestorType="infestor";break;case"infestor_king":T.health=2500,T.inventory=["infestor_king"],T.infestorType="infestor_king";break;case"juggernaut":T.style="juggernaut",T.maxSpeed=150,T.health=1e3,S={1:.3,2:.5},T.equipment="frag";break;case"militia_generic":T.style="militia_generic",T.health=200,T.equipment="frag";break;case"militia_heavy":T.style="militia_heavy",T.health=500,T.equipment="frag";break;case"rus_elite":T.style="rus_generic",T.health=300,T.equipment="stun";break;case"rus_rocketier":T.style="rus_rocketier",T.health=200,T.equipment="frag";break;case"opfor_heavy":T.style="opfor_heavy",T.health=400,T.equipment="frag";break;case"gign_generic":T.style="gign_generic",T.health=300,T.equipment="stun";break;case"gign_sniper":T.style="gign_sniper",T.health=300,T.equipment="smoke";break;case"un_generic":T.style="un_generic",T.health=300;break;case"gsg9_generic":T.style="gsg9_generic",T.health=300,T.equipment="stun";break;case"gsg9_heavy":T.style="gsg9_heavy",T.health=500,T.equipment="flashbang";break;case"gsg9_sniper":T.style="gsg9_sniper",T.health=300,T.equipment="flashbang";break;case"gsg9_commander":T.style="gsg9_commander",T.health=500;break;case"usmc_sniper":T.style="usmc_sniper",T.equipment="smoke";break;case"usmc_heavy":T.style="usmc_heavy",T.health=600,T.equipment="frag";break;case"usmc_generic":T.style="usmc_generic",T.health=300,T.equipment="flashbang";break;case"zombie_generic":T.style="zombie_generic",T.health=320;break;case"zombie_sprinter":T.style="zombie_sprinter",T.health=150;break;case"zombie_sprinter_boss":T.style="zombie_sprinter_boss",T.health=350;break;case"zombie_fat":T.style="zombie_fat",T.health=1200,T.maxSpeed=120;break;case"zombie_spitter":T.style="zombie_spitter",T.health=200;break;case"zombie_exploder":T.style="zombie_exploder",T.health=400;break;case"zombie_exploder_boss":T.style="zombie_exploder_boss",T.health=800;break;case"zombie_spitter_boss":T.style="zombie_spitter_boss",T.health=600}if("infestor"==T.type)this.requestEvent({eventId:GameServer.EVENT_CREATE_INFESTOR,data:{id:T.id?T.id:this.getRandomUniqueId(),x:T.position[0],y:T.position[1],team:1,infestorType:T.infestorType,health:T.health,botSkill:A,damageMultipliers:S,ai:R}});else if("character"==T.type){switch(T.style){case"hero":g={hairColour:T.hairColour?T.hairColour:this.getRandomHairColour(),hair:T.hair?T.hair:null!=T.zombieType?Character.HAIR_BALD:Character.HAIR_SHORT,beard:T.beard?T.beard:Character.BEARD_NONE,face:T.faces?T.faces[this.Random(0,T.faces.length-1)]:void 0,head:T.heads[this.Random(0,T.heads.length-1)],body:T.body,facewear:T.facewear,eyewear:T.eyewear};break;case"usmc_sniper":g={hairColour:Character.HAIR_COLOUR_BROWN,hair:Character.HAIR_BUZZED,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_USMC_GHILLIE,body:Character.BODY_USMC_GHILLIE,facewear:Character.FACEWEAR_MASK};break;case"usmc_generic":g={hairColour:Character.HAIR_COLOUR_BROWN,hair:Character.HAIR_BUZZED,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:(P=[Character.HEAD_USMC_HELMET,Character.HEAD_USMC_HELMET_TACTICAL])[this.Random(0,P.length-1)],body:Character.BODY_USMC_STANDARD};break;case"usmc_heavy":g={hairColour:Character.HAIR_COLOUR_BROWN,hair:Character.HAIR_BUZZED,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_USMC_SPEC_OPS,body:Character.BODY_USMC_HEAVY};break;case"opfor_generic":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_OPFOR_SCARF,body:Character.BODY_OPFOR_STANDARD};break;case"opfor_sniper":var g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_RADIO,body:Character.BODY_OPFOR_RECON,facewear:Character.FACEWEAR_SCARF_OPFOR};break;case"opfor_heavy":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_OPFOR_HELMET_2,body:Character.BODY_OPFOR_HEAVY,facewear:Character.FACEWEAR_SCARF_OPFOR};break;case"militia_generic":g={hairColour:Character.HAIR_COLOUR_BROWN,hair:Character.HAIR_LONG,beard:Character.BEARD_STUBBLE,face:Character.FACE_DEFAULT,head:Character.HEAD_MILITIA_BANDANA,body:Character.BODY_MILITIA_STANDARD};break;case"militia_heavy":g={hairColour:Character.HAIR_COLOUR_BROWN,hair:Character.HAIR_LONG,beard:Character.BEARD_FULL,face:Character.FACE_DEFAULT,head:Character.HEAD_MILITIA_BANDANA,body:Character.BODY_MILITIA_HEAVY};break;case"rus_generic":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_STUBBLE,face:Character.FACE_DEFAULT,head:Character.HEAD_NONE,facewear:Character.FACEWEAR_MASK,body:Character.BODY_RUS_STANDARD};break;case"rus_rocketier":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_STUBBLE,face:Character.FACE_DEFAULT,head:Character.HEAD_RUS_HELMET,body:Character.BODY_RUS_ROCKETIER};break;case"rus_heavy":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_RUS_HELMET,body:Character.BODY_RUS_HEAVY};break;case"rus_sniper":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_RADIO,body:Character.BODY_RUS_RECON,facewear:Character.FACEWEAR_MASK};break;case"rus_commander":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_BALD,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_OPFOR_BERET,body:Character.BODY_RUS_STANDARD};break;case"juggernaut":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_BALD,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_JUGGERNAUT_HELMET,body:Character.BODY_JUGGERNAUT};break;case"gign_generic":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_GIGN_HELMET,body:Character.BODY_GIGN_STANDARD};break;case"gign_sniper":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_RADIO,body:Character.BODY_GIGN_TACTICAL,facewear:Character.FACEWEAR_MASK};break;case"un_generic":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_UN_HELMET,body:Character.BODY_GIGN_TACTICAL};break;case"gsg9_generic":var P;g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:(P=[Character.HEAD_GSG9_HELMET,Character.HEAD_GSG9_HELMET_2,Character.HEAD_GSG9_HELMET_3])[this.Random(0,P.length-1)],body:Character.BODY_GSG9_STANDARD};break;case"gsg9_heavy":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_GSG9_HELMET_3,body:Character.BODY_GSG9_HEAVY};break;case"gsg9_sniper":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_RADIO,body:Character.BODY_GSG9_TACTICAL,facewear:Character.FACEWEAR_MASK};break;case"gsg9_commander":g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_GOATEE,face:Character.FACE_DEFAULT,head:Character.HEAD_RUS_BERET,body:Character.BODY_GSG9_PARA};break;case"zombie_generic":I=!0;var M=Zombie.TYPE_DEFAULT,O=[Character.FACE_ZOMBIE_1,Character.FACE_ZOMBIE_2,Character.FACE_ZOMBIE_3,Character.FACE_ZOMBIE_4];g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_BALD,beard:Character.BEARD_NONE,face:O[this.Random(0,O.length-1)],head:Character.HEAD_NONE,body:Character.BODY_ZOMBIE},T.inventory||(T.inventory=[{id:"zombie"}]);break;case"zombie_sprinter":I=!0,M=Zombie.TYPE_SPRINTER,g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_BALD,beard:Character.BEARD_NONE,face:Character.FACE_ZOMBIE_SPRINTER,head:Character.HEAD_NONE,body:Character.BODY_ZOMBIE_SPRINTER},T.inventory||(T.inventory=[{id:"zombie_sprinter"}]);break;case"zombie_sprinter_boss":I=!0,M=Zombie.TYPE_SPRINTER_BOSS,g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_BALD,beard:Character.BEARD_NONE,face:Character.FACE_ZOMBIE_SPRINTER_BOSS,head:Character.HEAD_NONE,body:Character.BODY_ZOMBIE_SPRINTER_BOSS},T.inventory||(T.inventory=[{id:"zombie_sprinter_boss"}]);break;case"zombie_fat":I=!0,M=Zombie.TYPE_FAT,g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_BALD,beard:Character.BEARD_NONE,face:Character.FACE_ZOMBIE_FAT,head:Character.HEAD_NONE,body:Character.BODY_ZOMBIE_FAT},T.inventory||(T.inventory=[{id:"zombie_fat"}]);break;case"zombie_spitter":I=!0,M=Zombie.TYPE_SPITTER,g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_BALD,beard:Character.BEARD_NONE,face:Character.FACE_ZOMBIE_SPITTER,head:Character.HEAD_NONE,body:Character.BODY_ZOMBIE_SPITTER},T.inventory=[{id:"zombie_spitter"}];break;case"zombie_exploder":I=!0,M=Zombie.TYPE_EXPLODER,g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_BALD,beard:Character.BEARD_NONE,face:Character.FACE_ZOMBIE_EXPLODER,head:Character.HEAD_NONE,body:Character.BODY_ZOMBIE_EXPLODER},T.inventory=[{id:"zombie_exploder"}];break;case"zombie_exploder_boss":I=!0,M=Zombie.TYPE_EXPLODER_BOSS,g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_BALD,beard:Character.BEARD_NONE,face:Character.FACE_ZOMBIE_EXPLODER,head:Character.HEAD_NONE,body:Character.BODY_ZOMBIE_EXPLODER_BOSS},T.inventory=[{id:"zombie_exploder_boss"}];break;case"zombie_spitter_boss":I=!0,M=Zombie.TYPE_SPITTER_BOSS,g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_BALD,beard:Character.BEARD_NONE,face:Character.FACE_ZOMBIE_SPITTER_BOSS,head:Character.HEAD_NONE,body:Character.BODY_ZOMBIE_SPITTER_BOSS},T.inventory=[{id:"zombie_spitter_boss"}];break;default:console.warn("No character style defined:",T),g={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_OPFOR_SCARF,body:Character.BODY_OPFOR_STANDARD}}var N=[Character.HAIR_COLOUR_BLACK,Character.HAIR_COLOUR_BROWN,Character.HAIR_COLOUR_BLONDE];g.hairColour=N[this.Random(0,N.length-1)],!I&&A>=3&&(T.equipment||(T.equipment="stim"),T.inventory[0].mods||(T.inventory[0].mods={base:Mods.BASE_RANGE})),this.requestEvent({eventId:GameServer.EVENT_CREATE_GENERIC_CHARACTER,data:{id:T.id?T.id:this.getRandomUniqueId(),x:T.position[0],y:T.position[1],team:1,health:T.health?T.health:200,inventory:T.inventory,equipment:T.equipment,avatarData:g,botSkill:A,ai:R,bUnlimitedAmmo:!0,maxSpeed:T.maxSpeed,damageMultipliers:S,bZombie:I,zombieType:M,baseSpeedMultiplier:T.baseSpeedMultiplier,bRegenHealth:T.bHero||this.localData.difficulty>=3,pawnName:T.pawnName,bHero:T.bHero,perks:T.perks}})}break;default:console.warn("Unhandled enemy type:",T.type)}}}}else if(a.bSurvival){t=a.playerStates;var L=this.getCurrentMapData().spawn_store;for(s=0;s<t.length;s++){(m=t[s]).avatarData||(m.avatarData=this.getRandomAvatarData());y=this.getSurvivalInventory();if(a.gameModeData.id===GameMode.SURVIVAL_STAKEOUT)var C="frag",f=2;else C=null,f=null;this.requestEvent({eventId:GameServer.EVENT_REQUEST_RANKED_CHARACTER,playerId:m.id,avatarData:m.avatarData,data:{x:L[0]+s*(400/t.length)-.5/t.length*400,y:L[1],inventory:y,equipment:C,equipmentAmmo:f,perks:[]}})}}else{switch(a.gameModeData.id){case GameMode.INFECTED:this.startInfectedIntermission()}this.checkAutoTeamBalance()}break;case GameServer.EVENT_PLAYER_UPDATE:if(m=this.getPlayerStateById(e.playerId))if(ma=e.data){if(null!=ma.bAutoRespawn&&(m.bAutoRespawn=ma.bAutoRespawn,!m.bHasPawn&&m.bAutoRespawn&&m.bCanRespawn&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_RESPAWN,playerId:m.id})),null!=ma.desiredClassData&&!this.localData.gameModeData.bNoClasses&&!m.bVIP){var k=this.clone(m.desiredClassData);m.desiredClassData=ma.desiredClassData,m.desiredClassData.killstreak==Killstreaks.TYPE_ASSAULT&&this.matchInProgress()&&(m.currentKillstreak=0),!this.matchInProgress()&&k&&k.killstreak!=m.desiredClassData.killstreak&&(m.currentKillstreak=0),ma.currentKillstreak=m.currentKillstreak}null!=ma.battlezone&&this.localData.bBattlezone&&(m.battlezone=ma.battlezone),null!=ma.level&&(m.level=ma.level),null!=ma.name&&(m.name=ma.name),void 0!==ma.clan&&(m.clan=ma.clan)}break;case GameServer.EVENT_PLAYER_CLOSE_WORLD_MENU:(ca=this.getObjectById(e.playerId))&&this.endCharacterUseDelay(ca);break;case GameServer.EVENT_PLAYER_SET_WORLD_POSITION:(ca=this.getObjectById(e.playerId))&&ca.data.weapon.bUseDelay&&(this.triggerPlayerCurrentKillstreak(ca.data.id,e.position[0],e.position[1]),this.endCharacterUseDelay(ca));break;case GameServer.EVENT_ROUND_END:this.localData.gameModeData;this.localData.matchState=MatchState.STATE_POST_ROUND;break;case GameServer.EVENT_GAME_END:e.condition==MatchState.END_CONDITION_FORFEIT&&(e.winningTeam=-1),this.localData.gameModeData.winner=e.winningTeam,this.endGame();break;case GameServer.EVENT_SPAWN_BULLET:var G=this.raycast(e.startX,e.startY,e.endX,e.endY);if(G){var B=[];if(e.bMelee)if(ya=this.getObjectById(e.causerId)){var w=this.getPawns().concat(this.getEquipment());for(s=0;s<w.length;s++){let e=w[s];e.getAABB().overlaps(ya.getAABB())&&G.push({body:e,point:{x:e.position[0],y:e.position[1]},distance:1})}}var K=e.weaponData?e.weaponData:this.getWeaponData(e.weaponId),H=0,U=0;switch(e.weaponId){case Killstreaks.KILLSTREAK_HELI_SNIPER:U=this.localData.bSurvival?10:5;break;case Killstreaks.KILLSTREAK_COBRA_CONTROLLABLE:case Killstreaks.KILLSTREAK_SCOUT:U=3;break;case Killstreaks.KILLSTREAK_CHOPPER_GUNNER:case Killstreaks.KILLSTREAK_ADVANCED_TURRET:U=this.localData.bSurvival?2:1;break;default:U=K?K.penetration:1}var W="default",V=!1,Y={},F=.8,x=this.Angle(e.endX,e.endY,e.startX,e.startY);for(s=0;s<G.length;s++){V=!1;var q=G[s];if(q){var Z=q.body;if(Z.data&&!Z.data.bInvisible){if(W=Z.data.material?Z.data.material:"default",Z.data.bHostage&&Z.data.bGodMode)continue;if("character"==Z.data.type){if((m=this.getPlayerStateById(Z.data.id))&&m.bSpawnProtection)continue}else if("ground"==Z.data.type)H=U,V=!0;else if("door"==Z.data.type)Z.data.bClosed&&("metal"==Z.data.material?H=U:(U>=5&&0==H||K&&K.type==Weapon.TYPE_SHOTGUN&&q.distance<100)&&this.setDoorClosed(Z,!1,this.getObjectById(e.causerId)),V=!0);else if("shield"==Z.data.type){if(Z.data.bActive&&Z.data.playerId!=e.causerId){var z=(ya=this.getObjectById(e.causerId))?ya.data.team:-1,j=!e.bMelee||this.localData.bSurvival;if(j&&z==Z.data.team&&(this.localData.bSurvival||this.localData.bSandbox||this.localData.bBattlezone||this.localData.bOperation&&1==z)&&(j=!1),j){H=U,V=!0;var J=Z}}}else if("obstacle"==Z.data.type){if(e.bIgnoreObstacles&&!Z.data.health)continue;var X=60;if((ya=this.getObjectById(e.causerId))&&("turret"==ya.data.type||ya.data.bBot)&&(X=100),!Z.data.bBlock&&this.Dist(q.point.x,q.point.y,e.startX,e.startY)<X)continue;H=U,V=!0}else if("destructableObject"==Z.data.type&&"deployable_cover"==Z.data.destructableData.type){if(e.bIgnoreObstacles)continue;if(this.Dist(q.point.x,q.point.y,e.startX,e.startY)<15)continue;e.damageAmount*=U,H=U,V=!0}if(!Y[Z.data.id]&&Z.data.health)switch(Z.data.type){case"grenade":Z.data.team==e.team&&e.controllerId!=Z.data.grenadeData.playerId||e.bMelee||this.detonate(Z);break;default:var Q=Z.data.team!=e.team;if("equipment"==Z.data.type&&e.controllerId==Z.data.ownerId&&(Q=!0),Q){"door"==Z.data.type||"obstacle"==Z.data.type?F=Math.max(.1,.35*F):"equipment"==Z.data.type&&(!this.localData.bOperation&&e.controllerId==Z.data.ownerId||Z.data.team!=e.team)&&(Y[Z.data.id]=!0,V=!0,Z.data.weaponData.bMine&&(Z.data.ownerId=e.controllerId?e.controllerId:e.causerId,this.detonate(Z))),Y[Z.data.id]=!0;var $=e.damageAmount;if(H>0){var ee=(1-H/U)*F;H!=U&&($=Math.ceil($*ee))}var ae=q.bHeadshot,te=q.bLegshot;if(K&&this.isMeleeWeapon(K)&&(ae=!1,te=!1),ae){var re=1;if(K&&(re=K.headshotMultiplier?K.headshotMultiplier:1),this.characterHasPerk(Z,Perks.PERK_PLAYER_HELMET)){var ie=.5*this.getCharacterHealth();K&&this.hasMod(K,Mods.AMMO_PIERCING)||$>50&&($*=.75),$=Math.min(ie,$)}else $*=1.4*re}else if(te){var se=.8;if(K){switch(K.type){case Weapon.TYPE_SNIPER:se=.5}K.bImpact&&(se=Math.min(1,se+.2))}$*=se}var oe=this.isMeleeWeapon(K),le=!1,ne=!1,de=this.characterHasPerk(Z,Perks.PERK_PLAYER_ANTI_SNIPER);if(K&&!oe){var Ee=this.Dist(e.startX,e.startY,e.endX,e.endY),he=q.distance,ce=.65;switch(K.type){case Weapon.TYPE_SHOTGUN:ce=.5}var me=Ee*ce;ne=he<=.35*Ee;var pe=1;if(le=he>=me){switch(K.type){case Weapon.TYPE_SHOTGUN:var _e=.1;break;case Weapon.TYPE_MACHINE_PISTOL:_e=K.bHighCaliber&&!de?.9:.2;break;case Weapon.TYPE_SMG:case Weapon.TYPE_PISTOL:_e=K.bHighCaliber&&!de?.9:.3;break;default:_e=K.bHighCaliber&&!de?.9:.4}$*=pe=Math.max(1-(he-me)/(Ee-me),_e)}else if(ne)switch(K.bImpact&&($*=this.localData.bSurvival?2:1.5),K.type){case Weapon.TYPE_SHOTGUN:$*=1.5}if(de)if(K.type==Weapon.TYPE_SNIPER||e.weaponId==Killstreaks.KILLSTREAK_HELI_SNIPER){(Ue=this.getCurrentCharacterInventoryItem(Z))&&Ue.type==Weapon.TYPE_SNIPER?$*=.65*pe:$=$*(.65*pe)*(ne?1:.8)*(le?.8:1);var Ae=!0}else K.bHighCaliber&&le&&(Ae=!0)}var Ie=this.getObjectById(e.controllerId);if(Ie)switch(Z.data.type){case"turret":case"helicopter":this.characterHasPerk(Ie,Perks.PERK_WEAPON_SHRAPNEL)&&($*=2),K&&(null!=K.vehicleMultiplier&&($*=K.vehicleMultiplier),K.penetration>1&&($+=3*(K.penetration-1))),this.localData.bModeGame&&e.weaponId==Killstreaks.KILLSTREAK_ADVANCED_TURRET&&($*=3);break;case"character":K&&Z.data.bZombie&&null!=K.zombieMultiplier&&($*=K.zombieMultiplier);let a=this.getPlayerStateById(Z.data.id);a&&a.bJuggernaut&&(this.characterHasPerk(Ie,Perks.PERK_WEAPON_SHRAPNEL)&&($*=2),K&&(null!=K.vehicleMultiplier&&($*=K.vehicleMultiplier),(this.hasMod(K,Mods.AMMO_PIERCING)||this.hasMod(K,Mods.BARREL_BOOSTER))&&($*=1.5)),this.localData.bModeGame&&e.weaponId==Killstreaks.KILLSTREAK_ADVANCED_TURRET&&($*=3))}this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:oe?DamageType.DAMAGE_MELEE:DamageType.DAMAGE_BULLET,damageAmount:$,pawnId:Z.data.id,attackerId:e.controllerId,causerId:e.causerId,weaponId:e.weaponId,bHeadshot:ae,bLongshot:le,bNearshot:ne,bSniper:Ae,bMelee:oe,bDirectlyCausedByPlayer:e.bDirectlyCausedByPlayer}),V=!0}}if(V){if(J){var Te=this.getObjectById(J.data.playerId);Te&&Te.data.health&&this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:Te.data.id,type:GameServer.PAWN_HIT_SHIELD,damage:$||e.damageAmount,causerId:e.causerId})}if(this.emitAISound([q.point.x,q.point.y],void 0,300),B.push({x:Math.round(q.point.x),y:Math.round(q.point.y),rotation:x,impactType:W,damageAmount:$||e.damageAmount}),++H>=U){e.endX=q.point.x,e.endY=q.point.y;break}}}}}}e.rotation=this.RoundDecimal(e.rotation),e.endX=Math.round(e.endX),e.endY=Math.round(e.endY),delete e.bIgnoreObstacles,delete e.bDirectlyCausedByPlayer,delete e.weaponData,delete e.team,delete e.damageAmount,delete e.causerId,delete e.weaponId,B&&this.createImpactEffects(B),this.localData.bMultiplayer&&this.batchData.length>=Settings.BATCH_MAX&&(e.bServerSideOnly=!0);break;case GameServer.EVENT_SPAWN_EXPLOSION:e.damage&&this.checkExplosion(Math.round(e.x),Math.round(e.y),e.radius,e.damage,e.playerId,e.causerId,e.weaponId,e.bLOS,e.directHitId);break;case GameServer.EVENT_STORE_BUY:this.purchaseStoreItem(e.playerId,e.data),e.bServerSideOnly=!0;break;case GameServer.EVENT_GAME_MONEY_ADD:null!=(wa=this.localData.bSandbox?0:e.value)&&this.addPlayerMoney(e.playerId,wa);break;case GameServer.EVENT_GAME_PAUSE:this.localData.bPaused=e.bPaused;break;case GameServer.EVENT_PLAYER_RESPAWN:if(this.roundHasEnded()){console.warn("Player respawning when round is ended!");break}if(m=this.getPlayerStateById(e.playerId)){m.bJuggernaut&&(m.avatarData=m.desiredAvatarData,m.bJuggernaut=!1,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:e.playerId,data:{bJuggernaut:m.bJuggernaut,avatarData:m.avatarData}})),m.bVIP&&(m.avatarData=m.desiredAvatarData,m.bVIP=!1,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:e.playerId,data:{bVIP:m.bVIP,avatarData:m.avatarData}}));var Re=this.getEquipmentByPlayerId(m.id,"tac_insert");if(Re[0]&&!Re[0].data.bJammed)var Se=this.clone(Re[0].position);this.removeEquipmentByPlayerId(m.id);var ve=this.getDeployableCovers(m.id);if(ve&&ve.length>0)for(s=0;s<ve.length;s++)this.removeNextStep(ve[s]);if((Ke=this.getGrenades(m.id))&&Ke.length>0)for(s=0;s<Ke.length;s++)Ke[s].data.bRemoteDetonation&&this.removeNextStep(Ke[s]);var ue=m.desiredClassData,be=(y=[ue.primary,ue.secondary],C=ue.equipment,[ue.playerPerk,ue.weaponPerk]);switch(this.localData.gameModeData.id){case GameMode.BATTLEZONE:if(m.battlezone){var ye=this.clone(m.battlezone);y=[ye.primary,ye.secondary],C=ye.equipment,be=[ye.playerPerk,ye.weaponPerk]}else y=[{id:"g17",ammo:20},{id:"none"}],C="smoke",be=[Perks.PERK_PLAYER_SCAVENGER];break;case GameMode.SANDBOX:y=[{id:"m16a4"},{id:"m9"}],C="frag";f=2;be=[];break;case GameMode.GUN_GAME:y=[this.localData.gameModeData.weapons[m.gunIndex]],C=null,be=[];break;case GameMode.INFECTED:if(m.bInfected){y=[this.localData.gameModeData.infectedWeapon],C=this.localData.gameModeData.infectedEquipment,be=this.localData.gameModeData.infectedPerks;I=!0,M=Zombie.TYPE_SPRINTER}else y=[{id:this.localData.gameModeData.survivorWeaponId}],C=this.localData.gameModeData.survivorEquipmentId,f=2,be=[]}this.requestEvent({eventId:GameServer.EVENT_REQUEST_RANKED_CHARACTER,playerId:m.id,bBot:m.bBot,botSkill:m.botSkill,avatarData:m.avatarData,data:{id:m.id,inventory:y,equipment:C,equipmentAmmo:f,perks:be,bZombie:I,zombieType:M,bJuggernaut:m.bJuggernaut,bTacticalInsertion:null!=Se,x:Se?Se[0]:null,y:Se?Se[1]-30:null}})}break;case GameServer.EVENT_PLAYER_EARN_KILLSTREAK:this.onPlayerEarnKillstreak(e.playerId,e.killstreakId);break;case GameServer.EVENT_PLAYER_USE_KILLSTREAK:this.onPlayerUseKillstreak(e.playerId,e.worldX,e.worldY),e.bServerSideOnly=!0;break;case GameServer.EVENT_PLAYER_UPDATE_CONTROLLABLE:if(m=this.getPlayerStateById(e.playerId)){var De=this.getObjectById(m.controllableId);if(De)switch(De.data.type){case"rocket":var ge=this.Angle(De.position[0],De.position[1],e.worldX,e.worldY);De.angle=ge;break;case"helicopter":var Pe=this.getMuzzlePosition(De);ge=this.WrapAngle(this.Angle(Pe[0],Pe[1],e.worldX,e.worldY),!0),De.data.desiredAimRotation=ge,De.data.aimPos[0]=e.worldX,De.data.aimPos[1]=e.worldY;break;case"turret":De.data.aimPos[0]=e.worldX,De.data.aimPos[1]=e.worldY}}e.bServerSideOnly=!0;break;case GameServer.EVENT_PLAYER_INPUT:var Me=e.keyInfo;if(Me){m=this.getPlayerStateById(e.playerId);var Oe=Object.keys(Me);for(s=0;s<Oe.length;s++){var Ne=Oe[s],Le={keyId:Ne,value:Me[Ne]};if(m&&m.controllableId){var Ce=this.getObjectById(m.controllableId);this.handleControllableInput(Ce,Le)}else{var fe=this.getObjectById(e.playerId);this.handlePlayerInput(fe,Le)}}}e.bServerSideOnly=!0;break;case GameServer.EVENT_PLAYER_INTERACT:if(!this.matchInProgress())return;if(m=this.getPlayerStateById(e.playerId),fe=this.getObjectById(e.playerId),m&&m.controllableId){if(m.bBot)break;if(De=this.getObjectById(m.controllableId))switch(De.data.type){case"helicopter":De.data.ammo=0,this.pushObjectDataUpdate(De.data.id,["ammo"]);break;case"turret":this.clearPlayerControllable(m),fe&&fe.wakeUp()}}else if(fe)if(e.interactableId)if(!fe.data.bBot&&fe.data.bWantsToInteract)this.stopCharacterInteract(fe);else{var ke=this.getObjectById(e.interactableId);if(ke&&this.characterCanInteract(fe,ke)){ke.data.bLimitInteractions&&(ke.data.currentPawnId=fe.data.id);var Ge=ke.data.interactData,Be=Ge?Ge.interactTime:0;if(Be>0){switch(ke.data.type){case"crate":this.localData.bBattlezone?Be=this.localData.settings.fps*Battlezone.CRATE_INTERACT_TIME:Ge.ownerId&&Ge.ownerId!=fe.data.id&&(Be=3*this.localData.settings.fps);break;case"reviver":this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:fe.data.id,type:GameServer.PAWN_START_REVIVE})}this.cancelCharacterBoltPull(fe),this.cancelCharacterReload(fe),fe.velocity=[0,0],fe.data.bWantsToInteract=!0,fe.data.interactTimer=Be,fe.data.interactableId=e.interactableId,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:fe.data.id,type:GameServer.PAWN_START_INTERACTION,timer:Be})}else this.executeInteractable(ke,e.playerId)}}else{var we=!1;if(C=fe.data.equipment)switch(C.id){case"c4":var Ke=this.getGrenades(fe.data.id,"c4");for(s=0;s<Ke.length;s++)this.detonate(Ke[s]),we=!0}if(!we){var He=this.getPlayerControllableTurret(fe.data.id);He&&this.executeInteractable(He,fe.data.id)}}e.bServerSideOnly=!0;break;case GameServer.EVENT_PLAYER_UPDATE_INVENTORY:if(fe=this.getObjectById(e.pawnId)){y=fe.data.inventory;switch(e.bRemoveEquipment&&(fe.data.equipment=null,e.equipment=null),"number"!=typeof e.type&&console.warn("Invalid type:",e.type),e.type){case GameServer.INV_PERK_ADD:(be=fe.data.perks)&&-1==be.indexOf(e.perkId)&&be.push(e.perkId),this.updateCharacterPerks(fe),e.perks=be;break;case GameServer.INV_PERKS:be=fe.data.perks;this.updateCharacterPerks(fe),e.perks=be;break;case GameServer.INV_PERKS_SET:fe.data.perks=e.perks,this.updateCharacterPerks(fe);break;case GameServer.INV_FIRE:var Ue=y[e.index];e.bBarrel?e.item=Ue:this.isMeleeWeapon(Ue)||(Ue.mag--,Ue.bBoltAction&&(Ue.bNeedsBoltPull=!0),e.item=Ue);break;case GameServer.INV_CLASS_DATA:if(!this.localData.gameModeData.bNoClasses&&this.localData.bModeGame)if((m=this.getPlayerStateById(e.pawnId))&&m.bVIP)e={};else{var We=this.getWeaponData(e.primary.id);this.applyWeaponMods(We,e.primary.mods,fe?fe.data.id:null);var Ve=this.getWeaponData(e.secondary.id);this.applyWeaponMods(Ve,e.secondary.mods,fe?fe.data.id:null);var Ye=this.getWeaponData(e.equipment);fe.data.inventory=[We,Ve],fe.data.equipment=Ye,delete fe.data.bBandolier,this.setCharacterCurrentInventoryItem(fe,0),e.inventory=fe.data.inventory,e.equipment=fe.data.equipment,e.currentInventoryIndex=0;be=[e.playerPerk,e.weaponPerk];fe.data.perks=be,this.updateCharacterPerks(fe),e.perks=be}else e={};break;case GameServer.INV_MOD_SET:var Fe=fe.data.inventory[e.index];if(Fe){var xe=Fe.mods?Fe.mods:{};xe[e.modType]=e.modId,this.applyWeaponMods(Fe,xe),e.inventory=fe.data.inventory}break;case GameServer.INV_EQUIPMENT_SET:var qe=this.getWeaponData(e.value);qe&&(null!=e.ammo&&(qe.ammo=e.ammo),fe.data.equipment=qe,e.equipment=fe.data.equipment);break;case GameServer.INV_EQUIPMENT_ADD:(C=fe.data.equipment)&&(C.ammo+=e.value,C.ammo=Math.min(C.ammo,C.ammoMax)),e.equipment=C;break;case GameServer.INV_AMMO:y[e.index].ammo=e.value,e.item=y[e.index];break;case GameServer.INV_AMMO_ADD:y[e.index].ammo+=e.value,y[e.index].ammo=Math.min(y[e.index].ammo,999),e.barrelAmmo>0&&y[e.index].barrelId&&(y[e.index].barrelAmmo=Math.min(y[e.index].barrelAmmo+1,y[e.index].barrelAmmoMax)),e.item=y[e.index];break;case GameServer.INV_MAG:y[e.index].mag=e.value,e.item=y[e.index];break;case GameServer.INV_MAG_ADD:y[e.index].mag+=e.value,e.item=y[e.index];break;case GameServer.INV_BURSTS:y[e.index].bursts=e.value,e.item=y[e.index];break;case GameServer.INV_BURSTS_ADD:y[e.index].bursts+=e.value,e.item=y[e.index];break;case GameServer.INV_ITEM:e.item=y[e.index];break;case GameServer.INV_ITEM_ADD:2==y.length&&y.splice(0,1),y.push(e.item),this.setCharacterCurrentInventoryItem(fe,1),e.currentInventoryIndex=1,e.inventory=y;break;case GameServer.INV_ITEM_REPLACE:y[e.index]=e.item,e.index==fe.data.currentInventoryIndex&&this.setCharacterCurrentInventoryItem(fe,e.index),e.inventory=y;break;case GameServer.INV_INVENTORY_REPLACE:fe.data.inventory=e.inventory,this.setCharacterCurrentInventoryItem(fe,0),e.currentInventoryIndex=0,e.inventory=e.inventory;break;case GameServer.INV_CURRENT_INVENTORY_INDEX:if(!fe.data.weapon.bFireDelay&&!fe.data.bWantsToInteract&&!fe.data.bShieldCooldown){this.setCharacterCurrentInventoryItem(fe,e.value),e.currentInventoryIndex=e.value;Ue=fe.data.inventory[e.value];fe.data.bIsReloading&&(e.bReload=!0)}break;case GameServer.INV_INVENTORY:e.inventory=y;break;case GameServer.INV_EQUIPMENT:e.equipment=fe.data.equipment}}break;case GameServer.EVENT_PLAYER_TRIGGER_WEAPON:var Ze=e.value;if(De=(m=this.getPlayerStateById(e.playerId))?this.getObjectById(m.controllableId):null)switch(De.data.type){case"rocket":Ze&&this.detonate(De);break;case"helicopter":case"turret":De.data.bWantsToFire=Ze}else if(fe=this.getObjectById(e.playerId))if(e.worldPosition&&(fe.data.inputPosition=e.worldPosition),e.bBarrel){if(q=this.getCurrentCharacterInventoryItem(fe),e.value&&q.barrelAmmo>0&&!fe.data.bBarrelCooldown&&!fe.data.bWantsToFire&&this.characterCanFire(fe,!1)){fe.data.bBarrelCooldown=!0;Pe=this.getCharacterMuzzlePosition(fe);switch(q.barrelId){case Mods.BARREL_GP25:case Mods.BARREL_M203:fe.data.barrelCooldownTimer=Math.round(1.5*this.localData.settings.fps);var ze=this.getWeaponData("thumper");ze.damage=350,ze.radius=300,this.createGrenade(Pe,{bImpact:!0,team:fe.data.team,playerId:fe.data.id,causerId:fe.data.id,rotation:fe.data.aimRotation,velocity:ze.velocity?ze.velocity:1500,damage:ze.damage,weaponId:q.barrelId,weaponData:ze,radius:ze.radius},!0);break;case Mods.BARREL_MASTERKEY:fe.data.barrelCooldownTimer=Math.round(.5*this.localData.settings.fps),(ze=this.getWeaponData("m3")).accuracy=10;var je=this.localData.bSurvival&&0==fe.data.team;for(s=0;s<6;s++){ge=fe.data.aimRotation;var Je=ze.accuracy*fe.data.accuracyMultiplier*(fe.data.bWantsToCrouch?.8:1)*10,Xe=ge+this.ToRad(.1*this.Random(-Je,Je));this.createBullet(Pe[0],Pe[1],Xe,ze.range,ze.damage,fe.data.id,fe.data.id,q.barrelId,ze,!0,!1,je)}}fe.data.bUseExposeTimer&&(this.emitAISound(this.clone(fe.position),fe.data.team),fe.data.bExposed=!0,fe.data.exposedTimer=2*this.localData.settings.fps),fe.data.bUnlimitedAmmo||(q.barrelAmmo--,this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:fe.data.id,index:fe.data.currentInventoryIndex,type:GameServer.INV_FIRE,bBarrel:!0})),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:fe.data.id,type:GameServer.PAWN_FIRE_WEAPON,recoil:5,bBarrel:!0,barrelId:q.barrelId})}}else if(q=this.getCurrentCharacterInventoryItem(fe),e.value){var Qe=fe.data.bWantsToFire;if(fe.data.bWantsToFire=!0,q.mag>0)Qe||this.onStartWeaponFire(fe),fe.data.weapon.bFireHandler=!0;else if(0!=q.ammo||fe.data.weapon.bUnlimitedAmmo)this.reloadCharacterWeapon(fe);else{var $e=1==fe.data.currentInventoryIndex?0:1,ea=fe.data.inventory[$e];ea&&(ea.mag>0||ea.ammo>0)&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:fe.data.id,type:GameServer.INV_CURRENT_INVENTORY_INDEX,value:$e}),fe.data.bBot||this.characterIsFree(fe)&&this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:fe.data.id,type:GameServer.PAWN_NO_AMMO})}}else fe.data.bWantsToFire&&this.onEndWeaponFire(fe),fe.data.bWantsToFire=!1;e.bServerSideOnly=!0;break;case GameServer.EVENT_PLAYER_TRIGGER_EQUIPMENT:if(fe=this.getObjectById(e.playerId))if(C=fe.data.equipment)if(C.ammo>0)this.useCharacterEquipment(fe,e.worldX,e.worldY);else switch(C.id){case"c4":for(Ke=this.getGrenades(fe.data.id,"c4"),s=0;s<Ke.length;s++)this.detonate(Ke[s])}e.bServerSideOnly=!0;break;case GameServer.EVENT_PLAYER_JOIN:var aa=e.data;switch(aa.id=e.playerId,aa.team=e.data.team,aa.bBot?this.onEvent({eventId:GameServer.EVENT_CREATE_AI_CONTROLLER,playerId:aa.id,botSkill:aa.botSkill}):this.onEvent({eventId:GameServer.EVENT_SET_PLAYER_CONTROLLER_ID,playerId:aa.id}),this.localData.gameModeData.id){case GameMode.DEATHMATCH:this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:this.localData.gameModeData});break;case GameMode.INFECTED:this.checkInfected()}break;case GameServer.EVENT_PLAYER_LEAVE:fe=this.getObjectById(e.playerId);if(this.localData.bBattlezone){if(fe)((m=this.getPlayerStateById(e.playerId)).shards>0||m.xp>0)&&this.createLootPack(fe.position,{shards:m.shards,xp:m.xp})}else if(this.localData.bSurvival)fe&&this.dropAllCharacterWeapons(fe);else switch(this.localData.gameModeData.id){case GameMode.ASSASSINATION:(m=this.getPlayerStateById(e.playerId))&&m.bVIP&&this.winRound(MatchState.END_CONDITION_VIP_KILLED,0==this.localData.gameModeData.vipTeam?1:0,1)}this.removePlayerStateById(e.playerId),this.removeNextStep(fe),this.removeNextStep(this.getReviverByPlayerId(e.playerId));var ta=this.getHelicopters();for(s=0;s<ta.length;s++){(n=ta[s]).data.heliData.playerId==e.playerId&&this.removeNextStep(n)}var ra=this.getTurrets(e.playerId);for(s=0;s<ra.length;s++)this.removeNextStep(ra[s]);switch(this.localData.gameModeData.id){case GameMode.DEATHMATCH:this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:this.localData.gameModeData});break;case GameMode.INFECTED:this.checkInfected();break;default:this.checkAutoTeamBalance()}break;case GameServer.EVENT_REQUEST_RANKED_CHARACTER:if(m=this.getPlayerStateById(e.playerId)){if(m.avatarData||(m.avatarData=e.avatarData),!m.bHasPawn){this.matchInProgress()&&this.localData.gameModeData.bSpawnProtection&&!e.data.bTacticalInsertion&&this.startSpawnProtectionTimer(e.playerId);var ia=this.clone(e);ia.eventId=GameServer.EVENT_CREATE_RANKED_CHARACTER,this.requestEvent(ia)}}else console.warn("Player id "+e.playerId+" not found");break;case GameServer.EVENT_CREATE_RANKED_CHARACTER:if(this.getObjectById(e.playerId))this.log(e.playerId+" already exists, don't create");else{if(m=this.getPlayerStateById(e.playerId),!(ma=e.data).x){var sa=this.getCurrentMapData(),oa={x:0,y:0};if(sa){var la=this.getGameModeData(this.localData.gameModeData.id);if(this.localData.bSandbox&&!this.matchInProgress())oa.x=sa.spawn_store[0]+this.Random(-100,100),oa.y=sa.spawn_store[1];else if(!la.bTeam||this.matchInProgress()&&!this.roundHasEnded()){if(da=sa.spawns){var na=this.getBestSpawnPosition(m.team);oa.x=na[0],oa.y=na[1]}}else{var da;if(da=sa.spawns_team){var Ea=m.team;switch(this.localData.gameModeData.id){case GameMode.HEADQUARTERS:Ea=m.team==(this.localData.gameModeData.round+1)%2==0?0:1;break;case GameMode.DEMOLITION:Ea=m.team==this.localData.gameModeData.bombTeam?1:0;break;case GameMode.ASSASSINATION:Ea=m.team==this.localData.gameModeData.vipTeam?0:1;break;case GameMode.RESCUE:Ea=m.team==this.localData.gameModeData.rescueTeam?0:1}var ha=75*this.getNumCharactersOnTeam(m.team)*(0==Ea?1:-1);oa.x=da[Ea][0]+ha,oa.y=da[Ea][1]}}}else console.warn("Missing map data");ma.x=oa.x,ma.y=oa.y}var ca=this.createCharacter(e.playerId,[ma.x,ma.y],m.team,m.avatarData,ma.inventory,ma.equipment,ma.perks);if(ma.equipment&&null!=ma.equipmentAmmo&&(ca.data.equipment.ammo=ma.equipmentAmmo),ca.data.equipment&&(ma.equipmentAmmo=ca.data.equipment.ammo),ma.inventory=ca.data.inventory,ma.maxHealth=ca.data.maxHealth,ma.reloadMultiplier=ca.data.reloadMultiplier,ma.maxSpeed=ca.data.maxSpeed,m.bAutoRespawn=!0,m.bBot)switch(ca.data.bBot=!0,this.setPawnAI(ca,m.botSkill,!1),this.localData.gameModeData.id){case GameMode.DOMINATION:case GameMode.CAPTURE_THE_FLAG:ca.data.ai.bObjectiveTakesPriority=this.Random(1,4)>1;break;case GameMode.DEFENDER:case GameMode.DEMOLITION:case GameMode.HEADQUARTERS:ca.data.ai.bObjectiveTakesPriority=this.Random(1,2)>1;break;case GameMode.ASSASSINATION:ca.data.ai.bObjectiveTakesPriority=!0}if(this.localData.bSandbox)ca.data.team;else if(this.localData.bBattlezone)ca.data.bBot||(ca.data.damageMultipliers[DamageType.DAMAGE_BULLET]=.5,ca.data.damageMultipliers[DamageType.DAMAGE_MELEE]=.5,ca.data.damageMultipliers[DamageType.DAMAGE_EXPLOSIVE]=.75);else if(this.localData.bSurvival){if(0==ca.data.team)if(ca.data.damageMultipliers[DamageType.DAMAGE_BULLET]=.15,ca.data.damageMultipliers[DamageType.DAMAGE_EXPLOSIVE]=.5,ca.data.bBot)(Aa=ca.data.ai).bCanInteract=!0,Aa.bCanCamp=!1,Aa.bUseActivityTimer=!1,Aa.bLOS=!1}else if(this.localData.bOperation)0==ca.data.team&&(ca.data.damageMultipliers[DamageType.DAMAGE_BULLET]=.2+.1*this.localData.difficulty,ca.data.damageMultipliers[DamageType.DAMAGE_EXPLOSIVE]=.5+.15*this.localData.difficulty);else{if(ca.data.bBot)(Aa=ca.data.ai).bCanInteract=!0,Aa.bCamp=1==this.Random(1,5)}ca.data.bGodMode=ma.bGodMode,ca.data.weapon.bUnlimitedAmmo=ma.bUnlimitedAmmo,m.bHasPawn=!0,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:m.id,data:{bAutoRespawn:m.bAutoRespawn,bHasPawn:m.bHasPawn}}),this.setCharacterCurrentInventoryItem(ca,0)}break;case GameServer.EVENT_CREATE_GENERIC_CHARACTER:var ma=e.data;if(ca=this.createCharacter(ma.id,[ma.x,e.data.y],ma.team,ma.avatarData,ma.inventory,ma.equipment,ma.perks),this.localData.bSurvival||this.localData.bBattlezone?ca.data.inventory[0].ammo=Math.round(ca.data.inventory[0].ammo*Math.random()):ca.data.inventory[0].ammo=0,ca.data.weapon.bUnlimitedAmmo=!0,ca.data.bBot=!0,this.setPawnAI(ca,ma.botSkill,ma.bZombie,ma.bHero),ma.bDummy&&(ca.data.ai.bDisabled=!0),ma.bHostage&&(ca.data.bHostage=!0,ca.data.bGodMode=!this.localData.bOperation&&!this.localData.bSandbox,ca.data.bExposed=!0,ca.data.bUseExposeTimer=!1,ca.data.ai.hostagePos=this.clone(ca.position),this.localData.bOperation&&(ma.damageMultipliers={},ma.damageMultipliers[DamageType.DAMAGE_BULLET]=.2+.1*this.localData.difficulty)),ca.data.ai.bLOS=!1,ca.data.ai.bObjectiveTakesPriority=!1,ca.data.ai.bCanCamp=!1,Aa=ma.ai)for(Oe=Object.keys(Aa),s=0;s<Oe.length;s++){var pa=Oe[s];ca.data.ai[pa]=Aa[pa]}if(ca.data.bRegenHealth=ma.bRegenHealth,ca.data.pawnName&&(ca.data.pawnName=ma.pawnName),ma.perks&&(ca.data.perks=ma.perks),null!=ma.health&&(ca.data.health=ca.data.maxHealth=ma.health,ma.maxHealth=ma.health),null!=ma.killReward&&(ca.data.killReward=ma.killReward),null!=ma.bZombie&&(ca.data.bZombie=ma.bZombie,ca.data.bZombie))if(ca.data.ai.lookRange=Number.MAX_VALUE,ca.data.zombieType=ma.zombieType,this.localData.bSurvival){ca.data.ai.bLOS=!1;var _a=200;(Ta=this.localData.gameModeData.wave)>(Ra=5)&&(_a=Math.min(_a+20*(Ta-Ra-1),300)),ca.data.maxSpeed=_a*(.01*this.Random(80,100))}else this.localData.bOperation?(ca.data.maxSpeed=(200+15*this.localData.difficulty)*(.01*this.Random(80,100)),ca.data.health=ca.data.maxHealth=ma.health*this.localData.difficulty):ca.data.maxSpeed=.01*this.Random(100,120)*200;if(null!=ma.damageMultipliers)for(Oe=Object.keys(ma.damageMultipliers),s=0;s<Oe.length;s++)ca.data.damageMultipliers[Oe[s]]=ma.damageMultipliers[Oe[s]];else ma.bZombie&&(ca.data.damageMultipliers[DamageType.DAMAGE_EXPLOSIVE]=2,ca.data.damageMultipliers[DamageType.DAMAGE_FIRE]=2);null!=ma.maxSpeed&&(ca.data.maxSpeed=ma.maxSpeed),null!=ma.baseSpeedMultiplier&&(ca.data.baseSpeedMultiplier=ma.baseSpeedMultiplier),(this.localData.bSurvival||this.localData.bSandbox||this.isTutorial())&&(ca.data.bUseExposeTimer=!1,ca.data.bExposed=!0),ma.bExposed=ca.data.bExposed,this.setCharacterCurrentInventoryItem(ca,0),ma.inventory=this.clone(ca.data.inventory);break;case GameServer.EVENT_CREATE_INFESTOR:ma=e.data;var Aa,Ia=this.createInfestor(ma.id,[ma.x,ma.y],ma.team,ma.infestorType);if(Ia.data.bBot=!0,this.setPawnAI(Ia,e.data.botSkill,!0),Ia.data.ai.bPreferDistance=!0,Ia.data.ai.bLOS=!1,Ia.data.ai.bCanCamp=!1,Aa=ma.ai)for(Oe=Object.keys(Aa),s=0;s<Oe.length;s++){pa=Oe[s];Ia.data.ai[pa]=Aa[pa]}if(null!=ma.damageMultipliers)for(Oe=Object.keys(ma.damageMultipliers),s=0;s<Oe.length;s++)Ia.data.damageMultipliers[Oe[s]]=ma.damageMultipliers[Oe[s]];else Ia.data.damageMultipliers[DamageType.DAMAGE_EXPLOSIVE]=2,Ia.data.damageMultipliers[DamageType.DAMAGE_FIRE]=3;if(this.localData.bOperation)Ia.data.maxSpeed=this.getSharedData(ma.infestorType).maxSpeed+30*this.localData.difficulty*(.01*this.Random(80,100)),Ia.data.health=Ia.data.maxHealth=ma.health+150*(this.localData.difficulty-1);else{Ia.data.health=Ia.data.maxHealth=ma.health,Ia.data.killReward=ma.killReward;_a=this.getSharedData(ma.infestorType).maxSpeed;if(this.localData.bSandbox)Ia.data.maxSpeed=_a*(.01*this.Random(100,120));else if(this.localData.bSurvival){var Ta,Ra;(Ta=this.localData.gameModeData.wave)>(Ra=10)&&(_a=Math.min(_a+25*(Ta-Ra-1),550)),Ia.data.maxSpeed=_a}}break;case GameServer.EVENT_PLAYER_OPEN_WORLD_MENU:if(!e.killstreakId)!(ca=this.getObjectById(e.playerId))||ca.data.bIsOnLadder||this.characterHasWeaponDelay(ca)?e={}:(this.cancelCharacterReload(ca),this.cancelCharacterBoltPull(ca),this.stopCharacterInteract(ca),ca.data.weapon.bUseDelay=!0,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:ca.data.id,type:GameServer.PAWN_OPEN_LAPTOP}));break;case GameServer.EVENT_PAWN_DAMAGE:if($=e.damageAmount,!this.matchInProgress())break;isNaN($)&&($=0,this.log("Invalid damage amount",e));var Sa=this.getObjectById(e.pawnId),va=this.getPlayerStateById(e.attackerId),ua=this.getObjectById(e.attackerId);if(Sa){var ba=!0;if(Sa.data.bGodMode)break;if("door"==Sa.data.type){ba=!1;break}if("obstacle"==Sa.data.type&&(ba=!1),e.bHitmarker=ba,Sa.data.health>0){this.localData.bBattlezone&&va&&this.getPlayerStateById(e.pawnId)&&($*=.5);var ya=this.getObjectById(e.causerId),Da=Sa.data.damageMultipliers;if(Da&&null!=Da[e.damageType]&&($*=Da[e.damageType]),e.damageType==DamageType.DAMAGE_EXPLOSIVE&&this.characterHasPerk(Sa,Perks.PERK_PLAYER_SPECIALIST)&&($=Math.min(this.getCharacterHealth()-1,.35*$)),e.damageType==DamageType.DAMAGE_FIRE&&this.characterHasPerk(Sa,Perks.PERK_PLAYER_SPECIALIST)&&($*=.1),$=Math.ceil($),Sa.data.health=Math.max(0,Math.round(Sa.data.health-$)),this.pushObjectDataUpdate(Sa.data.id,["health"]),Sa.data.bRegenHealth&&(Sa.data.regenTimer=Sa.data.regenTimerMax),"obstacle"==Sa.data.type&&(Sa.data.playerId=e.attackerId),Sa.data.health<=0)switch(e.bKill=!0,Sa.data.type){case"door":this.removeNextStep(Sa);break;case"obstacle":switch(Sa.data.obstacleId){case"barrel_explosive":this.detonate(Sa);break;default:this.removeNextStep(Sa)}break;case"destructableObject":this.removeNextStep(Sa);break;case"rocket":this.detonate(Sa);break;default:var ga=!(Ma||!va)&&va.team==Sa.data.team;if(Sa.data.bHostage&&(ga=!0),"character"==Sa.data.type&&(Sa.data.bHostage&&(Sa.data.ai.moveDirX=1),this.localData.bRanked)){var Pa=this.getPlayerStateById(e.pawnId);if(va&&Pa){var Ma=va==Pa;this.onEvent({eventId:GameServer.EVENT_KILLFEED_ADD,type:FeedItem.TYPE_KILL,killerId:va.id,killerName:va.name,killerClan:va.clan,killerTeam:va.team,victimId:Pa.id,victimName:Pa.name,victimClan:Pa.clan,victimTeam:Pa.team,weaponId:e.weaponId,bHeadshot:e.bHeadshot,bDirectImpact:e.bDirectImpact,bSuicide:Ma})}else if(this.localData.bBattlezone){var Oa=null;if(ua)switch(ua.data.type){case"infestor":Oa="Infestor";break;default:Oa=ua.data.bZombie?"Zombie":"Mercenary"}else Oa="Mercenary";Oa&&Pa&&this.onEvent({eventId:GameServer.EVENT_KILLFEED_ADD,type:FeedItem.TYPE_KILL,killerName:Oa,killerTeam:ua?ua.data.team:null,victimId:Pa?Pa.id:null,victimName:Pa?Pa.name:null,victimClan:Pa?Pa.clan:null,victimTeam:Pa?Pa.team:null,weaponId:e.weaponId,bHeadshot:e.bHeadshot,bDirectImpact:e.bDirectImpact,bSuicide:Ma})}}var Na=Sa.data.xpReward,La={type:Sa.data.type,damageType:e.damageType,weaponId:e.weaponId};switch(Sa.data.type){case"helicopter":case"turret":La.killstreakId=Sa.data.killstreakId}if(e.bDirectlyCausedByPlayer&&(La.bDirectlyCausedByPlayer=!0),e.bTeamKill||ga?La.bTeamKill=!0:this.localData.bSurvival||(La.xpReward=Na),e.bMelee&&(La.bMelee=!0),Ma&&(La.bSuicide=!0),e.bHeadshot&&(La.bHeadshot=!0),e.bDirectImpact&&(La.bDirectImpact=!0),e.bLongshot&&(La.bLongshot=!0),e.bNearshot&&(La.bNearshot=!0),"character"==Sa.data.type)switch(this.localData.gameModeData.id){case GameMode.DOMINATION:case GameMode.HEADQUARTERS:case GameMode.DEMOLITION:this.isNearFriendlyFlag(Sa)?La.bOffensiveKill=!0:this.isNearEnemyFlag(Sa)&&(La.bDefensiveKill=!0);break;case GameMode.DEFENDER:case GameMode.CAPTURE_THE_FLAG:this.isHoldingFlag(Sa)&&(La.bEnemyHoldingFlag=!0);break;case GameMode.ASSASSINATION:va&&va.bVIP&&(La.bOffensiveKill=!0)}if(ua&&"character"==ua.data.type)switch(this.localData.gameModeData.id){case GameMode.DOMINATION:case GameMode.HEADQUARTERS:case GameMode.DEMOLITION:this.isNearFriendlyFlag(ua)?La.bDefensiveKill=!0:this.isNearEnemyFlag(ua)&&(La.bOffensiveKill=!0);break;case GameMode.DEFENDER:case GameMode.CAPTURE_THE_FLAG:this.isHoldingFlag(ua)&&(La.bOffensiveKill=!0)}if(ya&&("helicopter"==ya.data.type?La.bHeli=!0:"turret"==ya.data.type&&(La.bTurret=!0)),this.localData.bSurvival&&this.localData.gameModeData.id!=GameMode.SURVIVAL_STAKEOUT){La.position=Sa.position;var Ca=Sa.data.killReward;e.bHeadshot?Ca*=1.5:e.bMelee&&(Ca*=2),La.moneyReward=Ca}e.damageAmount=$,this.onPlayerKill(e.attackerId,$,e.pawnId,e.causerId,La,e.bHeadshot),this.onPawnDeath(e.pawnId,$,e.attackerId,e.causerId,La,e.bHeadshot)}else{switch(Sa.data.type){case"character":if(this.isTeamGameMode()){Sa.data.damagedBy||(Sa.data.damagedBy=[]);var fa=Sa.data.damagedBy;-1==fa.indexOf(e.attackerId)&&fa.push(e.attackerId)}break;case"destructableObject":"deployable_cover"==Sa.data.destructableData.type&&(e.bDeployableCover=!0)}if(e.damageType==DamageType.DAMAGE_FIRE&&(Sa.data.bOnFire=!0,Sa.data.fireTimer=Math.round(.5*this.localData.settings.fps),this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:Sa.data.id,type:GameServer.PAWN_ON_FIRE,bValue:!0})),"tazer"==e.weaponId){if(Sa.data.bStunned=!0,this.characterHasPerk(Sa,Perks.PERK_PLAYER_SITREP)){Sa.data.stunTimer=1;var ka=!0}else Sa.data.stunTimer=3*this.localData.settings.fps;this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:Sa.data.id,type:GameServer.PAWN_STUN,bValue:!0})}(Pa=this.getPlayerStateById(Sa.data.id))&&(Pa.bJuggernaut&&(e.bJuggernaut=!0),Pa.bVIP&&(e.bVIP=!0),Pa.bInfected&&(e.bInfected=!0)),ka||e.bSitrep?e.perkId=Perks.PERK_PLAYER_SITREP:this.characterHasPerk(Sa,Perks.PERK_PLAYER_JUGGERNAUT)?e.perkId=Perks.PERK_PLAYER_JUGGERNAUT:e.damageType!=DamageType.DAMAGE_EXPLOSIVE&&e.damageType!=DamageType.DAMAGE_FIRE||!this.characterHasPerk(Sa,Perks.PERK_PLAYER_SPECIALIST)?e.bHeadshot&&this.characterHasPerk(Sa,Perks.PERK_PLAYER_HELMET)&&(e.perkId=Perks.PERK_PLAYER_HELMET):e.perkId=Perks.PERK_PLAYER_SPECIALIST,e.bSniper&&this.characterHasPerk(Sa,Perks.PERK_PLAYER_ANTI_SNIPER)&&(e.perkId=Perks.PERK_PLAYER_ANTI_SNIPER),e.bKnife&&this.characterHasPerk(Sa,Perks.PERK_PLAYER_NINJA)&&(e.perkId=Perks.PERK_PLAYER_NINJA);var Ga=this.getObjectById(e.attackerId);Ga&&(this.characterHasPerk(Ga,Perks.PERK_WEAPON_STOPPING_POWER)&&(Sa.data.bFreeze=!0,Sa.data.freezeTimer=this.localData.settings.fps*(this.localData.bSurvival?2:1),Sa.data.bWantsToSprint=!1,e.bFreeze=!0,this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:Sa.data.id,type:GameServer.PAWN_FREEZE,bValue:!0})),this.characterHasPerk(Ga,Perks.PERK_WEAPON_RECON)&&(e.bReconTagged=!0))}}e.damageAmount=Math.round(e.damageAmount),Sa&&Sa.data.bBot&&this.localData.bMultiplayer&&this.batchData.length>=Settings.BATCH_MAX&&(e.bServerSideOnly=!0)}break;case GameServer.EVENT_PAWN_ACTION:switch("string"==typeof e.type&&console.warn("Not using valid identifier:",e.type),e.type){case GameServer.PAWN_START_LADDER_CLIMB:if((fe=this.getObjectById(e.pawnId))&&!fe.data.bBot){var Ba=this.getObjectById(e.ladderId);Ba&&this.startLadderClimb(fe,Ba)}}for(Oe=Object.keys(e),s=0;s<Oe.length;s++){"boolean"==typeof(wa=e[pa=Oe[s]])&&(1==wa?e[pa]=1:delete e[pa])}}if(e&&!e.bServerSideOnly){for(s=(Oe=Object.keys(e)).length;s>=0;s--){var wa;"boolean"==typeof(wa=e[pa=Oe[s]])?1==e[pa]?e[pa]=1:delete e[pa]:null==wa&&delete e[pa]}this.onEvent(e)}}}isNearFlag(e){if(e)for(var a=this.getAllFlags(),t=0;t<a.length;t++){if(a[t].getAABB().overlaps(e.getAABB()))return!0}return!1}isNearFriendlyFlag(e){if(e){for(var a=this.getAllFlags(),t=0;t<a.length;t++){let r=a[t];if(r.getAABB().overlaps(e.getAABB()))return r.data.team==e.data.team}var r=this.getBombCrate();if(r&&this.Dist(r.position[0],r.position[1],e.position[0],e.position[1])<200)return this.localData.gameModeData.bBombPlanted?this.localData.gameModeData.bombTeam==e.data.team:this.localData.gameModeData.bombTeam!=e.data.team}return!1}isNearEnemyFlag(e){if(e){for(var a=this.getAllFlags(),t=0;t<a.length;t++){let r=a[t];if(r.getAABB().overlaps(e.getAABB()))return r.data.team!=e.data.team}var r=this.getBombCrate();if(r&&this.Dist(r.position[0],r.position[1],e.position[0],e.position[1])<200)return this.localData.gameModeData.bBombPlanted?this.localData.gameModeData.bombTeam!=e.data.team:this.localData.gameModeData.bombTeam==e.data.team}return!1}sendBatchData(){this.batchData.length>0&&(this.onEventFunc({eventId:GameServer.EVENT_BATCH,lobbyId:this.lobbyId,items:this.batchData}),this.batchData=[])}updateContainer(){try{this.update()}catch(e){console.error(e),this.localData.bMultiplayer?this.endGame():this.onEventFunc({eventId:GameServer.EVENT_ERROR,error:e})}}update(){if(this.data){var e=this.localData;if(e.bPaused)e.resetCallTime=!0;else{var a=0,t=0;for(t=0;t<e.playerStates.length;t++){if((v=e.playerStates[t]).controllableId&&(this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:v.id,data:{controllableId:v.controllableId}}),v.bBot)){var r=this.getObjectById(v.controllableId);if(r){var i=!1,s=!1;switch(r.data.type){case"turret":i=!0,s=!0}var o=r.data.maxRange?r.data.maxRange:Number.MAX_VALUE,l=this.getNearestEnemyPawn(r,{bTargetColdBlooded:i,bLOS:!1,maxRange:r.data.bMaxLookRange?Number.MAX_VALUE:o,bIgnoreOutOfSight:s});if(l){var n=this.Dist(r.position[0],r.position[1],l.position[0],l.position[1]);this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_CONTROLLABLE,playerId:v.id,worldX:l.position[0],worldY:l.position[1]})}switch(r.data.type){case"helicopter":r.data.bWantsToFire=null!=l&&n<.5*o,r.data.rockets>0&&(r.data.bWantsToFireRocket=!0),!l&&r.contraint&&this.dropHelicopterCrate(r);break;case"turret":r.data.bWantsToFire=null!=l}}}var d=this.getObjectById(v.id);if(e.gameModeData.bAllowRespawns&&null!=v.timer_respawn&&v.bWaitingToRespawn&&(v.timer_respawn>0?v.timer_respawn--:this.onRespawnTimer(v.id)),null!=v.timer_spawnProtection&&(v.timer_spawnProtection>0?v.timer_spawnProtection--:this.onSpawnProtectionTimer(v.id)),d&&d.data.health)delete d.data.bIsCapturingFlag,v.bHasPawn||(v.bHasPawn=!0,e.gameModeData.bAllowRespawns&&(v.bWaitingToRespawn=!1),this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:v.id,data:{bHasPawn:v.bHasPawn,bWaitingToRespawn:v.bWaitingToRespawn}}));else if(v.bHasPawn)if(v.bHasPawn=!1,e.gameModeData.bAllowRespawns)(null==v.lives||v.lives>0)&&(v.bCanRespawn=!1,v.bWaitingToRespawn=!0,v.respawnTimer<=0&&(null==v.timer_respawn&&(v.respawnTimer=e.gameModeData.respawnTime,v.timer_respawn=this.localData.settings.fps),this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:v.id,data:{bCanRespawn:v.bCanRespawn,bWaitingToRespawn:v.bWaitingToRespawn,bHasPawn:v.bHasPawn,respawnTimer:v.respawnTimer}})));else this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:v.id,data:{bHasPawn:v.bHasPawn,moneyMultiplier:v.moneyMultiplier}}),this.localData.bSurvival&&this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{bPlayerKilled:!0}});v.multiKillTimer>0?v.multiKillTimer--:0===v.multiKillTimer&&(this.endMultiKill(v),v.multiKillTimer=-1),v.avengerTimer>0?v.avengerTimer--:v.avengerTimer=-1}var E=e.world.bodies;for(t=0;t<E.length;t++){var h=E[t],c=h.data;if(c){switch(null!=c.destroyTimer&&(c.destroyTimer--,c.destroyTimer<=0&&this.removeNextStep(h)),c.type){case"equipment":if(!("jammer"==c.weaponData.id)){var m=this.getEquipment("jammer");for(a=0;a<m.length;a++){var p=m[a],_=c.bJammed;if(!_&&!c.jammerId||this.getObjectById(c.jammerId)||(_=!1),p.data.team!=c.team&&p.data.health)this.Dist(h.position[0],h.position[1],p.position[0],p.position[1])<2*c.radius&&(_=!0,c.jammerId=p.data.id);c.bJammed!=_&&this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:c.id,type:GameServer.PAWN_SET_JAMMED,bValue:_}),c.bJammed=_}}}switch(c.bFreeze&&(c.freezeTimer>0?c.freezeTimer--:(delete c.freezeTimer,c.bFreeze=!1,this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:c.id,type:GameServer.PAWN_FREEZE,bValue:!1}))),c.bOnFire&&(c.bWantsToSprint=!1,c.fireTimer>0?c.fireTimer--:(c.bOnFire=!1,this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:c.id,type:GameServer.PAWN_ON_FIRE,bValue:!1}))),c.bStunned&&(c.bWantsToSprint=!1,c.stunTimer>0?c.stunTimer--:(c.bStunned=!1,this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:c.id,type:GameServer.PAWN_STUN,bValue:!1}))),c.bFlashed&&(c.bWantsToSprint=!1,c.flashTimer>0?c.flashTimer--:(c.flashIntensity=null,c.bFlashed=!1,this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:c.id,type:GameServer.PAWN_FLASH,bValue:!1}))),c.type){case"door":c.cooldownTimer>0&&c.cooldownTimer--;break;case"shield":var A=this.getObjectById(c.playerId);if(A&&A.data.health){var I=this.getCurrentCharacterInventoryItem(A);if(I&&"riot_shield"==I.id){var T=A.data.weapon;c.bActive=!(this.playerHasControllable(c.playerId)||A.data.bIsOnLadder||A.data.bWantsToInteract||A.data.bDoorCooldown||T.bThrowDelay||T.bEquipmentDelay||T.bUseDelay),A.data.bWantsToSprint?h.angle=this.ToRad(1==A.data.scale?0:-180):h.angle=A.data.aimRotation;h.position[0]=A.position[0]+25*Math.cos(h.angle),h.position[1]=A.position[1]-10+25*Math.sin(h.angle)}else this.removeNextStep(h)}else this.removeNextStep(h);break;case"infestor":case"character":this.handleCharacter(h),c.bBot&&this.matchInProgress()&&this.handleAICharacter(h);break;case"flag_domination":this.matchInProgress()&&this.handleFlagDomination(h);break;case"flag_ctf":this.matchInProgress()&&this.handleFlagCTF(h);break;case"flag_defender":this.matchInProgress()&&this.handleFlagDefender(h);break;case"equipment":this.matchInProgress()&&this.handleEquipment(h);break;case"obstacle":if(this.matchInProgress()&&this.isTutorial()&&"barrel_explosive"==h.data.obstacleId){var R=this.getCharacters();for(a=0;a<R.length;a++){let e=R[a];if(!e.data.bBot)if(h.getAABB().overlaps(e.getAABB())){this.requestEvent({eventId:GameServer.EVENT_MESSAGE_ADD,data:{message:"STR_EXPLOSIVE_BARRELS",id:"tutorial_explosive_barrels",timer:30}});break}}}break;case"info":if(this.matchInProgress())for(R=this.getCharacters(),a=0;a<R.length;a++){let e=R[a];if(!e.data.bBot)if(h.getAABB().overlaps(e.getAABB())){this.executeInteractable(h,e.data.id);break}}break;case"scavenger_pack":if(this.matchInProgress())for(R=this.getCharacters(),a=0;a<R.length;a++){let e=R[a];if(this.characterHasPerk(e,Perks.PERK_PLAYER_SCAVENGER))if(h.getAABB().overlaps(e.getAABB())){this.executeInteractable(h,e.data.id);break}}break;case"loot_pack":if(this.matchInProgress()&&!h.data.bUsed)for(R=this.getCharacters(),a=0;a<R.length;a++){let e=R[a];if(e&&!e.data.bZombie)if(h.getAABB().overlaps(e.getAABB())){this.executeInteractable(h,e.data.id);break}}break;case"flame":if(this.matchInProgress())if(this.isInSmoke(h))this.removeNextStep(h);else if(h.data.destroyTimer%h.data.ticker==0){var S=this.getPawns().concat(this.getEquipment()).concat(this.getObstaclesWithHealth());for(a=0;a<S.length;a++){let e=S[a];var v;if((!(v=this.getPlayerStateById(e.data.id))||!v.bSpawnProtection)&&(e.data.team!=h.data.team||e.data.id==h.data.playerId&&this.localData.bFriendlyFire)){if(h.data.cooldownTimer>0&&e.data.id==h.data.playerId)continue;h.getAABB().overlaps(e.getAABB())&&this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_FIRE,damageAmount:h.data.damage,pawnId:e.data.id,attackerId:h.data.playerId,causerId:h.data.id,weaponId:h.data.weaponId,bDirectlyCausedByPlayer:!0})}}h.data.cooldownTimer>0&&h.data.cooldownTimer--}break;case"spawner":if(this.matchInProgress())if(c.timer>0)c.timer--;else{c.timer=c.timerMax;var u=null,b=null;switch(c.spawnerId){case"SPAWNER_RANDOM":b=[SurvivalEnemyType.OPFOR_PISTOL,SurvivalEnemyType.OPFOR_BASIC,SurvivalEnemyType.OPFOR_HEAVY,SurvivalEnemyType.OPFOR_RPG,SurvivalEnemyType.RUS_BASIC,SurvivalEnemyType.RUS_HARD,SurvivalEnemyType.RUS_EXPERT,SurvivalEnemyType.RUS_SNIPER,SurvivalEnemyType.RUS_CLAYMORE,SurvivalEnemyType.RUS_SHIELD,SurvivalEnemyType.RUS_EXPLOSIVES,SurvivalEnemyType.USMC_BASIC,SurvivalEnemyType.USMC_HARD,SurvivalEnemyType.USMC_HEAVY,SurvivalEnemyType.USMC_SNIPER,SurvivalEnemyType.GSG9_BASIC,SurvivalEnemyType.GSG9_HARD,SurvivalEnemyType.GSG9_HEAVY,SurvivalEnemyType.GSG9_SNIPER,SurvivalEnemyType.GIGN_BASIC,SurvivalEnemyType.GIGN_HARD,SurvivalEnemyType.GIGN_HEAVY,SurvivalEnemyType.GIGN_SNIPER,SurvivalEnemyType.JUGGERNAUT,SurvivalEnemyType.JUGGERNAUT_JAVELIN,SurvivalEnemyType.JUGGERNAUT_COMMANDER,SurvivalEnemyType.INFESTOR,SurvivalEnemyType.INFESTOR_KING,SurvivalEnemyType.ZOMBIE_DEFAULT,SurvivalEnemyType.ZOMBIE_MELEE,SurvivalEnemyType.ZOMBIE_SPRINTER,SurvivalEnemyType.ZOMBIE_FAT,SurvivalEnemyType.ZOMBIE_FAT_THUMPER,SurvivalEnemyType.ZOMBIE_JUGGERNAUT,SurvivalEnemyType.ZOMBIE_SPITTER,SurvivalEnemyType.ZOMBIE_EXPLODER,SurvivalEnemyType.ZOMBIE_SPITTER,SurvivalEnemyType.ZOMBIE_SPITTER_BOSS,SurvivalEnemyType.ZOMBIE_EXPLODER_BOSS,SurvivalEnemyType.ZOMBIE_RIFLE,SurvivalEnemyType.ZOMBIE_RPG,SurvivalEnemyType.ZOMBIE_SHIELD];break;case"SPAWNER_USMC":b=[SurvivalEnemyType.USMC_BASIC,SurvivalEnemyType.USMC_HARD,SurvivalEnemyType.USMC_HEAVY,SurvivalEnemyType.USMC_SNIPER];break;case"SPAWNER_GSG9":b=[SurvivalEnemyType.GSG9_BASIC,SurvivalEnemyType.GSG9_HARD,SurvivalEnemyType.GSG9_HEAVY,SurvivalEnemyType.GSG9_SNIPER];break;case"SPAWNER_GIGN":b=[SurvivalEnemyType.GIGN_BASIC,SurvivalEnemyType.GIGN_HARD,SurvivalEnemyType.GIGN_HEAVY,SurvivalEnemyType.GIGN_SNIPER];break;case"SPAWNER_OPFOR":b=[SurvivalEnemyType.OPFOR_PISTOL,SurvivalEnemyType.OPFOR_BASIC,SurvivalEnemyType.OPFOR_HEAVY,SurvivalEnemyType.OPFOR_RPG];break;case"SPAWNER_RUS":b=[SurvivalEnemyType.RUS_BASIC,SurvivalEnemyType.RUS_HARD,SurvivalEnemyType.RUS_EXPERT,SurvivalEnemyType.RUS_SNIPER,SurvivalEnemyType.RUS_CLAYMORE,SurvivalEnemyType.RUS_SHIELD];break;case"SPAWNER_JUGGERNAUT":b=[SurvivalEnemyType.JUGGERNAUT,SurvivalEnemyType.JUGGERNAUT,SurvivalEnemyType.JUGGERNAUT,SurvivalEnemyType.JUGGERNAUT_JAVELIN,SurvivalEnemyType.JUGGERNAUT_COMMANDER];break;case"SPAWNER_ZOMBIE":b=[SurvivalEnemyType.ZOMBIE_DEFAULT,SurvivalEnemyType.ZOMBIE_MELEE,SurvivalEnemyType.ZOMBIE_SPRINTER,SurvivalEnemyType.ZOMBIE_FAT,SurvivalEnemyType.ZOMBIE_FAT_THUMPER,SurvivalEnemyType.ZOMBIE_JUGGERNAUT,SurvivalEnemyType.ZOMBIE_SPITTER,SurvivalEnemyType.ZOMBIE_EXPLODER,SurvivalEnemyType.ZOMBIE_SPITTER,SurvivalEnemyType.ZOMBIE_SPITTER_BOSS,SurvivalEnemyType.ZOMBIE_EXPLODER_BOSS];break;case"SPAWNER_INFESTOR":b=[SurvivalEnemyType.INFESTOR]}if(b&&(u=b[this.Random(0,b.length-1)]),u){var y={team:c.team,unitId:u,pos:h.position};this.createSandboxUnit(y)}}break;case"grenade":if(c.stuckToId)this.getObjectById(c.stuckToId)||h.constraint&&(this.localData.world.removeConstraint(h.constraint),delete h.constraint,h.gravityScale=1);c.bDetonationTimerEnabled&&(c.detonationTimer>0?c.detonationTimer--:0==c.detonationTimer&&(c.bDetonated||c.grenadeData.bImpact||this.detonate(h))),c.minTimer>0&&(c.minTimer--,c.minTimer<=0&&delete c.minTimer);break;case"reviver":this.matchInProgress()&&(h.position[0]=Math.max(0,h.position[0]),h.position[0]=Math.min(this.getCurrentMapData().width,h.position[0]),c.currentPawnId||null==c.bleedTimer||(c.bleedTimer>0?c.bleedTimer--:0===c.bleedTimer&&(c.bleedTimer=-1,this.localData.bOperation?this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_DEAD_ALLY}):this.removeNextStep(h))));break;case"crate":switch(c.interactData.type){case Crate.CRATE_BOMB_GENERIC:c.bBombPlanted&&(c.bombTimer>0?c.bombTimer--:c.bDetonated||this.detonate(h))}h.position[1]>this.getCurrentMapData().height&&this.removeNextStep(h);break;case"helicopter":this.handleHelicopter(h);break;case"turret":this.handleTurret(h);break;case"rocket":if(0==c.destroyTimer&&this.detonate(h),h.position[1]<-500&&this.removeNextStep(h),c.rocketData.enemyId&&!c.path){if((N=this.getObjectById(c.rocketData.enemyId))&&N.data.health){var D=N.position[0]-h.position[0],g=N.position[1]-h.position[1],P=Math.atan2(g,D),M=300,O=this.WrapAngle(h.angle-P,!0);h.angle-=.5*O,h.applyForce([Math.cos(h.angle)*M,Math.sin(h.angle)*M],0,0),this.constrainVelocity(h,1e3)}else if(c.bAutoLock){var N;(N=this.getNearestEnemyPawn(h,{bTargetColdBlooded:!1,bIgnoreOutOfSight:!1,maxRange:2e3,pawnTypes:["helicopter"],bLOS:!1}))&&(c.rocketData.enemyId=N.data.id)}}else if(c.bControllable){M=300;h.applyForce([Math.cos(h.angle)*M,Math.sin(h.angle)*M],0,0),this.constrainVelocity(h,c.bBoost?1400:700)}else if(c.path){var L=c.path;if(L.length>0){var C=c.path[0];if(C)if(this.Dist(C[0],C[1],h.position[0],h.position[1])<200)L.splice(0,1);else{D=C[0]-h.position[0],g=C[1]-h.position[1],P=Math.atan2(g,D),M=500,O=this.WrapAngle(h.angle-P,!0);h.angle-=O,h.applyForce([Math.cos(h.angle)*M,Math.sin(h.angle)*M],0,0),this.constrainVelocity(h,1e3)}}else delete c.path}}if(c&&!c.bSkipServerUpdate){var f=c.id;if(f){e.objectsToUpdate||(e.objectsToUpdate={});var k=e.objectsToUpdate;k[f]||(k[f]=[]);var G=k[f],B=[Math.round(h.position[0]),Math.round(h.position[1])],w=null;h.mass>0&&(w=[Math.round(h.velocity[0]),Math.round(h.velocity[1])]);var K=null,H=null,U=null;(c.bFixed||h.mass>0&&!h.fixedRotation)&&(K=this.RoundDecimal(h.angle),H=Math.round(h.angularForce),U=Math.round(h.angularVelocity));var W=this.clone(c),V={};null!=B&&(V.position=B),null!=W&&(V.data=W),null!=w&&(V.velocity=w),null!=K&&(V.rotation=K),null!=H&&(V.angularForce=H),null!=U&&(V.angularVelocity=U),(x=Object.keys(V).length)>0&&(V.id=f,G.push(V))}}}}if(1==e.updateCounter){if(e.objectsToUpdate){var Y=Object.keys(e.objectsToUpdate),F={},x=Y.length;for(t=0;t<x;t++){var q=Y[t],Z=e.objectsToUpdate[q];if(F[q]=Z[Z.length-1].data,Z.length==this.localData.settings.update_counter_max){var z=[];for(a=0;a<Z.length;a++){var j=Z[a],J=null,X=null;if(a>0)J=Z[a-1].data;else{var Q=e.prevObjectData;Q&&(J=Q[j.id])}if(J)if(W=this.removeDuplicateKeys(j.data,J))(X=this.clone(j)).data=W,z.push(X);X||z.push(j)}z&&(e.objectsToUpdate[q]=z)}}this.onEvent({eventId:GameServer.EVENT_OBJECT_UPDATE,objects:e.objectsToUpdate}),e.prevObjectData=F,delete e.objectsToUpdate}e.updateCounter=e.updateCounterMax}else e.updateCounter--;e.deadswitchCooldownTimer>0?e.deadswitchCooldownTimer--:0===e.deadswitchCooldownTimer&&delete e.deadswitchCooldownTimer;var $=e.killstreaks;if($){var ee=!1,ae=!1;for(t=$.length-1;t>=0;t--){var te=$[t],re=te.rockets;if(re)for(a=0;a<re.length;a++){var ie=re[a];if(!(ie.timer>0)){this.createRocket(ie.position,ie.rocketData),re.splice(0,1);break}ie.timer--}if(te.timer>0)te.timer--;else{switch(te.id){case Killstreaks.KILLSTREAK_DEADSWITCH:this.executeDeadswitch(te.playerId),ae=!0}$.splice(t,1),ee=!0}}ee&&this.onEvent({eventId:GameServer.EVENT_KILLSTREAKS_UPDATE,killstreaks:$,bDeadswitch:ae})}var se=e.world,oe=0,le=Date.now();for(e.resetCallTime?(oe=0,e.resetCallTime=!1):void 0!==le&&void 0!==e.lastTimeMilliseconds&&(oe=(le-e.lastTimeMilliseconds)/1e3),se.step(this.localData.settings.fixed_timestep,oe,e.bMultiplayer?30:10),e.lastTimeMilliseconds=le;e.toRemove.length>0;)this.removeObject(e.toRemove[0]),e.toRemove.splice(0,1)}this.sendBatchData()}else console.warn("Invalid data reference in game loop!")}destroy(){this.log("Destroy game");var e=this.localData;if(e){var a=e.world;if(a){a.time=0,a.fixedStepTime=0,a.solver&&a.solver.equations.length&&a.solver.removeAllEquations();for(var t=a.constraints,r=t.length-1;r>=0;r--)a.removeConstraint(t[r]);var i=a.bodies;for(r=i.length-1;r>=0;r--)a.removeBody(i[r]);var s=a.springs;for(r=s.length-1;r>=0;r--)a.removeSpring(s[r]);var o=a.contactMaterials;for(r=o.length-1;r>=0;r--)a.removeContactMaterial(o[r]);a.off("beginContact",this.onBeginContact,this)}for(clearInterval(e.interval),this.stopAllTimers();this.localData.playerStates.length>0;)this.removePlayerStateById(this.localData.playerStates[0].id);this.localData.playerStates=null,this.onEndCallback=null,this.batchData=null,this.localData.graphInstance&&(this.localData.graphInstance.clear(),this.localData.graphInstance=null),delete this.onEndCallback,delete this.onEventFunc,delete this.localData,delete this.lobbyId,delete this.data,this.bDestroyed=!0}}log(e){console.log(Settings.LOG_PREFIX+" "+e)}removeDuplicateKeys(e,a){if(e&&a){for(var t={},r=Object.keys(e),i=0;i<r.length;i++){var s=r[i],o=e[s];switch("boolean"==typeof o?o=o?1:0:"number"==typeof o&&o%1!=0&&(o=this.RoundDecimal(o)),s){case"ai":case"weapon":case"damageMultipliers":case"inventory":case"perks":case"interactData":case"avatarData":case"inputPosition":case"bBot":case"regenTimer":case"bRegen":case"exposedTimer":case"interactData":case"bZombie":case"zombieType":case"xpReward":case"enemyId":case"moveX":case"moveY":case"jumpHeight":case"regenAmount":case"regenTimer":case"regenTimerMax":case"cooldownTimer":case"bADS":case"bEnabled":case"carrierId":case"bActivated":case"bIsBeingCaptured":case"interactTeam":case"team":case"equipment":case"bIsReloading":case"climbSpeedMultiplier":case"bRegenHealth":case"currentInventoryIndex":case"weaponData":case"bZombie":case"zombieType":case"bHostage":case"bVIP":case"projectileData":case"pawnName":case"clientPos":break;case"reloadMultiplier":e.bBot||(t[s]=o);break;case"bOnGround":case"bWantsToCrouch":case"bWantsToMove":case"bWantsToSprint":case"interactTeam":case"health":case"maxHealth":case"step":case"bWantsToFire":"boolean"==typeof(l=o)&&(l=l?1:0),t[s]=l;break;case"lookPos":t[s]=this.roundNumberArray(o);break;default:var l;"boolean"==typeof(l=a[s])&&(l=l?1:0),l!==o&&(t[s]=o)}}if(t)return t}else console.warn("removeDuplicateKeys: Invalid source or target reference");return null}getRandomUniqueId(){for(var e=0;e<4;e++){var a=Math.random().toString(36).substr(2,4);if(!this.getObjectById(a))return a}return a}constrainVelocity(e,a){var t,r,i;(r=e.velocity[0])*r+(i=e.velocity[1])*i>a*a&&(t=Math.atan2(i,r),r=Math.cos(t)*a,i=Math.sin(t)*a,e.velocity[0]=r,e.velocity[1]=i)}getTotalVelocity(e){if(e){var a=e.velocity[0],t=e.velocity[1];return a*a+t*t}return 0}setPaused(e){var a=this.localData;if(a.bPaused=e,a.timer_game){var t=a.timer_game;e?t.pause():t.resume()}a.timer_preGame&&(t=a.timer_preGame),a.timer_wave&&(t=a.timer_wave),a.timer_waveSpawn&&(t=a.timer_waveSpawn)}getWinner(){return this.localData&&this.localData.gameModeData?this.localData.gameModeData.winner:-1}endGame(){if(this.bGameEnded)this.log("Game is already ended");else{this.log("End game"),this.bGameEnded=!0,this.localData.matchState=MatchState.STATE_POST_GAME,this.localData.gameModeData.bAllowRespawns=!1,this.stopAllTimers();for(var e=this.getPawns(),a=0;a<e.length;a++){var t=e[a];switch(t.data.bWantsToFire=!1,t.data.type){case"helicopter":t.data.ammo=0;break;case"character":t.data.bWantsToFire=!1}}this.onEndCallback&&this.onEndCallback.apply(this,[this.lobbyId])}}matchInProgress(){return this.localData.matchState==MatchState.STATE_IN_PROGRESS}matchHasEnded(){return!this.localData||this.localData.matchState==MatchState.STATE_POST_GAME}roundHasEnded(){return!this.localData||this.localData.matchState==MatchState.STATE_POST_ROUND}createWorld(){var e=this.localData;e.objects={};var a=new p2.World({gravity:[0,600],broadphase:new p2.NaiveBroadphase,islandSplit:!1});a.defaultContactMaterial.friction=.5,this.localData.bMultiplayer?(a.solver.tolerance=.01,a.solver.iterations=10):(a.solver.tolerance=.9,a.solver.iterations=1),a.emitImpactEvent=!this.localData.bPerformanceMode,a.sleepMode=p2.World.BODY_SLEEPING,a.on("beginContact",this.onBeginContact,this),this.localData.world=a;var t=this.getCurrentMapData(),r=CollisionGroups.PAWN|CollisionGroups.PROJECTILE|CollisionGroups.DRONE|CollisionGroups.FLAME,i=new p2.Material;e.materials={ground:i};var s=new p2.Body({angle:3*Math.PI/2});s.data={id:"bounds_left",type:"ground",bSkipServerUpdate:!0},s.addShape(new p2.Plane({collisionGroup:CollisionGroups.GROUND,collisionMask:r})),this.addWorldBody(s);var o=new p2.Body({angle:Math.PI/2,position:[t.width,0]});o.data={id:"bounds_right",type:"ground",bSkipServerUpdate:!0},o.addShape(new p2.Plane({collisionGroup:CollisionGroups.GROUND,collisionMask:r})),this.addWorldBody(o);var l=new p2.Body({angle:this.ToRad(180),position:[0,t.height]});l.data={id:"bounds_bottom",type:"ground",bSkipServerUpdate:!0},l.addShape(new p2.Plane({collisionGroup:CollisionGroups.GROUND,collisionMask:r})),this.addWorldBody(l);var n=t.objects;if(n)for(var d=0;d<n.length;d++){var E=n[d];switch(E.type){case"polygon":var h=new p2.Body({mass:0,position:E.position});h.allowSleep=!0;var c=CollisionGroups.GROUND,m=CollisionGroups.PAWN|CollisionGroups.PROJECTILE|CollisionGroups.DRONE|CollisionGroups.FLAME,p="ground";E.bPlatform&&(c=CollisionGroups.PLATFORM,m=CollisionGroups.PAWN,p="platform"),this.loadPolygon(E.spriteId,h,E.width,E.height,1,{material:this.localData.materials.ground,collisionGroup:c,collisionMask:m}),h.data={id:"map",type:p,bSkipServerUpdate:!0},this.addWorldBody(h);break;case"ground":(_=new p2.Body({mass:0,position:E.position})).allowSleep=!0,_.data={id:this.getRandomUniqueId(),type:E.type,material:E.material,bSkipServerUpdate:!0},_.addShape(new p2.Box({width:E.width,height:E.height,collisionGroup:CollisionGroups.GROUND,collisionMask:CollisionGroups.PAWN|CollisionGroups.PROJECTILE|CollisionGroups.DRONE|CollisionGroups.FLAME})),this.addWorldBody(_);break;case"platform":var _=new p2.Body({mass:0,position:E.position});null!=E.rotation&&(_.angle=this.ToRad(E.rotation)),_.allowSleep=!0,_.data={id:this.getRandomUniqueId(),type:E.type,material:E.material,bSkipServerUpdate:!0},_.addShape(new p2.Box({width:E.width,height:E.height,collisionGroup:CollisionGroups.PLATFORM,collisionMask:CollisionGroups.PAWN|CollisionGroups.FLAME})),this.addWorldBody(_);break;case"ladder":this.getObjectById(E.id)&&console.warn("Ladder already exists:",E.id),(_=new p2.Body({mass:0,position:E.position})).allowSleep=!0,_.data={id:E.id,type:E.type,width:this.getSharedData("ladderWidth")?this.getSharedData("ladderWidth"):15,height:E.height,direction:E.direction,bPlayer:E.bPlayer,bBot:E.bBot,bSkipServerUpdate:!0};var A=new p2.Box({width:E.width,height:E.height});A.sensor=!0,_.addShape(A),this.addWorldBody(_);break;case"obstacle":this.createObstacle(E);break;case"door":this.createDoor(E)}}e.lastTimeMilliseconds=void 0}createDoor(e){var a=new p2.Body({mass:0,position:e.position,allowSleep:!0,fixedRotation:!0,sleepSpeedLimit:1,sleepTimeLimit:1});e.height||console.warn("Missing height");var t=e.width?e.width:40,r=e.height,i=Math.max(50,t),s=Math.max(100,r),o=e.material?e.material:"wood";a.data={id:e.id?e.id:this.getRandomUniqueId(),type:"door",bClosed:e.bClosed,material:o,width:t,height:r,useHeight:s,cooldownTimer:0},e.doorType&&(a.data.interactData={doorType:e.doorType});a.data.team=-1,a.data.damageMultipliers={1:1,2:1,3:1},a.addShape(new p2.Box({width:i,height:s,collisionGroup:CollisionGroups.PAWN})),this.addWorldBody(a),this.requestEvent({eventId:GameServer.EVENT_SPAWN_OBJECT,data:{id:a.data.id,position:a.position,type:"door",data:e}}),this.setDoorClosed(a,a.data.bClosed)}setDoorClosed(e,a,t,r,i){if(e){var s=e.data;if(!i&&s.cooldownTimer>0)return;var o=s.bClosed;s.bClosed=a;var l=e.shapes[0];if(a?(l.collisionGroup=CollisionGroups.GROUND,l.collisionMask=CollisionGroups.PAWN|CollisionGroups.PROJECTILE|CollisionGroups.DRONE|CollisionGroups.FLAME):(l.collisionGroup=0,l.collisionMask=0),s.bClosed!=o){var n=null;if(t){if(s.cooldownTimer=Math.round(.5*this.localData.settings.fps),!a){var d=t.previousPosition?t.previousPosition:t.position;n=e.position[0]>d[0]?1:-1}(r||a)&&this.emitAISound(e.position,t.data.team,400)}this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:s.id,causerId:t?t.data.id:null,type:GameServer.PAWN_UPDATE_DOOR,bClosed:s.bClosed,scale:n,bImpact:r})}}}createObstacle(e){if(!(this.localData.bNoSandbags&&e.obstacleId.indexOf("sandbags")>=0)){var a,t=new p2.Body({mass:0,position:e.position,allowSleep:!0,sleepSpeedLimit:1,sleepTimeLimit:1}),r=this.getSharedData(e.obstacleId),i=r.width,s=r.height;switch(e.obstacleId){case"barrel_explosive":var o=25;a="metal";break;case"sandbags":case"sandbags_large":case"sandbags_tall":case"sandbags_narrow":case"sandbags_edge":a="sandbag";break;case"window":o=1,a="glass";break;default:a="default"}e.rotation&&(t.angle=this.ToRad(e.rotation)),t.data={id:e.id?e.id:this.getRandomUniqueId(),obstacleId:e.obstacleId,scale:e.scale,rotation:e.rotation,type:e.type,material:a,width:i,height:s,bBlock:e.bBlock,bSkipServerUpdate:!0},o>0&&(t.data.health=o,t.data.team=-1,t.data.damageMultipliers={1:1,2:1,3:50}),t.addShape(new p2.Box({width:i,height:s,collisionMask:CollisionGroups.PROJECTILE})),this.addWorldBody(t),this.requestEvent({eventId:GameServer.EVENT_SPAWN_OBJECT,data:{id:t.data.id,position:t.position,rotation:t.angle,type:"obstacle",data:e}})}}onBeginContact(e){this.bDestroyed||(this.onHit(e.bodyA,e.bodyB),this.onHit(e.bodyB,e.bodyA))}onHit(e,a){var t=e.data,r=a.data;if((!r||!r.bInvisible)&&t){if(t.bPendingRemoval)return;switch(t.type){case"crate":this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:t.id,type:GameServer.PAWN_HIT});break;case"flame":t.bFromWeapon&&(e.velocity[0]*=.5,e.velocity[1]*=.5);break;case"character":case"infestor":switch(r.type){case"platform":case"ground":if(t.bOnGround,this.isHardcore()&&e.velocity&&!this.characterHasPerk(e,Perks.PERK_PLAYER_NINJA)){var i=e.velocity[1];i>400&&this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_WORLD,damageAmount:.05*i,pawnId:t.id,attackerId:t.id,causerId:r.id,weaponId:"fall",bDirectlyCausedByPlayer:!1})}}break;case"door":t.bClosed&&("character"!=r.type&&"infestor"!=r.type||(r.bBot||r.bWantsToSprint)&&this.setDoorClosed(e,!1,a,!0,r.bBot));break;case"helicopter":"ground"===r.type&&(t.health||(this.createExplosion({eventId:GameServer.EVENT_SPAWN_EXPLOSION,x:e.position[0],y:e.position[1],radius:500,damage:0,playerId:null,causerId:null,weaponId:null}),this.removeNextStep(e)));break;case"projectile":if(!t.bHit){var s=!0;if((this.localData.bSurvival||this.localData.bSandbox||this.localData.bOperation&&1==t.team)&&(s=t.team!=r.team),t.projectileData.playerId==r.id&&(s=!1),"shield"==r.type&&t.projectileData.playerId==r.playerId&&(s=!1),s)(_=this.getPlayerStateById(r.id))&&_.bSpawnProtection&&(s=!1);if(s){if(t.bHit=!0,"character"==r.type){var o=r.material?r.material:"default";this.createImpactEffect(e.position[0],e.position[1],e.angle,o,1)}if(t.team!=r.team){var l=DamageType.DAMAGE_MELEE;if("zombie_spitter_boss"==t.projectileData.weaponId&&(l=DamageType.DAMAGE_EXPLOSIVE),r.health){var n=t.damage;switch(t.projectileData.weaponId){case"knife":"character"==r.type&&(e.position[1]>a.position[1]+10&&(n*=.5),this.characterHasPerk(a,Perks.PERK_PLAYER_NINJA)&&(n=Math.min(n,100)));break;case"crossbow":if(r.bZombie&&(n*=2),"character"==r.type)if(e.position[1]<a.position[1]-20){var d=!0;n*=2}else e.position[1]>a.position[1]+10&&(n*=this.localData.bSurvival?.5:.25);else"infestor"==r.type&&e.position[1]>a.position[1]&&(d=!0,n*=2)}this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:l,damageAmount:n,pawnId:r.id,attackerId:t.projectileData.playerId,causerId:t.id,weaponId:t.projectileData.weaponId,bMelee:"knife"==t.projectileData.weaponId||"crossbow"==t.projectileData.weaponId,bKnife:"knife"==t.projectileData.weaponId,bHeadshot:d,bDirectlyCausedByPlayer:!0})}}var E=e.previousPosition?e.previousPosition:e.position;switch(t.projectileData.weaponId){case"knife":this.createDroppedWeapon(this.getRandomUniqueId(),E,e.rotation,1,{weaponData:this.getWeaponData(t.projectileData.weaponId),playerId:t.projectileData.playerId});break;case"crossbow":this.createImpactEffect(E[0],E[1],e.rotation,"default",1)}this.removeNextStep(e)}}break;case"grenade":if(t.grenadeData.bImpact){if(r){var h=t.minTimer>0&&!t.bDud;switch(r.type){case"helicopter":var c=!0,m=!0;if((I=this.getPlayerStateById(t.grenadeData.playerId))?I.id==r.heliData.playerId?m=c=this.localData.bFriendlyFire&&!r.bPlayerControlled:I.team==r.team&&(c=!1,m=!1):t.team==r.team&&(c=!1,m=!1),c){var p=t.damage;this.localData.bModeGame&&(p*=.75),this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_EXPLOSIVE,damageAmount:p,pawnId:r.id,attackerId:t.grenadeData.playerId,causerId:t.id,weaponId:t.grenadeData.weaponId})}m&&this.detonate(e,r.id);break;case"infestor":case"character":var _;m=!0;if((I=this.getPlayerStateById(t.grenadeData.playerId))?I.id==r.id&&(m=!1):t.grenadeData.playerId==r.id&&(m=!1),m&&t.grenadeData.team==r.team&&(m=!this.localData.bSurvival&&!this.localData.bSandbox&&!this.localData.bBattlezone),m)if(h)(_=this.getPlayerStateById(r.id))&&_.bSpawnProtection||t.grenadeData.team==r.team?this.createImpactEffect(e.position[0],e.position[1],e.angle,"grenade",1):(this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_MELEE,damageAmount:200,pawnId:r.id,attackerId:t.grenadeData.playerId,causerId:t.id,weaponId:t.grenadeData.weaponId,bDirectImpact:!0}),t.bDud=!0),this.removeNextStep(e);else this.detonate(e);break;case"turret":m=!0;(this.localData.bSurvival||t.team==r.team)&&(m=!1),m&&this.detonate(e);break;case"obstacle":this.localData.bSurvival?t.grenadeData.team:this.detonate(e);break;case"door":this.detonate(e),this.setDoorClosed(a,!1,e,!0);break;default:this.detonate(e)}}}else if(t.grenadeData.bStartDetonationAfterHit&&(t.bDetonationTimerEnabled=!0),this.getWeaponData(t.grenadeData.weaponId).bSticky&&!e.constraint){switch(e.velocity[0]=0,e.velocity[1]=0,e.angularVelocity=0,a.data.type){case"shield":var A=new p2.LockConstraint(e,a);break;default:A=new p2.RevoluteConstraint(e,a,{worldPivot:[e.position[0],e.position[1]]})}A.setStiffness(1e3),this.localData.world.addConstraint(A),e.constraint=A,t.bStuck=!0,t.stuckToId=a.data.id}break;case"rocket":if(r)switch(r.type){case"helicopter":var I;c=!0,m=!0;(I=this.getPlayerStateById(t.rocketData.playerId))?t.rocketData.causerId==r.id?c=!1:I.id==r.heliData.playerId?c=this.localData.bFriendlyFire:I.team==r.team&&(c=!1):t.rocketData.team==r.team&&(c=!1),m=c,c&&this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_EXPLOSIVE,damageAmount:t.damage,pawnId:r.id,attackerId:t.rocketData.playerId,causerId:t.id,weaponId:t.rocketData.weaponId}),m&&this.detonate(e,r.id);break;case"character":m=!0;var T=this.getObjectById(t.rocketData.playerId);T&&(T.data.id==r.id?m=!1:t.rocketData.team==r.team&&(m=!this.localData.bSurvival&&!this.localData.bSandbox&&!this.localData.bBattlezone)),m&&this.detonate(e);break;case"obstacle":case"destructableObject":this.localData.bSurvival?t.rocketData.team:this.detonate(e);break;case"turret":m=!0;this.localData.bSurvival||this.localData.bSandbox?m=0!=t.rocketData.team:t.team==r.team&&(m=!1),m&&this.detonate(e);break;case"equipment":break;case"door":this.detonate(e),this.setDoorClosed(a,!1,e,!0);break;default:this.detonate(e)}}}}createWeaponObject(){return{fireDelayTimer:0,burstTimer:0,recoil:0}}characterNeedsWeapon(e){var a=e.data;if(a.bNoPickups)return!1;if(1==a.inventory.length){if(a.inventory[0].type===Weapon.TYPE_PISTOL)return!0;if(this.characterHasNoAmmo(e))return!0}else if(this.characterHasNoAmmo(e))return!0;return!1}characterHasNoAmmo(e){for(var a=e.data,t=0;t<a.inventory.length;t++){var r=a.inventory[t];if(r.ammo>0&&r.mag>0)return!1}return!0}characterIsLowOnAmmo(e){var a=this.getCurrentCharacterInventoryItem(e);return a.ammo<=a.magSize}characterShouldReload(e){var a=this.getCurrentCharacterInventoryItem(e);return a.mag<a.magSize}getBestInventoryIndex(e,a,t){for(var r=e.data,i=r.inventory,s=r.currentInventoryIndex,o=0,l=0;l<i.length;l++){var n=i[l],d=n.damage;n.type==Weapon.TYPE_SHOTGUN?d*=6:n.type==Weapon.TYPE_LAUNCHER&&(d*=.5);var E=d*n.magSize;if(n.mag>0||n.ammo>0||r.weapon.bUnlimitedAmmo){var h=a?this.getPlayerStateById(a.data.id):null;a&&"helicopter"==a.data.type?n.bRocket&&(s=l):h&&h.bJuggernaut&&!n.bAirOnly&&n.type==Weapon.TYPE_LAUNCHER||a&&t<200&&"riot_shield"==n.id?s=l:E>o&&!n.bAirOnly&&(s=l,o=E)}}return s}hasInventoryAmmo(e){for(var a=e.data,t=a.inventory,r=0;r<t.length;r++)if(t[r].mag>0||t[r].ammo>0)return!0;return!!a.weapon.bUnlimitedAmmo}emitAISound(e,a,t,r=0){if(this.localData.bOperation||this.localData.bBattlezone){for(var i=this.getCharacters(),s=0;s<i.length;s++){var o=i[s];if((E=o.data).bBot){if(null!=a&&a==E.team)continue;var l=E.ai;if(l&&!l.bDisabled&&l.bCanInvestigate&&!l.currentEnemy){var n=this.Dist(e[0],e[1],o.position[0],o.position[1]);if(!E.bStunned&&!E.bFlashed){if(l.investigatePos&&l.investigatePriority>r)continue;n<=(t||l.hearRange)&&(this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:E.id,type:GameServer.PAWN_INVESTIGATE}),l.investigatePos=this.clone(e),l.investigatePriority=r,l.returnPos=this.clone(o.position))}}}}var d=this.getHelicopters();for(s=0;s<d.length;s++){var E,h=d[s];if(0!=(E=h.data).team)(n=this.Dist(e[0],e[1],h.position[0],h.position[1]))<=1500+500*this.localData.difficulty&&(E.heliData.destination=[e[0]-(E.muzzleOffsetX?E.muzzleOffsetX:0),E.bDrone?e[1]:Math.min(e[1],this.getHeliMaxY())])}}}getBestSpawnPosition(e,a){var t=this.getCurrentMapData(),r=t.spawns;if(0==this.getCharacters().length)return r[this.Random(0,r.length-1)];var i=[],s=this.getCharacters();s=(s=s.concat(this.getHelicopters())).concat(this.getAllFlags());var o=this.getBombCrate();o&&s.push(o);for(var l=0;l<r.length;l++){for(var n=r[l],d=0,E=0,h=0,c=0;c<s.length;c++){var m=s[c];if(m!=a){var p=this.Dist(m.position[0],m.position[1],n[0],n[1]),_=t.width;if(p<_){var A=p/_;if("crate_bomb"==m.data.id&&(h+=10),m.data.team!=e)switch((p<300||this.isInLOS(n,[m.position[0],m.position[1]],m))&&h++,m.data.type){case"flag_domination":this.localData.gameModeData.id==GameMode.DOMINATION&&(d+=3*A);break;case"flag_defender":case"flag_ctf":default:d+=A}else switch(m.data.type){case"flag_domination":this.localData.gameModeData.id==GameMode.DOMINATION&&(p<600&&E++,d-=3*A);break;case"flag_defender":case"flag_ctf":break;default:d-=A}}}}i.push({index:l,flags:E,enemies:h,danger:d})}i.sort((function(e,a){return e.flags>a.flags?-1:e.flags<a.flags||e.enemies>a.enemies?1:e.enemies<a.enemies||e.danger>a.danger?-1:e.danger<a.danger?1:0})),i=[i[0],i[1],i[2]],this.shuffleArray(i);var I=r[i[0].index];return[I[0]+this.Random(-40,40),I[1]]}getBombCrate(){return this.getObjectById("crate_bomb")}isBeingInteractedWith(e){for(var a=this.getCharacters(),t=0;t<a.length;t++){if(a[t].data.interactableId==e.data.id)return!0}return!1}getBestInteractable(e){if(this.localData.bBattlezone){var a=this.getCurrentCharacterInventoryItem(e);if(a&&this.isMeleeWeapon(a))return null;var t=this.getLootPacks();if(t.length>0){t.sort(((a,t)=>{var r=this.Dist(e.position[0],e.position[1],a.position[0],a.position[1]),i=this.Dist(e.position[0],e.position[1],t.position[0],t.position[1]);return r<i?-1:r>i?1:0}));var r=t[0];if(r)return[r,!0]}}var i=this.getBombCrate();if(i)if(i.data.bBombPlanted){if(e.data.team!=this.localData.gameModeData.bombTeam)return[i,!1]}else if(e.data.team==this.localData.gameModeData.bombTeam)return[i,!1];var s=this.getRevivers();if(s.length>0)return[s[0],!1];var o=this.characterIsLowOnAmmo(e),l=this.characterHasNoAmmo(e);if(l||o){var n=this.getAmmoCrates();if(n.length>0)return n.sort(((a,t)=>{var r=this.Dist(e.position[0],e.position[1],a.position[0],a.position[1]),i=this.Dist(e.position[0],e.position[1],t.position[0],t.position[1]);return r<i?-1:r>i?1:0})),[n[0],!0]}if(this.characterNeedsWeapon(e)){var d=this.getDroppedWeapons(!0);if(d.length>0)return d.sort(this.compareDroppedWeapons),[d[0],l]}if(!e.data.bHasFlag){var E=this.getAvailableControllableTurrets(e.data.team);if(E.length>0)return E.sort(((a,t)=>{var r=this.Dist(e.position[0],e.position[1],a.position[0],a.position[1]),i=this.Dist(e.position[0],e.position[1],t.position[0],t.position[1]);return r<i?-1:r>i?1:0})),[E[0],!1]}var h=this.getItemCrates(e);if(h.length>0){for(var c=h.length-1;c>=0;c--){h[c].data.ownerId!=e.data.id&&h.splice(c,1)}h.sort(((a,t)=>{var r=this.Dist(e.position[0],e.position[1],a.position[0],a.position[1]),i=this.Dist(e.position[0],e.position[1],t.position[0],t.position[1]);return r<i?-1:r>i?1:0}));var m=h[0];if(m)return[m,m.data.ownerId==e.data.id]}return null}compareDroppedWeapons(e,a){var t=e.data.interactData.weaponData,r=a.data.interactData.weaponData;return t.damage*t.magSize>r.damage*r.magSize?-1:t.damage*t.magSize<r.damage*r.magSize?1:0}setPawnAI(e,a,t,r){var i={ticker:1,pathTicker:0,destThreshold:30,activityTimer:1,botSkill:a,lookToPos:[0,0],moveToPos:null,path:null,fireBurstTimer:0,fireBurstTimerMax:Math.round((this.Random(25,30)+10*a)*this.localData.settings.fps_mult),fireCooldownTimer:0,fireCooldownTimerMax:Math.round((this.Random(90,100)-15*a)*this.localData.settings.fps_mult),semiCooldownTimer:0,semiCooldownTimerMax:Math.round((this.Random(15,20)-2*a)*this.localData.settings.fps_mult),lookRange:this.Random(1e3,1100)+a*(r?200:100),hearRange:Number.MAX_VALUE,bFireCooldown:!0,bLOS:!1,bObjectiveTakesPriority:!1,bCanInteract:!1,bCanCamp:!t,bCanExplore:!0,bUseActivityTimer:!0,bCanInvestigate:!1};if(this.localData.bOperation&&(i.lookRange+=500),!t){this.localData.bRanked&&(a==BotSkill.SKILL_EASY?(i.fireBurstTimerMax=Math.ceil(.4*i.fireBurstTimerMax),i.fireCooldownTimerMax=Math.ceil(1.5*i.fireCooldownTimerMax)):a==BotSkill.SKILL_NORMAL?(i.fireBurstTimerMax=Math.ceil(.5*i.fireBurstTimerMax),i.fireCooldownTimerMax=Math.ceil(1.2*i.fireCooldownTimerMax)):a==BotSkill.SKILL_INSANE?(i.semiCooldownTimerMax-=Math.round(3*this.localData.settings.fps_mult),i.fireBurstTimerMax=Math.ceil(1.5*i.fireBurstTimerMax)):a>=BotSkill.SKILL_GOD&&(i.semiCooldownTimerMax=1,i.fireBurstTimerMax=Math.ceil(5*i.fireBurstTimerMax)));var s=1-.1*a;i.fireCooldownTimer=Math.round(i.fireCooldownTimerMax*s),i.semiCooldownTimer=Math.round(i.semiCooldownTimerMax*s)}e.data.ai=i,e.data.aimSpeed=(.05+.1*a)/this.localData.settings.fps_mult}generateMapNodes(){this.log("Generating map nodes...");var e=this.getCurrentMapData(),a=e.nodes,t=e.links;if(a&&t){var r=this.data.graph;if(r){var i=r();this.localData.graphInstance=i;for(var s=0;s<a.length;s++){var o=a[s];i.addNode(o.id,o.data)}for(s=0;s<t.length;s++){var l=t[s];i.addLink(l.source,l.target)}this.localData.graph=i;var n=this.data.path.aStar(i);this.localData.pathfinder=n}else console.warn("Invalid graph reference!")}else a||console.warn("Missing node data!"),t||console.warn("Missing link data!")}getClosestNode(e){if(e){var a=this.getCurrentMapData().nodes;if(a){for(var t=[],r=0;r<a.length;r++){var i=a[r],s=this.checkLineOfSight(e,i.data.position),o=this.Dist(e[0],e[1],i.data.position[0],i.data.position[1]);t.push({node:i,dist:o,bLOS:s})}return 0===t.length?null:(t.sort((function(e,a){return e.bLOS<a.bLOS?1:e.bLOS>a.bLOS||e.dist<a.dist?-1:e.dist>a.dist?1:0})),t[0].node)}}return null}getAIPath(e,a,t,r,i){if(e&&a){var s=this.localData.graph,o=this.localData.pathfinder;if(s&&o){var l=this.getClosestNode(e),n=this.getClosestNode(a);if(l&&n){var d=o.find(l.id,n.id);if(d){if(d.length>0){d.reverse();var E=d[0];if("node_climb"==E.data.type)if(!t.data.bIsOnLadder){var h=d[1];if(h&&h.data.position[1]<t.position[1]-100){var c=this.getObjectById(E.data.ladderId);c&&this.startLadderClimb(t,c)}}d.splice(0,1),d.push({data:{position:a,type:"node_dest",threshold:r}})}else console.warn("Empty path!",l.id,n.id,this.getCurrentMapData().id);return d}console.warn("Invalid path!")}else l||console.warn("Invalid fromNode!"),n||console.warn("Invalid toNode!")}else s||console.warn("Invalid graph reference!"),o||console.warn("Invalid pathfinder reference!")}return null}handleEquipment(e){var a=e.data,t=a.weaponData;switch(t.id){case"trophy":if(a.bJammed)break;if(a.blockNum>0){var r=this.getRockets();r=r.concat(this.getGrenades());for(var i=0;i<r.length;i++){var s=r[i];if(s.data.team!=a.team)if(this.Dist(e.position[0],e.position[1],s.position[0],s.position[1])<=t.radius){a.blockNum--,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_TROPHY_HIT,pos:s.position}),this.removeNextStep(s),this.createExplosion({eventId:GameServer.EVENT_SPAWN_EXPLOSION,x:s.position[0],y:s.position[1],radius:200,damage:0,playerId:null,causerId:null,weaponId:null});break}}}else this.removeNextStep(e);break;default:if(t.bMine)if(a.bTriggered){if(a.triggerTimer==Math.ceil(.5*this.localData.settings.fps))switch(a.weaponData.id){case"betty":e.applyImpulse([0,-550],0,0),e.angularVelocity=this.Random(-1,1)}a.triggerTimer>0?a.triggerTimer--:this.detonate(e)}else{var o=this.getPawns();for(i=0;i<o.length;i++){var l=o[i];if(l.data.team!=a.team){if(a.bUseScale){if(1==a.scale&&l.position[0]<e.position[0])continue;if(-1==a.scale&&l.position[0]>e.position[0])continue}if(this.Dist(l.position[0],l.position[1],e.position[0],e.position[1])<a.triggerRange&&this.checkLineOfSight(e.position,l.position,!1,l)){var n=this.characterHasPerk(l,Perks.PERK_PLAYER_SITREP);this.triggerMine(e,Math.ceil(this.localData.settings.fps*(n?3:.5)));break}}}}}}handleFlagDomination(e){for(var a,t=e.data,r=this.getCharacters(),i=0;i<r.length;i++){var s=r[i];e.getAABB().overlaps(s.getAABB())&&(a||(a={}),a[s.data.team]||(a[s.data.team]=[]),a[s.data.team].push(s.data.id))}var o=t.bIsBeingCaptured,l=t.bIsContested,n=t.capturingTeam,d=t.team;if(t.charsTouching=a,t.bIsBeingCaptured=!1,t.bIsContested=!1,t.capturingTeam=null,a){var E=Object.keys(a);if(1===E.length){var h=parseInt(E[0]);if(h!=t.team)if(t.bIsBeingCaptured=!0,t.capturingTeam=h,t.captureTimer[h]>0){t.captureTimer[h]-=Math.min(a[h].length,4);for(i=0;i<a[h].length;i++){(s=this.getObjectById(a[h][i]))&&(s.data.bIsCapturingFlag=!0)}}else t.captureTimer[h]=0,t.team=h,this.onFlagCaptured(e,a[h])}else E.length>1&&(t.bIsContested=!0)}else{this.localData.gameModeData.id==GameMode.DOMINATION&&(t.captureTimerMax=this.localData.settings.fps*(null==t.team?5:10));for(i=0;i<2;i++)if(t.captureTimer[i]<t.captureTimerMax){t.captureTimer[i]=Math.min(t.captureTimer[i]+2,t.captureTimerMax)}}null!=t.team&&(t.pointTimer>0?t.pointTimer--:(this.onFlagPoint(t.team),t.pointTimer=t.pointTimerMax));var c=[];o!=t.bIsBeingCaptured&&c.push("bIsBeingCaptured"),l!=t.bIsContested&&c.push("bIsContested"),n!=t.capturingTeam&&c.push("capturingTeam"),d!=t.team&&c.push("team"),c.length>0&&this.pushObjectDataUpdate(t.id,c)}returnFlagCTF(e,a){if(e){var t=e.data,r=this.getCurrentMapData().flags_ctf[t.team];e.position[0]=r[0],e.position[1]=r[1],t.bAwayFromHome=!1,t.cooldownTimer=5,a&&this.onFlagReturned(e,a)}}returnFlagDefender(e){if(e){var a=e.data,t=this.getCurrentMapData().flag_defender;e.position[0]=t[0],e.position[1]=t[1],a.cooldownTimer=5}}characterHasFlag(e){return!1}handleFlagCTF(e){this.isOutOfMap(e)&&this.returnFlagCTF(e);var a=e.data;if(a.cooldownTimer>0?a.cooldownTimer--:delete a.cooldownTimer,a.carrierId){var t=this.getObjectById(a.carrierId);t?(t.data.health&&(e.position[0]=t.position[0],e.position[1]=t.position[1]-40),e.gravityScale=0):(this.onFlagDropped(e,a.carrierId),this.setFlagCarrierId(e,null))}if(a.bAwayFromHome)a.carrierId||(e.gravityScale=1);else{var r=this.getCurrentMapData().flags_ctf[a.team];e.position[0]=r[0],e.position[1]=r[1],e.gravityScale=0}if(!a.cooldownTimer)for(var i=this.getCharacters(),s=0;s<i.length;s++){var o=i[s];if(e.getAABB().overlaps(o.getAABB()))if(o.data.team==a.team){if(!a.carrierId&&a.bAwayFromHome)a.cooldownTimer=5,this.returnFlagCTF(e,o.data.id);else if(!a.bAwayFromHome){var l=this.getFlagCTF(1==a.team?0:1);if(l.data.carrierId==o.data.id){this.setFlagCarrierId(l,null),l.data.cooldownTimer=5;r=this.getCurrentMapData().flags_ctf[l.data.team];return l.position[0]=r[0],l.position[1]=r[1],l.data.bAwayFromHome=!1,l.wakeUp(),a.cooldownTimer=5,void this.onFlagCaptured(e,[o.data.id])}}}else a.carrierId||(this.setFlagCarrierId(e,o.data.id),a.bAwayFromHome=!0,a.cooldownTimer=5,this.onFlagPickedUp(e,o.data.id))}}setFlagCarrierId(e,a){if(e){var t=e.data,r=t.carrierId;t.carrierId=a,r!=a&&this.pushObjectDataUpdate(t.id,["carrierId"])}}handleFlagDefender(e){this.isOutOfMap(e)&&this.returnFlagDefender(e);var a=e.data;if(a.cooldownTimer>0?a.cooldownTimer--:delete a.cooldownTimer,a.carrierId){var t=this.getObjectById(a.carrierId);if(t){if(t.data.health){var r=a.team;a.team=t.data.team,r!=a.team&&this.pushObjectDataUpdate(a.id,["team"]),e.position[0]=t.position[0],e.position[1]=t.position[1]-40,e.gravityScale=0}}else this.onFlagDropped(e,a.carrierId),e.gravityScale=1,a.team=null,this.pushObjectDataUpdate(a.id,["team"]),this.setFlagCarrierId(e,null),a.cooldownTimer=5}if(!a.cooldownTimer)for(var i=this.getCharacters(),s=0;s<i.length;s++){var o=i[s];e.getAABB().overlaps(o.getAABB())&&(a.carrierId||(this.setFlagCarrierId(e,o.data.id),a.cooldownTimer=5,this.onDefenderFlagPickedUp(e,o.data.id)))}null!=a.team&&(a.pointTimer>0?a.pointTimer--:(this.onFlagPoint(a.team,a.carrierId),a.pointTimer=a.pointTimerMax))}getDefenderFlag(){return this.getObjectById("flag_defender")}isHoldingFlag(e){if(e)switch(this.localData.gameModeData.id){case GameMode.DEFENDER:var a=this.getDefenderFlag();if(a)return a.data.carrierId==e.data.id;break;case GameMode.CAPTURE_THE_FLAG:for(var t=[this.getFlagCTF(0),this.getFlagCTF(1)],r=0;r<t.length;r++)if((a=t[r])&&a.data.carrierId==e.data.id)return!0}return!1}handleCharacter(e){var a=e.data;a.bOnGround=this.isOnGround(e),e.fixedRotation||a.bOnGround||(e.angularVelocity=10*-e.angle);var t=this.getSurfaceMaterial(e);t&&(a.step=t);(e.position[0]<-10||e.position[0]>this.getCurrentMapData().width+10||e.position[1]>this.getCurrentMapData().height)&&(this.log("Player out of bounds: "+a.id),this.killPawn(a.id)),this.constrainVelocity(e,600),e.position[1]=Math.max(0,e.position[1]);var r=this.WrapAngle(a.aimRotation-a.desiredAimRotation,!0);a.aimRotation-=r*a.aimSpeed;var i=this.ToDeg(this.WrapAngle(a.aimRotation,!0)),s=Math.abs(i);if(a.scale=s<90?1:-1,a.bUseExposeTimer&&a.bExposed&&(a.exposedTimer>0?a.exposedTimer--:a.bExposed=!1),a.bWantsToMove&&this.characterCanMove(e)&&this.matchInProgress()){var o=a.maxSpeed*this.getCharacterSpeedMultiplier(e);if(a.bStunned)o*=.2;else if(a.bFreeze)o*=.5;else if(!a.bIsOnLadder){if(a.bWantsToSprint)o*=this.characterHasPerk(e,Perks.PERK_PLAYER_LIGHTWEIGHT)?2:1.8;else if(a.bWantsToCrouch){o*=this.characterHasPerk(e,Perks.PERK_PLAYER_NINJA)?1:.6}}switch(a.moveX){case-1:if(e.velocity[0]=-o,"character"===a.type)if((l=this.getSurfaceNormal(e))&&o>100)(n=Math.abs(l[0]))<.8&&(e.velocity[1]+=o*n*this.localData.settings.fixed_timestep_mult);break;case 1:var l,n;if(e.velocity[0]=o,"character"===a.type)if((l=this.getSurfaceNormal(e))&&o>0)(n=Math.abs(l[0]))<.8&&(e.velocity[1]+=o*n*this.localData.settings.fixed_timestep_mult)}}else e.velocity[0]=0;if(a.bIsOnLadder){(p=e.shapes[0])&&(p.collisionMask=CollisionGroups.PROJECTILE),a.bWantsToCrouch=!1;var d=this.getObjectById(a.ladderId);if(d&&!a.bLadderCooldown){var E=.5*d.shapes[0].height;e.position[1]<d.position[1]-E?e.velocity[1]<0&&this.leaveLadder(e):e.position[1]>d.position[1]+E&&e.velocity[1]>0&&1===a.moveY&&this.leaveLadder(e)}if(a.bWantsToClimb){var h=a.maxSpeed*this.getCharacterSpeedMultiplier(e)*a.climbSpeedMultiplier;switch(a.bStunned?h*=.2:a.bFreeze&&(h*=.5),this.characterHasPerk(e,Perks.PERK_PLAYER_NINJA)&&(h*=this.getSharedData("perks").ninjaClimbSpeedMultiplier),a.moveY){case-1:e.velocity[1]=-h;break;case 1:e.velocity[1]=h}}else e.velocity[1]=0}var c=a.aimSpeed;if(a.bStunned?a.aimSpeed=.01/this.localData.settings.fps_mult:a.aimSpeed=Math.min(.2*a.aimSpeedMultiplier/this.localData.settings.fps_mult,1),a.bBot||a.aimSpeed!=c&&this.pushObjectDataUpdate(a.id,["aimSpeed"]),"character"==a.type){var m=85;if(a.bWantsToCrouch&&!a.bIsOnLadder&&(a.bWantsToSprint=!1,m=60),(p=e.shapes[0]).height!=m){e.removeShape(p);var p=new p2.Box({width:40,height:m,collisionGroup:CollisionGroups.PAWN,collisionMask:a.bIsOnLadder?CollisionGroups.PROJECTILE:CollisionGroups.GROUND|CollisionGroups.PLATFORM|CollisionGroups.PROJECTILE});e.addShape(p),a.bOnGround&&!a.bIsOnLadder&&(a.bWantsToCrouch?e.position[1]-=1:e.position[1]-=15),e.wakeUp()}}if(a.bRegenHealth){var _=a.maxHealth;a.bJuggernaut&&(_=.3*a.maxHealth),a.health<_&&(0==a.regenTimer?(a.health=Math.min(a.maxHealth,a.health+a.regenAmount),this.pushObjectDataUpdate(a.id,["health","maxHealth"]),a.damagedBy&&delete a.damagedBy):a.regenTimer--)}var A=this.getCurrentCharacterInventoryItem(e);if(a.weapon){var I=.35;(A.fireMode==Weapon.MODE_AUTO||A.fireRate<=10)&&(I=.3),A.bRevolver&&(I-=.1),a.bWantsToCrouch&&(I+=.05),a.bADS&&(I+=.05),(this.hasMod(A,Mods.BARREL_GRIP)||this.hasMod(A,Mods.BASE_DAMPER)||this.hasMod(A,Mods.BARREL_COMPENSATOR))&&(I+=.05);var T=I*this.localData.settings.fps_mult;a.weapon.recoil-=a.weapon.recoil*T,a.weapon.recoil=this.RoundDecimal(a.weapon.recoil)}if(A.bAirOnly&&a.lookPos){var R=a.lockOnTargetId;a.lockOnTargetId=null;for(var S=this.getHelicopters(),v=0;v<S.length;v++){var u=S[v];if(u.data.team!==a.team)if(u.getAABB().containsPoint(a.lookPos)||this.Dist(u.position[0],u.position[1],a.lookPos[0],a.lookPos[1])<100){a.lockOnTargetId=u.data.id;break}}R!=a.lockOnTargetId&&this.pushObjectDataUpdate(a.id,["lockOnTargetId"])}if(a.bWantsToInteract){var b=this.getObjectById(a.interactableId);b?a.interactTimer>0?a.interactTimer--:(a.interactableId&&this.executeInteractable(b,a.id),this.stopCharacterInteract(e)):this.stopCharacterInteract(e)}a.bLadderCooldown&&(a.ladderCooldownTimer>0?a.ladderCooldownTimer--:((p=e.shapes[0])&&(p.collisionMask=CollisionGroups.GROUND|CollisionGroups.PLATFORM|CollisionGroups.PROJECTILE),a.speedMultiplier=this.getCurrentCharacterInventoryItem(e).speedModifier,delete a.bLadderCooldown,delete a.ladderCooldownTimer,this.pushObjectDataUpdate(a.id,["bLadderCooldown"])));a.bShieldCooldown&&(a.shieldCooldownTimer>0?a.shieldCooldownTimer--:(delete a.bShieldCooldown,delete a.shieldCooldownTimer,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_END_SHIELD_COOLDOWN,bDoor:a.bDoorCooldown}))),a.bBarrelCooldown&&(a.barrelCooldownTimer>0?a.barrelCooldownTimer--:(delete a.bBarrelCooldown,delete a.barrelCooldownTimer));var y=a.weapon,D=this.getCurrentCharacterInventoryItem(e);if(y.bFireHandler)if(a.bWantsToFire)if(this.characterCanFire(e))switch(this.fireCharacterWeapon(e),D.fireMode){case Weapon.MODE_SEMI:y.bFireDelay=!0,y.fireDelayTimer=Math.floor(D.fireRate*this.localData.settings.fps_mult),y.bFireHandler=!1;break;case Weapon.MODE_BURST:y.bFireDelay=!0,y.fireDelayTimer=Math.floor(D.burstFireRate*this.localData.settings.fps_mult),D.bursts=(D.numBursts?D.numBursts:3)-1,y.burstTimer=Math.floor(D.fireRate*this.localData.settings.fps_mult),y.bBurstFireHandler=!0,y.bFireHandler=!1;break;case Weapon.MODE_AUTO:y.bFireDelay=!0,y.fireDelayTimer=Math.max(1,Math.ceil(D.fireRate*this.localData.settings.fps_mult))}else 0==D.mag||D.bAirOnly?this.reloadCharacterWeapon(e):a.bIsReloading&&D.bSingleRoundLoaded&&D.mag>0&&this.cancelCharacterReload(e);else y.bFireHandler=!1;if(y.bBurstFireHandler&&(D.bursts>0?y.burstTimer>0?y.burstTimer--:D.mag>0?(D.bursts>0&&D.bursts--,y.burstTimer=Math.round(D.fireRate*this.localData.settings.fps_mult),this.fireCharacterWeapon(e)):y.bBurstFireHandler=!1:y.bBurstFireHandler=!1),y.bFireDelay&&(y.fireDelayTimer--,y.fireDelayTimer<=0&&(y.bFireDelay=!1,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_END_FIRE_DELAY}),D.bNeedsBoltPull?this.pullCharacterBolt(e):0==D.mag&&(D.ammo>0&&this.reloadCharacterWeapon(e),this.onEndWeaponFire(e)))),y.bBoltDelay&&(y.boltDelayTimer--,y.boltDelayTimer<=0&&(y.bBoltDelay=!1,D.bNeedsBoltPull=!1,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_END_BOLT_DELAY}),0==D.mag&&D.ammo>0&&this.reloadCharacterWeapon(e))),y.bThrowDelay&&(y.throwDelayTimer--,y.throwDelayTimer<=0&&(y.bThrowDelay=!1,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_END_THROW_DELAY}))),y.bEquipmentDelay&&(y.equipmentDelayTimer>0?(y.equipmentDelayTimer--,a.bWantsToCrouch=!0):(y.bEquipmentDelay=!1,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_END_EQUIPMENT_DELAY}),a.bWantsToCrouch=!1,this.pushObjectDataUpdate(a.id,["bWantsToCrouch"]))),y.bUseDelay&&(y.useDelayTimer>0&&y.useDelayTimer--,0==y.useDelayTimer)){y.useDelayTimer=-1;var g=y.useData;if(g)switch(g.type){case"killstreak":var P=this.getCurrentPlayerKillstreak(a.id),M=this.getKillstreakData(P);!a.bBot&&M&&M.bWorldMenu?this.onEvent({eventId:GameServer.EVENT_PLAYER_OPEN_WORLD_MENU,playerId:a.id,killstreakId:P}):(this.triggerPlayerCurrentKillstreak(a.id,g.position[0],g.position[1]),this.endCharacterUseDelay(e))}}if(y.bMeleeDelay&&(y.meleeDelayTimer--,y.meleeDelayTimer<=0&&(y.bMeleeDelay=!1,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_END_MELEE_DELAY}),0==D.mag&&D.ammo>0&&this.reloadCharacterWeapon(e))),a.bIsReloading&&(a.reloadTimer--,0==a.reloadTimer)){if(a.bIsReloading=!1,D.bSingleRoundLoaded){var O=1;if(D.bSpeedLoader){(y.bUnlimitedAmmo||D.ammo>2&&D.mag+2<=D.magSize)&&(O=2)}y.bUnlimitedAmmo||(D.ammo=Math.max(D.ammo-O,0)),D.mag=Math.min(D.mag+O,D.magSize)}else D.ammo>=D.magSize||y.bUnlimitedAmmo?(y.bUnlimitedAmmo||(D.ammo-=D.magSize-D.mag),D.mag=D.magSize):D.ammo+D.mag>D.magSize?(y.bUnlimitedAmmo||(D.ammo-=D.magSize-D.mag),D.mag+=D.magSize-D.mag):(D.mag+=D.ammo,y.bUnlimitedAmmo||(D.ammo-=D.ammo));this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:a.id,index:a.currentInventoryIndex,type:GameServer.INV_ITEM}),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_RELOAD_COMPLETE}),D.bSingleRoundLoaded&&D.mag<D.magSize&&this.reloadCharacterWeapon(e)}if(null!=this.getPlayerStateById(a.id)){var N=this.getDroppedWeapons();for(v=0;v<N.length;v++){var L=N[v];if(this.characterHasWeapon(e,L.data.interactData.weaponData.id)){if(!L.data.interactData.weaponData.bMelee&&L.getAABB().overlaps(e.getAABB())){this.requestEvent({eventId:GameServer.EVENT_PLAYER_INTERACT,playerId:a.id,pawnId:a.id,interactableId:L.data.id,bServerSideOnly:!0});break}}else if(this.characterHasEquipment(e,L.data.interactData.weaponData.id)&&e.data.equipment.ammo<e.data.equipment.ammoMax&&L.getAABB().overlaps(e.getAABB())){this.requestEvent({eventId:GameServer.EVENT_PLAYER_INTERACT,playerId:a.id,pawnId:a.id,interactableId:L.data.id,bServerSideOnly:!0});break}}}}characterHasWeapon(e,a){if(e){var t=e.data.inventory;if(t)for(var r=0;r<t.length;r++)if(t[r].id===a)return!0}return!1}characterHasEquipment(e,a){if(e){var t=e.data.equipment;return t&&t.id==a}return!1}endCharacterUseDelay(e){var a=e.data.weapon;if(a.bUseDelay){a.bUseDelay=!1,delete a.useData;var t=this.getPlayerStateById(e.data.id);t&&!t.controllableId&&this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:t.id,type:GameServer.PAWN_CLOSE_LAPTOP})}}getCurrentCharacterInventoryItem(e){return e.data.inventory[e.data.currentInventoryIndex]}setCharacterCurrentInventoryItem(e,a){this.cancelCharacterReload(e),this.cancelCharacterBoltPull(e);var t=this.getCurrentCharacterInventoryItem(e);t&&"riot_shield"==t.id&&(e.data.bShieldCooldown=!0,e.data.shieldCooldownTimer=Math.ceil(this.localData.settings.fps*(this.characterHasPerk(e,Perks.PERK_WEAPON_QUICKDRAW)?.3:.6)),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:e.data.id,type:GameServer.PAWN_START_SHIELD_COOLDOWN})),e.data.currentInventoryIndex=a;var r=this.getCurrentCharacterInventoryItem(e);if(e.data.reloadTimerMax=Math.round(Math.ceil(r.reloadTime*this.localData.settings.fps)/e.data.reloadMultiplier),e.data.reloadTimer=e.data.reloadTimerMax,e.data.aimRotation=this.ToRad(-90),e.data.speedMultiplier=r.speedModifier,r.bNeedsBoltPull&&this.pullCharacterBolt(e),void 0!==e.data.lockOnTargetId&&(e.data.lockOnTargetId=null,this.pushObjectDataUpdate(e.data.id,["lockOnTargetId"])),0==r.mag&&this.reloadCharacterWeapon(e),"riot_shield"==r.id){var i=this.createShield(e.data.id);i&&(e.data.shieldId=i.data.id)}else e.data.shieldId&&(this.removeObjectById(e.data.shieldId),delete e.data.shieldId)}getCharacterInventoryItemIndex(e,a){for(var t=e.data.inventory,r=0;r<t.length;r++)if(t[r].id==a)return r;return-1}onStartWeaponFire(e){var a=this.getCurrentCharacterInventoryItem(e);if(a)switch(a.id){case"flamethrower":this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:e.data.id,type:GameServer.PAWN_START_FLAME}),e.data.weapon.bStartFlame=!0}}onEndWeaponFire(e){var a=this.getCurrentCharacterInventoryItem(e);if(a)switch(a.id){case"flamethrower":e.data.weapon.bStartFlame&&(this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:e.data.id,type:GameServer.PAWN_END_FLAME}),delete e.data.weapon.bStartFlame)}}reloadCharacterWeapon(e,a){this.characterCanReload(e)&&(e.data.reloadTimer=e.data.reloadTimerMax,e.data.bIsReloading=!0,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:e.data.id,type:GameServer.PAWN_RELOAD,bManual:a}))}dropCharacterEquipment(e){if(this.localData.bDroppedWeapons){var a=e.data.aimRotation;-1==e.data.scale&&(a+=this.ToRad(-180));var t=e.data.equipment;if(t&&t.ammo>0){var r=this.Random(100,150),i=Math.cos(e.data.aimRotation)*r,s=Math.sin(e.data.aimRotation)*r;this.createDroppedWeapon(this.getRandomUniqueId(),[e.position[0],e.position[1]-30],a,e.data.scale,{weaponData:this.clone(t)},[i,s],this.Random(0,5))}}}dropAllCharacterWeapons(e){if(this.localData.bDroppedWeapons){this.dropCharacterEquipment(e);var a=e.data.aimRotation;-1==e.data.scale&&(a+=this.ToRad(-180));for(var t=e.data.inventory,r=0;r<t.length;r++){var i=t[r];if(!i.bZombie&&"none"!=i.id){var s=this.Random(100,150),o=Math.cos(e.data.aimRotation)*s,l=Math.sin(e.data.aimRotation)*s;this.createDroppedWeapon(this.getRandomUniqueId(),[e.position[0],e.position[1]-30],a+this.ToRad(30*r),e.data.scale,{weaponData:i},[o,l],this.Random(0,5))}}}}dropCharacterWeapon(e,a){if(this.localData.gameModeData.id!=GameMode.GUN_GAME&&this.localData.gameModeData.id!=GameMode.INFECTED&&this.localData.bDroppedWeapons){var t=e.data.aimRotation;-1==e.data.scale&&(t+=this.ToRad(-180));var r=e.data.inventory[a];if(!r.bZombie&&"none"!=r.id){var i=this.Random(120,150),s=Math.cos(e.data.aimRotation)*i,o=Math.sin(e.data.aimRotation)*i;this.createDroppedWeapon(this.getRandomUniqueId(),[e.position[0],e.position[1]-30],t,e.data.scale,{weaponData:r},[s,o],this.Random(0,5))}}}getCharacterHealth(){return this.isHardcore()?100:200}isHardcore(){return this.localData.gameModeData.bHardcore}updateCharacterPerks(e){var a=e.data.perks;if(a){var t=e.data;t.maxSpeed=200,t.maxHealth=this.getCharacterHealth(),t.health=Math.min(t.health,t.maxHealth),t.regenTimerMax=3*this.localData.settings.fps,t.regenAmount=1,t.unTargetable=!1,t.aimSpeedMultiplier=1,t.accuracyMultiplier=1,t.reloadMultiplier=1;var r=this.getCurrentCharacterInventoryItem(e);t.reloadTimerMax=Math.round(Math.ceil(r.reloadTime*this.localData.settings.fps)/t.reloadMultiplier);for(var i=["maxSpeed","maxHealth","health","regenAmount","unTargetable","aimSpeedMultiplier","accuracyMultiplier","reloadMultiplier","reloadTimerMax"],s=0;s<a.length;s++)switch(a[s]){case Perks.PERK_PLAYER_LIGHTWEIGHT:t.maxSpeed=230;break;case Perks.PERK_PLAYER_JUGGERNAUT:if(this.localData.bSurvival)t.maxHealth=3*this.getCharacterHealth();else{var o=this.getPlayerStateById(t.id);t.maxHealth=1.5*this.getCharacterHealth(),o&&(o.bInfected||(o.bJuggernaut?(t.bNoPickups=!0,t.maxHealth=6*this.getCharacterHealth(),t.damageMultipliers[DamageType.DAMAGE_BULLET]=.2,t.maxSpeed=150,i.push("bNoPickups")):o.bVIP&&(t.bNoPickups=!0,t.maxHealth=2*this.getCharacterHealth(),i.push("bNoPickups"))))}t.health=t.maxHealth;break;case Perks.PERK_PLAYER_SPECIALIST:t.regenAmount=5,t.regenTimerMax=2*this.localData.settings.fps;break;case Perks.PERK_PLAYER_COLD_BLOODED:t.unTargetable=!0;break;case Perks.PERK_WEAPON_AMMO:if(!t.bBandolier||!this.matchInProgress()){t.bBandolier=!0;for(var l=t.inventory,n=0;n<l.length;n++){var d=l[n];if(!d.bMelee){var E=this.getWeaponData(d.id);d.ammo=Math.min(d.ammo+E.ammo,999)}}t.equipment&&(t.equipment.ammo=Math.min(t.equipment.ammo+1,t.equipment.ammoMax)),this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:t.id,type:GameServer.INV_INVENTORY}),this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:t.id,type:GameServer.INV_EQUIPMENT})}break;case Perks.PERK_WEAPON_QUICKDRAW:t.aimSpeedMultiplier=2;break;case Perks.PERK_WEAPON_ACCURACY:t.accuracyMultiplier=.6;break;case Perks.PERK_WEAPON_RELOAD:t.reloadMultiplier=this.getSharedData("perks").fastReloadMultiplier;r=this.getCurrentCharacterInventoryItem(e);t.reloadTimerMax=Math.round(Math.ceil(r.reloadTime*this.localData.settings.fps)/e.data.reloadMultiplier)}this.pushObjectDataUpdate(t.id,i)}else console.warn("Invalid perk reference")}pushObjectDataUpdate(e,a){var t=this.getObjectById(e);if(t){for(var r=this.localData.objectsToUpdate,i=r?r[e]:null,s=(i&&i[i.length-1],{}),o=0;o<a.length;o++){var l=a[o];s[l]=t.data[l]}this.onEvent({eventId:GameServer.EVENT_OBJECT_UPDATE,object:{id:e,data:s}})}}pullCharacterBolt(e){e.data.weapon.bBoltDelay=!0;var a=this.getCurrentCharacterInventoryItem(e);e.data.weapon.boltDelayTimer=a.boltDelayTimer*this.localData.settings.fps,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:e.data.id,type:GameServer.PAWN_PULL_BOLT})}cancelCharacterReload(e){e.data.bIsReloading&&this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:e.data.id,type:GameServer.PAWN_CANCEL_RELOAD}),e.data.bIsReloading=!1}cancelCharacterBoltPull(e){e.data.weapon.bBoltDelay&&this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:e.data.id,type:GameServer.PAWN_CANCEL_BOLT_PULL}),e.data.weapon.bBoltDelay=!1}characterHasAllSurvivalPerks(e){if(!e)return!1;var a=e.data;return!!a.perks&&a.perks.length>=this.getSurvivalPerks().length}getRandomSurvivalPerk(){var e=this.getSurvivalPerks();return e[this.Random(0,e.length-1)]}getRandomPerk(){var e=this.getAllPerks();return e[this.Random(0,e.length-1)]}getAllPerks(){var e=this.getSurvivalPerks();return e.push(Perks.PERK_PLAYER_MARTYRDOM,Perks.PERK_WEAPON_SHRAPNEL,Perks.PERK_WEAPON_RECON,Perks.PERK_PLAYER_SCAVENGER,Perks.PERK_PLAYER_SITREP,Perks.PERK_PLAYER_ANTI_SNIPER,Perks.PERK_PLAYER_COLD_BLOODED),e}getSurvivalPerks(){return[Perks.PERK_PLAYER_NINJA,Perks.PERK_PLAYER_LIGHTWEIGHT,Perks.PERK_PLAYER_JUGGERNAUT,Perks.PERK_PLAYER_SPECIALIST,Perks.PERK_PLAYER_HELMET,Perks.PERK_WEAPON_QUICKDRAW,Perks.PERK_WEAPON_ACCURACY,Perks.PERK_WEAPON_AGGRESSION,Perks.PERK_WEAPON_RELOAD,Perks.PERK_WEAPON_STOPPING_POWER,Perks.PERK_WEAPON_VAMPIRE,Perks.PERK_PLAYER_SCAVENGER,Perks.PERK_PLAYER_HELMET]}characterHasPerk(e,a){if(!e)return!1;var t=e.data;return!!t.perks&&t.perks.indexOf(a)>=0}characterHasWeaponDelay(e){var a=e.data.weapon;return a.bFireDelay||a.bMeleeDelay||a.bThrowDelay||a.bEquipmentDelay||a.bUseDelay}characterCanCrouch(e){var a=e.data;return(!a.bBot||!a.bLadderCooldown)&&!a.bIsOnLadder}characterCanSprint(e){var a=e.data;return!a.bWantsToCrouch&&!a.bIsOnLadder&&a.bWantsToMove&&!a.bStunned&&!a.bFlashed&&a.bOnGround}characterCanClimb(e){var a=e.data;return!(!a.bBot&&a.bLadderCooldown)&&(!a.bUseDelay&&!a.bEquipmentDelay&&!a.bWantsToCrouch)}characterCanJump(e){var a=e.data,t=this.getPlayerStateById(a.id);if(t&&t.controllableId)return!1;if(a.bIsOnLadder)return!0;var r=this.isOnGround(e);return this.characterCanMove(e)&&!a.bStunned&&!a.bFlashed&&!a.bLadderCooldown&&r}characterCanMelee(e){var a=e.data,t=this.getPlayerStateById(a.id);if(t&&t.controllableId)return!1;if(a.bShieldCooldown)return!1;var r=this.getCurrentCharacterInventoryItem(e),i=!this.isMeleeWeapon(r)||r.bCanMelee;return!a.bWantsToInteract&&!a.bIsOnLadder&&!this.characterHasWeaponDelay(e)&&i}characterIsFree(e){var a=e.data,t=this.getPlayerStateById(a.id);return(!t||!t.controllableId)&&(!a.bShieldCooldown&&!(a.bWantsToInteract||a.bIsOnLadder||this.characterHasWeaponDelay(e)||a.bIsReloading))}characterCanReload(e){var a=e.data,t=this.getPlayerStateById(a.id);if(t&&t.controllableId)return!1;var r=this.getCurrentCharacterInventoryItem(e);if(r.bMelee)return!1;var i=a.weapon,s=r.mag<r.magSize&&(r.ammo>0||i.bUnlimitedAmmo);return!a.bShieldCooldown&&!a.bWantsToInteract&&!a.bIsOnLadder&&r&&!this.characterHasWeaponDelay(e)&&!a.bIsReloading&&s}characterCanInteract(e,a){var t=e.data,r=this.getPlayerStateById(t.id);if(r&&r.controllableId)return!1;if(a){if(null!=a.data.interactTeam&&a.data.interactTeam!==t.team)return!1;if(a.data.bLimitInteractions&&a.data.currentPawnId)return!1}var i=this.Dist(e.position[0],e.position[1],a.position[0],a.position[1]);return!t.bIsOnLadder&&!t.bWantsToInteract&&i<200}characterCanFire(e,a=!0){if(!this.matchInProgress())return!1;var t=this.getPlayerStateById(e.data.id);if(t&&t.controllableId)return!1;var r=this.getCurrentCharacterInventoryItem(e);if(!r)return!1;if(a&&!(!!this.isMeleeWeapon(r)||r.mag>0))return!1;var i=e.data;if(i.bIsOnLadder)return!1;if(r.bAirOnly&&!i.lockOnTargetId)return!1;var s=i.weapon;return!(i.bWantsToInteract||i.bIsReloading||this.characterHasWeaponDelay(e)||s.bBoltDelay||i.bWantsToSprint||i.bShieldCooldown)}characterCanMove(e){var a=e.data,t=this.getPlayerStateById(a.id);return(!t||!t.controllableId)&&(!a.bIsOnLadder&&!a.bEquipmentDelay&&!a.bWantsToInteract)}characterCanUseEquipment(e){var a=e.data,t=a.equipment;if(!t)return!1;return!((t.bPlaceable||t.bMine)&&!t.bThrowable&&!a.bOnGround)&&(!("riot_shield"==this.getCurrentCharacterInventoryItem(e).id&&!this.localData.bSurvival)&&(!(!t.bSprintUse&&a.bWantsToSprint)&&!(a.bWantsToInteract||a.bIsOnLadder||this.characterHasWeaponDelay(e)||a.bShieldCooldown)))}useCharacterEquipment(e,a,t){if(this.characterCanUseEquipment(e)){this.cancelCharacterReload(e),this.cancelCharacterBoltPull(e);var r=e.data,i=r.equipment,s=!0,o=r.desiredAimRotation?r.desiredAimRotation:r.aimRotation;switch(i.type){case Weapon.TYPE_GRENADE:r.weapon.bThrowDelay=!0,r.weapon.throwDelayTimer=Math.round(.4*this.localData.settings.fps);var l=Math.min(1200,2*this.Dist(a,t,e.position[0],e.position[1])),n=0,d=r.bBot?this.Angle(e.position[0],e.position[1],a,t):o;this.createGrenade([e.position[0]+Math.cos(d)*n,e.position[1]-30+Math.sin(d)*n],{team:r.team,playerId:r.id,causerId:r.id,rotation:d,velocity:l,damage:i.damage,weaponId:i.id,bStartDetonationAfterHit:i.bStartDetonationAfterHit,bImpact:i.bImpact}),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:r.id,type:GameServer.PAWN_THROW_GRENADE,weaponId:i.id});break;default:switch(i.id){case"molotov":r.weapon.bThrowDelay=!0,r.weapon.throwDelayTimer=Math.round(.4*this.localData.settings.fps);l=Math.min(1200,2*this.Dist(a,t,e.position[0],e.position[1])),n=0,d=r.bBot?this.Angle(e.position[0],e.position[1],a,t):o;this.createGrenade([e.position[0]+Math.cos(d)*n,e.position[1]-30+Math.sin(d)*n],{team:r.team,playerId:r.id,causerId:r.id,rotation:d,velocity:l,damage:i.damage,weaponId:i.id,bStartDetonationAfterHit:i.bStartDetonationAfterHit,bImpact:i.bImpact}),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:r.id,type:GameServer.PAWN_THROW_GRENADE,weaponId:i.id});break;case"c4":var E=this.getGrenades(r.id,"c4");E.length>=4&&this.removeNextStep(E[0]),r.weapon.bThrowDelay=!0,r.weapon.throwDelayTimer=Math.round(.3*this.localData.settings.fps);l=Math.min(600,2*this.Dist(a,t,e.position[0],e.position[1])),n=0;this.createGrenade([e.position[0]+Math.cos(o)*n,e.position[1]-30+Math.sin(o)*n],{team:r.team,playerId:r.id,causerId:r.id,rotation:o,velocity:l,damage:i.damage,weaponId:i.id}),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:r.id,type:GameServer.PAWN_THROW_GRENADE,weaponId:i.id});break;case"stim":if(r.health>=r.maxHealth){s=!1;var h=this.getNearestFriendlyPawn(e,{maxRange:100,bInjured:!0,pawnTypes:["character"]});if(h){s=!0;var c=h.data;c.health=c.maxHealth,this.pushObjectDataUpdate(c.id,["health"]),r.weapon.bThrowDelay=!0,r.weapon.throwDelayTimer=Math.round(.5*this.localData.settings.fps),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:r.id,type:GameServer.PAWN_USE_STIM,bAlly:!0}),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:c.id,type:GameServer.PAWN_RECEIVE_STIM})}}else r.health=r.maxHealth,this.pushObjectDataUpdate(r.id,["health"]),r.weapon.bThrowDelay=!0,r.weapon.throwDelayTimer=Math.round(.5*this.localData.settings.fps),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:r.id,type:GameServer.PAWN_USE_STIM});break;case"knife":r.weapon.bThrowDelay=!0,r.weapon.throwDelayTimer=Math.round(.5*this.localData.settings.fps);l=160,n=0;this.createProjectile([e.position[0]+Math.cos(o)*n,e.position[1]-30+Math.sin(o)*n],o,r.team,{playerId:r.id,causerId:r.id,rotation:o,velocity:l,damage:i.damage,weaponId:i.id}),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:r.id,type:GameServer.PAWN_THROW_GRENADE,weaponId:i.id});break;case"deployable_cover":r.weapon.bEquipmentDelay=!0,r.weapon.equipmentDelayTimer=Math.round(.3*this.localData.settings.fps),this.createDeployableCover(this.getRandomUniqueId(),[e.position[0],e.position[1]+10],r.id),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:r.id,type:GameServer.PAWN_PLACE_EQUIPMENT,equipmentId:i.id});break;default:if("tac_insert"==i.id&&this.removeEquipmentByPlayerId(r.id,"tac_insert"),i.bThrowable){r.weapon.bThrowDelay=!0,r.weapon.throwDelayTimer=Math.round(.3*this.localData.settings.fps);var m=this.createEquipment([e.position[0],e.position[1]-30],r.team,r.scale,r.id,i);if(m){var p=Math.min(400,2*this.Dist(a,t,e.position[0],e.position[1])),_=o;m.applyImpulse([Math.cos(_)*p,Math.sin(_)*p],0,0)}this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:r.id,type:GameServer.PAWN_THROW_GRENADE,equipmentId:i.id})}else{r.weapon.bEquipmentDelay=!0,r.weapon.equipmentDelayTimer=Math.round(.3*this.localData.settings.fps);var A=[e.position[0]+10,e.position[1]+20];"claymore"==i.id&&(A[0]+=30*r.scale),this.createEquipment(A,r.team,r.scale,r.id,i),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:r.id,type:GameServer.PAWN_PLACE_EQUIPMENT,equipmentId:i.id})}}}s&&(i.ammo--,this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:r.id,type:GameServer.INV_EQUIPMENT,equipment:i}))}}useCharacterMeleeAttack(e){if(this.characterCanMelee(e)){this.cancelCharacterReload(e),this.cancelCharacterBoltPull(e);var a=e.data;a.weapon.bMeleeDelay=!0,a.weapon.meleeDelayTimer=Math.round(this.characterHasPerk(e,Perks.PERK_PLAYER_NINJA)?15:35)*this.localData.settings.fps_mult;var t=100;this.localData.bModeGame||1!==e.data.team||(t=50);var r=e.data.perks;if(r)for(var i=0;i<r.length;i++)if(r[i]==Perks.PERK_WEAPON_AGGRESSION){t=300;break}this.createBullet(e.position[0],e.position[1]-10,a.aimRotation,50,t,a.id,a.id,"none",null,!0,!0,!0),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_MELEE_ATTACK})}}getCharacterMuzzlePosition(e){if(e){var a=e.data,t=a.aimRotation,r=5;e.data.bBot&&this.localData.bOperation&&(r=10);var i=e.position;return e.data.clientPos&&(i=e.data.clientPos),[i[0]+Math.cos(t)*r,i[1]-25+(a.bWantsToCrouch?10:0)+Math.sin(t)*r]}return null}fireCharacterWeapon(e){var a=e.data,t=a.inventory[a.currentInventoryIndex],r=a.aimRotation,i=this.hasMod(t,Mods.BARREL_SILENCER),s=this.getCharacterMuzzlePosition(e),o=this.isMeleeWeapon(t),l=1;t.type!=Weapon.TYPE_SHOTGUN||t.bSlug||(l=6);for(var n=0;n<l;n++){var d=t.accuracy*a.accuracyMultiplier*(a.bWantsToCrouch?.8:1)*10,E=r+this.ToRad(.1*this.Random(-d,d));if(E+=this.ToRad(a.weapon.recoil),t.bRocket){var h={type:t.rocketType?t.rocketType:Rocket.TYPE_DEFAULT,team:a.team,playerId:a.id,causerId:a.id,rotation:E,weaponId:t.id,damage:t.damage,radius:t.radius,bAirOnly:t.bAirOnly};if(t.fireDamage&&(h.weaponData=t),"javelin"==t.id){var c=[e.data.lookPos[0],Math.max(e.data.lookPos[1],500)];h.path=[[e.position[0]+100*e.data.scale,0],[c[0]+100*-e.data.scale,0],[c[0]+100*-e.data.scale,500],[c[0],c[1]]],t.bAirOnly&&h.path.pop()}this.createRocket(s,h)}else if(t.bGrenade){var m=t.velocity?t.velocity:1500;this.createGrenade(s,{bImpact:!0,team:a.team,playerId:a.id,causerId:a.id,rotation:E,velocity:m,damage:t.damage,weaponId:t.id,radius:t.radius},!0)}else if(t.bProjectile){m=120;this.createProjectile([e.position[0]+60*Math.cos(E),e.position[1]-30+60*Math.sin(E)],E,a.team,{playerId:a.id,causerId:a.id,rotation:E,velocity:m,damage:t.damage,weaponId:t.id})}else if(t.bExploder)this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_MELEE,damageAmount:a.health,pawnId:a.id,attackerId:a.id,causerId:a.id,weaponId:t.id,bDirectlyCausedByPlayer:!0});else if(t.bFlame){var p=t.velocity?t.velocity:2e3,_=this.Random(p,p+200);this.createFlame(s,[Math.cos(E)*_,Math.sin(E)*_],a.team,a.id,t.id,t,t.fireTime,!0).data.ticker=Math.round(4*this.localData.settings.fps_mult)}else if("crossbow"==t.id){var A=t.damage;this.localData.bSurvival&&(A*=5),this.createProjectile(s,E,a.team,{playerId:a.id,causerId:a.id,rotation:E,velocity:200,damage:A,weaponId:t.id,frameId:"arrow"})}else{var I=t.damage;if(o&&this.characterHasPerk(e,Perks.PERK_WEAPON_AGGRESSION)&&"riot_shield"!=t.id&&(I*=2),t.bJumpRecoil&&!a.bOnGround){var T=t.recoil*(a.bWantsToCrouch?.25:.5);E+=this.ToRad(this.Random(-T,T))}var R=this.localData.bSurvival&&0==a.team||o;this.createBullet(s[0],s[1],E,t.range,I,a.id,a.id,t.id,t,!0,o,R)}}if(!t.bBoltAction){var S=this.Random(1,2),v=1==a.scale?-1:1,u=(a.bWantsToCrouch?.5:1)*(a.bADS?.5:1),b=t.recoil+.1*Math.abs(a.weapon.recoil);a.weapon.recoil+=-b*u*(1==S?v:-v)}a.bUseExposeTimer&&!i&&!o&&"crossbow"!=t.id&&(this.emitAISound(this.clone(e.position),a.team),a.bExposed=!0,a.exposedTimer=2*this.localData.settings.fps),t.type==Weapon.TYPE_MELEE?this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_FIRE_MELEE,recoil:t.recoil}):(this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:a.id,index:a.currentInventoryIndex,type:GameServer.INV_FIRE}),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_FIRE_WEAPON,recoil:t.recoil}))}handleAICharacter(e){var a=e.data,t=a.ai;if(!t.bDisabled){if(a.health>0){if(t.ticker>0)t.ticker--;else{var r=this.localData.settings.fps;if(this.localData.bSurvival)r=this.localData.settings.fps*(t.botSkill>=BotSkill.SKILL_INSANE?1:2);else if(this.localData.bBattlezone)r=.5*this.localData.settings.fps;else if(this.localData.bOperation)r=this.localData.settings.fps;else switch(t.botSkill){case BotSkill.SKILL_GOD:case BotSkill.SKILL_INSANE:r=this.localData.settings.fps*(this.localData.bMultiplayer?.5:1);break;default:r=this.localData.settings.fps}switch(t.botSkill){case BotSkill.SKILL_INSANE:t.offsetX=this.Random(-15,15),t.offsetY=this.Random(-15,15);break;case BotSkill.SKILL_HARD:t.offsetX=this.Random(-30,30),t.offsetY=this.Random(-30,30);break;default:t.offsetX=this.Random(-50,50),t.offsetY=this.Random(-50,50)}t.tickerMax=Math.ceil(r),t.ticker=t.tickerMax}if(t.bUseActivityTimer)if(t.activityTimer>0)if(t.activityTimer--,t.campPosition)this.Dist(e.position[0],e.position[1],t.campPosition[0],t.campPosition[1])<200&&t.activityTimer--;else t.activityTimer--;else if(t.activityTimer=30*this.localData.settings.fps,t.bCamp=!1,delete t.campPosition,this.localData.bBattlezone&&this.RandomBoolean()&&(t.bPatrol=!0),a.bVIP||t.bCanCamp&&!t.bObjectiveTakesPriority){var i=a.bVIP?1:this.Random(1,3+t.botSkill),s=!0;if(this.localData.gameModeData.id==GameMode.CAPTURE_THE_FLAG&&(s=!a.bHasFlag),1==i&&!a.bIsCapturingFlag&&s&&!this.isGuidingHostage(e)){var o=this.getCurrentMapData().campSpots;o&&(t.campPosition=o[this.Random(0,o.length-1)],t.bCamp=!0)}}if(a.bWantsToCrouch=!1,a.bFlashed||a.bStunned)a.bWantsToFire=!1,a.bWantsToCrouch=!1;else{var l=this.getLOSStartPos(e);if(t.currentEnemy){if((I=this.getObjectById(t.currentEnemy))&&I.data&&I.data.health){var n=Math.min(t.tickerMax,this.localData.bSurvival||t.botSkill<=BotSkill.SKILL_HARD?this.localData.settings.fps:Math.round(.5*this.localData.settings.fps));if(t.ticker%n==0){var d=t.bHasEnemyLOS;t.bHasEnemyLOS=this.checkLineOfSight(l,I.position,!0,I),this.localData.bSurvival||!t.bHasEnemyLOS&&t.botSkill>=BotSkill.SKILL_NORMAL&&(t.bHasEnemyLOS=this.checkLineOfSight(l,[I.position[0],I.position[1]-20],!0,I)),d&&!t.bHasEnemyLOS&&t.botSkill>=BotSkill.SKILL_INSANE&&!e.data.bZombie&&this.triggerCharacterJump(e)}}else delete t.currentEnemy,delete t.bEnemyWithinRange,t.ticker=0;if(t.bLOS&&I){var E=this.Dist(e.position[0],e.position[1],I.position[0],I.position[1]);(!t.bHasEnemyLOS||E>t.maxRange)&&(this.localData.bOperation&&this.emitAISound(I.position,I.data.team,null,9),delete t.currentEnemy,delete t.bEnemyWithinRange,t.investigatePriority=9,t.investigatePos=this.clone(I.position),t.ticker=0)}t.currentEnemy&&t.investigatePos&&(delete t.investigatePriority,delete t.investigatePos)}if(0==t.ticker){if(a.bHostage){if(t.followId){var h=this.getObjectById(t.followId);h?this.Dist(h.position[0],h.position[1],e.position[0],e.position[1])>500&&(t.followId=null):t.followId=null}if(!t.followId)for(var c=this.localData.gameModeData.id==GameMode.RESCUE?this.localData.gameModeData.rescueTeam:0,m=this.getPawns(),p=0;p<m.length;p++){var _=m[p];if("character"==_.data.type&&!_.data.bHostage)if(this.Dist(_.position[0],_.position[1],e.position[0],e.position[1])<100&&_.data.team==c){t.followId=_.data.id,this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{bHostageFollowing:1,playerId:_.data.id,hostageId:a.id}}),this.onHostageInteract(e);break}}}else{var A=a.bZombie?["character","turret","infestor"]:null,I=this.getNearestEnemyPawn(e,{bIgnoreOutOfSight:a.ai.bIgnoreOutOfSight,bLOS:a.ai.bLOS,bPreferDistance:a.ai.bPreferDistance,pawnTypes:A,bAllTypes:a.bZombie,maxRange:a.ai.maxRange});t.bHasLOS=!1,delete t.enemyDist}I?(this.localData.bOperation&&this.localData.difficulty>=3&&this.emitAISound(I.position,I.data.team),t.currentEnemy=I.data.id,t.enemyDist=this.Dist(e.position[0],e.position[1],I.position[0],I.position[1]),t.bHasLOS=this.checkLineOfSight(l,I.position,!0,I),t.bHasLOS&&t.bCamp&&t.bCampUntilLOS&&(t.bCamp=!1,delete t.campPosition),t.returnPos&&delete t.returnPos,t.patrolPoints&&(this.localData.bOperation?(delete t.bPatrol,delete t.patrolPoints):delete t.bPatrol)):t.bLOS&&(delete t.currentEnemy,delete t.bEnemyWithinRange,delete t.bHasLOS);var T=this.getPlayerStateById(a.id);if(T){if(T.controllableId)return;if(T.killstreaks.length>0){var R=T.killstreaks;for(p=0;p<R.length;p++){var S=R[p];if(this.canUseKillstreak(T.id,S)){var v=!0,u=e.position[0],b=e.position[1]-200;switch(S){case Killstreaks.KILLSTREAK_AIRSTRIKE:case Killstreaks.KILLSTREAK_BOMBARDMENT:case Killstreaks.KILLSTREAK_NAPALM:case Killstreaks.KILLSTREAK_STEALTH_BOMBER:case Killstreaks.KILLSTREAK_SENTRY_GUN_PLACE:case Killstreaks.KILLSTREAK_DEADSWITCH:v=null!=I,I&&(u=I.position[0],b=I.position[1])}if(v){T.currentKillstreakIndex=p,this.requestEvent({eventId:GameServer.EVENT_PLAYER_USE_KILLSTREAK,playerId:T.id,worldX:u,worldY:b});break}}}}}var y=null;switch(t.destThreshold=20,this.localData.gameModeData.id){case GameMode.HEADQUARTERS:case GameMode.DOMINATION:(P=this.getAIBestDominationFlag(e))&&(t.destThreshold=100,y=P.position);break;case GameMode.CAPTURE_THE_FLAG:t.destThreshold=5;var D=this.getFlagCTF(0==a.team?1:0),g=this.getFlagCTF(a.team);if(D.data.carrierId===a.id)a.bHasFlag=!0,t.activityTimer=0,y=this.clone(g.position);else if(delete a.bHasFlag,g.data.bAwayFromHome)this.Dist(g.position[0],g.position[1],e.position[0],e.position[1])<this.Dist(D.position[0],D.position[1],e.position[0],e.position[1])?y=this.clone(g.position):(y=this.clone(D.position),D.data.carrierId&&(t.destThreshold=200));else y=this.clone(D.position),D.data.carrierId&&(t.destThreshold=200);break;case GameMode.DEFENDER:var P;if(P=this.getDefenderFlag())if(P.data.carrierId==a.id)I&&(y=I.position),(L=this.getNearestFriendlyPawn(e,{pawnTypes:["character"]}))&&(y=L.position,t.destThreshold=100);else y=this.clone(P.position),P.data.carrierId&&P.data.team===a.team&&(t.destThreshold=300);break;case GameMode.DEMOLITION:I&&(y=I.position);var M=this.getBombCrate();M&&(a.team!=this.localData.gameModeData.bombTeam?M.data.bBombPlanted&&!M.data.currentPawnId?y=M.position:t.bObjectiveTakesPriority&&(y=M.position,t.destThreshold=300):M.data.bBombPlanted||M.data.currentPawnId?t.bObjectiveTakesPriority&&(y=M.position,t.destThreshold=300):y=M.position);break;case GameMode.OP_HOSTAGE:if(a.bHostage){var O=this.getRescueZone();this.Dist(e.position[0],e.position[1],O[0],O[1])<200&&this.rescueHostage(e,t.followId)}else I&&(y=I.position);break;case GameMode.RESCUE:if(a.bHostage){O=this.getRescueZone();this.Dist(e.position[0],e.position[1],O[0],O[1])<200&&this.rescueHostage(e,t.followId)}else{var N=this.getNearestHostage(e);N?(y=N.position,a.team==this.localData.gameModeData.rescueTeam?(t.destThreshold=50,this.isGuidingHostage(e)&&(y=this.getCurrentMapData().spawns_team[0])):t.destThreshold=200):I&&(y=I.position)}break;case GameMode.ASSASSINATION:if(a.bVIP);else if(a.team==this.localData.gameModeData.vipTeam){(L=this.getNearestFriendlyPawn(e,{pawnTypes:["character"],bVIP:!0}))?t.followId=L.data.id:I&&(delete t.followId,y=I.position)}else I&&(y=I.position);break;case GameMode.SURVIVAL_BASIC:case GameMode.SURVIVAL_CHAOS:case GameMode.SURVIVAL_UNDEAD:case GameMode.SURVIVAL_STAKEOUT:case GameMode.SURVIVAL_PRO:var L;if(0===a.team)(L=this.getNearestFriendlyPawn(e,{pawnTypes:["character"],bPlayerOnly:!0}))?t.followId=L.data.id:I&&(delete t.followId,y=I.position);else I&&(y=I.position);break;default:I&&(y=I.position)}if(delete t.interactableId,delete t.bInteractableTakesPriority,t.bCanInteract)(Y=this.getBestInteractable(e))&&(t.interactableId=Y[0].data.id,t.bInteractableTakesPriority=Y[1],delete t.bCamp,delete t.campPosition,delete t.followId);if(a.bIsCapturingFlag);else if(t.interactableId){(Y=this.getObjectById(t.interactableId))?(y=Y.position,t.destThreshold=20):delete t.interactableId}else if(t.followId){var C=this.getObjectById(t.followId);C&&(y=C.position,t.destThreshold=a.bHostage?50:200)}else t.campPosition?(y=t.campPosition,t.destThreshold=30):t.investigatePos&&t.bCanInvestigate?(y=t.investigatePos,t.destThreshold=50):t.returnPos&&t.bCanInvestigate?(y=t.returnPos,t.destThreshold=50):t.bPatrol&&t.patrolPoints&&(y=t.patrolPoints[0],t.destThreshold=100);t.moveToPos=y;var f="infestor"===a.type?30:0;if(t.pathTicker<=0){t.path=this.getAIPath([e.position[0],e.position[1]+f],y,e,t.destThreshold,a.bIsOnLadder);var k=0;if(!e.data.bHostage)switch(t.botSkill){case BotSkill.SKILL_EASY:k=2;break;case BotSkill.SKILL_NORMAL:k=1;break;case BotSkill.SKILL_GOD:k=0;break;default:k=1}t.pathTicker=k}else t.pathTicker--;var G=this.getBestInventoryIndex(e,I,t.enemyDist);G!=a.currentInventoryIndex&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:a.id,type:GameServer.INV_CURRENT_INVENTORY_INDEX,value:G});var B=a.inventory[a.currentInventoryIndex],w=a.equipment;if(w&&w.ammo){if(I)var K=t.enemyDist;switch(w.type){case Weapon.TYPE_GRENADE:var H=!1;if(I&&(K>.5*t.lookRange&&K<t.lookRange?H=Math.random()>.95:(!t.bHasLOS&&K<.5*t.lookRange||"turret"===I.data.type)&&(H=Math.random()>.8)),H){var U=this.Angle(e.position[0],e.position[1],I.position[0],I.position[1]),W=.3*K;this.useCharacterEquipment(e,e.position[0]+Math.cos(U)*W,e.position[1]+Math.sin(U)*W-.3*K)}break;case Weapon.TYPE_EXPLOSIVE:(!I||K>.5*t.lookRange)&&this.useCharacterEquipment(e,e.position[0],e.position[1]);break;case Weapon.TYPE_TACTICAL:switch(w.id){case"knife":if(!t.bFireCooldown&&t.bHasLOS&&K<t.lookRange){U=this.Angle(e.position[0],e.position[1],I.position[0],I.position[1]);this.useCharacterEquipment(e,e.position[0],e.position[1]-.1*K)}break;case"trophy":(t.bFireCooldown||t.bHasLOS||K<.5*t.lookRange)&&this.useCharacterEquipment(e,e.position[0],e.position[1]);break;case"stim":if(e.data.health<.5*e.data.maxHealth)this.useCharacterEquipment(e,e.position[0],e.position[1]);else this.getNearestFriendlyPawn(e,{maxRange:100,bInjured:!0})&&this.useCharacterEquipment(e,e.position[0],e.position[1]);break;default:(!I||K>.5*t.lookRange)&&this.useCharacterEquipment(e,e.position[0],e.position[1])}}}}var V=void 0;(y=t.moveToPos)&&(V=this.Dist(e.position[0],e.position[1],y[0],y[1]));var Y,F=0,x=0,q=!1;if(t.path){var Z=t.path[0];if(Z&&Z.data){if(!a.bIsOnLadder&&!a.bLadderCooldown){var z=t.path[t.path.length-1];if(t.ticker%10==0)var j=this.checkLineOfSight(e.position,Z.data.position);if(j)if(this.Dist(e.position[0],e.position[1],z.data.position[0],z.data.position[1])<t.destThreshold&&j)var J=!0}if(J)t.path=[];else{var X=Z.data.threshold?Z.data.threshold:"character"===a.type?30:40;if((a.bIsOnLadder||a.bLadderCooldown)&&(X=10),this.Dist(Z.data.position[0],Z.data.position[1],e.position[0],e.position[1])>=X){if(Math.abs(Z.data.position[0]-e.position[0])>5&&(F=Z.data.position[0]<e.position[0]?-1:1),!a.bIsOnLadder)if(!0)if(Z.data.position[1]>e.position[1]+100)if(a.bOnGround&&!a.bLadderCooldown)(Q=this.getClimbableLadder(e))&&this.startLadderClimb(e,Q);a.bIsOnLadder&&(Z.data.position[1]<e.position[1]+70?x=-1:Z.data.position[1]>e.position[1]+100?x=1:this.leaveLadder(e))}else{switch(Z.data.type){case"node_walk":a.bIsOnLadder&&this.triggerCharacterJump(e);break;case"node_jump":this.triggerCharacterJump(e);break;case"node_climb":var Q;if(!0)if(($=t.path[1])&&$.data.position[1]<e.position[1]-10)(Q=this.getObjectById(Z.data.ladderId))&&this.startLadderClimb(e,Q)}t.path.splice(0,1)}}0===t.path.length&&(t.bCamp||(t.investigatePos&&(delete t.investigatePos,delete t.investigatePriority),t.returnPos&&delete t.returnPos),t.bPatrol&&t.patrolPoints&&t.patrolPoints.push(t.patrolPoints.shift()))}}if(Y=this.getObjectById(t.interactableId))(this.Dist(e.position[0],e.position[1],Y.position[0],Y.position[1])<5||Y.getAABB().overlaps(e.getAABB()))&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_INTERACT,playerId:a.id,pawnId:a.id,interactableId:t.interactableId,bServerSideOnly:!0});var $,ee=this.getObjectById(t.currentEnemy);if(ee){K=ee?this.Dist(e.position[0],e.position[1],ee.position[0],ee.position[1]):0;var ae=!0;t.bLOS&&(ae=t.bHasEnemyLOS)}if(ee&&ae){if((le=this.getCurrentCharacterInventoryItem(e)).bProjectile)a.lookPos=[ee.position[0],ee.position[1]-.14*K+20];else if(le.bGrenade)a.lookPos=[ee.position[0],ee.position[1]-.15*K+20];else if(le.bRocket)a.lookPos=[ee.position[0],ee.position[1]];else if(K>100)switch(t.botSkill){case BotSkill.SKILL_GOD:case BotSkill.SKILL_INSANE:"character"==ee.data.type?ee.data.shieldId?a.lookPos=[ee.position[0],ee.position[1]+35]:a.lookPos=[ee.position[0],ee.position[1]-12]:"infestor"===ee.data.type?a.lookPos=[ee.position[0],ee.position[1]+40]:a.lookPos=[ee.position[0],ee.position[1]];break;default:"infestor"===ee.data.type?a.lookPos=[ee.position[0],ee.position[1]+20]:(ee.data.shieldId?a.lookPos=[ee.position[0],ee.position[1]+25]:a.lookPos=[ee.position[0],ee.position[1]+(a.bWantsToCrouch?-10:10)],t.offsetX&&(a.lookPos[0]+=t.offsetX),t.offsetY&&(a.lookPos[1]+=t.offsetY))}else"infestor"===ee.data.type?a.lookPos=[ee.position[0],ee.position[1]+20]:ee.data.shieldId?a.lookPos=[ee.position[0],ee.position[1]+25]:a.lookPos=[ee.position[0],ee.position[1]+20];if(B=this.getCurrentCharacterInventoryItem(e),t.bEnemyWithinRange=K<Math.max(B.range,t.lookRange)&&K<B.range,t.bEnemyWithinRange){var te=!0;t.bHasEnemyLOS||(te=!1),this.requestEvent({eventId:GameServer.EVENT_PLAYER_TRIGGER_WEAPON,playerId:a.id,value:this.hasInventoryAmmo(e)&&te,worldPosition:a.lookPos,bServerSideOnly:!0}),"character"===a.type&&(a.bZombie?a.zombieType:K<50&&(a.ai.bFireCooldown||this.useCharacterMeleeAttack(e)));var re=!!Y&&t.bInteractableTakesPriority;if(!t.bObjectiveTakesPriority&&!a.bLadderCooldown&&t.bHasLOS&&!re){var ie=.2*B.range;if(t.bCamp&&V<100&&(ie=100),K<ie){var se=ee.position[0]>e.position[0]?-1:1;t.ticker%10==0&&(t.bMoveCheck=this.checkLineOfSight([e.position[0],e.position[1]],[e.position[0]+50*se,e.position[1]+50],!1)),1==t.bMoveCheck||null==t.bMoveCheck?F=0:(F=se,q=!0)}else F=0}}}else if(!ee){if(a.bWantsToFire=!1,t.investigatePos?a.lookPos=t.investigatePos:t.moveToPos&&(a.lookPos=t.moveToPos),a.lookPos)this.Dist(a.lookPos[0],a.lookPos[1],e.position[0],e.position[1])<80&&(a.lookPos=[e.position[0]+100*a.scale,e.position[1]])}if(a.bWantsToMove=!1,!a.bOnGround&&!a.bLadderCooldown)if(0!=F)if(($=t.path?t.path[0]:null)&&$.data)e.position[1],$.data.position[1];switch(a.bIsCapturingFlag&&(F=0),F){case 1:this.handlePlayerInput(e,{keyId:"right",value:!0});break;case-1:this.handlePlayerInput(e,{keyId:"left",value:!0});break;case 0:if(!a.bZombie&&!this.playerHasControllable(a.id)&&!a.bLadderCooldown&&this.characterCanCrouch(e))switch(t.botSkill){case BotSkill.SKILL_HARD:case BotSkill.SKILL_INSANE:case BotSkill.SKILL_GOD:a.bWantsToCrouch=!!t.bCamp||(t.bHasLOS||t.enemyDist>t.lookRange||!t.currentEnemy);break;default:a.bWantsToCrouch=t.bCamp}}switch(x){case 1:this.handlePlayerInput(e,{keyId:"down",value:!0});break;case-1:this.handlePlayerInput(e,{keyId:"up",value:!0})}if("character"===a.type)//!data["bZombie"]
{a.bWantsToSprint=!1;var oe=t.botSkill>=BotSkill.SKILL_HARD?1:.5;if(t.bHasLOS&&t.enemyDist<B.range*oe&&!this.isMeleeWeapon(B));else if(0!=F&&!q&&a.bWantsToMove&&!this.isGuidingHostage(e)&&!a.bVIP){if(V)switch(t.botSkill){case BotSkill.SKILL_GOD:a.bWantsToSprint=V>50;break;case BotSkill.SKILL_INSANE:a.bWantsToSprint=V>100;break;case BotSkill.SKILL_HARD:a.bWantsToSprint=V>.2*t.lookRange;break;case BotSkill.SKILL_NORMAL:a.bWantsToSprint=V>t.lookRange}a.bWantsToSprint=a.bWantsToSprint&&this.characterCanSprint(e)}}if(t.bFireCooldown?t.fireCooldownTimer>0?t.fireCooldownTimer--:(t.bFireCooldown=!1,t.fireCooldownTimer=t.fireCooldownTimerMax):t.fireBurstTimer>0?t.fireBurstTimer--:(t.bFireCooldown=!0,t.fireBurstTimer=t.fireBurstTimerMax),a.bWantsToFire)if(t.bFireCooldown)a.bWantsToFire=!1;else{var le;te=!0;if((le=a.inventory[a.currentInventoryIndex]).fireMode==Weapon.MODE_SEMI&&(0==t.semiCooldownTimer?(t.semiCooldownTimer=t.semiCooldownTimerMax,te=!0):(t.semiCooldownTimer--,te=!1)),a.bWantsToFire=te,a.bWantsToFire)a.weapon.bFireHandler=!0}else a.bWantsToFire=!1}}if(a.lookPos){var ne=a.lookPos[0]-e.position[0],de=a.lookPos[1]-e.position[1],Ee=Math.atan2(de,ne);a.desiredAimRotation=Ee}}}handleTurret(e){var a=e.data,t=a.turretData,r=a.bWantsToFire;if(a.bUseExposeTimer&&a.bExposed&&(a.exposedTimer>0?a.exposedTimer--:a.bExposed=!1),a.fireDelayTimer>0?(a.bFireDelay=!0,a.fireDelayTimer--):a.bFireDelay=!1,a.bStunned||a.bFlashed||this.isInSmoke(e)&&a.bAutomated)a.desiredAimRotation=1==a.scale?this.ToRad(30)+e.angle:this.ToRad(150)+e.angle,a.bWantsToFire=!1;else if(a.ammo>0){var i=this.getMuzzlePosition(e);if(a.bAutomated){if(a.ticker>0)a.ticker--;else if(0==a.ticker){if(a.bWantsToFire=!1,!t.bDisabled)var s=this.getNearestEnemyPawn(e,{bTargetColdBlooded:!1,bIgnoreOutOfSight:a.bLOS,maxRange:a.maxRange,pawnTypes:a.enemyTypes,scale:a.bLimitScale?a.scale:void 0,bLOS:a.bLOS});var o=a.enemyId;a.enemyId=s?s.data.id:null,"rocket"==a.weaponType&&s&&o!=a.enemyId&&(a.bFireDelay=!0,a.fireDelayTimer=this.localData.settings.fps),a.ticker=this.localData.settings.fps}var l=this.getObjectById(a.enemyId);l&&(a.bWantsToFire=!0,a.bLimitScale&&(1==a.scale&&l.position[0]<e.position[0]||-1==a.scale&&l.position[0]>e.position[0])&&(a.bWantsToFire=!1),a.desiredAimRotation=this.Angle(i[0],i[1],l.position[0],l.position[1])),a.bWantsToFire||(a.desiredAimRotation=1==a.scale?e.angle:this.ToRad(180)+e.angle)}else a.controllerId?a.desiredAimRotation=this.Angle(i[0],i[1],a.aimPos[0],a.aimPos[1]):(a.bWantsToFire=!1,a.desiredAimRotation=1==a.scale?e.angle:this.ToRad(180)+e.angle);if(a.bWantsToFire&&!a.bFireDelay&&this.matchInProgress()){var n=a.accuracy,d=a.aimRotation+this.ToRad(this.Random(-n,n));switch(a.weaponType){case"bullet":var E=t.playerId;a.bAutomated||(E=a.controllerId);var h=this.localData.bSurvival||a.bAutomated,c=null;this.localData.bRanked&&(c={damage:a.damage,range:a.maxRange,penetration:1}),this.createBullet(i[0],i[1],d,a.maxRange,a.damage,E||a.id,a.id,a.killstreakId,c,!a.bAutomated,!1,h);break;case"grenade":E=a.controllerId?a.controllerId:t.playerId;this.createGrenade(i,{bImpact:!0,team:a.team,playerId:E,causerId:a.id,rotation:d,velocity:1600,damage:a.damage,weaponId:"thumper",killstreakId:a.killstreakId,radius:400},!0);break;case"rocket":this.createRocket(i,{type:Rocket.TYPE_DEFAULT,team:a.team,playerId:t.playerId,causerId:a.id,rotation:d,enemyId:a.enemyId,weaponId:a.killstreakId})}a.bUseExposeTimer&&(this.emitAISound(this.clone(e.position),e.data.team),e.data.bExposed=!0,e.data.exposedTimer=2*this.localData.settings.fps),a.bUnlimitedAmmo||a.ammo--,a.fireDelayTimer=a.fireRate,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_FIRE_WEAPON,recoil:2}),this.emitAISound(i,a.team)}}else a.desiredAimRotation=this.ToRad(0),null==a.destroyTimer&&(a.destroyTimer=this.localData.settings.fps);var m=this.WrapAngle(a.aimRotation-a.desiredAimRotation,!0);a.aimRotation-=m*a.aimSpeed,a.bWantsToFire!=r&&this.pushObjectDataUpdate(a.id,["bWantsToFire"])}handleHelicopter(e){var a=e.data,t=a.heliData,r=t.destination,i=r?this.Dist(r[0],r[1],e.position[0],e.position[1]):Number.MAX_VALUE;if(a.health){switch(a.burstDelayTimer>0?(a.bBurstDelay=!0,a.burstDelayTimer--):a.bBurstDelay=!1,a.fireDelayTimer>0?(a.bFireDelay=!0,a.fireDelayTimer--):a.bFireDelay=!1,null!=a.rockets&&(a.rocketDelayTimer>0?(a.bRocketDelay=!0,a.rocketDelayTimer--):a.bRocketDelay=!1),a.bBot&&!a.bPlayerControlled&&(a.bWantsToFire=!1),a.bUseTimer&&(a.timer>0?a.timer--:(a.ammo=0,this.pushObjectDataUpdate(a.id,["ammo"]))),a.behaviour){case"deliver":if(i<a.distThreshold)if(a.bDestinationReached){if(a.bDestroy){this.removeNextStep(e);break}}else a.bDestinationReached=!0,a.bDestroy=!0,t.destination=[1===t.scale?this.getCurrentMapData().width:0,0],this.dropHelicopterCrate(e);break;case"attack":if(a.bDestroy&&i<a.distThreshold){this.removeNextStep(e);break}a.ticker>0?a.ticker--:this.localData.bBattlezone?a.ticker=2*this.localData.settings.fps:a.ticker=this.localData.settings.fps*(a.bPlayerControlled?3:1);var s=this.getMuzzlePosition(e);if(a.rockets>0&&a.bWantsToFireRocket&&(a.bRocketDelay||(this.createRocket(s,{type:Rocket.TYPE_DEFAULT,team:a.team,playerId:t.playerId?t.playerId:a.id,causerId:a.id,rotation:a.aimRotation,weaponId:a.killstreakId}),a.rockets--,a.rocketDelayTimer=this.localData.settings.fps,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_FIRE_ROCKET,recoil:10}),this.emitAISound(s,a.team))),a.ammo>0){if(a.bControllable&&!a.controllerId&&(a.ammo=0,this.pushObjectDataUpdate(a.id,["ammo"])),a.bBot&&0==a.ticker){var o=this.getNearestEnemyPawn(e,{bTargetColdBlooded:!1,maxRange:a.bMaxLookRange?Number.MAX_VALUE:a.maxRange,pawnTypes:this.localData.bModeGame?["character","infestor"]:null,bLOS:this.localData.bOperation||this.localData.bBattlezone,bIgnoreOutOfSight:this.localData.bOperation||this.localData.bBattlezone});o?a.currentEnemy=o.data.id:delete a.currentEnemy,a.bAirdrop||(a.bExplore=null==o)}var l=this.getObjectById(a.currentEnemy);if(l){var n=this.Dist(l.position[0],l.position[1],e.position[0],e.position[1]);if(a.bBot&&!a.bPlayerControlled){a.desiredAimRotation=this.Angle(s[0],s[1],l.position[0],l.position[1]),a.aimPos[0]=l.position[0],a.aimPos[1]=l.position[1];var d=this.checkLineOfSight(e.position,l.position,!0,l);n<a.maxRange&&d&&(a.bWantsToFire=!0,a.rockets>0&&(a.bWantsToFireRocket=!0))}a.bExplore||a.bAirdrop||!a.bBot||(a.bDrone?t.destination=[l.position[0],l.position[1]-200]:t.destination=[l.position[0],l.position[1]-(a.bPlayerControlled?500:400)])}else a.bHasBurstDelay&&(a.burstTimer=a.burstTimerMax);if(a.bDefendOwner)if(a.heliData.playerId){var E=this.getObjectById(a.heliData.playerId),h=E?this.Dist(E.position[0],E.position[1],e.position[0],e.position[1]):0;(!l||h>.5*a.maxRange)&&E&&(t.destination=[E.position[0],E.position[1]-400])}else l&&(t.destination=[l.position[0]-a.muzzleOffsetX,l.position[1]-300]);if(a.bExplore){if(i<a.distThreshold||!r)if(a.exploreTimer>0)a.exploreTimer--;else{var c=this.getCurrentMapData().heliExploreSpots;c&&(t.destination=c[this.Random(0,c.length-1)],a.exploreTimer=5*this.localData.settings.fps)}}else if(a.bAirdrop&&i<a.distThreshold){var m=a.heliData.items;if(m&&m.length>0)a.dropTimer>0?a.dropTimer--:(this.dropHelicopterCrate(e),m.splice(0,1),a.dropTimer=a.dropTimerMax?a.dropTimerMax:5*this.localData.settings.fps);else if(a.defendTimer>0)a.defendTimer--;else{a.bDestinationReached=!0,a.bDestroy=!0;var p=this.getCurrentMapData().width;t.destination=[e.position[0]>.5*p?p:0,0]}}if(a.rocketTimerMax>0&&(a.rocketTimer>0?a.rocketTimer--:(a.rocketTimer=a.rocketTimerMax,a.weaponType="rocket")),!a.bBurstDelay){var _=a.bDrone&&a.bStunned;if(a.bWantsToFire&&this.matchInProgress()&&!_){if(!a.bFireDelay&&!a.currentRocketId){switch(a.weaponType){case"bullet":for(var A=a.numBullets?a.numBullets:1,I=0;I<A;I++){var T=null!=a.accuracy?a.accuracy:0;this.createBullet(s[0],s[1],a.aimRotation+this.ToRad(this.Random(-T,T)),a.maxRange,a.damage,t.playerId?t.playerId:a.id,a.id,a.killstreakId,a.weaponData,a.bPlayerControlled,!1,this.localData.bSurvival&&0==a.team)}break;case"grenade":this.createGrenade(s,{bImpact:!0,team:a.team,playerId:t.playerId?t.playerId:a.id,causerId:a.id,rotation:a.aimRotation,velocity:1600,damage:a.damage,weaponId:"thumper",killstreakId:a.killstreakId,radius:400});break;case"rocket":this.createRocket(s,{type:Rocket.TYPE_DEFAULT,team:a.team,playerId:t.playerId?t.playerId:a.id,causerId:a.id,rotation:a.desiredAimRotation,weaponId:a.killstreakId,enemyId:a.rocketTimerMax?a.currentEnemy:null}),a.rocketTimerMax&&(a.weaponType="bullet")}a.bUnlimitedAmmo||a.ammo--,a.fireDelayTimer=a.fireRate;var R=2;if(t.weaponId){var S=this.getWeaponData(t.weaponId);S&&(R=S.recoil)}this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_FIRE_WEAPON,recoil:R}),this.emitAISound(s,a.team)}a.bHasBurstDelay&&(a.burstTimer>0?a.burstTimer--:(a.burstDelayTimer=a.burstDelayTimerMax,a.burstTimer=a.burstTimerMax))}}}else if(e.constraint&&this.dropHelicopterCrate(e),!a.currentRocketId&&!a.bDestroy)if(e.fixedY=!1,a.bDestroy=!0,a.bPlayerControlled&&(g=this.getPlayerStateById(a.controllerId))&&this.clearPlayerControllable(g),a.bDrone)this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_EXPLOSIVE,damageAmount:a.health,pawnId:a.id,attackerId:null,causerId:a.id,weaponId:Killstreaks.KILLSTREAK_EMP,bDirectlyCausedByPlayer:!1});else{a.distThreshold=200,a.maxSpeed=300;p=this.getCurrentMapData().width;t.destination=[e.position[0]>.5*p?p:0,0]}}if(null!=a.desiredAimRotation){var v=this.WrapAngle(a.aimRotation-a.desiredAimRotation,!0);a.aimRotation-=v*a.aimSpeed}if(a.swayMax>0&&(1==a.swayDir?(a.sway++,a.sway>a.swayMax&&(a.swayDir=-1)):(a.sway--,a.sway<-a.swayMax&&(a.swayDir=1))),r=t.destination){var u=a.maxSpeed,b=[r[0],r[1]];i<a.distThreshold+a.swayMax&&(b[0]+=a.sway,b[1]+=a.sway);var y=b[0]-e.position[0]-e.velocity[0]*a.heliVelocityXAdjust,D=b[1]-e.position[1]-2*e.velocity[1];y=y>0?Math.min(y,u):Math.max(y,-u),e.applyForce([y,D],[0,0]),this.constrainVelocity(e,500)}a.bDrone?e.angularVelocity=10*-e.angle:(e.angle=this.ToRad(e.velocity[0]*a.angleMult),e.position[1]=Math.min(e.position[1],this.getHeliMaxY(a.bBot)),e.position[1]=Math.max(e.position[1],0))}else if(a.controllerId){var g=this.getPlayerStateById(a.controllerId);this.clearPlayerControllable(g)}}createBullet(e,a,t,r,i,s,o,l,n,d,E,h){var c=r,m=Math.cos(t)*c,p=Math.sin(t)*c,_=this.getObjectById(o),A={eventId:GameServer.EVENT_SPAWN_BULLET,startX:Math.round(e),startY:Math.round(a),endX:Math.round(e+m),endY:Math.round(a+p),rotation:t,team:_?_.data.team:-1,damageAmount:i,controllerId:s,causerId:o,weaponId:l,weaponData:n};E&&(A.bMelee=!0),d&&(A.bDirectlyCausedByPlayer=!0),h&&(A.bIgnoreObstacles=!0),this.hasMod(n,Mods.BARREL_SILENCER)&&(A.bSilenced=!0),this.requestEvent(A)}createImpactEffects(e){this.localData.bMultiplayer&&this.batchData.length>=Settings.BATCH_MAX||e&&e.length>0&&this.requestEvent({eventId:GameServer.EVENT_SPAWN_OBJECT,data:{type:"impactEffect",items:e}})}createImpactEffect(e,a,t,r,i){this.localData.bMultiplayer&&this.batchData.length>=Settings.BATCH_MAX||this.requestEvent({eventId:GameServer.EVENT_SPAWN_OBJECT,data:{x:Math.round(e),y:Math.round(a),type:"impactEffect",rotation:this.RoundDecimal(t),impactType:r,intensity:i}})}triggerCharacterJump(e){this.handlePlayerInput(e,{keyId:"jump",value:!0})}triggerMine(e,a){var t=e.data;t.bJammed||(t.bTriggered=!0,t.triggerTimer=a,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:t.id,type:GameServer.PAWN_TRIGGER_MINE}))}detonate(e,a){if(e&&e.data){var t=e.data;if(t.bDetonated)return;switch(t.bDetonated=!0,t.type){case"obstacle":"barrel_explosive"==t.obstacleId&&(this.createExplosion({eventId:GameServer.EVENT_SPAWN_EXPLOSION,x:e.position[0],y:e.position[1],radius:400,damage:500,playerId:t.playerId?t.playerId:t.id,causerId:t.id,weaponId:"barrel",bDirectlyCausedByPlayer:!0,directHitId:a}),this.removeNextStep(e));break;case"equipment":if(o=t.weaponData){var r=e.position[0],i=e.position[1]-10;switch(o.id){case"claymore":r+=50*t.scale,i-=10}this.createExplosion({eventId:GameServer.EVENT_SPAWN_EXPLOSION,x:r,y:i,radius:o.radius,damage:o.damage,playerId:t.ownerId?t.ownerId:t.id,causerId:t.id,weaponId:o.id,bDirectlyCausedByPlayer:!0,directHitId:a})}this.removeNextStep(e);break;case"grenade":var s=t.grenadeData;if("smoke"==s.weaponId)this.emitAISound(e.position),e.data.destroyTimer=8*this.localData.settings.fps,e.data.bActivated=!0,this.pushObjectDataUpdate(e.data.id,["bActivated"]),this.createExplosion({eventId:GameServer.EVENT_SPAWN_EXPLOSION,x:e.position[0],y:e.position[1],radius:200,damage:1,playerId:s.playerId?s.playerId:t.id,causerId:t.id,weaponId:s.weaponId,bDirectlyCausedByPlayer:!0,directHitId:a});else if("napalm"==s.weaponId||"molotov"==s.weaponId){var o=this.getWeaponData(s.weaponId),l=e.previousPosition?e.previousPosition:e.position;this.createExplosion({eventId:GameServer.EVENT_SPAWN_EXPLOSION,x:l[0],y:l[1],radius:o.radius,damage:o.damage,playerId:s.playerId?s.playerId:t.id,causerId:t.id,weaponId:s.weaponId,bDirectlyCausedByPlayer:!0,directHitId:a});for(var n=15,d=0;d<n;d++)this.createFlame(e.position,[this.Random(-500,500),this.Random(-500,-100)],e.data.team,s.playerId?s.playerId:t.id,s.weaponId,null,o.fireTime);this.removeNextStep(e)}else if(t.minTimer>0)this.removeNextStep(e),this.createImpactEffect(e.position[0],e.position[1],e.angle,"grenade",1);else{var E=e.previousPosition;0===E[0]&&0===E[1]&&(E=e.position),E[1]-=10;var h=s.killstreakId?s.killstreakId:s.weaponId;this.createExplosion({eventId:GameServer.EVENT_SPAWN_EXPLOSION,x:E[0],y:E[1],radius:t.radius,damage:t.damage,playerId:s.playerId?s.playerId:t.id,causerId:t.id,weaponId:h,bDirectlyCausedByPlayer:!0}),e.constraint&&(this.localData.world.removeConstraint(e.constraint),delete e.constraint),this.removeNextStep(e)}break;case"rocket":var c=t.rocketData,m=e.previousPosition;switch(0===m[0]&&0===m[1]&&(m=e.position),this.createExplosion({eventId:GameServer.EVENT_SPAWN_EXPLOSION,x:m[0],y:m[1],radius:t.radius,damage:t.damage,playerId:c.playerId?c.playerId:t.id,causerId:t.id,weaponId:c.weaponId,bDirectlyCausedByPlayer:!0}),c.type){case Rocket.TYPE_NAPALM:n=10;switch(c.weaponId){case Killstreaks.KILLSTREAK_NAPALM:var p=15;break;default:p=5}for(d=0;d<n;d++)this.createFlame(e.position,[this.Random(-500,500),this.Random(-500,-100)],e.data.team,c.playerId?c.playerId:t.id,c.weaponId,c.weaponData,p)}this.removeNextStep(e);break;case"crate":if(t.interactData.type==Crate.CRATE_BOMB_GENERIC){this.createExplosion({eventId:GameServer.EVENT_SPAWN_EXPLOSION,x:e.position[0],y:e.position[1],radius:500,damage:500,causerId:t.id,playerId:t.planterId,weaponId:"bomb"}),this.removeNextStep(e);var _=this.localData.gameModeData;_.id==GameMode.OP_BOMB&&(_.numBombs--,this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{numBombs:_.numBombs}}),0===_.numBombs&&this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_OBJECTIVE,winningTeam:0}))}}}}removeNextStep(e){e&&(e.data.bPendingRemoval=!0,this.localData.toRemove.push(e))}createInfestor(e,a,t,r){var i=this.getSharedData(r),s=new p2.Body({mass:1,fixedRotation:i.fixedRotation,position:a,damping:i.damping,angularDamping:i.angularDamping,allowSleep:!0,sleepSpeedLimit:1,sleepTimeLimit:1});s.data={id:e,type:"infestor",infestorType:r,material:"flesh",damageMultipliers:{1:1,2:.5,3:1,4:1.5},bZombie:!0,health:500,maxHealth:500,team:t,maxSpeed:i.maxSpeed,jumpHeight:i.jumpHeight,exposedTimer:0,reloadTimer:0,weapon:this.createWeaponObject(),currentInventoryIndex:0,aimRotation:0,aimSpeed:.5,aimSpeedMultiplier:1,accuracyMultiplier:1,reloadMultiplier:1,speedMultiplier:1,baseSpeedMultiplier:1,desiredAimRotation:this.ToRad(this.RandomBoolean()?0:180),climbSpeedMultiplier:i.climbSpeedMultiplier,xpReward:200},s.data.inventory=[this.getWeaponData(r)],this.setCharacterCurrentInventoryItem(s,0);var o=new p2.Box({width:i.width,height:i.height,collisionGroup:CollisionGroups.PAWN,collisionMask:CollisionGroups.GROUND|CollisionGroups.PLATFORM|CollisionGroups.PROJECTILE});return s.addShape(o),this.addWorldBody(s),s}createCharacter(e,a,t,r,i,s,o){var l=this.getSharedData("character"),n=new p2.Body({mass:1,fixedRotation:l.fixedRotation,damping:l.damping,position:a,allowSleep:!1}),d=this.getCharacterHealth();if(n.data={id:e,type:"character",material:"flesh",damageMultipliers:{1:1,2:1,3:1},health:d,maxHealth:d,team:t,maxSpeed:l.maxSpeed,climbSpeedMultiplier:l.climbSpeedMultiplier,jumpHeight:l.jumpHeight,avatarData:r,exposedTimer:0,regenAmount:1,regenTimer:0,regenTimerMax:3*this.localData.settings.fps,reloadTimer:0,weapon:this.createWeaponObject(),currentInventoryIndex:0,aimRotation:0,aimSpeed:.2,aimSpeedMultiplier:1,accuracyMultiplier:1,reloadMultiplier:1,desiredAimRotation:this.ToRad(this.RandomBoolean()?0:180),bRegenHealth:!0,bUseExposeTimer:!0,xpReward:100,speedMultiplier:1,baseSpeedMultiplier:1,perks:[]},i){for(var E=[],h=0;h<i.length;h++){var c=i[h],m=this.getWeaponData(c.id);m&&(null!=c.mag&&(m.mag=c.mag),null!=c.ammo&&(m.ammo=c.ammo),this.applyWeaponMods(m,c.mods),E.push(m))}n.data.inventory=E,this.setCharacterCurrentInventoryItem(n,0)}else console.warn("Character has no inventory");s&&(n.data.equipment=this.getWeaponData(s)),o&&(n.data.perks=o,this.updateCharacterPerks(n));var p=new p2.Box({width:l.width,height:l.height,collisionGroup:CollisionGroups.PAWN,collisionMask:CollisionGroups.GROUND|CollisionGroups.PLATFORM|CollisionGroups.PROJECTILE});n.addShape(p),p.material=new p2.Material;var _=new p2.ContactMaterial(p.material,this.localData.materials.ground,{friction:.5,restitution:0});return this.localData.world.addContactMaterial(_),this.addWorldBody(n),n}addWorldBody(e){var a=this.localData;if(a.world.addBody(e),e.data){if(!e.data.id){var t="a_"+this.getRandomUniqueId();e.data.id=t,console.warn("Missing id",e.data,t)}a.objects[e.data.id]=e}}hasMod(e,a){if(e&&a){switch(a){case Mods.BARREL_SILENCER:if(e.bSilenced)return!0}var t=e.mods;if(t)for(var r=Object.keys(t),i=0;i<r.length;i++){if(t[r[i]]==a)return!0}}return!1}applyWeaponMods(e,a,t){var r=e;if(r.mods={},a){var i=this.getWeaponData(e.id),s=r.barrelId,o=r.barrelAmmo;delete r.barrelId,delete r.barrelAmmo,delete r.barrelAmmoMax,delete r.bSlug,delete r.bSpeedLoader,delete r.bHighCaliber,delete r.bImpact,r.fireMode=i.fireMode,r.accuracy=i.accuracy,r.fireRate=i.fireRate,r.burstFireRate=i.burstFireRate,r.boltDelayTimer=i.boltDelayTimer,r.recoil=i.recoil,r.speedModifier=i.speedModifier,r.range=i.range,r.penetration=i.penetration,r.damage=i.damage,r.radius=i.radius,r.magSize=i.magSize,r.lookModifier=i.lookModifier,r.headshotMultiplier=i.headshotMultiplier?i.headshotMultiplier:1,i.bAirOnly&&(r.bAirOnly=i.bAirOnly),r.mods[Mods.TYPE_BASE]=a[Mods.TYPE_BASE];var l=r.type===Weapon.TYPE_SHOTGUN?.8:.6;switch(a[Mods.TYPE_BASE]){case Mods.BASE_SHIELD_DAMAGE:r.damage=Math.round(1.5*i.damage);break;case Mods.BASE_SHIELD_RAPID_FIRE:r.id,r.fireRate=Math.floor(.5*i.fireRate);break;case Mods.BASE_DEADEYE:r.accuracy=Math.floor(i.accuracy*l);break;case Mods.BASE_RAPID_FIRE:if(r.bZombie?r.fireRate=Math.max(1,Math.round(.5*i.fireRate)):(r.fireRate=Math.ceil(i.fireRate<10?i.fireRate-1:.7*i.fireRate),r.fireRate=Math.max(1,r.fireRate-r.fireRate%(1/this.localData.settings.fps_mult))),r.type!=Weapon.TYPE_MELEE)if(r.bBoltAction&&(r.boltDelayTimer=.8*i.boltDelayTimer),r.burstFireRate)r.burstFireRate=Math.ceil(.8*i.burstFireRate),r.accuracy=i.accuracy+.5;else{var n=this.RoundDecimal(Math.max(0,1-.05*r.fireRate));(this.localData.bSurvival||this.localData.bBattlezone)&&(n*=.1),r.accuracy=i.accuracy+n,r.recoil=Math.max(1,i.recoil)+n}this.localData.bSurvival||r.fireRate<=4&&(r.damage=Math.round(.75*r.damage));break;case Mods.BASE_DAMPER:r.recoil=Math.floor(.75*r.recoil);break;case Mods.BASE_SPEED:var d=.2;"riot_shield"==r.id&&(d=.25),r.speedModifier=i.speedModifier+d;break;case Mods.BASE_RANGE:if(r.bZombie||this.isMeleeWeapon(r))r.range=i.range+20;else if("flamethrower"==r.id){var E=300,h=.1;r.velocity=r.velocity+E}else switch(E=500,h=.25,r.type){case Weapon.TYPE_SNIPER:h=.1;break;case Weapon.TYPE_SHOTGUN:E=300,h=.2}E&&(r.range=i.range+E),h&&(r.lookModifier=i.lookModifier+h);break;case Mods.BASE_MODE_SELECTOR:break;case Mods.BASE_BURST_FIRE:r.fireMode=Weapon.MODE_BURST,r.fireRate=Math.max(1,Math.round((i.fireRate-1)*(i.fireRate>6?.6:.8))),r.burstFireRate=Math.max(r.type==Weapon.TYPE_LMG?20:18,Math.round(3.2*i.fireRate)),r.accuracy=this.RoundDecimal(r.accuracy*l),r.recoil=this.RoundDecimal(.8*r.recoil),r.range=r.range+400,r.lookModifier=r.lookModifier+.15;break;case Mods.BASE_FULL_AUTO:var c=r.fireMode;r.fireMode=Weapon.MODE_AUTO,r.fireRate=Math.ceil(1.5*i.fireRate),this.localData.bSurvival?(r.recoil=r.recoil+1,r.accuracy=r.accuracy+1):(r.recoil=r.recoil+2,r.accuracy=r.accuracy+2,c==Weapon.MODE_BURST&&(r.accuracy+=1));break;case Mods.BASE_SINGLE_FIRE:r.fireMode=Weapon.MODE_SEMI,r.type==Weapon.TYPE_SHOTGUN?(r.accuracy=this.RoundDecimal(.8*r.accuracy),r.fireRate=this.RoundDecimal(1.5*i.fireRate)):(r.accuracy=this.RoundDecimal(r.accuracy*l),r.recoil=this.RoundDecimal(.8*r.recoil),r.fireRate=i.fireRate>=8?10:8),r.range=r.range+400,r.lookModifier=r.lookModifier+.15}this.getPlayerStateById(t);for(var m=[Mods.TYPE_BARREL,Mods.TYPE_BARREL+"2",Mods.TYPE_BARREL+"3"],p=0;p<m.length;p++){let e=m[p];if(e)switch(r.mods[e]=a[e],a[e]){case Mods.BARREL_SILENCER:r.recoil=Math.floor(.9*r.recoil);break;case Mods.BARREL_LASER:r.accuracy=Math.floor(r.accuracy*l);break;case Mods.BARREL_GRIP:case Mods.BARREL_COMPENSATOR:r.recoil=Math.floor(.75*r.recoil);break;case Mods.BARREL_BOOSTER:r.penetration=r.penetration+(this.localData.bSurvival?2:1);break;case Mods.BARREL_ACCELERATOR:r.range=r.range+300,r.recoil+=.3;break;case Mods.BARREL_GP25:r.barrelId=Mods.BARREL_GP25,r.barrelAmmo=4,r.barrelAmmoMax=r.barrelAmmo;break;case Mods.BARREL_M203:r.barrelId=Mods.BARREL_M203,r.barrelAmmo=4,r.barrelAmmoMax=r.barrelAmmo;break;case Mods.BARREL_MASTERKEY:r.barrelId=Mods.BARREL_MASTERKEY,r.barrelAmmo=8,r.barrelAmmoMax=r.barrelAmmo}}switch(r.barrelId&&r.barrelId==s&&o&&(r.barrelAmmo=Math.min(o,r.barrelAmmoMax)),r.mods[Mods.TYPE_AMMO]=a[Mods.TYPE_AMMO],a[Mods.TYPE_AMMO]){case Mods.AMMO_PIERCING:r.penetration=r.penetration+(this.localData.bSurvival?2:1);break;case Mods.AMMO_FMJ:var _=1.2;r.bZombie?_=1.5:this.localData.bSurvival&&(_=1.8),r.damage=Math.round(i.damage*_);break;case Mods.AMMO_EXTENDED:r.id,r.magSize=Math.floor(1.5*i.magSize),r.mag=r.magSize;break;case Mods.AMMO_HOLLOW_POINT:var A=i.headshotMultiplier?i.headshotMultiplier:1;r.headshotMultiplier=A+(this.localData.bSurvival?1.6:.6);break;case Mods.AMMO_LAUNCHER_RADIUS:r.type==Weapon.TYPE_LAUNCHER&&(r.radius=i.radius+(this.localData.bSurvival?200:100));break;case Mods.AMMO_LAUNCHER_EXPLOSIVE:r.type==Weapon.TYPE_LAUNCHER&&(r.damage=Math.round(i.damage*(this.localData.bSurvival?5:1.4)));break;case Mods.AMMO_SLUG:r.type==Weapon.TYPE_SHOTGUN&&(r.damage=Math.round(i.damage*(this.localData.bSurvival?10:5)),r.accuracy=Math.round(.5*i.accuracy),r.recoil+=.5,r.bSlug=!0,r.range=r.range-100);break;case Mods.AMMO_SPEED_LOADER:r.bSingleRoundLoaded&&(r.bSpeedLoader=!0);break;case Mods.AMMO_HIGH_CALIBER:r.bHighCaliber=!0;break;case Mods.AMMO_IMPACT:r.bImpact=!0;break;case Mods.AMMO_NAPALM:r.type==Weapon.TYPE_LAUNCHER?(r.rocketType=Rocket.TYPE_NAPALM,this.localData.bSurvival||(r.damage=Math.round(.5*r.damage)),r.fireDamage=15,r.fireTime=6):r.bFlame=!0}}}createRocket(e,a){var t=new p2.Body({mass:.1,position:e,angle:a.rotation,gravityScale:0}),r=0,i=0,s=0,o=!1,l=!1,n=a.weaponId,d=this.localData,E=5*this.localData.settings.fps;switch(n){case Killstreaks.KILLSTREAK_HELLFIRE:E=10*this.localData.settings.fps,r=d.bSurvival?3e3:1e3,i=500,s=0,o=!0;break;case Killstreaks.KILLSTREAK_REAPER:r=d.bSurvival?1e3:500,i=d.bSurvival?600:300,s=200;break;case Killstreaks.KILLSTREAK_COBRA_CONTROLLABLE:r=d.bSurvival?500:300,i=400,s=200;break;case Killstreaks.KILLSTREAK_PAVE_LOW:r=500,i=400,s=200;var h=!0;break;case Killstreaks.KILLSTREAK_AIRSTRIKE:r=d.bSurvival?800:300,i=400,s=150;break;case Killstreaks.KILLSTREAK_NAPALM:r=d.bSurvival?500:200,i=300,s=150;break;case Killstreaks.KILLSTREAK_BOMBARDMENT:r=d.bSurvival?800:300,i=500,s=200;break;case Killstreaks.KILLSTREAK_STEALTH_BOMBER:r=d.bSurvival?1e3:350,i=450,s=200;break;case Killstreaks.KILLSTREAK_SAM_TURRET:r=this.localData.bSurvival?250:500,i=100,s=150,h=!0;break;case"javelin":var c=this.getWeaponData(n);r=a.damage?a.damage:c.damage,i=a.radius?a.radius:c.radius,s=50;var m=a.path;l=a.bAirOnly;break;default:c=this.getWeaponData(n);r=a.damage?a.damage:c.damage,i=a.radius?a.radius:c.radius,l=a.bAirOnly,o=c.bControllable,s=150}t.data={id:this.getRandomUniqueId(),destroyTimer:E,type:"rocket",damage:r,radius:i,team:a.team,rocketData:a},m&&(t.data.path=m),h&&(t.data.bAutoLock=!0),o&&(t.data.bControllable=o,t.data.health=20);var p=new p2.Box({width:20,height:8,collisionGroup:CollisionGroups.PROJECTILE,collisionMask:CollisionGroups.GROUND|CollisionGroups.PAWN|CollisionGroups.PAWN_AIR|CollisionGroups.DRONE});if(p.sensor=!0,n==Killstreaks.KILLSTREAK_SAM_TURRET&&(p.collisionGroup=CollisionGroups.PROJECTILE_AIR,p.collisionMask=CollisionGroups.PAWN_AIR|CollisionGroups.DRONE),t.addShape(p),this.addWorldBody(t),s){var _=a.rotation;t.applyImpulse([Math.cos(_)*s,Math.sin(_)*s],0,0)}if(l){var A=this.getObjectById(a.playerId);A&&(t.data.rocketData.enemyId=A.data.lockOnTargetId)}if(o){var I=this.getPlayerStateById(a.playerId);I&&(t.data.team=I.team,this.setPlayerControllable(I,t))}return this.requestEvent({eventId:GameServer.EVENT_SPAWN_ROCKET,position:t.position,velocity:t.velocity,angularVelocity:t.angularVelocity,rotation:t.angle,data:t.data}),t}createProjectile(e,a,t,r){this.localData;var i=new p2.Body({mass:.1,position:e,angle:a,angularDamping:.2}),s=this.getWeaponData(r.weaponId);i.data={id:this.getRandomUniqueId(),type:"projectile",team:t,damage:s.damage,projectileData:r};switch(s.id){case"crossbow":var o=new p2.Box({width:30,height:10});i.gravityScale=.25;break;case"knife":o=new p2.Circle({radius:10}),i.gravityScale=.5;break;default:o=new p2.Circle({radius:10})}o.sensor=!0,o.collisionGroup=CollisionGroups.PROJECTILE,o.collisionMask=CollisionGroups.SHIELD|CollisionGroups.GROUND|CollisionGroups.PAWN|CollisionGroups.PAWN_AIR|CollisionGroups.DRONE,i.addShape(o),this.addWorldBody(i);var l=r.rotation,n=r.velocity;return i.applyImpulse([Math.cos(l)*n,Math.sin(l)*n],0,0),this.requestEvent({eventId:GameServer.EVENT_SPAWN_PROJECTILE,position:i.position,rotation:i.angle,velocity:i.velocity,angularVelocity:i.angularVelocity,data:i.data}),i}isInSmoke(e){if(e)for(var a=this.getSmokeGrenades(),t=0;t<a.length;t++){var r=a[t];if(this.Dist(r.position[0],r.position[1],e.position[0],e.position[1])<=this.getSharedData("smokeSize"))return!0}return!1}createFlame(e,a,t,r,i,s=null,o=5,l=!1){var n=new p2.Body({mass:1,fixedRotation:!0,position:e,velocity:a,damping:l?.92:.8});switch(n.data={id:this.getRandomUniqueId(),x:e[0],y:e[1],type:"flame",team:t,damage:10,playerId:r,weaponId:i,destroyTimer:Math.round(this.localData.settings.fps*o),ticker:20*this.localData.settings.fps_mult,bFromWeapon:l},l&&(n.data.cooldownTimer=5),i){case Killstreaks.KILLSTREAK_NAPALM:n.data.damage=20;break;default:var d=s||this.getWeaponData(i);d&&(n.data.damage=d.fireDamage?d.fireDamage:d.damage)}var E=CollisionGroups.FLAME,h=CollisionGroups.GROUND,c=new p2.Circle({radius:20,collisionGroup:E,collisionMask:h});n.addShape(c);var m=this.getFlames();return m.length>Settings.FLAMES_MAX&&this.removeNextStep(m[0]),this.addWorldBody(n),this.onEvent({eventId:GameServer.EVENT_SPAWN_OBJECT,data:n.data}),n}createGrenade(e,a,t){var r=this.localData,i=new p2.Body({mass:1,position:e,damping:.2,angularDamping:.7,allowSleep:!0,sleepSpeedLimit:1,sleepTimeLimit:1}),s=a.weaponData?a.weaponData:this.getWeaponData(a.weaponId),o=!!s&&s.bRemoteDetonation;i.data={id:this.getRandomUniqueId(),type:"grenade",team:a.team,damage:a.damage?a.damage:s.damage,radius:a.radius?a.radius:s.radius,bDetonationTimerEnabled:!a.bStartDetonationAfterHit,detonationTimer:(s?s.detonationTimer:this.localData.settings.fps)*this.localData.settings.fps_mult,bRemoteDetonation:o,grenadeData:a},t&&(this.localData.bSurvival||(i.data.minTimer=10*this.localData.settings.fps_mult));var l=a.bImpact||s.bCollidePawns;if(o){i.data.bDetonationTimerEnabled=!1,i.allowSleep=!1,i.data.health=1;var n=new p2.Box({width:20,height:20})}else n=new p2.Box({width:20,height:20});a.bImpact&&(n.sensor=!0),n.collisionGroup=CollisionGroups.PROJECTILE,n.collisionMask=CollisionGroups.GROUND|CollisionGroups.SHIELD|CollisionGroups.DRONE,l?n.collisionMask=CollisionGroups.GROUND|CollisionGroups.PAWN|CollisionGroups.PAWN_AIR|CollisionGroups.SHIELD|CollisionGroups.DRONE:o&&(n.collisionMask=CollisionGroups.GROUND|CollisionGroups.PLATFORM|CollisionGroups.SHIELD|CollisionGroups.DRONE),i.addShape(n);var d=r.world;this.addWorldBody(i),n.material=new p2.Material;var E=new p2.ContactMaterial(n.material,r.materials.ground,{friction:1,restitution:o?.1:.25,stiffness:Number.MAX_VALUE});d.addContactMaterial(E);var h=a.rotation,c=a.velocity;return i.angularVelocity=.01*c,i.applyImpulse([Math.cos(h)*c,Math.sin(h)*c],0,0),this.requestEvent({eventId:GameServer.EVENT_SPAWN_GRENADE,position:i.position,velocity:i.velocity,angularVelocity:i.angularVelocity,data:i.data}),i}createTurret(e,a,t,r,i){var s=this.getSharedData(i.type),o=new p2.Body({mass:1,position:a,damping:s.damping,angularDamping:s.angularDamping,allowSleep:!0,sleepSpeedLimit:1,sleepTimeLimit:1,velocity:[0,1]});o.data={id:e,x:a[0],y:a[1],type:"turret",material:"metal",damageMultipliers:{1:.2,2:this.localData.bSurvival?1:2,3:1,4:.1},scale:t,team:r,aimRotation:this.ToRad(-90),desiredAimRotation:this.ToRad(-90),aimPos:[0,0],aimSpeed:.2/this.localData.settings.fps_mult,bWantsToFire:!1,bFireDelay:!1,fireDelayTimer:0,accuracy:2,bAutomated:!0,fireRate:1,weaponType:"bullet",maxRange:1250,enemyTypes:null,bLimitScale:!0,bUnlimitedAmmo:i.bUnlimitedAmmo,turretData:i,muzzleOffsetY:-.5*s.height,xpReward:100,bUseExposeTimer:!this.localData.bSurvival&&!this.localData.bSandbox&&!this.isTutorial(),bLOS:!0};var l=o.data;l.bExposed=!l.bUseExposeTimer;var n=200;switch(i.type){case Turret.TYPE_SAM:l.aimSpeed=.5,l.killstreakId=Killstreaks.KILLSTREAK_SAM_TURRET,l.fireRate=3*this.localData.settings.fps,l.ammo=10,l.accuracy=0,l.weaponType="rocket",l.maxRange=4e3,l.enemyTypes=["helicopter"],l.bLimitScale=!1,l.bLOS=!1;break;case Turret.TYPE_SENTRY:l.killstreakId=Killstreaks.KILLSTREAK_SENTRY_GUN,l.fireRate=Math.round(4*this.localData.settings.fps_mult),l.ammo=1e3,l.maxRange=this.localData.bSurvival?2e3:this.localData.bOperation?1250:1500,l.weaponType="bullet",l.damage=30,l.enemyTypes=["character","infestor"];break;case Turret.TYPE_REMOTE:l.killstreakId=Killstreaks.KILLSTREAK_REMOTE_TURRET,l.accuracy=3,l.bAutomated=!1,l.maxRange=1800,l.fireRate=Math.floor(3*this.localData.settings.fps_mult),l.ammo=500,l.weaponType="bullet",l.damage=40,l.muzzleOffsetY-=12,n=100;break;case Turret.TYPE_BALLISTIC:l.killstreakId=Killstreaks.KILLSTREAK_ADVANCED_TURRET,l.accuracy=1,l.bAutomated=!1,l.maxRange=2e3,l.fireRate=Math.round(10*this.localData.settings.fps_mult),l.ammo=this.localData.bModeGame?100:250,l.weaponType="bullet",l.damage=this.localData.bModeGame?60:200;break;case Turret.TYPE_GRENADE:l.killstreakId=Killstreaks.KILLSTREAK_GRENADE_TURRET,l.accuracy=1,l.bAutomated=!1,l.maxRange=2e3,l.fireRate=Math.round(20*this.localData.settings.fps_mult),l.ammo=this.localData.bModeGame?50:100,l.weaponType="grenade",l.damage=this.localData.bModeGame?200:800}l.bAutomated&&(l.ticker=0),l.health=l.maxHealth=n,l.ammoMax=l.ammo;var d=new p2.Box({width:s.width,height:s.height,collisionGroup:CollisionGroups.PAWN,collisionMask:CollisionGroups.GROUND|CollisionGroups.PLATFORM|CollisionGroups.PROJECTILE});o.addShape(d),this.addWorldBody(o),this.requestEvent({eventId:GameServer.EVENT_SPAWN_TURRET,position:o.position,velocity:o.velocity,angularVelocity:o.angularVelocity,rotation:o.angle,data:o.data});var E=i.playerId;if(E){var h=this.getTurrets(E,i.type);h.length>Settings.TURRETS_MAX&&this.removeNextStep(h[0])}return o}createSpawner(e,a,t){var r=new p2.Body({mass:0,position:[e,a]});return r.data={id:this.getRandomUniqueId(),type:"spawner",team:t.team,spawnerId:t.spawnerId,timerMax:3*this.localData.settings.fps,timer:0},this.addWorldBody(r),r}createHelicopter(e,a,t){var r=new p2.Body({mass:1,position:e,gravityScale:0});r.data={id:this.getRandomUniqueId(),type:"helicopter",material:"metal",damageMultipliers:{1:.5,2:.9,3:2,4:.1},sway:this.Random(0,99),swayDir:this.RandomBoolean()?1:-1,swayMax:100,team:a,moveSpeed:600,maxSpeed:300,weaponType:"bullet",bBot:!0,distThreshold:60,heliVelocityXAdjust:1.5,aimRotation:this.ToRad(0),aimSpeed:.2/this.localData.settings.fps_mult,aimPos:[0,0],heliData:t,angleMult:.015};var i=r.data,s=!1;0==a&&this.localData.bSurvival&&(s=!0,i.damageMultipliers[DamageType.DAMAGE_BULLET]=.25),i.killReward=t.killReward;var o=100,l=!1;switch(t.type){case Helicopter.TYPE_MH6:o=750,i.heliVelocityXAdjust=2,i.behaviour="deliver",i.xpReward=100;break;case Helicopter.TYPE_MH6_ATTACK:o=this.localData.bSurvival?750:1250,i.bUseTimer=this.localData.bModeGame,i.heliVelocityXAdjust=.5,i.killstreakId=Killstreaks.KILLSTREAK_MH6,i.muzzleOffsetX=70,i.muzzleOffsetY=15,i.fireDelayTimer=0,i.fireRate=Math.round(4*this.localData.settings.fps_mult),i.damage=s?40:20,i.accuracy=5,i.ammo=1e3,i.maxRange=2e3,i.behaviour="attack",i.bDefendOwner=!0,i.bHasBurstDelay=!0,i.burstTimerMax=2*this.localData.settings.fps,i.burstDelayTimerMax=2*this.localData.settings.fps,i.heliData.weaponId="skorpion",i.heliData.style=Helicopter.TYPE_MH6;break;case Helicopter.TYPE_MH6_GRENADE:o=1e3,i.weaponType="grenade",i.bBot=!1,i.bUseTimer=this.localData.bModeGame,i.bPlayerControlled=!0,i.distThreshold=300,i.killstreakId=Killstreaks.KILLSTREAK_MH6_GRENADE,i.muzzleOffsetX=70,i.muzzleOffsetY=12,i.fireDelayTimer=0,i.fireRate=Math.round(15*this.localData.settings.fps_mult),i.damage=this.localData.bSurvival?500:200,i.accuracy=5,i.ammo=this.localData.bSurvival?this.localData.bUseMoneyMultiplier?200:100:60,i.maxRange=2e3,i.behaviour="attack",i.heliData.weaponId="mgl",i.heliData.style=Helicopter.TYPE_MH6,l=!0;break;case Helicopter.TYPE_SCOUT:o=2e3,i.moveSpeed=500,i.bBot=!1,i.bPlayerControlled=!0,i.bUseTimer=this.localData.bModeGame,i.distThreshold=300,i.killstreakId=Killstreaks.KILLSTREAK_SCOUT,i.muzzleOffsetX=170,i.muzzleOffsetY=40,i.fireDelayTimer=0,i.fireRate=Math.round(12*this.localData.settings.fps_mult),i.damage=s?150:75,i.accuracy=2,i.ammo=this.localData.bSurvival?500:200,i.maxRange=2250,i.bMaxLookRange=!0,i.behaviour="attack",i.heliData.weaponId="samr",i.xpReward=200,l=!0;break;case Helicopter.TYPE_COBRA:o=1500,i.bUseTimer=this.localData.bModeGame,i.heliVelocityXAdjust=2,i.killstreakId=Killstreaks.KILLSTREAK_COBRA,i.muzzleOffsetX=140,i.muzzleOffsetY=45,i.fireDelayTimer=0,i.fireRate=Math.round(4*this.localData.settings.fps_mult),i.damage=s?45:30,i.accuracy=3,i.ammo=1e3,i.maxRange=1500,i.behaviour="attack",i.bDefendOwner=!0,i.bHasBurstDelay=!0,i.burstTimerMax=1.5*this.localData.settings.fps,i.burstDelayTimerMax=2*this.localData.settings.fps,i.heliData.weaponId="m249",i.heliData.style=Helicopter.TYPE_COBRA,i.xpReward=200;break;case Helicopter.TYPE_COBRA_CONTROLLABLE:o=2e3,i.bBot=!1,i.bUseTimer=this.localData.bModeGame,i.bPlayerControlled=!0,i.distThreshold=300,i.killstreakId=Killstreaks.KILLSTREAK_COBRA_CONTROLLABLE,i.muzzleOffsetX=140,i.muzzleOffsetY=45,i.fireDelayTimer=0,i.fireRate=Math.round(2*this.localData.settings.fps_mult),i.damage=this.localData.bSurvival?this.localData.bUseMoneyMultiplier?320:160:40,i.accuracy=3,i.ammo=this.localData.bModeGame?500:1500,i.rockets=this.localData.bSurvival?10:5,i.maxRange=2e3,i.behaviour="attack",i.heliData.weaponId="ak47",i.heliData.style=Helicopter.TYPE_COBRA,l=!0;break;case Helicopter.TYPE_REAPER:o=1e3,i.angleMult=.025,i.swayMax=50,i.weaponType="rocket",i.bBot=!1,i.bUseTimer=this.localData.bModeGame,i.bPlayerControlled=!0,i.moveSpeed=800,i.heliVelocityXAdjust=3,i.killstreakId=Killstreaks.KILLSTREAK_REAPER,i.muzzleOffsetY=20,i.fireDelayTimer=0,i.fireRate=Math.round((this.localData.bSurvival?30:60)*this.localData.settings.fps_mult),i.ammo=this.localData.bSurvival?this.localData.bUseMoneyMultiplier?100:50:25,i.maxRange=4e3,i.behaviour="attack",i.heliData.weaponId="smaw",i.xpReward=400,l=!0;break;case Helicopter.TYPE_BLACKHAWK:o=2e3,i.bBot=!1,i.bUseTimer=this.localData.bModeGame,i.bPlayerControlled=!0,i.distThreshold=300,i.killstreakId=Killstreaks.KILLSTREAK_CHOPPER_GUNNER,i.muzzleOffsetX=100,i.muzzleOffsetY=45,i.fireDelayTimer=0,i.fireRate=Math.round(5*this.localData.settings.fps_mult),i.damage=this.localData.bUseMoneyMultiplier?120:50,i.accuracy=4,i.ammo=500,i.maxRange=2500,i.behaviour="attack",i.heliData.weaponId="m240",i.xpReward=300,l=!0;break;case Helicopter.TYPE_BLACKHAWK_SNIPER:o=2e3,i.swayMax=25,i.bBot=!1,i.bUseTimer=this.localData.bModeGame,i.bPlayerControlled=!0,i.distThreshold=600,i.killstreakId=Killstreaks.KILLSTREAK_HELI_SNIPER,i.muzzleOffsetX=100,i.muzzleOffsetY=45,i.fireDelayTimer=0,i.fireRate=Math.round(75*this.localData.settings.fps_mult),i.damage=this.localData.bUseMoneyMultiplier?800:200,i.accuracy=0,i.ammo=50,i.maxRange=2500,i.behaviour="attack",i.heliData.weaponId="r700",i.heliData.style=Helicopter.TYPE_BLACKHAWK,i.xpReward=300,l=!0;break;case Helicopter.TYPE_PAVE_LOW:o=3e3,i.bUseTimer=this.localData.bModeGame,i.rocketTimerMax=15*this.localData.settings.fps,i.heliVelocityXAdjust=1,i.maxSpeed=100,i.killstreakId=Killstreaks.KILLSTREAK_PAVE_LOW,i.distThreshold=100,i.muzzleOffsetX=200,i.muzzleOffsetY=130,i.fireDelayTimer=0,i.fireRate=Math.round(10*this.localData.settings.fps_mult),i.damage=this.localData.bUseMoneyMultiplier?100:40,i.accuracy=2,i.ammo=500,i.maxRange=this.localData.bUseMoneyMultiplier?2500:1500,i.bMaxLookRange=!0,i.behaviour="attack",i.bExplore=this.localData.bModeGame,i.exploreTimer=0,i.bHasBurstDelay=!0,i.burstTimerMax=3*this.localData.settings.fps,i.burstDelayTimerMax=5*this.localData.settings.fps,i.heliData.weaponId="m16a4",i.xpReward=300;break;case Helicopter.TYPE_OSPREY:o=s?4e3:3e3,i.heliVelocityXAdjust=1,i.killstreakId=Killstreaks.KILLSTREAK_ESCORT_AIRDROP,i.distThreshold=200,i.muzzleOffsetX=0,i.muzzleOffsetY=155,i.fireDelayTimer=0,i.fireRate=Math.round((this.localData.bSurvival?10:12)*this.localData.settings.fps_mult),i.damage=this.localData.bUseMoneyMultiplier?200:40,i.accuracy=2,i.ammo=5e3,i.maxRange=s?1500:1400,i.behaviour="attack",i.bAirdrop=!0,i.dropTimer=5*this.localData.settings.fps,i.defendTimer=30*this.localData.settings.fps,i.heliData.weaponId="msg90",i.xpReward=300;break;case Helicopter.TYPE_DRAGONFIRE:o=400,i.angleMult=.03,i.bBot=!1,i.bDrone=!0,i.bUseTimer=this.localData.bModeGame,i.bPlayerControlled=!0,i.moveSpeed=800,i.heliVelocityXAdjust=1,i.killstreakId=Killstreaks.KILLSTREAK_DRAGONFIRE,i.muzzleOffsetY=0,i.fireDelayTimer=0,i.fireRate=Math.floor(2*this.localData.settings.fps_mult),i.damage=s?40:20,i.ammo=this.localData.bSurvival?1e3:500,i.accuracy=5,i.maxRange=1e3,i.bMaxLookRange=!0,i.bIgnoreLOS=!0,i.behaviour="attack",i.swayMax=50,i.heliData.weaponId="vector",i.xpReward=200,l=!0,i.weaponData={id:i.killstreakId,damage:i.damage,range:i.maxRange,type:Weapon.TYPE_SMG,penetration:1}}i.health=i.maxHealth=o,i.bUseTimer&&!i.timer&&(i.timer=180*this.localData.settings.fps),i.weaponData||(i.weaponData={id:i.killstreakId,damage:i.damage,range:i.maxRange,type:Weapon.TYPE_LMG,penetration:1}),i.rockets&&(i.rocketsMax=i.rockets,i.rocketDelayTimer=0),"attack"==i.behaviour&&(i.ticker=0),i.ammo&&(i.ammoMax=i.ammo),i.bHasBurstDelay&&(i.burstTimer=i.burstTimerMax,i.burstDelayTimer=0,i.bBurstDelay=!1),i.bPlayerControlled&&(i.bShowPlayer=!0);var n=t.style?t.style:t.type,d=this.getSharedData(n),E=new p2.Box({width:d.width,height:d.height,collisionGroup:i.bDrone&&!this.localData.bOperation?CollisionGroups.DRONE:CollisionGroups.PAWN_AIR,collisionMask:i.bDrone&&!this.localData.bOperation?CollisionGroups.GROUND|CollisionGroups.PROJECTILE|CollisionGroups.PROJECTILE_AIR:CollisionGroups.PROJECTILE|CollisionGroups.PROJECTILE_AIR});if(r.addShape(E),this.addWorldBody(r),l){r.data.bControllable=!0;var h=this.getPlayerStateById(t.playerId);h&&(t.avatarData=h.avatarData,this.setPlayerControllable(h,r))}if((p=t.items)&&!i.bAirdrop){var c=p[0];switch(c.type){case"crate":var m;switch(c.crateType){case Crate.CRATE_AMMO:m=this.createAmmoCrate(r.position[0],r.position[1],t.playerId);break;case Crate.CRATE_DECOY:m=this.createDecoyCrate(r.position[0],r.position[1],t.playerId);break;case Crate.CRATE_WEAPON:var p;if(!(p=c.items)){var _=c.weaponData;_||(_=this.getWeaponData(c.weaponId,c.mods)),p=[_]}m=this.createItemCrate(r.position[0],r.position[1],t.playerId,p);break;case Crate.CRATE_PERK:m=this.createPerkCrate(r.position[0],r.position[1],t.playerId,c.perkId);break;case Crate.CRATE_SHARD:m=this.createShardCrate(r.position[0],r.position[1],c.shards);break;case Crate.CRATE_XP:m=this.createXPCrate(r.position[0],r.position[1],c.xp);break;case Crate.CRATE_LIFE:m=this.createLifeCrate(r.position[0],r.position[1],c.lives);break;case Crate.CRATE_KILLSTREAK:m=c.killstreakId?this.createKillstreakCrate(r.position[0],r.position[1],c.killstreakId,t.playerId):this.createKillstreakCrate(r.position[0],r.position[1],void 0,t.playerId)}if(m){m.mass=.1,m.updateMassProperties(),m.angularDamping=.5,m.shapes[0].collisionMask=0;var A=t.type==Helicopter.TYPE_SCOUT?120:80;m.position[1]+=A,m.data.bEnabled=!1,m.data.bOnRope=!0;var I=new p2.RevoluteConstraint(r,m,{worldPivot:[r.position[0],r.position[1]]});I.setStiffness(100),I.upperLimit=this.ToRad(45),I.upperLimitEnabled=!0,I.lowerLimit=this.ToRad(-45),I.lowerLimitEnabled=!0,this.localData.world.addConstraint(I),r.constraint=I,r.data.crateId=m.data.id,this.pushObjectDataUpdate(m.data.id,["bEnabled","bOnRope"])}}}return this.requestEvent({eventId:GameServer.EVENT_SPAWN_HELICOPTER,position:r.position,data:r.data}),r}setInteractableEnabled(e,a){}getRescueZone(){switch(this.localData.gameModeData.id){case GameMode.OP_HOSTAGE:return this.localData.gameModeData.rescueZone?this.localData.gameModeData.rescueZone:this.localData.operation.data.player.position;default:return this.getCurrentMapData().spawns_team[0]}}createDroppedWeapon(e,a,t,r,i,s,o){var l=new p2.Body({mass:1,position:a,angle:t,allowSleep:!0,sleepSpeedLimit:1,sleepTimeLimit:1});l.data={id:e,type:"droppedWeapon",scale:r,interactData:i};var n=i.weaponData,d=this.getWorldWeaponData(n.id),E=new p2.Box({width:d.w,height:d.h,collisionMask:CollisionGroups.GROUND|CollisionGroups.PLATFORM});l.addShape(E),this.addWorldBody(l),0==n.ammo&&0==n.mag&&(l.data.destroyTimer=this.localData.settings.fps),s&&l.applyImpulse([s[0],s[1]],0,0),this.onEvent({eventId:GameServer.EVENT_SPAWN_DROPPED_WEAPON,position:l.position,rotation:l.angle,velocity:l.velocity,angularVelocity:l.angularVelocity,data:l.data});for(var h,c=this.localData.world.bodies,m=0,p=0;p<c.length;p++)if(c[p].data&&"droppedWeapon"==c[p].data.type&&(h||(h=c[p]),++m>8)){this.removeNextStep(h);break}return l}createExplosion(e){this.requestEvent(e)}createEquipment(e,a,t,r,i){var s=this.getSharedData(i.id),o=new p2.Body({mass:s.mass?s.mass:1,damping:.9,position:e,allowSleep:!0,sleepSpeedLimit:1,sleepTimeLimit:1,velocity:[0,1]});if(o.data={id:this.getRandomUniqueId(),x:e[0],y:e[1],type:"equipment",health:i.health?i.health:1,team:a,scale:t,ownerId:r,weaponData:i},"trophy"==i.id?(o.data.material="metal",o.data.blockNum=2,o.data.bCanMelee=!0):"tac_insert"==i.id&&(o.fixedRotation=!0),i.radius&&(o.data.radius=i.radius),i.bMine)switch(i.id){case"claymore":o.data.bUseScale=!0,o.data.triggerRange=200;break;case"betty":o.data.triggerRange=60;break;default:o.data.triggerRange=100}var l=new p2.Box({width:s.width,height:s.height,collisionGroup:CollisionGroups.PAWN,collisionMask:CollisionGroups.GROUND|CollisionGroups.PLATFORM|CollisionGroups.PROJECTILE});o.addShape(l);var n=4;switch(i.id){case"jammer":case"sensor":case"trophy":n=2}var d=this.getEquipmentByPlayerId(r,i.id);return d.length>=n&&this.removeNextStep(d[0]),this.addWorldBody(o),this.onEvent({eventId:GameServer.EVENT_SPAWN_EQUIPMENT,position:o.position,data:o.data}),o}resetFlag(e){if(e){var a=e.data;a.bIsBeingCaptured=!1,a.captureTimer[0]=a.captureTimerMax,a.captureTimer[1]=a.captureTimerMax,a.pointTimer=0,a.team=null,this.pushObjectDataUpdate(a.id,["bIsBeingCaptured","pointTimer","team","captureTimer"])}}createFlagDomination(e,a){var t=this.getCurrentMapData(),r=t.flags_domination[e];if(this.localData.gameModeData.id==GameMode.HEADQUARTERS){var i=t.flags_headquarters;i&&(r=i[this.Random(0,i.length-1)])}var s=new p2.Body({mass:0,position:r,fixedRotation:!0}),o=this.localData.settings.fps*a;s.data={id:"flag_"+e,x:s.position[0],y:s.position[1],type:"flag_domination",num:e,str:["a","b","c"][e],team:null,bIsBeingCaptured:!1,captureTimer:[o,o],captureTimerMax:o,pointTimer:0,pointTimerMax:2*this.localData.settings.fps};var l=new p2.Box({width:250,height:100,collisionGroup:CollisionGroups.PAWN,collisionMask:CollisionGroups.GROUND});return s.addShape(l),this.addWorldBody(s),this.onEvent({eventId:GameServer.EVENT_SPAWN_FLAG,position:s.position,data:s.data}),s}createFlagCTF(e){var a=this.getCurrentMapData(),t=new p2.Body({mass:10,position:a.flags_ctf[e],fixedRotation:!0,allowSleep:!0,sleepSpeedLimit:1,sleepTimeLimit:1});t.data={id:"flag_"+e,type:"flag_ctf",team:e,bAwayFromHome:!1};var r=new p2.Box({width:32,height:100,collisionGroup:CollisionGroups.PAWN,collisionMask:CollisionGroups.GROUND|CollisionGroups.PLATFORM});return t.addShape(r),this.addWorldBody(t),this.onEvent({eventId:GameServer.EVENT_SPAWN_FLAG,position:t.position,data:t.data}),t}createFlagDefender(){var e=this.getCurrentMapData(),a=e.flag_defender,t=e.flags_headquarters;t&&(a=t[this.Random(0,t.length-1)]);var r=new p2.Body({mass:10,position:a,fixedRotation:!0,allowSleep:!0,sleepSpeedLimit:1,sleepTimeLimit:1});r.data={id:"flag_defender",type:"flag_defender",team:null,pointTimer:0,pointTimerMax:2*this.localData.settings.fps};var i=new p2.Box({width:32,height:100,collisionGroup:CollisionGroups.PAWN,collisionMask:CollisionGroups.GROUND|CollisionGroups.PLATFORM});return r.addShape(i),this.addWorldBody(r),this.onEvent({eventId:GameServer.EVENT_SPAWN_FLAG,position:r.position,data:r.data}),r}createReviver(e,a,t,r,i,s){var o=new p2.Body({mass:10,damping:.7,position:a});if(o.data={id:e,x:a[0],y:a[1],type:"reviver",bLimitInteractions:!0,interactData:s},i){var l=30;this.localData.bOperation&&(l=30-5*this.localData.difficulty),o.data.bleedTimerMax=this.localData.settings.fps*l,o.data.bleedTimer=o.data.bleedTimerMax}var n=new p2.Box({width:20,height:20,collisionMask:CollisionGroups.GROUND|CollisionGroups.PLATFORM});return o.addShape(n),this.addWorldBody(o),o.applyImpulse([t[0],t[1]],0,0),o.angularVelocity=r,this.onEvent({eventId:GameServer.EVENT_SPAWN_REVIVER,position:o.position,velocity:o.velocity,data:o.data}),o}createInfo(e,a){var t=new p2.Body({mass:0,position:e,allowSleep:!0,sleepSpeedLimit:1,sleepTimeLimit:1});t.data={id:this.getRandomUniqueId(),x:e[0],y:e[1],type:"info",interactData:a};var r=a.size?a.size:100,i=new p2.Box({width:r,height:r,collisionMask:CollisionGroups.PAWN});return t.addShape(i),this.addWorldBody(t),t}createScavengerPack(e,a){var t=this.getSharedData("scavenger_pack"),r=new p2.Body({mass:1,position:e,allowSleep:!0,sleepSpeedLimit:1,sleepTimeLimit:1,velocity:[0,1]});r.data={id:this.getRandomUniqueId(),x:e[0],y:e[1],type:"scavenger_pack",interactData:a};var i=new p2.Box({width:t.width,height:t.height,collisionMask:CollisionGroups.GROUND|CollisionGroups.PLATFORM});r.addShape(i),this.addWorldBody(r),this.onEvent({eventId:GameServer.EVENT_SPAWN_OBJECT,position:r.position,data:r.data});var s=this.getScavengerPacks();return s.length>Settings.SCAVENGER_PACKS_MAX&&this.removeNextStep(s[0]),r}createLootPack(e,a){var t=this.getSharedData("scavenger_pack"),r=new p2.Body({mass:1,position:e,allowSleep:!0,sleepSpeedLimit:1,sleepTimeLimit:1,velocity:[0,1]});r.data={id:this.getRandomUniqueId(),x:e[0],y:e[1],type:"loot_pack",interactData:a};var i=new p2.Box({width:t.width,height:t.height,collisionMask:CollisionGroups.GROUND|CollisionGroups.PLATFORM});r.addShape(i),this.addWorldBody(r),this.onEvent({eventId:GameServer.EVENT_SPAWN_OBJECT,position:r.position,data:r.data});var s=this.getLootPacks();return s.length>Settings.SCAVENGER_PACKS_MAX&&this.removeNextStep(s[0]),r.applyImpulse([this.Random(-100,100),0],0,0),r}createCrate(e,a,t,r=1){var i=new p2.Body({mass:r,position:a,allowSleep:!0,sleepSpeedLimit:1,sleepTimeLimit:1});i.data={id:e,x:a[0],y:a[1],type:"crate",interactData:t,team:t.team},(this.localData.bModeGame||this.localData.bBattlezone)&&t.type!=Crate.CRATE_STORE&&t.type!=Crate.CRATE_BOMB&&t.type!=Crate.CRATE_BOMB_GENERIC&&(i.data.destroyTimer=180*this.localData.settings.fps);var s=new p2.Box({width:60,height:24,collisionMask:CollisionGroups.GROUND|CollisionGroups.PLATFORM});i.addShape(s),this.addWorldBody(i),this.onEvent({eventId:GameServer.EVENT_SPAWN_CRATE,position:i.position,data:i.data,mass:r});var o=this.getDisposableCrates();return o.length>Settings.CRATES_MAX&&this.removeNextStep(o[0]),i}createDestructableObject(e,a,t){var r=new p2.Body({mass:t.mass,fixedRotation:t.fixedRotation,damping:.5,angularDamping:.9,position:a});r.data={id:e,x:a[0],y:a[1],type:"destructableObject",material:t.material,damageMultipliers:t.damageMultipliers,health:t.health,playerId:t.playerId,destructableData:t};var i=void 0,s=CollisionGroups.GROUND|CollisionGroups.PLATFORM|CollisionGroups.PROJECTILE;t.bCollidePawns&&(i=CollisionGroups.PROJECTILE,s=CollisionGroups.GROUND|CollisionGroups.PLATFORM|CollisionGroups.PROJECTILE|CollisionGroups.PAWN);var o=new p2.Box({width:t.width,height:t.height,collisionGroup:i,collisionMask:s});return r.addShape(o),this.addWorldBody(r),this.onEvent({eventId:GameServer.EVENT_SPAWN_OBJECT,data:r.data}),r}createShield(e){var a=this.getObjectById(e);if(!a)return null;var t=new p2.Body({damping:0,angularDamping:0,gravityScale:0,position:a.position});t.data={id:this.getRandomUniqueId(),type:"shield",material:"metal",playerId:e,team:a.data.team,bActive:!0};var r=new p2.Box({width:25,height:60,collisionGroup:CollisionGroups.SHIELD,collisionMask:CollisionGroups.PROJECTILE});return t.addShape(r),this.addWorldBody(t),this.onEvent({eventId:GameServer.EVENT_SPAWN_OBJECT,data:t.data}),t}createDeployableCover(e,a,t){var r=this.getPlayerStateById(t),i=this.getSharedData("deployable_cover");this.createDestructableObject(e,a,{type:"deployable_cover",mass:10,fixedRotation:!0,material:"metal",width:i.width,height:i.height,health:100,damageMultipliers:{1:.15,2:1,3:1},playerId:t,team:r?r.team:null});var s=this.getDeployableCovers(t);s.length>2&&this.removeNextStep(s[0])}createLargeBox(e,a){this.createDestructableObject(e,a,{type:"box_large",mass:10,width:69,height:69,health:200,bCollidePawns:!0})}createSmallBox(e,a){this.createDestructableObject(e,a,{type:"box_small",mass:5,width:35,height:35,health:100,bCollidePawns:!0})}createStoreCrate(e,a){var t=this.createCrate("crate_store",[e,a],{type:Crate.CRATE_STORE,team:0},0);return t.data.bSkipServerUpdate=!0,t}createBombCrate(e){var a=this.getCurrentMapData(),t=a.spawns_bomb[this.Random(0,a.spawns_bomb.length-1)],r=this.createCrate("crate_bomb",[t[0],t[1]+24],{type:Crate.CRATE_BOMB,team:0==e?1:0,interactTime:this.localData.gameModeData.plantTime},0);return r.data.bLimitInteractions=!0,r.data.interactTeam=e,r}createGenericBombCrate(e,a,t,r,i){var s=this.createCrate(e,[a,t],{type:Crate.CRATE_BOMB_GENERIC,team:r,interactTime:3*this.localData.settings.fps},1);return s.data.bombTimer=5*this.localData.settings.fps,s.data.bLimitInteractions=!0,s.data.interactTeam=i,s}createAmmoCrate(e,a,t,r=0){var i=this.getPlayerStateById(t);return this.createCrate(this.getRandomUniqueId(),[e,a],{type:Crate.CRATE_AMMO,ownerId:t,team:i?i.team:this.localData.bBattlezone?Battlezone.TEAM_AIRDROPS:r,interactTime:Math.round(.5*this.localData.settings.fps)})}createDecoyCrate(e,a,t,r=0){var i=this.getPlayerStateById(t),s=[Killstreaks.KILLSTREAK_COUNTER_UAV,Killstreaks.KILLSTREAK_UAV,Killstreaks.KILLSTREAK_HELLFIRE,Killstreaks.KILLSTREAK_AIRSTRIKE,Killstreaks.KILLSTREAK_NAPALM,Killstreaks.KILLSTREAK_STEALTH_BOMBER,Killstreaks.KILLSTREAK_MH6,Killstreaks.KILLSTREAK_MH6_GRENADE,Killstreaks.KILLSTREAK_COBRA,Killstreaks.KILLSTREAK_COBRA_CONTROLLABLE,Killstreaks.KILLSTREAK_CHOPPER_GUNNER,Killstreaks.KILLSTREAK_REAPER,Killstreaks.KILLSTREAK_SENTRY_GUN_PLACE,Killstreaks.KILLSTREAK_SAM_TURRET_PLACE,Killstreaks.KILLSTREAK_HELI_SNIPER,Killstreaks.KILLSTREAK_PAVE_LOW,Killstreaks.KILLSTREAK_EMP,Killstreaks.KILLSTREAK_SCOUT,Killstreaks.KILLSTREAK_JUGGERNAUT_RECON_USE,Killstreaks.KILLSTREAK_JUGGERNAUT_USE,Killstreaks.KILLSTREAK_DRAGONFIRE],o=this.createCrate(this.getRandomUniqueId(),[e,a],{type:Crate.CRATE_DECOY,ownerId:t,team:i?i.team:r,interactTime:Math.round(.5*this.localData.settings.fps),fraudKillstreakId:s[this.Random(0,s.length-1)]});return this.isTeamGameMode()&&(o.data.interactTeam=0==o.data.team?1:0),o}createItemCrate(e,a,t,r,i=0){for(var s=this.getPlayerStateById(t),o=[],l=0;l<r.length;l++)o.push(r[l]);return this.createCrate(this.getRandomUniqueId(),[e,a],{type:Crate.CRATE_WEAPON,items:o,ownerId:t,team:s?s.team:this.localData.bBattlezone?Battlezone.TEAM_AIRDROPS:i,interactTime:Math.round(.5*this.localData.settings.fps)})}stopCharacterInteract(e){if(e.data.interactableId){var a=this.getObjectById(e.data.interactableId);a&&a.data.bLimitInteractions&&delete a.data.currentPawnId}e.data.bWantsToInteract=!1,delete e.data.interactableId,delete e.data.interactTimer,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:e.data.id,type:GameServer.PAWN_END_INTERACTION})}createShardCrate(e,a,t=1){return this.createCrate(this.getRandomUniqueId(),[e,a],{type:Crate.CRATE_SHARD,shards:t,team:Battlezone.TEAM_AIRDROPS,interactTime:Math.round(.5*this.localData.settings.fps)})}createXPCrate(e,a,t=1){return this.createCrate(this.getRandomUniqueId(),[e,a],{type:Crate.CRATE_XP,xp:t,team:Battlezone.TEAM_AIRDROPS,interactTime:Math.round(.5*this.localData.settings.fps)})}createLifeCrate(e,a,t=1){return this.createCrate(this.getRandomUniqueId(),[e,a],{type:Crate.CRATE_LIFE,lives:t,team:Battlezone.TEAM_AIRDROPS,interactTime:Math.round(.5*this.localData.settings.fps)})}createPerkCrate(e,a,t,r,i){var s=this.getPlayerStateById(t);return this.createCrate(this.getRandomUniqueId(),[e,a],{type:Crate.CRATE_PERK,perkId:r,ownerId:t,team:s?s.team:this.localData.bBattlezone?Battlezone.TEAM_AIRDROPS:i,interactTime:Math.round(.5*this.localData.settings.fps)})}createKillstreakCrate(e,a,t,r,i){var s=t;if(!s){var o={};if(this.localData.bSurvival){var l=Math.min(this.localData.gameModeData.wave,100);o[Killstreaks.KILLSTREAK_HELLFIRE]=15,o[Killstreaks.KILLSTREAK_NAPALM]=15,o[Killstreaks.KILLSTREAK_AIRSTRIKE]=20,o[Killstreaks.KILLSTREAK_STEALTH_BOMBER]=20,o[Killstreaks.KILLSTREAK_BOMBARDMENT]=10+.5*l,o[Killstreaks.KILLSTREAK_MH6]=6+l,o[Killstreaks.KILLSTREAK_DRAGONFIRE]=6+l,o[Killstreaks.KILLSTREAK_COBRA]=4+.5*l,o[Killstreaks.KILLSTREAK_SCOUT]=4+.5*l,o[Killstreaks.KILLSTREAK_PAVE_LOW]=2+.25*l,o[Killstreaks.KILLSTREAK_REMOTE_TURRET]=12+.5*l,o[Killstreaks.KILLSTREAK_ADVANCED_TURRET]=8+.5*l,o[Killstreaks.KILLSTREAK_GRENADE_TURRET]=4+.5*l,o[Killstreaks.KILLSTREAK_HELI_SNIPER]=2,o[Killstreaks.KILLSTREAK_CHOPPER_GUNNER]=2,o[Killstreaks.KILLSTREAK_MH6_GRENADE]=1,o[Killstreaks.KILLSTREAK_COBRA_CONTROLLABLE]=1,o[Killstreaks.KILLSTREAK_REAPER]=1,o[Killstreaks.KILLSTREAK_DEADSWITCH]=.1*l,o[Killstreaks.KILLSTREAK_SENTRY_GUN_PLACE]=l,o[Killstreaks.KILLSTREAK_SAM_TURRET_PLACE]=l}else o[Killstreaks.KILLSTREAK_UAV]=10,o[Killstreaks.KILLSTREAK_COUNTER_UAV]=10,o[Killstreaks.KILLSTREAK_SAM_TURRET_PLACE]=5,o[Killstreaks.KILLSTREAK_AMMO]=5,o[Killstreaks.KILLSTREAK_HELLFIRE]=7,o[Killstreaks.KILLSTREAK_NAPALM]=7,o[Killstreaks.KILLSTREAK_AIRSTRIKE]=6,o[Killstreaks.KILLSTREAK_SENTRY_GUN_PLACE]=4,o[Killstreaks.KILLSTREAK_REMOTE_TURRET]=5,o[Killstreaks.KILLSTREAK_STEALTH_BOMBER]=5,o[Killstreaks.KILLSTREAK_DRAGONFIRE]=5,o[Killstreaks.KILLSTREAK_HELI_SNIPER]=3,o[Killstreaks.KILLSTREAK_EMP]=3,o[Killstreaks.KILLSTREAK_COBRA]=4,o[Killstreaks.KILLSTREAK_MH6]=4,o[Killstreaks.KILLSTREAK_SCOUT]=4,o[Killstreaks.KILLSTREAK_CHOPPER_GUNNER]=2,o[Killstreaks.KILLSTREAK_PAVE_LOW]=2,o[Killstreaks.KILLSTREAK_BOMBARDMENT]=2,o[Killstreaks.KILLSTREAK_REAPER]=2,o[Killstreaks.KILLSTREAK_JUGGERNAUT_USE]=2,o[Killstreaks.KILLSTREAK_JUGGERNAUT_RECON_USE]=2,o[Killstreaks.KILLSTREAK_ADVANCED_TURRET]=2,o[Killstreaks.KILLSTREAK_GRENADE_TURRET]=2,o[Killstreaks.KILLSTREAK_COBRA_CONTROLLABLE]=1,o[Killstreaks.KILLSTREAK_MH6_GRENADE]=1;s=this.getRandomProperty(o)}var n,d=this.getPlayerStateById(r);switch(s){case Killstreaks.KILLSTREAK_AMMO:n=this.createAmmoCrate(e,a,r,i);break;default:n=this.createCrate(this.getRandomUniqueId(),[e,a],{type:Crate.CRATE_KILLSTREAK,killstreakId:s,ownerId:r,team:d?d.team:this.localData.bBattlezone?Battlezone.TEAM_AIRDROPS:i,interactTime:Math.round(.5*this.localData.settings.fps)})}return n}getRandomProperty(e){var a=[];for(var t in e)if(e.hasOwnProperty(t))for(var r=0;r<e[t];r++)a.push(t);return a[Math.floor(Math.random()*a.length)]}removeBody(e){e&&this.localData.world.removeBody(e)}addBody(e){e&&this.localData.world.addBody(e)}removeObject(e){if(e){e.constraint&&(this.localData.world.removeConstraint(e.constraint),delete e.constraint);var a=e.data,t=a?a.id:void 0,r=a?a.type:void 0;if(delete e.data,this.localData.world.removeBody(e),t){for(var i=this.localData.playerStates,s=0;s<i.length;s++){var o=i[s];if(o.controllableId==t){this.clearPlayerControllable(o);break}}if("rocket"==r){var l=this.getPawns();for(s=0;s<l.length;s++){var n=l[s];if(n.data.currentRocketId==t){delete n.data.currentRocketId;break}}}delete this.localData.objects[t],this.onEvent({eventId:GameServer.EVENT_REMOVE_OBJECT,id:t})}}}playerHasControllable(e){var a=this.getPlayerStateById(e);return!!a&&a.controllableId}setPlayerControllable(e,a){if(e&&a){e.controllableId=a.data.id,a.data.controllerId=e.id;var t=this.getObjectById(e.id);switch(this.cancelCharacterBoltPull(t),this.cancelCharacterReload(t),a.data.type){case"turret":t&&(t.data.bWantsToMove=!1,t.velocity=[0,0],a.data.turretData.type!=Turret.TYPE_REMOTE&&(t.position[0]=a.position[0]-35*a.data.scale),t.wakeUp());break;case"helicopter":case"rocket":(this.localData.bSurvival||this.localData.bSandbox)&&(t.data.bUntargetable=!0,t.data.bInvisible=!0,this.pushObjectDataUpdate(t.data.id,["bUntargetable","bInvisible"]))}this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:e.id,type:GameServer.PAWN_OPEN_LAPTOP})}}clearPlayerControllable(e){if(e){var a=this.getObjectById(e.controllableId);a&&(a.data.controllerId=null),e.controllableId=null,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:e.id,data:{controllableId:null}});var t=this.getObjectById(e.id);if(t){if(this.localData.bSurvival||this.localData.bSandbox){t.data.bInvisible;t.data.bUntargetable=!1,t.data.bInvisible=!1,this.pushObjectDataUpdate(t.data.id,["bUntargetable","bInvisible"])}this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:e.id,type:GameServer.PAWN_CLOSE_LAPTOP})}}}removeObjectById(e){var a=this.getObjectById(e);a&&this.removeNextStep(a)}getCharacterSpeedMultiplier(e){return e.data.speedMultiplier*e.data.baseSpeedMultiplier}handlePlayerInput(e,a){if(e&&a){var t=a.keyId,r=a.value,i=e;if(i){i.data.maxSpeed,this.getCharacterSpeedMultiplier(i);if(i.data.bStunned).2;else if(!i.data.bIsOnLadder)if(i.data.bWantsToSprint)1.8;else if(i.data.bWantsToCrouch){this.characterHasPerk(i,Perks.PERK_PLAYER_NINJA)?1:.6}switch(t){case"look":i.data.desiredAimRotation=r.angle,i.data.lookPos=r.pos,r.char&&!i.data.bBot&&(i.data.clientPos=r.char);break;case"melee":this.useCharacterMeleeAttack(i);break;case"left":i.data.bWantsToMove=r&&this.characterCanMove(i),r?i.data.moveX=-1:i.velocity[0]=0;break;case"right":i.data.bWantsToMove=r&&this.characterCanMove(i),r?i.data.moveX=1:i.velocity[0]=0;break;case"up":if(r&&!i.data.bIsOnLadder&&this.characterCanClimb(i))if(o=this.getClimbableLadder(i)){var s=.5*o.data.height-30;i.position[1]>o.position[1]-s&&this.startLadderClimb(i,o)}i.data.bIsOnLadder&&(i.data.bWantsToClimb=r,r&&(i.data.moveY=-1));break;case"down":var o;if(r&&!i.data.bIsOnLadder&&this.characterCanClimb(i))if(o=this.getClimbableLadder(i)){s=.5*o.data.height-30;i.position[1]<o.position[1]+s&&this.startLadderClimb(i,o)}i.data.bIsOnLadder&&(i.data.bWantsToClimb=r,r&&(i.data.moveY=1));break;case"jump":r&&this.characterCanJump(i)&&(i.data.bIsOnLadder&&this.leaveLadder(i),i.velocity[1]=-i.data.jumpHeight,i.wakeUp(),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:i.data.id,type:GameServer.PAWN_JUMP}));break;case"crouch":i.data.bWantsToCrouch=r&&this.characterCanCrouch(i),i.data.bIsOnLadder&&!i.data.bBot&&(this.leaveLadder(i),i.wakeUp());break;case"sprint":i.data.bWantsToSprint=r&&this.characterCanSprint(i);break;case"weapon":var l=this.getCurrentCharacterInventoryItem(i);l&&this.characterIsFree(i)&&this.hasMod(l,Mods.BASE_MODE_SELECTOR)&&(l.bAirOnly=!l.bAirOnly,l.lookModifier=l.bAirOnly?2.5:2,this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:i.data.id,index:i.data.currentInventoryIndex,type:GameServer.INV_AMMO_ADD,value:0,sfxId:"wpn_bolt_open"}));break;case"ads":i.data.bAds=1==r;break;case"reload":this.reloadCharacterWeapon(i,!0);break;case"killstreak_next":r&&this.cyclePlayerCurrentKillstreakIndex(i.data.id,1);break;case"killstreak_prev":r&&this.cyclePlayerCurrentKillstreakIndex(i.data.id,-1)}}}}cyclePlayerCurrentKillstreakIndex(e,a){var t=this.getPlayerStateById(e);if(t){var r=t.killstreaks;if(r.length>1){var i=t.currentKillstreakIndex;t.currentKillstreakIndex=Math.max(0,Math.min(r.length-1,t.currentKillstreakIndex+a)),i!==t.currentKillstreakIndex&&this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:e,data:{currentKillstreakIndex:t.currentKillstreakIndex}})}}}handleControllableInput(e,a){if(e&&a){var t=e.data.type,r=a.keyId,i=a.value,s=e.data;switch(t){case"rocket":"ads"==r&&1==i&&(s.bBoost||(s.bBoost=!0,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:s.id,type:GameServer.PAWN_ON_BOOST})));break;case"helicopter":if(!s.bBot&&!s.bNoInput){var o=this.getCurrentMapData(),l=s.bPlayerControlled?s.moveSpeed:400;l=Math.round(l*this.localData.settings.fps_mult);o=this.getCurrentMapData();switch(r){case"left":i&&e.position[0]>0&&e.applyForce([-l,0]);break;case"right":i&&e.position[0]<o.width&&e.applyForce([l,0]);break;case"up":i&&e.position[1]>0&&e.applyForce([0,-l]);break;case"down":i&&e.position[1]<o.height&&e.applyForce([0,l]);break;case"ads":switch(s.killstreakId){case Killstreaks.KILLSTREAK_COBRA_CONTROLLABLE:s.bWantsToFireRocket=1==i;break;case Killstreaks.KILLSTREAK_SCOUT:i&&e.constraint&&this.dropHelicopterCrate(e)}}if(s.bPlayerControlled){var n=Math.max(500,Math.min(o.width-500,e.position[0])),d=Math.max(500,Math.min(1500,e.position[1]));s.heliData.destination=[n,d]}}}}}removeSpawnProtection(e){var a=this.getPlayerStateById(e);a&&null!=a.timer_spawnProtection&&(delete a.timer_spawnProtection,a.bSpawnProtection=!1,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:a.id,data:{bSpawnProtection:a.bSpawnProtection}}))}stopAllTimers(){var e=this.localData;if(e.timer_game){var a=e.timer_game;clearInterval(a),delete e.timer_game}e.timer_preGame&&(a=e.timer_preGame,clearInterval(a),delete e.timer_preGame),e.timer_wave&&(a=e.timer_wave,clearInterval(a),delete e.timer_wave),e.timer_waveSpawn&&(a=e.timer_waveSpawn,clearInterval(a),delete e.timer_waveSpawn);for(var t=e.playerStates,r=0;r<t.length;r++){var i=t[r];(a=i.timer_respawn)&&delete i.timer_respawn,(a=i.timer_spawnProtection)&&delete i.timer_spawnProtection}}onFlagReturned(e,a){var t=this.getPlayerStateById(a);t&&(t.returns++,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:a,data:{returns:t.returns}}),this.onEvent({eventId:GameServer.EVENT_PLAYER_FLAG,playerId:a,team:e.data.team,type:"returned"})),this.addAnnouncerMessage("flag_returned",e.data.team)}onFlagDropped(e,a){switch(e.wakeUp(),this.onEvent({eventId:GameServer.EVENT_PLAYER_FLAG,playerId:a,team:e.data.team,type:"dropped"}),this.localData.gameModeData.id){case GameMode.CAPTURE_THE_FLAG:this.addAnnouncerMessage("flag_dropped",e.data.team);break;case GameMode.DEFENDER:this.localData.gameModeData.flagTeam=null,this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{flagTeam:null}}),this.addAnnouncerMessage("flagd_dropped",e.data.team)}}onFlagPickedUp(e,a){this.onEvent({eventId:GameServer.EVENT_PLAYER_FLAG,playerId:a,team:e.data.team,type:"picked_up"}),this.addAnnouncerMessage("flag_has",0==e.data.team?1:0)}onDefenderFlagPickedUp(e,a){var t=this.getPlayerStateById(a);this.onEvent({eventId:GameServer.EVENT_PLAYER_FLAG,playerId:a,team:e.data.team,type:"picked_up"}),t&&(this.localData.gameModeData.flagTeam=t.team,this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{flagTeam:t.team}}),this.addAnnouncerMessage("flagd_achieve",t.team))}onFlagPoint(e,a){if(null!=e){var t=this.localData,r=t.gameModeData.scores;r[e]++,this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{scores:r,pointTeam:e}}),r[e]>=t.gameModeData.scoreLimit&&this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_SCORE,winningTeam:e})}if(null!=a){var i=this.getPlayerStateById(a);i&&i.score>=0&&(i.score++,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:a,data:{score:i.score}}))}}onFlagCaptured(e,a){var t=e.data.team,r=this.localData;if(a){for(var i=0;i<a.length;i++){var s=this.getPlayerStateById(a[i]);s&&(s.captures++,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:a[i],data:{captures:s.captures}}))}var o={eventId:GameServer.EVENT_PLAYER_FLAG,team:e.data.team,playerIds:a,type:"captured",flagNum:e.data.num};this.onEvent(o)}switch(r.gameModeData.id){case GameMode.CAPTURE_THE_FLAG:var l=r.gameModeData.scores;l[t]++,this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{scores:l}}),l[t]>=r.gameModeData.scoreLimit&&this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_SCORE,winningTeam:t}),this.addAnnouncerMessage("flag_captured",e.data.team);break;case GameMode.DOMINATION:this.addAnnouncerMessage(e.data.str+"_captured",e.data.team);break;case GameMode.HEADQUARTERS:var n=this.localData.gameModeData,d=e.data.team;null!=n.hqTeam?(this.addScore(d,10),this.winRound(MatchState.END_CONDITION_HEADQUARTERS,-1)):n.hqTeam=d,this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{hqTeam:n.hqTeam,scores:n.scores}}),this.addAnnouncerMessage("hq_captured",d)}}isTeamGameMode(){var e=this.getGameModeData(this.localData.gameModeData.id);return!!e&&e.bTeam}allowsKillstreaks(){var e=this.getGameModeData(this.localData.gameModeData.id);return!e||e.bAllowKillstreaks}onPlayerKill(e,a,t,r,i,s){var o=this.localData,l=this.getPlayerStateById(e),n=e==t,d=!0;if(!n&&i.bDirectlyCausedByPlayer){var E=this.getObjectById(e);E&&this.characterHasPerk(E,Perks.PERK_WEAPON_VAMPIRE)&&(E.data.health=Math.min(E.data.health+100,E.data.maxHealth),this.pushObjectDataUpdate(E.data.id,["health"]))}var h=this.getObjectById(t);if(l){var c=l.killedBy;if(c){var m=c.indexOf(t);if(m>=0){var p=!0;c.splice(m)}}var _=!n&&!!h&&l.team==h.data.team;if(!n&&!_){var A=!!h&&"character"==h.data.type;if(d=!o.bModeGame||A){l.kills++,s&&l.headshots++,i.bMelee&&l.melees++,l.multiKillTimer=this.localData.settings.fps,l.multiKillCount++;var I=this.getPlayerStateById(t);if(this.isTeamGameMode()){if(l.avengerTimer=this.localData.settings.fps,I&&I.avengerTimer>0)var T=!0;if(h){var R=h.data.damagedBy;if(R&&R.length>0)for(var S=0;S<R.length;S++)if(R[S]!=e){let e=this.getPlayerStateById(R[S]);e&&(e.assists++,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:R[S],data:{assists:e.assists}}))}}}if(o.bKillstreaks){if(I){var v=I.currentKillstreak+1;if(I.desiredKillstreaks&&I.desiredClassData){var u=I.desiredKillstreaks[I.desiredClassData.killstreak];if(u)for(S=0;S<u.length;S++){if((g=this.getKillstreakData(u[S]))&&g.kills==v){var b=!0;break}}}}var y=this.getObjectById(r);if(y)switch(y.data.type){case"character":case"grenade":case"rocket":case"projectile":default:if(l.bHasPawn){l.currentKillstreak++;var D=l.desiredKillstreaks[l.desiredClassData.killstreak];if(D)for(S=0;S<D.length&&!(S>=4);S++){var g;if((g=this.getKillstreakData(D[S]))&&g.kills==l.currentKillstreak){this.requestEvent({eventId:GameServer.EVENT_PLAYER_EARN_KILLSTREAK,playerId:l.id,killstreakId:g.id});break}}}}}}var P={eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:e,data:{kills:l.kills,headshots:l.headshots,melees:l.melees,currentKillstreak:l.currentKillstreak,currentKillstreakIndex:l.currentKillstreakIndex,bRevenge:p,bAvenger:T,bBuzzKill:b}};if(o.bBattlezone){var M=100;switch(h.data.type){case"helicopter":M=h.data.maxHealth;break;case"turret":M=1e3;break;default:this.getPlayerStateById(h.data.id)?M=1e3:h.data.killReward&&(M=h.data.killReward),M=Math.max(h.data.maxHealth,M)}this.addBattlezoneLoot(l.id,M,0),P.data.xp=l.xp}else if(o.bSurvival){h=this.getObjectById(t);var O=this.getObjectById(e);if(O&&O.data&&0==O.data.team&&0!=h.data.team)if((L=o.gameModeData).kills++,L.waveKills++,i.bHeadshot?(i.bDirectlyCausedByPlayer&&this.addPlayerMoneyMultiplier(l.id,.1),L.waveHeadshots++):i.bMelee?(this.addPlayerMoneyMultiplier(l.id,.1),L.waveMelees++):"character"!=h.data.type&&"infestor"!=h.data.type||l.multiKillCount<2&&i.bDirectlyCausedByPlayer&&(i.damageType!=DamageType.DAMAGE_BULLET||i.bHeli||i.bTurret||this.resetPlayerMoneyMultiplier(l.id)),o.bUseMoneyMultiplier&&(P.data.moneyMultiplier=l.moneyMultiplier),this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{wave:L.wave,kills:L.kills}}),i.moneyReward){var N=this.RoundToNearest(i.moneyReward*l.moneyMultiplier);this.addPlayerMoney(e,N)}}else{var L={};switch(h&&"character"==h.data.type&&o.bModeGame&&!o.gameModeData.bFirstBlood&&(L.firstBloodPlayerId=e,o.gameModeData.bFirstBlood=!0),o.gameModeData.id){case GameMode.ASSASSINATION:h&&h.bVIP&&(l.score++,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:l.id,data:{score:l.score}}));break;case GameMode.GUN_GAME:if(d){var C=this.localData.gameModeData.weapons;if(i.weaponId==C[l.gunIndex].id){var f={playerId:l.id};if(l.gunKills++,l.gunKills>=this.localData.gameModeData.killsPerGun)if(l.gunIndex+1>=C.length)this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_SCORE,winningTeam:l.team});else{l.gunIndex++,f.gunIndex=l.gunIndex,l.gunKills=0;var k=this.getObjectById(l.id);k&&this.cancelCharacterReload(k);setTimeout((()=>{if(this.localData){var e=this.getObjectById(l.id);e&&(e.data.bWantsToFire=!1,e.data.weapon.bFireDelay=!0,e.data.weapon.bFireHandler=!1,e.data.weapon.bBurstFireHandler=!1);var a=C[l.gunIndex],t=this.getWeaponData(a.id);a.mods&&this.applyWeaponMods(t,a.mods),this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:l.id,index:0,item:t,type:GameServer.INV_ITEM_REPLACE})}}),100)}f.gunKills=l.gunKills,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:l.id,data:f}),this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{playerId:l.id}})}}break;case GameMode.DEATHMATCH:d&&(L.bPlayerKill=!0,l.kills>=o.gameModeData.scoreLimit&&this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_SCORE,winningTeam:l.team}));break;case GameMode.TEAM_DEATHMATCH:if(d){var G=o.gameModeData.scores;G[l.team]++,L.scores=G,G[l.team]>=o.gameModeData.scoreLimit&&this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_SCORE,winningTeam:l.team})}}}this.onEvent(P),L&&Object.keys(L).length>0&&this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:L})}}}addPlayerMoneyMultiplier(e,a){if(this.localData.bUseMoneyMultiplier){var t=this.getPlayerStateById(e);t&&(t.moneyMultiplier=Math.min(Settings.SURVIVAL_MULTIPLIER_MAX,t.moneyMultiplier+a))}}resetPlayerMoneyMultiplier(e){if(this.localData.bUseMoneyMultiplier){var a=this.getPlayerStateById(e);a&&(a.moneyMultiplier=1)}}onPawnDeath(e,a,t,r,i,s){var o=this.getPlayerStateById(e),l=this.getObjectById(e),n=l.data.team,d=null,E=0,h=0,c=Math.random(-50,50),m=this.getObjectById(r);if(m){var p=this.Angle(m.position[0],m.position[1],l.position[0],l.position[1])+this.ToRad(this.Random(-5,5)),_=60*a*(s?1.4:1),A=i.damageType===DamageType.DAMAGE_EXPLOSIVE?1e4:7e3;_=Math.max(1e3,Math.min(_,A)),E=Math.cos(p)*_,h=Math.sin(p)*_}switch(l&&this.emitAISound(l.position),l.data.type){case"infestor":d={id:this.getRandomUniqueId(),x:Math.round(l.position[0]),y:Math.round(l.position[1]),type:"ragdoll",vx:-E,vy:-h,va:c,data:{type:"infestor",infestorType:l.data.infestorType,scale:l.data.scale},playerId:e},this.removeNextStep(l);break;case"character":if(this.localData.bSurvival?1==this.Random(1,10)&&this.createScavengerPack(l.position,{}):!l.data.bZombie&&i.damageType!=DamageType.DAMAGE_EXPLOSIVE&&(this.localData.bModeGame||this.localData.bSandbox||this.localData.bBattlezone)&&this.createScavengerPack(l.position,{}),l.data.zombieType===Zombie.TYPE_EXPLODER||l.data.zombieType===Zombie.TYPE_EXPLODER_BOSS){(I=this.getWeaponData(l.data.zombieType))&&this.createExplosion({eventId:GameServer.EVENT_SPAWN_EXPLOSION,x:Math.round(l.position[0]),y:Math.round(l.position[1]),radius:I.radius,damage:I.damage,playerId:e,causerId:e,weaponId:I.id,bDirectlyCausedByPlayer:!0})}else{var I=this.getWeaponData(i.weaponId),T=!1;if(i.damageType==DamageType.DAMAGE_EXPLOSIVE&&(T=!!l.data.bZombie||this.RandomBoolean()&&a>=100),I&&!T){switch(I.round){case"50bmg":case"408":T=!0}switch(I.type){case Weapon.TYPE_SHOTGUN:T=i.bNearshot;break;default:T=a>200&&!s}switch(I.id){case"melee_katana":case"melee_machete":case"melee_hatchet":T=!0}}var R=s&&a>=100;if(d={id:this.getRandomUniqueId(),x:Math.round(l.position[0]),y:Math.round(l.position[1]),type:"ragdoll",vx:-E,vy:-h,va:c,data:{bHeadshot:R,damageAmount:a,type:"character",bGib:T},playerId:e},i.damageType!==DamageType.DAMAGE_EXPLOSIVE&&this.characterHasPerk(l,Perks.PERK_PLAYER_MARTYRDOM)){var S=this.getWeaponData("frag");this.createGrenade(this.roundNumberArray(l.position),{team:l.data.team,playerId:l.data.id,causerId:l.data.id,rotation:this.ToRad(-90),velocity:100,damage:S.damage,weaponId:S.id,bStartDetonationAfterHit:S.bStartDetonationAfterHit,bImpact:S.bImpact,bMartyrdom:!0})}}if(this.localData.bOperation?1==l.data.team&&1==this.Random(1,10)&&this.dropCharacterWeapon(l,l.data.currentInventoryIndex):this.localData.bBattlezone?l.data.bBot?1==this.Random(1,2)&&this.dropAllCharacterWeapons(l):this.dropAllCharacterWeapons(l):this.localData.bSandbox&&!l.data.bBot?this.dropAllCharacterWeapons(l):this.localData.bModeGame?1==this.Random(1,10)&&this.dropCharacterWeapon(l,l.data.currentInventoryIndex):1==l.data.team&&1==this.Random(1,this.localData.gameModeData.id==GameMode.SURVIVAL_STAKEOUT?5:10)&&this.dropCharacterWeapon(l,l.data.currentInventoryIndex),l.data.interactableId){var v=this.getObjectById(l.data.interactableId);v&&v.data.bLimitInteractions&&delete v.data.currentPawnId}this.removeNextStep(l);break;case"helicopter":l.data.heliData.destination=null,l.data.destroyTimer=5*this.localData.settings.fps,l.gravityScale=1,l.angularForce+=this.Random(-10,10),l.shapes[0].collisionGroup=CollisionGroups.PAWN,l.shapes[0].collisionMask=CollisionGroups.GROUND,this.dropHelicopterCrate(l);break;default:this.removeNextStep(l)}if(o){o.deaths++;var u=o.killedBy;switch(u&&t&&-1==u.indexOf(t)&&u.push(t),o.desiredClassData.killstreak){case Killstreaks.TYPE_ASSAULT:case Killstreaks.TYPE_PERKS:o.currentKillstreak=0;break;case Killstreaks.TYPE_SUPPORT:var b=o.desiredKillstreaks[o.desiredClassData.killstreak];if(b){var y=b[b.length-1];if(y){var D=this.getKillstreakData(y);D&&o.currentKillstreak>=D.kills&&(o.currentKillstreak=0)}}}if(this.endMultiKill(o),this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:e,data:{deaths:o.deaths,currentKillstreak:o.currentKillstreak,bHasPawn:!1}}),o.controllableId){var g=this.getObjectById(o.controllableId);if(g)switch(g.data.type){case"turret":this.clearPlayerControllable(o)}}}var P=this.localData.gameModeData;if(this.localData.bSandbox);else if(this.localData.bBattlezone)o?((o.shards>0||o.xp>0)&&this.createLootPack(l.position,{shards:o.shards,xp:o.xp}),o.shards=0,o.xp=0,o.lives>=1&&(o.lives--,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:o.id,data:{lives:o.lives,shards:o.shards,xp:o.xp}}))):l.data.loot?this.createLootPack(l.position,{shards:l.data.loot.shards,xp:l.data.loot.xp}):1==this.Random(1,5)&&this.createLootPack(l.position,{shards:1==this.Random(1,50)?1:0,xp:this.RoundToNearest(this.Random(1e3,5e3))});else if(this.localData.gameModeData.id==GameMode.ASSASSINATION){if(o&&o.bVIP){this.winRound(MatchState.END_CONDITION_VIP_KILLED,0==this.localData.gameModeData.vipTeam?1:0,1,{id:t});var M=!0}}else if(!this.localData.bModeGame)if(this.localData.gameModeData.id==GameMode.OP_HOSTAGE&&l.data.bHostage&&this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_HOSTAGE_KILLED}),0==n){if(o){null!=o.moneyMultiplier&&this.resetPlayerMoneyMultiplier(o.id);for(var O=this.localData.playerStates,N=0,L=0;L<O.length;L++){var C=O[L],f=this.getObjectById(C.id);C.bHasPawn&&f&&f.data.health||N++}if(N==O.length)this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_DEAD});else{o.inventory=l.data.inventory,o.equipment=l.data.equipment;var k=!0}}}else{if("equipment"!=l.data.type&&P.enemiesRemaining--,P.id==GameMode.SURVIVAL_STAKEOUT){var G=P.wave;G>15?(P.enemiesRemaining===Math.round(.25*P.enemies)&&this.createStakeoutAirdrops(),P.enemiesRemaining===Math.round(.5*P.enemies)&&this.createStakeoutAirdrops(),P.enemiesRemaining===Math.round(.75*P.enemies)&&this.createStakeoutAirdrops()):G>10?(P.enemiesRemaining===Math.round(.33*P.enemies)&&this.createStakeoutAirdrops(),P.enemiesRemaining===Math.round(.66*P.enemies)&&this.createStakeoutAirdrops()):G>5&&P.enemiesRemaining===Math.round(.5*P.enemies)&&this.createStakeoutAirdrops()}0==P.enemiesRemaining&&(this.localData.bSurvival?this.onSurvivalWaveComplete():P.id==GameMode.OP_ELIMINATION&&this.requestEvent({eventId:GameServer.EVENT_GAME_END,result:MatchState.END_RESULT_WIN,condition:MatchState.END_CONDITION_OBJECTIVE})),this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{enemiesRemaining:P.enemiesRemaining}})}var B=r;if(m)switch(m.data.type){case"rocket":B=m.data.rocketData.causerId;break;case"grenade":B=m.data.grenadeData.playerId}switch(this.onEvent({eventId:GameServer.EVENT_PAWN_DIE,data:{id:e,damageAmount:a,killerId:t,causerId:B,damageInfo:i,bHeadshot:s,ragdoll:d,bReviver:k,bVIP:M}}),P.id){case GameMode.INFECTED:O=this.localData.playerStates;var w=this.getNumInfected();o&&!o.bInfected&&(w>=O.length-1?this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_INFECTED,winningTeam:1}):o&&this.makePlayerInfected(o.id));break;case GameMode.GUN_GAME:o&&"none"==i.weaponId&&(o.gunIndex=Math.max(0,o.gunIndex-1),o.gunKills=0,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:o.id,data:{gunIndex:o.gunIndex,gunKills:o.gunKills,bSetback:!0}}))}k&&this.createReviver(this.getRandomUniqueId(),l.position,[E,h],c,this.localData.bOperation,{playerId:e,interactTime:2*this.localData.settings.fps})}getNumInfected(){for(var e=this.localData.playerStates,a=0,t=0;t<e.length;t++)e[t].bInfected&&a++;return a}checkInfected(){if(this.matchInProgress()){var e=this.getNumInfected();if(0==e&&this.localData.gameModeData.bFirstInfected)if(this.localData.playerStates.length>=2){var a=this.Random(0,this.localData.playerStates.length-1),t=this.localData.playerStates[a];this.makePlayerInfected(t.id)}else this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_FORFEIT,winningTeam:0});else e>=this.localData.playerStates.length&&this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_INFECTED,winningTeam:1})}}getEquipmentByPlayerId(e,a){var t=[];if(e)for(var r=this.getEquipment(),i=0;i<r.length;i++){var s=r[i];s.data.ownerId==e&&(null!=a?s.data.weaponData.id==a&&t.push(s):t.push(s))}return t}removeEquipmentByPlayerId(e,a){if(e)for(var t=this.getEquipment(),r=0;r<t.length;r++){var i=t[r];i.data.ownerId==e&&(null!=a?i.data.weaponData.id==a&&this.removeNextStep(i):this.removeNextStep(i))}}onSurvivalWaveComplete(){var e=this.localData.gameModeData;this.startWaveIntermission();var a=0;if(e.waveHeadshots+e.waveMelees===e.waveKills&&(a=1),e.id===GameMode.SURVIVAL_STAKEOUT)this.onEvent({eventId:GameServer.EVENT_GAME_WAVE_COMPLETE,gameModeData:e}),this.createStakeoutAirdrops();else{var t=100*e.wave;if(t+=Math.round(2.5*e.waveKills),t+=10*e.waveHeadshots,t+=25*e.waveMelees,a){t+=100*e.wave;for(var r=this.getPlayerStates(),i=0;i<r.length;i++){var s=r[i];this.addPlayerMoneyMultiplier(s.id,a),this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:s.id,data:{moneyMultiplier:s.moneyMultiplier}})}this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{}})}e.id==GameMode.SURVIVAL_CHAOS?t*=2.5:e.id==GameMode.SURVIVAL_PRO&&(t*=5),t*=Math.max(1,1+.2*e.wave),t=Math.min(t,1e4),t=this.RoundToNearest(t),this.onEvent({eventId:GameServer.EVENT_GAME_WAVE_COMPLETE,moneyReward:t,multBonus:a,gameModeData:e});var o=this.localData.playerStates;for(i=0;i<o.length;i++)0==o[i].team&&this.addPlayerMoney(o[i].id,t)}}endMultiKill(e){if(e){var a=e.multiKillCount;a>1&&(this.requestEvent({eventId:GameServer.EVENT_PLAYER_MULTI_KILL,playerId:e.id,kills:a}),this.localData.bSurvival?(this.addPlayerMoneyMultiplier(e.id,Math.min(.5,.1*(a-1))),this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:e.id,data:{moneyMultiplier:e.moneyMultiplier}}),this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{}})):this.localData.bBattlezone&&this.addBattlezoneLoot(e.id,500*a,0)),e.multiKillTimer=0,e.multiKillCount=0}}getDestructableObjects(e){for(var a=this.localData.world,t=[],r=0;r<a.bodies.length;r++){var i=a.bodies[r];if(i.data)switch(i.data.type){case"destructableObject":e&&i.data.destructableData.type,t.push(i)}}return t}getDeployableCovers(e){for(var a=this.localData.world,t=[],r=0;r<a.bodies.length;r++){var i=a.bodies[r];if(i.data)switch(i.data.type){case"destructableObject":i.data.playerId===e&&t.push(i)}}return t}getDisposableCrates(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"crate":switch(r.data.interactData.type){case Crate.CRATE_AMMO:case Crate.CRATE_WEAPON:case Crate.CRATE_PERK:case Crate.CRATE_DECOY:case Crate.CRATE_KILLSTREAK:case Crate.CRATE_XP:case Crate.CRATE_LIFE:case Crate.CRATE_SHARD:a.push(r)}}}return a}getAmmoCrates(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data&&r.data.bEnabled)switch(r.data.type){case"crate":r.data.interactData.type==Crate.CRATE_AMMO&&a.push(r)}}return a}getStoreCrate(){return this.getObjectById("crate_store")}getItemCrates(e){for(var a=this.localData.world,t=[],r=e.data.team,i=0;i<a.bodies.length;i++){var s=a.bodies[i];if(s.data&&s.data.bEnabled)switch(s.data.type){case"crate":if(this.isBeingInteractedWith(s))continue;s.data.interactData.type==Crate.CRATE_KILLSTREAK?t.push(s):s.data.interactData.type!=Crate.CRATE_DECOY||r==s.data.interactData.team||this.characterHasPerk(e,Perks.PERK_PLAYER_SITREP)?(s.data.interactData.type==Crate.CRATE_WEAPON||s.data.interactData.type==Crate.CRATE_PERK||s.data.interactData.type==Crate.CRATE_SHARD||s.data.interactData.type==Crate.CRATE_XP||s.data.interactData.type==Crate.CRATE_LIFE)&&t.push(s):t.push(s)}}return t}getPlayerControllableTurret(e){for(var a=this.localData.world,t=0;t<a.bodies.length;t++){var r=a.bodies[t];if(r.data)switch(r.data.type){case"turret":if(!r.data.bAutomated){if(r.data.controllerId)continue;if(r.data.turretData.type==Turret.TYPE_REMOTE&&r.data.turretData.playerId==e)return r}}}return null}getAvailableControllableTurrets(e){for(var a=this.localData.world,t=[],r=0;r<a.bodies.length;r++){var i=a.bodies[r];if(i.data)switch(i.data.type){case"turret":if(!i.data.bAutomated){if(i.data.controllerId)continue;var s=!0;null!=e&&(s=i.data.team==e),s&&t.push(i)}}}return t}getTurrets(e,a){for(var t=this.localData.world,r=[],i=0;i<t.bodies.length;i++){var s=t.bodies[i];if(s.data)switch(s.data.type){case"turret":var o=!0;e&&(o=s.data.turretData.playerId==e),a&&(o=o&&s.data.turretData.type==a),o&&r.push(s)}}return r}getDroppedWeapons(e=!1){for(var a=this.localData.world,t=[],r=0;r<a.bodies.length;r++){var i=a.bodies[r];if(i.data)switch(i.data.type){case"droppedWeapon":if(e){var s=i.data.interactData.weaponData;s.ammo+s.mag>=s.magSize&&t.push(i)}else t.push(i)}}return t}getReviverByPlayerId(e){var a=this.getRevivers();if(a)for(var t=0;t<a.length;t++){var r=a[t];if(r.data.interactData.playerId===e)return r}return null}getRevivers(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"reviver":a.push(r)}}return a}getHelicopters(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"helicopter":r.data.health&&a.push(r)}}return a}getNumCharactersOnTeam(e){for(var a=this.localData.world,t=0,r=0;r<a.bodies.length;r++){var i=a.bodies[r];if(i.data)switch(i.data.type){case"character":i.data.team==e&&t++}}return t}getNumHelicoptersOnTeam(e){for(var a=this.localData.world,t=0,r=0;r<a.bodies.length;r++){var i=a.bodies[r];if(i.data)switch(i.data.type){case"helicopter":i.data.team==e&&t++}}return t}getNumAttackHelicoptersOnTeam(e){for(var a=this.localData.world,t=0,r=0;r<a.bodies.length;r++){var i=a.bodies[r];if(i.data)switch(i.data.type){case"helicopter":i.data.team==e&&"attack"==i.data.behaviour&&t++}}return t}getScavengerPacks(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];r.data&&"scavenger_pack"==r.data.type&&a.push(r)}return a}getLootPacks(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];r.data&&"loot_pack"==r.data.type&&a.push(r)}return a}getFlames(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];r.data&&"flame"==r.data.type&&a.push(r)}return a}getCharacters(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data&&r.data.health)switch(r.data.type){case"character":a.push(r)}}return a}getInfestors(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data&&r.data.health)switch(r.data.type){case"infestor":a.push(r)}}return a}getAllCrates(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"crate":a.push(r)}}return a}getAllFlags(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"flag":case"flag_domination":case"flag_ctf":case"flag_defender":a.push(r)}}return a}getAllDominationFlags(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"flag_domination":a.push(r)}}return a}getFlagDomination(e){for(var a=this.localData.world,t=0;t<a.bodies.length;t++){var r=a.bodies[t];if(r.data)switch(r.data.type){case"flag_domination":if(r.data.team==e)return r}}return null}getAIBestDominationFlag(e){for(var a=e.data,t=[],r=0;r<3;r++){(i=this.getObjectById("flag_"+r))&&t.push(i)}var i=null,s=Number.MAX_VALUE,o=!1;for(r=0;r<t.length;r++){var l=t[r];if(l.data.team!=a.team){var n=this.Dist(e.position[0],e.position[1],l.position[0],l.position[1]);n<s&&(o=!0,i=l,s=n)}}return o?i:t[this.Random(0,t.length-1)]}getFlagCTF(e){for(var a=this.localData.world,t=0;t<a.bodies.length;t++){var r=a.bodies[t];if(r.data)switch(r.data.type){case"flag_ctf":if(r.data.team==e)return r}}return null}startLadderClimb(e,a){this.cancelCharacterReload(e),this.cancelCharacterBoltPull(e),e.shapes[0].collisionMask=CollisionGroups.PROJECTILE;var t=this.getSharedData(e.data.type);e.gravityScale=0,e.damping=t.climbDamping,e.velocity=[0,0],e.position[0]=a.position[0],e.fixedX=!0;var r=e.data;r.bIsOnLadder=!0,r.ladderId=a.data.id,r.ladderDirection=a.data.direction,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:r.id,type:GameServer.PAWN_START_LADDER_CLIMB,position:e.position,ladderDirection:r.ladderDirection})}roundNumberArray(e){return e?[Math.round(e[0]),Math.round(e[1])]:e}leaveLadder(e){var a=this.getSharedData(e.data.type);e.gravityScale=1,e.damping=a.damping,e.velocity=[0,0],e.fixedX=!1,e.shapes[0].collisionMask=CollisionGroups.GROUND|CollisionGroups.PROJECTILE;var t=e.data;t.bIsOnLadder&&(t.bLadderCooldown=1,t.speedMultiplier=1,t.ladderCooldownTimer=a.ladderCooldown?a.ladderCooldown*this.localData.settings.fps_mult:1),t.bIsOnLadder=!1,delete t.ladderId,delete t.ladderDirection,t.bBot&&(t.ai.ticker=1),this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:t.id,position:this.roundNumberArray(e.position),velocity:e.velocity,type:GameServer.PAWN_LEAVE_LADDER})}getClimbableLadder(e){for(var a=this.localData.world,t=0;t<a.bodies.length;t++){var r=a.bodies[t];if(r.data)switch(r.data.type){case"ladder":if(r.data.bPlayer&&e.data.bBot)continue;if(r.data.bBot&&!e.data.bBot)continue;if(e.getAABB().overlaps(r.getAABB()))return r}}return null}getLadders(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"ladder":a.push(r)}}return a}getSpawners(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"spawner":a.push(r)}}return a}getPawns(e){for(var a=this.localData.world,t=[],r=0;r<a.bodies.length;r++){var i=a.bodies[r];if(i.data)switch(i.data.type){case"infestor":case"character":case"turret":case"helicopter":null!=e?i.data.team===e&&t.push(i):t.push(i)}}return t}getRockets(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"rocket":a.push(r)}}return a}getEMPItems(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"grenade":case"equipment":case"turret":case"helicopter":a.push(r);break;case"rocket":r.data.rocketData.type==Rocket.TYPE_HELLFIRE&&a.push(r)}}return a}createStakeoutAirdrops(e){for(var a=this.localData.playerStates,t=Math.min(this.localData.gameModeData.wave,100),r=0;r<a.length;r++)if(this.getDisposableCrates().length<Settings.CRATES_MAX){var i=a[r];if(e)var s=e;else{var o={};o[Killstreaks.KILLSTREAK_AMMO]=3+.25*t,o[Killstreaks.KILLSTREAK_WEAPON]=t,o[Killstreaks.KILLSTREAK_CARE_PACKAGE]=t+.5*t,o[Killstreaks.KILLSTREAK_SENTRY_GUN]=t/(this.getTurrets(i.id,Turret.TYPE_SENTRY)+1),o[Killstreaks.KILLSTREAK_SAM_TURRET]=(.25*t+.5*t)/(this.getTurrets(i.id,Turret.TYPE_SAM)+1);var l=this.getObjectById(l);this.characterHasAllSurvivalPerks(l)||(o[Killstreaks.KILLSTREAK_PERK]=Math.min(20,t*t*.5)),s=this.getRandomProperty(o)}if(s){var n=this.getRandomAirdropPosition();this.executePlayerKillstreak(i.id,s,n[0],n[1],!0)}}}getRandomAirdropPosition(){var e=this.getCurrentMapData(),a=e.airdrops;if(a){var t=a[this.Random(0,a.length-1)];t[0]+=this.Random(-50,50)}else{t=[this.Random(600,e.width-600),this.Random(600,1e3)]}return t}getSmokeGrenades(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"grenade":"smoke"==r.data.grenadeData.weaponId&&r.data.bActivated&&a.push(r)}}return a}getGrenades(e,a){for(var t=this.localData.world,r=[],i=0;i<t.bodies.length;i++){var s=t.bodies[i];if(s.data)switch(s.data.type){case"grenade":if(a&&s.data.grenadeData.weaponId!=a)continue;e?e==s.data.grenadeData.playerId&&r.push(s):r.push(s)}}return r}getRandomHairColour(){var e=[Character.HAIR_COLOUR_BLACK,Character.HAIR_COLOUR_BROWN,Character.HAIR_COLOUR_BROWN_LIGHT,Character.HAIR_COLOUR_BLONDE,Character.HAIR_COLOUR_GINGER];return e[this.Random(0,e.length-1)]}getRandomHair(){var e=[Character.HAIR_BALD,Character.HAIR_SHORT,Character.HAIR_LONG,Character.HAIR_STYLED,Character.HAIR_UNDERCUT];return e[this.Random(0,e.length-1)]}getRandomBeard(){var e=[Character.BEARD_NONE,Character.BEARD_FULL,Character.BEARD_GOATEE,Character.BEARD_MOUSTACHE,Character.BEARD_STUBBLE];return e[this.Random(0,e.length-1)]}getEquipment(e){for(var a=this.localData.world,t=[],r=0;r<a.bodies.length;r++){var i=a.bodies[r];if(i.data)switch(i.data.type){case"equipment":e?i.data.weaponData.id==e&&t.push(i):t.push(i)}}return t}getObstacles(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"obstacle":a.push(r)}}return a}getObstaclesWithHealth(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"obstacle":r.data.health&&a.push(r)}}return a}getDoors(){for(var e=this.localData.world,a=[],t=0;t<e.bodies.length;t++){var r=e.bodies[t];if(r.data)switch(r.data.type){case"door":a.push(r)}}return a}getNumPawnType(e){for(var a=this.getPawns(),t=0,r=0;r<a.length;r++)a[r].data.type==e&&t++;return t}getNumRocketType(e){for(var a=this.getRockets(),t=0,r=0;r<a.length;r++){a[r].data.rocketData.type==e&&t++}return t}getNumHelicopterType(e){for(var a=this.getPawns(),t=0,r=0;r<a.length;r++){var i=a[r];"helicopter"==i.data.type&&i.data.heliData.type==e&&t++}return t}getMuzzlePosition(e){if(e){var a=[e.position[0],e.position[1]],t=e.data.muzzleOffsetX?e.data.muzzleOffsetX:0,r=e.data.muzzleOffsetY?e.data.muzzleOffsetY:0,i=[a[0]+t,a[1]+r],s=this.Angle(e.position[0],e.position[1],i[0],i[1])+e.angle,o=this.Dist(e.position[0],e.position[1],i[0],i[1]);return a[0]+=Math.cos(e.angle+s)*o,a[1]+=Math.sin(e.angle+s)*o,a}return null}dropHelicopterCrate(e){var a=e.data,t=a.heliData;if(e.constraint){this.localData.world.removeConstraint(e.constraint);var r=this.getObjectById(a.crateId);r&&(r.mass=1,r.updateMassProperties(),r.damping=.1,r.angularDamping=.1,r.shapes[0].collisionMask=CollisionGroups.GROUND|CollisionGroups.PLATFORM,r.data.bEnabled=!0,r.data.bOnRope=!1,this.pushObjectDataUpdate(r.data.id,["bEnabled","bOnRope"])),a.crateId=null,this.pushObjectDataUpdate(a.id,["crateId"]),delete e.constraint,t.items=[],this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a.id,type:GameServer.PAWN_DROP_CRATE})}else{if((s=t.items)&&s.length>0){var i=s[0];switch(i.type){case"unit":i.unitId&&this.createSandboxUnit({unitId:i.unitId,team:a.team,pos:e.position,patrolPoints:i.patrolPoints,bLOS:i.bLOS});break;case"crate":switch(i.crateType){case Crate.CRATE_KILLSTREAK:switch(a.killstreakId){case Killstreaks.KILLSTREAK_ESCORT_AIRDROP:r=this.localData.bSurvival||1!=this.Random(1,5)?this.createKillstreakCrate(e.position[0],e.position[1],void 0,t.playerId):this.createDecoyCrate(e.position[0],e.position[1],t.playerId);break;default:r=this.createKillstreakCrate(e.position[0],e.position[1],void 0,t.playerId)}break;case Crate.CRATE_WEAPON:var s;if(!(s=i.items))s=[this.getWeaponData(i.weaponId)];r=this.createItemCrate(e.position[0],e.position[1],t.playerId,s);break;case Crate.CRATE_PERK:r=this.createPerkCrate(e.position[0],e.position[1],t.playerId,i.perkId);break;case Crate.CRATE_AMMO:r=this.createAmmoCrate(e.position[0],e.position[1],t.playerId);break;case Crate.CRATE_SHARD:r=this.createShardCrate(e.position[0],e.position[1],i.shards);break;case Crate.CRATE_XP:r=this.createXPCrate(e.position[0],e.position[1],i.xp);break;case Crate.CRATE_LIFE:r=this.createLifeCrate(e.position[0],e.position[1],i.lives);break;default:console.warn("Unhandled helicopter crate: "+s[0].crateType)}}r&&(r.angularVelocity=.1*this.Random(-10,10),r.applyImpulse([this.Random(-100,100),0],0,0))}}}getObjectById(e){if(!e)return null;var a=this.localData.objects[e];return a&&a.data&&!a.data.bPendingRemoval?a:null}createPlayerState(){return{id:null,name:null,level:1,prestige:0,team:0,kills:0,headshots:0,melees:0,assists:0,deaths:0,currentKillstreak:0,avengerTimer:0,multiKillTimer:0,multiKillCount:0,controllableId:null,killstreaks:[],currentKillstreakIndex:0,factionId:null,avatarData:null,respawnTimer:-1,bSpawnProtection:!1,bWaitingToRespawn:!1,bCanRespawn:!1,bAutoRespawn:!0,bHasPawn:!1,bBot:!1}}addPlayerState(e){var a=this.createPlayerState();return a.id=e.id,a.name=e.name,a.level=e.level,a.prestige=e.prestige,a.card=e.card,a.clan=e.clan,a.factionId=e.factionId,a.avatarData=e.avatarData,this.localData.factions&&(a.avatars=e.avatars),a.team=e.team,e.bBot&&(a.bBot=e.bBot),e.bRanked&&(a.bRanked=e.bRanked),e.bPremium&&(a.bPremium=e.bPremium),e.bAdmin&&(a.bAdmin=e.bAdmin),e.bDev&&(a.bDev=e.bDev),e.steamId&&(a.steamId=e.steamId),e.bClanLeader&&(a.bClanLeader=e.bClanLeader),e.bMod&&(a.bMod=e.bMod),a.botSkill=e.botSkill,a.desiredClassData=e.desiredClassData,a.desiredKillstreaks=e.desiredKillstreaks,a.latency=e.latency,a.currentPartyId=e.currentPartyId,this.localData.bBattlezone&&(a.battlezone=e.battlezone),a}removePlayerStateById(e){for(var a=this.localData.playerStates,t=0;t<a.length;t++)if(a[t].id==e){var r=a[t],i=r.timer_respawn;return i&&delete r.timer_respawn,(i=r.timer_spawnProtection)&&delete r.timer_spawnProtection,a.splice(t,1),!0}return this.log("Player doesn't exist: "+e),!1}getPlayerStates(){return this.localData.playerStates}getPlayerStateById(e){for(var a=this.localData.playerStates,t=0;t<a.length;t++)if(a[t].id==e)return a[t];return null}startSpawnProtectionTimer(e){var a=this.getPlayerStateById(e);if(a){var t=1.5;this.isHardcore()?t=.5:this.localData.bBattlezone&&(t=3),a.timer_spawnProtection=Math.ceil(this.localData.settings.fps*t),a.bSpawnProtection=!0,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:a.id,data:{bSpawnProtection:a.bSpawnProtection}})}}onPlayerEarnKillstreak(e,a){var t=this.getPlayerStateById(e);if(t){var r=this.getKillstreakData(a);r.type==Killstreaks.TYPE_PERKS?t.bJuggernaut||this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:e,type:GameServer.INV_PERK_ADD,perkId:r.perkId}):(t.killstreaks.push(a),t.currentKillstreakIndex=t.killstreaks.length-1,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:e,data:{killstreaks:t.killstreaks,currentKillstreakIndex:t.currentKillstreakIndex}}))}}killstreakIsActive(e){for(var a=this.localData.killstreaks,t=0;t<a.length;t++){if(a[t].id===e)return!0}return!1}getNumJuggernautsOnTeam(e){for(var a=0,t=this.getCharacters(),r=0;r<t.length;r++){var i=t[r];i.data.team==e&&i.data.bJuggernaut&&a++}return a}canUseKillstreak(e,a){var t=this.getPlayerStateById(e);if(!t)return!0;var r=t.team;if(t.controllableId)return!1;if(!this.getObjectById(e))return!1;for(var i=this.localData.killstreaks,s=0,o=0,l=0;l<i.length;l++){var n=i[l];if(n.id==Killstreaks.KILLSTREAK_EMP&&n.team!=t.team)return!1;if(n.id==Killstreaks.KILLSTREAK_DEADSWITCH)return!1;if(n.id==Killstreaks.KILLSTREAK_BOMBARDMENT){if(a==Killstreaks.KILLSTREAK_BOMBARDMENT&&++s>=(this.localData.bSurvival?2:1))return!1}else if(n.id==Killstreaks.KILLSTREAK_NAPALM&&a==Killstreaks.KILLSTREAK_NAPALM&&++o>=(this.localData.bSurvival?2:1))return!1}var d=this.localData.bSurvival||this.localData.bSandbox?4:1,E=this.localData.bSurvival||this.localData.bSandbox?2:1,h=this.localData.bSurvival||this.localData.bSandbox?6:2;switch(a){case Killstreaks.KILLSTREAK_AMMO:case Killstreaks.KILLSTREAK_DECOY:case Killstreaks.KILLSTREAK_CARE_PACKAGE:case Killstreaks.KILLSTREAK_SAM_TURRET:case Killstreaks.KILLSTREAK_SENTRY_GUN:case Killstreaks.KILLSTREAK_WEAPON:case Killstreaks.KILLSTREAK_WEAPON_M202:case Killstreaks.KILLSTREAK_SUPPORT_AIRDROP:case Killstreaks.KILLSTREAK_JUGGERNAUT:case Killstreaks.KILLSTREAK_JUGGERNAUT_RECON:if(this.getNumHelicopterType(Helicopter.TYPE_MH6)>=2)return!1;break;case Killstreaks.KILLSTREAK_MH6:if(this.getNumHelicopterType(Helicopter.TYPE_MH6_ATTACK)>=2)return!1;if(this.getNumAttackHelicoptersOnTeam(r)>=h)return!1;break;case Killstreaks.KILLSTREAK_MH6_GRENADE:if(this.getNumHelicopterType(Helicopter.TYPE_MH6_GRENADE)>=E)return!1;if(this.getNumAttackHelicoptersOnTeam(r)>=h)return!1;break;case Killstreaks.KILLSTREAK_COBRA:if(this.getNumHelicopterType(Helicopter.TYPE_COBRA)>=1)return!1;if(this.getNumAttackHelicoptersOnTeam(r)>=h)return!1;break;case Killstreaks.KILLSTREAK_COBRA_CONTROLLABLE:if(this.getNumHelicopterType(Helicopter.TYPE_COBRA_CONTROLLABLE)>=E)return!1;if(this.getNumAttackHelicoptersOnTeam(r)>=h)return!1;break;case Killstreaks.KILLSTREAK_CHOPPER_GUNNER:if(this.getNumHelicopterType(Helicopter.TYPE_BLACKHAWK)>=E)return!1;if(this.getNumAttackHelicoptersOnTeam(r)>=h)return!1;break;case Killstreaks.KILLSTREAK_HELI_SNIPER:if(this.getNumHelicopterType(Helicopter.TYPE_BLACKHAWK_SNIPER)>=E)return!1;if(this.getNumAttackHelicoptersOnTeam(r)>=h)return!1;break;case Killstreaks.KILLSTREAK_PAVE_LOW:if(this.getNumHelicopterType(Helicopter.TYPE_PAVE_LOW)>=1)return!1;if(this.getNumAttackHelicoptersOnTeam(r)>=h)return!1;break;case Killstreaks.KILLSTREAK_REAPER:if(this.getNumHelicopterType(Helicopter.TYPE_REAPER)>=E)return!1;if(this.getNumAttackHelicoptersOnTeam(r)>=h)return!1;break;case Killstreaks.KILLSTREAK_SCOUT:if(this.getNumHelicopterType(Helicopter.TYPE_SCOUT)>=E)return!1;if(this.getNumAttackHelicoptersOnTeam(r)>=h)return!1;break;case Killstreaks.KILLSTREAK_DRAGONFIRE:if(this.getNumHelicopterType(Helicopter.TYPE_DRAGONFIRE)>=2)return!1;break;case Killstreaks.KILLSTREAK_ESCORT_AIRDROP:case Killstreaks.KILLSTREAK_ESCORT_AIRDROP_SURVIVAL:if(this.getNumHelicopterType(Helicopter.TYPE_OSPREY)>=1)return!1;break;case Killstreaks.KILLSTREAK_HELLFIRE:if(this.getNumRocketType(Rocket.TYPE_HELLFIRE)>=2)return!1;break;case Killstreaks.KILLSTREAK_JUGGERNAUT_RECON_USE:case Killstreaks.KILLSTREAK_JUGGERNAUT_USE:if(t.bVIP)return!1;if(this.getNumJuggernautsOnTeam(r)>=d)return!1}return!0}addKillstreak(e){this.localData.killstreaks.push(e),this.onEvent({eventId:GameServer.EVENT_KILLSTREAKS_UPDATE,killstreaks:this.localData.killstreaks})}executeInteractable(e,a){if(this.matchInProgress()){var t=e;if(t&&!t.data.bPendingDestroy){t.data.bLimitInteractions&&delete t.data.currentPawnId,this.onEvent({eventId:GameServer.EVENT_INTERACTABLE_USED,data:{interactableId:t.data.id,playerId:a}});var r=this.getObjectById(a),i=t.data,s=i.interactData;if(i)switch(i.type){case"info":this.requestEvent({eventId:GameServer.EVENT_MESSAGE_ADD,data:t.data.interactData}),s.bRemove&&this.removeNextStep(t);break;case"door":i.cooldownTimer||(this.setDoorClosed(t,!i.bClosed,r),this.cancelCharacterBoltPull(r),this.cancelCharacterReload(r),r.data.bShieldCooldown=!0,r.data.shieldCooldownTimer=Math.ceil(.5*this.localData.settings.fps),r.data.bDoorCooldown=!0,this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:r.data.id,type:GameServer.PAWN_START_SHIELD_COOLDOWN,bDoor:!0,position:this.roundNumberArray(r.position)}));break;case"scavenger_pack":var o=r.data.inventory;for(c=0;c<o.length;c++){var l=o[c];l.bMelee||this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:r.data.id,index:c,type:GameServer.INV_AMMO_ADD,value:l.magSize,barrelAmmo:1})}(d=r.data.equipment)&&0==d.ammo&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:r.data.id,type:GameServer.INV_EQUIPMENT_ADD,value:1}),this.removeNextStep(t);break;case"loot_pack":r&&(this.addBattlezoneLoot(r.data.id,t.data.interactData.xp,t.data.interactData.shards),t.data.bUsed=!0,this.removeNextStep(t));break;case"reviver":var n=this.localData.bUseMoneyMultiplier?250:0;this.revivePlayer(s.playerId,[t.position[0],t.position[1]-20],a),this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:a,type:GameServer.PAWN_END_REVIVE,money:n}),this.removeNextStep(t),this.localData.bSurvival&&this.addPlayerMoney(a,n);break;case"turret":if(!i.controllerId)(p=this.getPlayerStateById(a))&&this.setPlayerControllable(p,t);break;case"droppedWeapon":if(r)if((S=s.weaponData).bEquipment){var d;(d=r.data.equipment)&&d.id===S.id?(this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:r.data.id,index:E,value:1,type:GameServer.INV_EQUIPMENT_ADD,sfxId:"wpn_ammo"}),this.removeNextStep(t)):r.data.bNoPickups||(this.dropCharacterEquipment(r),this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:r.data.id,index:E,value:S.id,type:GameServer.INV_EQUIPMENT_SET,sfxId:"wpn_ammo"}),this.removeNextStep(t),this.isTutorial()&&this.requestEvent({eventId:GameServer.EVENT_MESSAGE_ADD,data:{message:"STR_CONTROL_EQUIPMENT",id:"tutorial_equipment"}}))}else{o=r.data.inventory;var E=this.getCharacterInventoryItemIndex(r,S.id);if(E>=0)this.isMeleeWeapon(S)||(this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:r.data.id,index:E,value:S.mag+S.ammo,type:GameServer.INV_AMMO_ADD,sfxId:"wpn_ammo",barrelAmmo:S.barrelAmmo}),this.removeNextStep(t));else if(!r.data.bNoPickups){if(o.length<=1)o[0]&&"none"==o[0].id?this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:r.data.id,index:0,item:S,type:GameServer.INV_ITEM_REPLACE}):(this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:r.data.id,item:S,type:GameServer.INV_ITEM_ADD,sfxId:"wpn_ammo"}),this.isTutorial()&&this.requestEvent({eventId:GameServer.EVENT_MESSAGE_ADD,data:{message:"STR_CONTROL_SWITCH",id:"tutorial_switch"}}));else{for(var h=r.data.currentInventoryIndex,c=0;c<o.length;c++)if("none"==o[c].id){h=c;break}this.dropCharacterWeapon(r,h),this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:r.data.id,index:h,item:S,type:GameServer.INV_ITEM_REPLACE}),h>=0&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:r.data.id,value:h,type:GameServer.INV_CURRENT_INVENTORY_INDEX})}this.removeNextStep(t)}}break;case"crate":if(s&&r){if(this.localData.bModeGame&&r.data.id!=s.ownerId)switch(s.type){case Crate.CRATE_AMMO:case Crate.CRATE_KILLSTREAK:case Crate.CRATE_PERK:case Crate.CRATE_WEAPON:r.data.team==s.team?this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:s.ownerId,type:GameServer.PAWN_SHARED_CRATE}):this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:r.data.id,type:GameServer.PAWN_STOLE_CRATE})}switch(s.type){case Crate.CRATE_BOMB_GENERIC:if(!i.bBombPlanted){var m=this.localData.gameModeData;i.bBombPlanted=!0,i.bEnabled=!1,this.pushObjectDataUpdate(i.id,["bBombPlanted","bEnabled"]),(p=this.getPlayerStateById(a))&&(p.plants++,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:a,data:{plants:p.plants}})),this.emitAISound(t.position)}break;case Crate.CRATE_BOMB:if(!this.matchInProgress())break;var p=this.getPlayerStateById(a);m=this.localData.gameModeData;i.bBombPlanted&&r.data.team!=m.bombTeam?(i.bBombPlanted=!1,i.interactTeam=m.bombTeam,this.pushObjectDataUpdate(i.id,["bBombPlanted","interactTeam"]),m.bBombPlanted=i.bBombPlanted,m.playerId=a,p&&(p.defuses++,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:a,data:{defuses:p.defuses}})),this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{bBombPlanted:!1,playerId:a,scores:m.scores}}),this.winRound(MatchState.END_CONDITION_DEFUSE,r.data.team,1,{id:a})):i.bBombPlanted||r.data.team!=m.bombTeam||(m.bombTimer=m.bombTimerMax,i.bBombPlanted=!0,i.interactTeam=0==m.bombTeam?1:0,i.interactData.interactTime=this.localData.gameModeData.defuseTime,i.planterId=r.data.id,this.pushObjectDataUpdate(i.id,["bBombPlanted","interactTeam"]),m.bBombPlanted=i.bBombPlanted,p&&(p.plants++,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:a,data:{plants:p.plants}})),this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{bBombPlanted:!0,bombTimer:m.bombTimer,playerId:a}}));break;case Crate.CRATE_STORE:p=this.getPlayerStateById(a);if(r&&p&&p.bBot){var _=this.characterNeedsWeapon(r),A=this.getRandomWeapon();if(_&&p.money>=A.cost)this.purchaseStoreItem(p.id,{type:"item",itemId:A.id,index:1});else if(0==p.killstreaks.length){var I=this.getKillstreakData(Killstreaks.KILLSTREAK_AMMO);p.money>=I.moneyCost&&this.purchaseStoreItem(p.id,{type:"killstreak",killstreakId:I.id})}delete r.data.ai.interactableId}break;case Crate.CRATE_AMMO:o=r.data.inventory;var T=this.localData.bSurvival?5:3;for(c=0;c<o.length;c++)o[c].bMelee||this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:r.data.id,index:c,type:GameServer.INV_AMMO_ADD,value:o[c].magSize*T,barrelAmmo:1});this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:r.data.id,type:GameServer.INV_EQUIPMENT_ADD,value:1}),this.removeNextStep(t);break;case Crate.CRATE_KILLSTREAK:this.requestEvent({eventId:GameServer.EVENT_PLAYER_EARN_KILLSTREAK,playerId:a,killstreakId:s.killstreakId,bAcquired:!0}),this.removeNextStep(t),this.isTutorial()&&this.requestEvent({eventId:GameServer.EVENT_MESSAGE_ADD,data:{message:"STR_CONTROL_KILLSTREAK",id:"tutorial_killstreak"}});break;case Crate.CRATE_DECOY:this.createExplosion({eventId:GameServer.EVENT_SPAWN_EXPLOSION,x:t.position[0],y:t.position[1],radius:500,damage:500,playerId:i.interactData.ownerId,causerId:i.id,weaponId:Killstreaks.KILLSTREAK_DECOY,bDirectlyCausedByPlayer:!0}),this.removeNextStep(t);break;case Crate.CRATE_SHARD:this.addBattlezoneLoot(a,0,i.interactData.shards),this.removeNextStep(t);break;case Crate.CRATE_XP:this.addBattlezoneLoot(a,i.interactData.xp,0),this.removeNextStep(t);break;case Crate.CRATE_LIFE:(p=this.getPlayerStateById(a))&&(p.lives+=i.interactData.lives,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:p.id,data:{lives:p.lives}})),this.removeNextStep(t);break;case Crate.CRATE_WEAPON:var R=i.interactData.items;for(c=0;c<R.length;c++){var S=R[c];this.localData.gameModeData.id==GameMode.SURVIVAL_STAKEOUT&&(S.ammo+=3*S.magSize),this.createDroppedWeapon(this.getRandomUniqueId(),[t.position[0],t.position[1]-10],0,1,{weaponData:S,playerId:i.interactData.playerId},[this.Random(-100,100),this.Random(-200,-100)],this.Random(0,5))}this.removeNextStep(t);break;case Crate.CRATE_PERK:this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:a,type:GameServer.INV_PERK_ADD,perkId:i.interactData.perkId}),this.removeNextStep(t)}}}}}}getCurrentPlayerKillstreak(e){var a=this.getPlayerStateById(e),t=a.killstreaks;return t&&0!==t.length?t[a.currentKillstreakIndex]:null}addBattlezoneLoot(e,a=0,t=0){if(this.localData.bBattlezone){var r=this.getObjectById(e),i=this.getPlayerStateById(e);i?i.bHasPawn&&r&&((null==i.xp||isNaN(i.xp))&&(i.xp=0),null!=a&&(i.xp=Math.min(Battlezone.MAX_XP,i.xp+a)),(null==i.shards||isNaN(i.shards))&&(i.shards=0),null!=t&&(i.shards=Math.min(Battlezone.MAX_SHARDS,i.shards+t)),this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:i.id,data:{xp:i.xp,shards:i.shards}})):r&&!r.data.bZombie&&r.data.health>0&&(r.data.loot||(r.data.loot={xp:0,shards:0}),a&&(r.data.loot.xp=Math.min(Battlezone.MAX_XP,r.data.loot.xp+a)),t&&(r.data.loot.shards=Math.min(Battlezone.MAX_SHARDS,r.data.loot.shards+t)))}}executePlayerKillstreak(e,a,t,r,i){var s=this.getPlayerStateById(e);if(s){var o=a;if(o){var l=this.getKillstreakData(o);l&&this.addBattlezoneLoot(s.id,l.xpReward?l.xpReward:100),this.onEvent({eventId:GameServer.EVENT_PLAYER_EXECUTE_KILLSTREAK,playerId:e,killstreakId:o,team:s.team,bSilent:i,position:[t,r]});var n=this.getCurrentMapData(),d=this.getObjectById(e),E=t<.5*n.width?1:-1,h=1===E?100:n.width-100;switch(o){case Killstreaks.KILLSTREAK_UAV_SUPPORT:case Killstreaks.KILLSTREAK_UAV:this.addKillstreak({id:o,playerId:s.id,team:s.team,timer:30*this.localData.settings.fps});break;case Killstreaks.KILLSTREAK_COUNTER_UAV:this.addKillstreak({id:o,playerId:s.id,team:s.team,timer:15*this.localData.settings.fps});break;case Killstreaks.KILLSTREAK_JUGGERNAUT:this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_MH6,playerId:s.id,destination:[t,Math.min(this.getHeliMaxY(),r)],items:[{type:"crate",crateType:Crate.CRATE_KILLSTREAK,killstreakId:Killstreaks.KILLSTREAK_JUGGERNAUT_USE}],scale:E});break;case Killstreaks.KILLSTREAK_JUGGERNAUT_USE:this.makePlayerJuggernaut(s.id,Killstreaks.KILLSTREAK_JUGGERNAUT);break;case Killstreaks.KILLSTREAK_JUGGERNAUT_RECON:this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_MH6,playerId:s.id,destination:[t,Math.min(this.getHeliMaxY(),r)],items:[{type:"crate",crateType:Crate.CRATE_KILLSTREAK,killstreakId:Killstreaks.KILLSTREAK_JUGGERNAUT_RECON_USE}],scale:E});break;case Killstreaks.KILLSTREAK_JUGGERNAUT_RECON_USE:this.makePlayerJuggernaut(s.id,Killstreaks.KILLSTREAK_JUGGERNAUT_RECON);break;case Killstreaks.KILLSTREAK_CARE_PACKAGE:this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_MH6,playerId:s.id,destination:[t,Math.min(this.getHeliMaxY(),r)],items:[{type:"crate",crateType:Crate.CRATE_KILLSTREAK}],scale:E});break;case Killstreaks.KILLSTREAK_AMMO:this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_MH6,playerId:s.id,destination:[t,Math.min(this.getHeliMaxY(),r)],items:[{type:"crate",crateType:Crate.CRATE_AMMO}],scale:E});break;case Killstreaks.KILLSTREAK_SUPPORT_AIRDROP:if(this.RandomBoolean()){for(var c=[],m=this.Random(1,3),p=0;p<m;p++){var _=this.getRandomWeapon(this.localData.gameModeData.id==GameMode.SURVIVAL_STAKEOUT),A=this.getRandomMods(_);this.applyWeaponMods(_,A),c.push(_)}var I={type:"crate",crateType:Crate.CRATE_WEAPON,items:c}}else I={type:"crate",crateType:Crate.CRATE_PERK,perkId:this.getRandomPerk()};this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_MH6,playerId:s.id,destination:[t,Math.min(this.getHeliMaxY(),r)],items:[I],scale:E});break;case Killstreaks.KILLSTREAK_WEAPON:c=[];var T=this.localData.gameModeData.id==GameMode.SURVIVAL_STAKEOUT?3:1;for(p=0;p<T;p++){_=this.getRandomWeapon(this.localData.gameModeData.id==GameMode.SURVIVAL_STAKEOUT),A=this.getRandomMods(_);this.applyWeaponMods(_,A),null!=_.ammo&&null!=_.magSize&&(_.ammo=this.Random(0,_.magSize)),c.push(_)}this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_MH6,playerId:s.id,destination:[t,Math.min(this.getHeliMaxY(),r)],items:[{type:"crate",crateType:Crate.CRATE_WEAPON,items:c}],scale:E});break;case Killstreaks.KILLSTREAK_WEAPON_M202:var R=this.getWeaponData("m202");this.applyWeaponMods(R,{base:Mods.BASE_MODE_SELECTOR,barrel:Mods.BARREL_LASER,ammo:Mods.AMMO_LAUNCHER_EXPLOSIVE}),R.damage=500,R.ammo=20,R.mag=10,R.magSize=10,this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_MH6,playerId:s.id,destination:[t,Math.min(this.getHeliMaxY(),r)],items:[{type:"crate",crateType:Crate.CRATE_WEAPON,weaponData:R}],scale:E});break;case Killstreaks.KILLSTREAK_PERK:var S=this.getSurvivalPerks(),v={};for(p=0;p<S.length;p++)this.characterHasPerk(d,S[p])||(v[S[p]]=1);var u=this.getRandomProperty(v);u&&this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_MH6,playerId:s.id,destination:[t,Math.min(this.getHeliMaxY(),r)],items:[{type:"crate",crateType:Crate.CRATE_PERK,perkId:u}],scale:E});break;case Killstreaks.KILLSTREAK_DECOY:this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_MH6,playerId:s.id,destination:[t,Math.min(this.getHeliMaxY(),r)],items:[{type:"crate",crateType:Crate.CRATE_DECOY,playerId:s.id}],scale:E});break;case Killstreaks.KILLSTREAK_SAM_TURRET:this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_MH6,playerId:s.id,destination:[t,Math.min(this.getHeliMaxY(),r)],items:[{type:"crate",crateType:Crate.CRATE_KILLSTREAK,killstreakId:Killstreaks.KILLSTREAK_SAM_TURRET_PLACE,playerId:s.id}],scale:E});break;case Killstreaks.KILLSTREAK_SENTRY_GUN:this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_MH6,playerId:s.id,destination:[t,Math.min(this.getHeliMaxY(),r)],items:[{type:"crate",crateType:Crate.CRATE_KILLSTREAK,killstreakId:Killstreaks.KILLSTREAK_SENTRY_GUN_PLACE,playerId:s.id}],scale:E});break;case Killstreaks.KILLSTREAK_SAM_TURRET_PLACE:this.createTurret(this.getRandomUniqueId(),d.position,d.data.scale,s.team,{type:Turret.TYPE_SAM,playerId:s.id});break;case Killstreaks.KILLSTREAK_SENTRY_GUN_PLACE:this.createTurret(this.getRandomUniqueId(),d.position,d.data.scale,s.team,{type:Turret.TYPE_SENTRY,playerId:s.id});break;case Killstreaks.KILLSTREAK_REMOTE_TURRET:this.createTurret(this.getRandomUniqueId(),d.position,d.data.scale,s.team,{type:Turret.TYPE_REMOTE,playerId:s.id});break;case Killstreaks.KILLSTREAK_ADVANCED_TURRET:this.createTurret(this.getRandomUniqueId(),d.position,d.data.scale,s.team,{type:Turret.TYPE_BALLISTIC,playerId:s.id});break;case Killstreaks.KILLSTREAK_GRENADE_TURRET:this.createTurret(this.getRandomUniqueId(),d.position,d.data.scale,s.team,{type:Turret.TYPE_GRENADE,playerId:s.id});break;case Killstreaks.KILLSTREAK_HELLFIRE:this.createRocket([t,0],{type:Rocket.TYPE_HELLFIRE,team:s.team,playerId:e,causerId:e,rotation:this.ToRad(90),weaponId:Killstreaks.KILLSTREAK_HELLFIRE});break;case Killstreaks.KILLSTREAK_AIRSTRIKE:var b=[];for(p=0;p<5;p++){var y=t+this.Random(-100,100),D=0,g=this.Angle(y,D,t+this.Random(-50,50),r);b.push({timer:this.localData.settings.fps+p*(30*this.localData.settings.fps_mult),position:[y,D],rocketData:{type:Rocket.TYPE_DEFAULT,team:s.team,playerId:e,causerId:e,rotation:g,weaponId:Killstreaks.KILLSTREAK_AIRSTRIKE}}),this.addKillstreak({id:o,playerId:s.id,team:s.team,timer:2*this.localData.settings.fps,rockets:b})}break;case Killstreaks.KILLSTREAK_NAPALM:for(b=[],p=0;p<3;p++){y=t+this.Random(-100,100),D=0,g=this.Angle(y,D,t+this.Random(-50,50),r);b.push({timer:this.localData.settings.fps+p*(45*this.localData.settings.fps_mult),position:[y,D],rocketData:{type:Rocket.TYPE_NAPALM,team:s.team,playerId:e,causerId:e,rotation:g,weaponId:Killstreaks.KILLSTREAK_NAPALM}}),this.addKillstreak({id:o,playerId:s.id,team:s.team,timer:15*this.localData.settings.fps,rockets:b})}break;case Killstreaks.KILLSTREAK_BOMBARDMENT:for(b=[],p=0;p<30;p++){y=t+this.Random(-50,50),D=0,g=this.Angle(y,D,t+this.Random(-100,100),r);b.push({timer:this.localData.settings.fps+p*(30*this.localData.settings.fps_mult),position:[y,D],rocketData:{type:Rocket.TYPE_DEFAULT,team:s.team,playerId:e,causerId:e,rotation:g,weaponId:Killstreaks.KILLSTREAK_BOMBARDMENT}})}this.addKillstreak({id:o,playerId:s.id,team:s.team,timer:this.localData.settings.fps*(this.localData.bSurvival?15:10),rockets:b});break;case Killstreaks.KILLSTREAK_STEALTH_BOMBER:for(b=[],p=0;p<5;p++){y=t+200*p-400,D=0,g=this.ToRad(90);b.push({timer:2*this.localData.settings.fps+p*Math.round(10*this.localData.settings.fps_mult),position:[y,D],rocketData:{type:Rocket.TYPE_DEFAULT,team:s.team,playerId:e,causerId:e,rotation:g,weaponId:Killstreaks.KILLSTREAK_STEALTH_BOMBER}})}this.addKillstreak({id:o,playerId:s.id,team:s.team,timer:3*this.localData.settings.fps,rockets:b});break;case Killstreaks.KILLSTREAK_COBRA:this.createHelicopter([t,0],s.team,{type:Helicopter.TYPE_COBRA,playerId:s.id,destination:[t,r]});break;case Killstreaks.KILLSTREAK_COBRA_CONTROLLABLE:(O=this.createHelicopter([t,0],s.team,{type:Helicopter.TYPE_COBRA_CONTROLLABLE,playerId:s.id,destination:[t,r]})).data.bBot=s.bBot,O.data.bPlayerControlled=!s.bBot;break;case Killstreaks.KILLSTREAK_MH6:this.createHelicopter([t,0],s.team,{type:Helicopter.TYPE_MH6_ATTACK,playerId:s.id,destination:[t,.5*n.height]});break;case Killstreaks.KILLSTREAK_MH6_GRENADE:(O=this.createHelicopter([t,0],s.team,{type:Helicopter.TYPE_MH6_GRENADE,playerId:s.id,destination:[t,.5*n.height]})).data.bBot=s.bBot,O.data.bPlayerControlled=!s.bBot;break;case Killstreaks.KILLSTREAK_CHOPPER_GUNNER:(O=this.createHelicopter([t,0],s.team,{type:Helicopter.TYPE_BLACKHAWK,playerId:s.id,destination:[.5*n.width,.5*n.height]})).data.bBot=s.bBot,O.data.bPlayerControlled=!s.bBot;break;case Killstreaks.KILLSTREAK_HELI_SNIPER:(O=this.createHelicopter([t,0],s.team,{type:Helicopter.TYPE_BLACKHAWK_SNIPER,playerId:s.id,destination:[.5*n.width,.5*n.height]})).data.bBot=s.bBot,O.data.bPlayerControlled=!s.bBot;break;case Killstreaks.KILLSTREAK_REAPER:n=this.getCurrentMapData();(O=this.createHelicopter([t,0],s.team,{type:Helicopter.TYPE_REAPER,playerId:s.id,destination:[.5*n.width,.5*n.height]})).data.bBot=s.bBot,O.data.bPlayerControlled=!s.bBot;break;case Killstreaks.KILLSTREAK_DRAGONFIRE:n=this.getCurrentMapData();var P=this.getObjectById(s.id),M=P?[P.position[0],P.position[1]-40]:[t,r];(O=this.createHelicopter(M,s.team,{type:Helicopter.TYPE_DRAGONFIRE,playerId:s.id,destination:[M[0],M[1]-20]})).data.bBot=s.bBot,O.data.bPlayerControlled=!s.bBot;break;case Killstreaks.KILLSTREAK_SCOUT:n=this.getCurrentMapData();var O=this.createHelicopter([t,0],s.team,{type:Helicopter.TYPE_SCOUT,playerId:s.id,destination:[t,.5*n.height],items:[{type:"crate",crateType:Crate.CRATE_AMMO}]});break;case Killstreaks.KILLSTREAK_PAVE_LOW:this.createHelicopter([.5*n.width,0],s.team,{type:Helicopter.TYPE_PAVE_LOW,playerId:s.id,destination:null});break;case Killstreaks.KILLSTREAK_ESCORT_AIRDROP:this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_OSPREY,playerId:s.id,destination:[t,Math.max(200,Math.min(this.getHeliMaxY(),r-200))],items:[{type:"crate",crateType:Crate.CRATE_KILLSTREAK,playerId:s.id},{type:"crate",crateType:Crate.CRATE_KILLSTREAK,playerId:s.id},{type:"crate",crateType:Crate.CRATE_KILLSTREAK,playerId:s.id},{type:"crate",crateType:Crate.CRATE_KILLSTREAK,playerId:s.id},{type:"crate",crateType:Crate.CRATE_KILLSTREAK,playerId:s.id}],scale:E});break;case Killstreaks.KILLSTREAK_ESCORT_AIRDROP_SURVIVAL:var N=[];for(p=0;p<3;p++){c=[],m=this.Random(1,3);for(var L=0;L<m;L++){_=this.getRandomWeapon(this.localData.gameModeData.id==GameMode.SURVIVAL_STAKEOUT),A=this.getRandomMods(_);this.applyWeaponMods(_,A),c.push(_)}N.push({type:"crate",crateType:Crate.CRATE_WEAPON,playerId:s.id,items:c})}if(this.localData.gameModeData.id===GameMode.SURVIVAL_STAKEOUT)for(p=0;p<this.localData.playerStates.length;p++)N.push({type:"crate",crateType:Crate.CRATE_KILLSTREAK,playerId:s.id});for(p=0;p<3;p++)N.push({type:"crate",crateType:Crate.CRATE_AMMO,playerId:s.id});this.createHelicopter([h,0],s.team,{type:Helicopter.TYPE_OSPREY,playerId:s.id,destination:[t,Math.max(200,Math.min(this.getHeliMaxY(),r-200))],items:N,scale:E});break;case Killstreaks.KILLSTREAK_EMP:this.executeEMP(s.id),this.addKillstreak({id:o,playerId:s.id,team:s.team,timer:30*this.localData.settings.fps});break;case Killstreaks.KILLSTREAK_DEADSWITCH:this.addKillstreak({id:o,playerId:s.id,team:s.team,timer:3*this.localData.settings.fps});break;default:this.log("Unhandled killstreak: "+o)}}}else console.warn("Invalid player state")}triggerPlayerCurrentKillstreak(e,a,t){t=Math.min(1500,t);var r=this.getPlayerStateById(e),i=r.killstreaks,s=r.currentKillstreakIndex,o=i[s];this.canUseKillstreak(e,o)?(i.splice(s,1),r.currentKillstreakIndex=Math.min(i.length-1,s),o&&(this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:e,data:{killstreaks:r.killstreaks,currentKillstreakIndex:r.currentKillstreakIndex}}),this.executePlayerKillstreak(r.id,o,a,t))):this.onEvent({eventId:GameServer.EVENT_PLAYER_EXECUTE_KILLSTREAK,playerId:e,killstreakId:o,team:r.team,bUnavailable:!0})}executeEMP(e){if(!this.matchHasEnded()){for(var a=this.getPlayerStateById(e),t=this.getEMPItems(),r=0;r<t.length;r++){var i=t[r];i.data.team!=a.team&&i.data.health&&this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_EXPLOSIVE,damageAmount:5e3,pawnId:i.data.id,attackerId:a.id,causerId:a.id,weaponId:Killstreaks.KILLSTREAK_EMP,bDirectlyCausedByPlayer:!0})}var s=this.getCharacters();for(r=0;r<s.length;r++){var o=s[r];o.data.bJuggernaut&&this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_EXPLOSIVE,damageAmount:this.getCharacterHealth(),pawnId:o.data.id,attackerId:a.id,causerId:a.id,weaponId:Killstreaks.KILLSTREAK_EMP,bDirectlyCausedByPlayer:!1})}}}executeDeadswitch(e){if(!this.matchHasEnded()){var a=this.getPlayerStateById(e);if(a){for(var t=this.getPawns(),r=0;r<t.length;r++){var i=t[r];if(i.data.type){var s=!0;if(this.localData.bSurvival&&i.data.team==a.team&&(s=!1),s){var o=i.data.health;i.data.damageMultipliers&&(i.data.damageMultipliers[DamageType.DAMAGE_EXPLOSIVE]=1),i.data.perks&&(i.data.perks=[]),this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_EXPLOSIVE,damageAmount:Math.max(o,500),pawnId:i.data.id,attackerId:a.id,causerId:a.id,weaponId:Killstreaks.KILLSTREAK_DEADSWITCH,bDirectlyCausedByPlayer:!1})}}}this.localData.bSurvival?this.localData.deadswitchCooldownTimer=10*this.localData.settings.fps:this.localData.bModeGame&&this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_NUKE,winningTeam:a.team,playerSpotlight:{id:a.id}})}}}killPawn(e){var a=this.getObjectById(e);if(a){var t=a.data.health;a.data.damageMultipliers&&(a.data.damageMultipliers[DamageType.DAMAGE_EXPLOSIVE]=1),a.data.perks&&(a.data.perks=[]),this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_EXPLOSIVE,damageAmount:Math.max(t,500),pawnId:e,attackerId:e,causerId:null,weaponId:"generic",bDirectlyCausedByPlayer:!1})}}onPlayerUseKillstreak(e,a,t){var r=this.getPlayerStateById(e);if(r){var i=this.getObjectById(e),s=r.killstreaks;if(i&&s&&s.length>0){var o=s[r.currentKillstreakIndex];if(!i.data.bIsOnLadder&&!this.characterHasWeaponDelay(i)){var l=[Killstreaks.KILLSTREAK_REMOTE_TURRET,Killstreaks.KILLSTREAK_ADVANCED_TURRET,Killstreaks.KILLSTREAK_JUGGERNAUT_USE,Killstreaks.KILLSTREAK_JUGGERNAUT_RECON_USE];o.indexOf("place")>=0||l.indexOf(o)>=0?this.triggerPlayerCurrentKillstreak(e,a,t):(this.cancelCharacterReload(i),this.cancelCharacterBoltPull(i),this.stopCharacterInteract(i),i.data.weapon.bUseDelay=!0,i.data.weapon.useDelayTimer=Math.round(.3*this.localData.settings.fps),i.data.weapon.useData={type:"killstreak",position:[a,t]},this.requestEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:i.data.id,type:GameServer.PAWN_OPEN_LAPTOP}))}}}}purchaseStoreItem(e,a){var t=this.getPlayerStateById(e),r=this.getObjectById(e);if(t&&r)if(a){var i=0;switch(a.type){case"ammo":if(2===a.index)var s=r.data.equipment;else s=r.data.inventory[a.index];if(s)var o=this.getAmmoStoreInfo(s.id);o&&(i=o.cost?o.cost:0,t.money>=i&&(2==a.index?this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:e,type:GameServer.INV_EQUIPMENT_ADD,value:o.ammo}):this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:e,index:a.index,type:GameServer.INV_AMMO_ADD,value:o.ammo,barrelAmmo:1})));break;case"item":if((s=this.getWeaponData(a.itemId))&&(i=s.cost?s.cost:0,t.money>=i))if(2==a.index)this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:e,type:GameServer.INV_EQUIPMENT_SET,value:s.id});else if(r.data.inventory.length<2)this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:e,type:GameServer.INV_ITEM_ADD,item:s});else{var l=0==a.index?1:0;r.data.inventory[l].type,this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:e,index:a.index,item:s,type:GameServer.INV_ITEM_REPLACE})}break;case"perk":var n=this.getPerkData(a.perkId);n&&(i=n.cost?n.cost:0,t.money>=i&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:e,type:GameServer.INV_PERK_ADD,perkId:n.id}));break;case"killstreak":var d=this.getKillstreakData(a.killstreakId);d&&(i=d.moneyCost?d.moneyCost:0,t.money>=i&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_EARN_KILLSTREAK,playerId:e,killstreakId:a.killstreakId,bAcquired:!0}));break;case"mod":var E=this.getModData(a.modId);i=E?E.moneyCost:0,t.money>=i&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:e,type:GameServer.INV_MOD_SET,index:a.index,modId:a.modId,modType:a.modType})}this.requestEvent({eventId:GameServer.EVENT_GAME_MONEY_ADD,playerId:e,value:-i})}else console.warn("Invalid data")}getAmmoStoreInfo(e){var a=this.getWeaponData(e);if(a){if(a.bEquipment)var t=a.cost;else t=this.getAmmoRoundCost(a.round);if(t>0){var r=a.bEquipment?1:a.magSize;return{cost:this.RoundToNearest(t*r),ammo:r}}}return null}getAmmoRoundCost(e){var a=this.getSharedData("ammoCost");return a&&null!=a[e]?a[e]:0}addAnnouncerMessage(e,a){this.onEvent({eventId:GameServer.EVENT_ANNOUNCER_MESSAGE,id:e,team:a})}getBattlezonePatrolPoints(){var e=this.getCurrentMapData(),a=this.clone(e.campSpots);return a=a.concat(this.getAllPlayerPositions()),this.shuffleArray(a),a}getAllPlayerPositions(){for(var e=[],a=0;a<this.localData.playerStates.length;a++){var t=this.getObjectById(this.localData.playerStates[a].id);t&&t.data.health>0&&e.push([t.position[0],t.position[1]])}return e}onGameTimer(){var e=this.localData;if(!e.bPaused&&!e.preGameTimer){var a=e.gameModeData;switch(a.id){case GameMode.BATTLEZONE:if(e.gameTimer--,e.gameTimer>0){var t=this.getCurrentMapData();if(e.gameTimer%(e.gameTimer<=300?20:40)==0){var r=this.getBattlezonePatrolPoints(),i=5,s={};s[SurvivalEnemyType.ZOMBIE_DEFAULT]=5,s[SurvivalEnemyType.ZOMBIE_MELEE]=2,s[SurvivalEnemyType.ZOMBIE_SPRINTER_MELEE]=2,s[SurvivalEnemyType.ZOMBIE_FAT]=2,s[SurvivalEnemyType.ZOMBIE_SPRINTER]=2,s[SurvivalEnemyType.ZOMBIE_SPITTER]=1,s[SurvivalEnemyType.ZOMBIE_EXPLODER]=1,s[SurvivalEnemyType.INFESTOR]=1,e.gameTimer<=300&&(s[SurvivalEnemyType.ZOMBIE_SPRINTER_BOSS]=2,s[SurvivalEnemyType.ZOMBIE_SPRINTER_MELEE]=2,s[SurvivalEnemyType.ZOMBIE_EXPLODER_BOSS]=2,s[SurvivalEnemyType.ZOMBIE_SPITTER_BOSS]=1),1==this.Random(1,50)&&(s[SurvivalEnemyType.INFESTOR_KING]=1),this.getNumCharactersOnTeam(Battlezone.TEAM_ENEMIES)>=8&&(i=1);for(var o=0;o<i;o++)this.createSandboxUnit({type:"unit",unitId:this.getRandomProperty(s),team:Battlezone.TEAM_ENEMIES,pos:t.spawns_survival[this.Random(0,t.spawns_survival.length-1)],bLOS:!1})}if(e.gameTimer%180==0&&this.getNumHelicoptersOnTeam(Battlezone.TEAM_MERCENARIES)<Battlezone.MAX_HELIS){this.requestEvent({eventId:GameServer.EVENT_MESSAGE_ADD,data:{hqSound:"hq_enemy_chopper"}});var l=[SurvivalEnemyType.HELI_MH6,SurvivalEnemyType.HELI_COBRA,SurvivalEnemyType.HELI_SCOUT,SurvivalEnemyType.HELI_SNIPER,SurvivalEnemyType.HELI_CHOPPER_GUNNER,SurvivalEnemyType.HELI_PAVE_LOW];this.createSandboxUnit({type:"unit",unitId:l[this.Random(0,l.length-1)],team:Battlezone.TEAM_MERCENARIES,pos:[this.RandomBoolean()?0:t.width,0],avatarData:{body:Character.BODY_RUS_STANDARD,head:Character.HEAD_RUS_BERET,facewear:Character.FACEWEAR_BALACLAVA}})}if(e.gameTimer%60==0&&e.gameTimer>60){this.requestEvent({eventId:GameServer.EVENT_MESSAGE_ADD,data:{message:"STR_MERCS_INBOUND",hqSound:"hq_enemy_generic_"+this.Random(1,4)}});r=this.getBattlezonePatrolPoints(),this.Random(1,8);var n=[SurvivalEnemyType.RUS_BASIC,SurvivalEnemyType.RUS_HARD,SurvivalEnemyType.RUS_CLAYMORE,SurvivalEnemyType.RUS_EXPERT,SurvivalEnemyType.RUS_SNIPER,SurvivalEnemyType.RUS_MERC,SurvivalEnemyType.RUS_RPG,SurvivalEnemyType.RUS_SHIELD,SurvivalEnemyType.RUS_MELEE];(A=[]).push({type:"unit",unitId:SurvivalEnemyType.RUS_CLAYMORE,patrolPoints:r}),e.gameTimer<=300&&this.createSandboxUnit({type:"unit",unitId:SurvivalEnemyType.HELI_DRAGONFIRE,team:Battlezone.TEAM_MERCENARIES,pos:[this.RandomBoolean()?0:t.width,0]});var d=e.gameTimer>=180,E=this.Random(2,3);this.getNumCharactersOnTeam(Battlezone.TEAM_MERCENARIES)>=Battlezone.MAX_MERCS&&(E=0);for(o=0;o<E;o++)A.push({type:"unit",unitId:n[this.Random(0,n.length-1)],patrolPoints:d?r:null,bLOS:d});A.push({type:"unit",unitId:this.RandomBoolean()?SurvivalEnemyType.TURRET_SENTRY:SurvivalEnemyType.TURRET_SAM,patrolPoints:r});var h=[this.Random(500,t.width-500),this.Random(800,1e3)];this.createHelicopter([h[0]>.5*t.width?t.width:0,0],Battlezone.TEAM_MERCENARIES,{type:Helicopter.TYPE_OSPREY,playerId:null,destination:h,items:A,scale:1}).data.dropTimerMax=Math.round(.5*this.localData.settings.fps)}if(60==e.gameTimer)this.requestEvent({eventId:GameServer.EVENT_MESSAGE_ADD,data:{message:"STR_JUGGERNAUTS_INBOUND",hqSound:"hq_enemy_juggernauts"}}),this.createHelicopter([0,0],Battlezone.TEAM_MERCENARIES,{type:Helicopter.TYPE_OSPREY,playerId:null,destination:[.2*t.width,this.Random(500,1e3)],items:[{type:"unit",unitId:SurvivalEnemyType.ZOMBIE_JUGGERNAUT_MERC,bLOS:!1},{type:"unit",unitId:SurvivalEnemyType.JUGGERNAUT_MERC,bLOS:!1}],scale:1}).data.dropTimerMax=Math.round(.5*this.localData.settings.fps),this.createHelicopter([t.width,0],Battlezone.TEAM_MERCENARIES,{type:Helicopter.TYPE_OSPREY,playerId:null,destination:[.8*t.width,this.Random(500,1e3)],items:[{type:"unit",unitId:SurvivalEnemyType.JUGGERNAUT_MERC,bLOS:!1},{type:"unit",unitId:SurvivalEnemyType.ZOMBIE_JUGGERNAUT_MERC,bLOS:!1}],scale:1}).data.dropTimerMax=Math.round(.5*this.localData.settings.fps);if(e.gameTimer%30==0){var c=this.Random(1,3);for(o=0;o<c;o++){var m=[this.Random(500,t.width-500),this.Random(800,1e3)],p=[m[0]<.5*t.width?0:t.width,this.Random(0,500)];switch(this.Random(1,12)){case 1:case 2:var _=[Perks.PERK_PLAYER_LIGHTWEIGHT,Perks.PERK_PLAYER_SITREP,Perks.PERK_PLAYER_JUGGERNAUT,Perks.PERK_PLAYER_ANTI_SNIPER,Perks.PERK_PLAYER_HELMET,Perks.PERK_PLAYER_COLD_BLOODED,Perks.PERK_PLAYER_SPECIALIST,Perks.PERK_PLAYER_NINJA,Perks.PERK_WEAPON_ACCURACY,Perks.PERK_WEAPON_SHRAPNEL,Perks.PERK_WEAPON_QUICKDRAW,Perks.PERK_WEAPON_AGGRESSION,Perks.PERK_WEAPON_RELOAD,Perks.PERK_WEAPON_VAMPIRE,Perks.PERK_WEAPON_STOPPING_POWER];this.createHelicopter(p,Battlezone.TEAM_AIRDROPS,{type:Helicopter.TYPE_MH6,playerId:null,destination:m,items:[{type:"crate",crateType:Crate.CRATE_PERK,perkId:_[this.Random(0,_.length-1)]}],scale:1});break;case 3:var A=[],I=this.Random(1,3);for(o=0;o<I;o++){var T=this.getRandomWeapon(!0),R=this.getRandomMods(T);this.applyWeaponMods(T,R),null!=T.ammo&&T.magSize,A.push(T)}this.createHelicopter(p,Battlezone.TEAM_AIRDROPS,{type:Helicopter.TYPE_MH6,playerId:null,destination:m,items:[{type:"crate",crateType:Crate.CRATE_WEAPON,items:A}],scale:1});break;case 4:var S=[Killstreaks.KILLSTREAK_AIRSTRIKE,Killstreaks.KILLSTREAK_NAPALM,Killstreaks.KILLSTREAK_STEALTH_BOMBER,Killstreaks.KILLSTREAK_SAM_TURRET_PLACE,Killstreaks.KILLSTREAK_SENTRY_GUN_PLACE,Killstreaks.KILLSTREAK_REMOTE_TURRET,Killstreaks.KILLSTREAK_ADVANCED_TURRET,Killstreaks.KILLSTREAK_GRENADE_TURRET,Killstreaks.KILLSTREAK_EMP];this.createHelicopter(p,Battlezone.TEAM_AIRDROPS,{type:Helicopter.TYPE_MH6,playerId:null,destination:m,items:[{type:"crate",crateType:Crate.CRATE_KILLSTREAK,killstreakId:S[this.Random(0,S.length-1)]}],scale:1});break;case 5:this.createHelicopter(p,Battlezone.TEAM_AIRDROPS,{type:Helicopter.TYPE_MH6,playerId:null,destination:m,items:[{type:"crate",crateType:Crate.CRATE_SHARD,shards:1}],scale:1});break;case 6:this.createHelicopter(p,Battlezone.TEAM_AIRDROPS,{type:Helicopter.TYPE_MH6,playerId:null,destination:m,items:[{type:"crate",crateType:Crate.CRATE_XP,xp:this.RoundToNearest(this.Random(5e3,25e3))}],scale:1});break;case 7:this.createHelicopter(p,Battlezone.TEAM_AIRDROPS,{type:Helicopter.TYPE_MH6,playerId:null,destination:m,items:[{type:"crate",crateType:Crate.CRATE_LIFE,lives:1}],scale:1});break;default:this.createHelicopter(p,Battlezone.TEAM_AIRDROPS,{type:Helicopter.TYPE_MH6,playerId:null,destination:m,items:[{type:"crate",crateType:Crate.CRATE_AMMO}],scale:1})}}}}break;case GameMode.DEMOLITION:if(a.bBombPlanted){var v=!0;if(a.bombTimer>0)a.bombTimer--;else if(0==a.bombTimer){a.bombTimer=-1;var u=this.getBombCrate();u&&(this.createExplosion({eventId:GameServer.EVENT_SPAWN_EXPLOSION,x:u.position[0],y:u.position[1],radius:500,damage:1e3,causerId:u.data.id,playerId:u.data.planterId,weaponId:"bomb"}),this.removeNextStep(u)),this.winRound(MatchState.END_CONDITION_BOMB,a.bombTeam,1,{id:u.data.planterId})}this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{bombTimer:a.bombTimer}})}else e.gameTimer--;break;default:e.gameTimer--}if(this.onEvent({eventId:GameServer.EVENT_GAME_TIMER,timer:e.gameTimer,bTimerPaused:v}),e.gameTimer<0){var b=e.timer_game;if(clearInterval(b),delete e.timer_game,null!=e.gameModeData.round)switch(e.gameModeData.id){case GameMode.HEADQUARTERS:this.winRound(MatchState.END_CONDITION_TIME,null);break;case GameMode.ASSASSINATION:this.winRound(MatchState.END_CONDITION_TIME,0==a.vipTeam?0:1,1);break;case GameMode.RESCUE:this.winRound(MatchState.END_CONDITION_TIME,0==a.rescueTeam?1:0,1);break;case GameMode.DEMOLITION:this.winRound(MatchState.END_CONDITION_TIME,0==a.bombTeam?1:0,1)}else{var y={eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_TIME};switch(e.gameModeData.id){case GameMode.INFECTED:case GameMode.DEMOLITION:y.winningTeam=0;break;case GameMode.BATTLEZONE:if((D=this.getPlayerStates()).sort((function(e,a){return e.shards<a.shards?1:e.shards>a.shards?-1:e.xp<a.xp?1:e.xp>a.xp?-1:e.kills<a.kills?1:e.kills>a.kills?-1:e.lives<a.lives?1:e.lives>a.lives?-1:0})),D.length>0)D[0].lives>0&&(y.winningTeam=D[0].team);break;case GameMode.GUN_GAME:(D=this.getPlayerStates()).sort((function(e,a){return e.gunIndex<a.gunIndex?1:e.gunIndex>a.gunIndex?-1:e.gunKills<a.gunKills?1:e.gunKills>a.gunKills?-1:e.kills<a.kills?1:e.kills>a.kills?-1:0})),D.length>0&&(D.length>1&&D[1].kills===D[0].kills?y.winningTeam=-1:y.winningTeam=D[0].team);break;case GameMode.DEATHMATCH:var D;(D=this.getPlayerStates()).sort((function(e,a){return e.kills<a.kills?1:e.kills>a.kills?-1:0})),D.length>0&&(D.length>1&&D[1].kills===D[0].kills?y.winningTeam=-1:y.winningTeam=D[0].team);break;default:var g=e.gameModeData.scores;g&&(g[0]>g[1]?y.winningTeam=0:g[1]>g[0]?y.winningTeam=1:y.winningTeam=-1)}this.requestEvent(y)}}}}addScore(e,a){if(null!=e&&-1!=e){var t=this.localData.gameModeData;t.scores[e]=Math.min(t.scoreLimit,t.scores[e]+a)}}winRound(e,a,t,r){this.localData.timer_game&&(clearInterval(this.localData.timer_game),delete this.localData.timer_game);var i=this.localData.gameModeData;if(null!=a&&-1!=a){0!=t&&this.addScore(a,t);i.scores[a]}var s=i.scores;if(i.bUseRoundThreshold){Math.ceil(.5*i.numRounds);var o=Math.ceil(.5*i.scoreLimit)}if(s[0]>=i.scoreLimit||s[1]>=i.scoreLimit)this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_SCORE,winningTeam:s[0]>s[1]?0:1,gameModeData:{scores:i.scores}});else if(i.bUseRoundThreshold&&(s[0]>=o&&s[1]<s[0]||s[1]>=o&&s[0]<s[1]))this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_SCORE,winningTeam:s[0]>s[1]?0:1,gameModeData:{scores:i.scores}});else if(i.round+1>=i.numRounds){var l=-1;i.scores[0]>i.scores[1]?l=0:i.scores[0]<i.scores[1]&&(l=1),this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_SCORE,winningTeam:l,gameModeData:{scores:i.scores}})}else{this.requestEvent({eventId:GameServer.EVENT_ROUND_END,condition:e,winningTeam:a,playerSpotlight:r,gameModeData:{scores:i.scores}}),setTimeout(this.prepareRound.bind(this),3e3),i.round++,i.bAllowRespawns=!1;for(var n=0;n<this.localData.playerStates.length;n++){var d=this.localData.playerStates[n];d&&(d.bCanRespawn=!1,d.bWaitingToRespawn=!1,d.desiredClassData.killstreak==Killstreaks.TYPE_PERKS&&(d.currentKillstreak=0))}}}prepareRound(){if(!this.matchHasEnded()){for(var e=this.localData.killstreaks,a=0;a<e.length;a++){e[a].timer=0}var t=this.getPawns().concat(this.getAllCrates()).concat(this.getDroppedWeapons()).concat(this.getEquipment()).concat(this.getGrenades()).concat(this.getScavengerPacks());t=t.concat(this.getObstaclesWithHealth());for(a=0;a<t.length;a++)this.removeObject(t[a]);var r=this.getCurrentMapData();switch(this.localData.gameModeData.id){case GameMode.HEADQUARTERS:var i=this.getAllDominationFlags()[0];i&&this.resetFlag(i);var s=r.flags_headquarters;s&&(i.position=s[this.Random(0,s.length-1)]);break;case GameMode.DEMOLITION:this.localData.gameModeData.bBombPlanted=!1;break;case GameMode.RESCUE:this.localData.gameModeData.numHostages=2}setTimeout(this.startRound.bind(this),5e3)}}startRound(){if(this.localData){var e=this.localData,a=e.gameModeData;if(a.bAllowRespawns=!0,a.bFirstBlood=!1,a.firstBloodPlayerId=null,e.gameModeData.timeLimit){e.gameTimer=e.gameModeData.timeLimit;var t=setInterval(this.onGameTimer.bind(this),1e3);e.timer_game=t}var r=this.getCurrentMapData().objects;if(r)for(var i=0;i<r.length;i++){var s=r[i];switch(s.type){case"obstacle":"barrel_explosive"==s.obstacleId&&this.createObstacle(s)}}var o=this.getDoors();for(i=0;i<o.length;i++){var l=o[i];this.setDoorClosed(l,!0,null,!1,!0)}switch(a.id){case GameMode.HEADQUARTERS:a.hqTeam=null;break;case GameMode.DEMOLITION:a.bombTimer=null,a.bombTeam=0==a.bombTeam?1:0,a.bBombPlanted=!1,this.getBombCrate()||this.createBombCrate(a.bombTeam);break;case GameMode.ASSASSINATION:a.vipTeam=0==a.vipTeam?1:0;break;case GameMode.RESCUE:a.rescueTeam=0==a.rescueTeam?1:0,a.numHostages=2}e.matchState=MatchState.STATE_PRE_GAME,e.preGameTimer=10;var n=setInterval(this.onPreGameTimer.bind(this),1e3);e.timer_preGame=n,this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:e.gameModeData}),this.onEvent({eventId:GameServer.EVENT_GAME_PRE_TIMER,timer:e.preGameTimer}),this.requestEvent({eventId:GameServer.EVENT_ROUND_START,round:a.round});var d=this.localData.playerStates;for(i=0;i<d.length;i++)this.requestEvent({eventId:GameServer.EVENT_PLAYER_RESPAWN,playerId:d[i].id});this.onRoundStart()}}rescueHostage(e,a){var t=this.getPlayerStateById(a);t&&(t.score++,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:t.id,data:{score:t.score}}));var r={bHostageRescued:1,playerId:a};switch(this.localData.gameModeData.id){case GameMode.OP_HOSTAGE:this.localData.gameModeData.numHostages--,(i=Math.min(this.localData.gameModeData.numHostages,this.getNumHostages()-1))<=0?this.requestEvent({eventId:GameServer.EVENT_GAME_END,condition:MatchState.END_CONDITION_HOSTAGES_RESCUED,winningTeam:0}):r.numHostages=i;break;case GameMode.RESCUE:var i;this.localData.gameModeData.numHostages--,(i=this.getNumHostages()-1)<=0&&this.winRound(MatchState.END_CONDITION_HOSTAGES_RESCUED,this.localData.gameModeData.rescueTeam,1),r.numHostages=i}this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:r}),this.removeNextStep(e)}getHostages(){for(var e=[],a=this.getPawns(),t=0;t<a.length;t++)a[t].data.bHostage&&e.push(a[t]);return e}getNumHostages(){return this.getHostages().length}onRoundStart(){switch(this.localData.gameModeData.id){case GameMode.ASSASSINATION:var e=this.clone(this.localData.playerStates);this.shuffleArray(e);for(var a=0;a<e.length;a++){var t=e[a];if(t.team==this.localData.gameModeData.vipTeam){this.makePlayerVIP(t.id);break}}break;case GameMode.RESCUE:var r=this.getCurrentMapData().spawns_hostages;if(r)for(a=0;a<r.length;a++)this.createSandboxUnit({unitId:SurvivalEnemyType.HOSTAGE,team:99,pos:r[a]});else console.warn("Missing hostage spawn points")}}onPreGameTimer(){var e=this.localData;if(!e.bPaused)if(e.preGameTimer--,e.preGameTimer<0){var a=e.timer_preGame;clearInterval(a),delete e.timer_preGame,delete e.preGameTimer;for(var t=this.localData.playerStates,r=0;r<t.length;r++){var i=t[r];i.bAutoRespawn=!0,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:i.id,data:{bAutoRespawn:i.bAutoRespawn}})}this.localData.matchState=MatchState.STATE_IN_PROGRESS,this.requestEvent({eventId:GameServer.EVENT_GAME_START,timer:e.gameTimer})}else this.onEvent({eventId:GameServer.EVENT_GAME_PRE_TIMER,timer:e.preGameTimer})}onInfectedTimer(){var e=this.localData;if(!e.bPaused){var a=e.gameModeData;if(a.intermissionTimer--,a.intermissionTimer<0){var t=e.timer_wave;clearInterval(t),delete e.timer_wave;var r=this.Random(0,this.localData.playerStates.length-1),i=this.localData.playerStates[r];this.makePlayerInfected(i.id),a.bFirstInfected=!0}this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{intermissionTimer:e.gameModeData.intermissionTimer}})}}makePlayerVIP(e){var a=this.getPlayerStateById(e);if(a){var t=this.getObjectById(a.id);if(t&&t.data.health){t.data.bVIP=!0,t.data.bNoPickups=!0,a.bVIP=!0,this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:a.id,type:GameServer.INV_PERKS_SET,perks:[Perks.PERK_PLAYER_JUGGERNAUT],bRemoveEquipment:!0});var r=this.getWeaponData("p320");this.applyWeaponMods(r,{barrel:"barrel_laser"}),this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:a.id,type:GameServer.INV_INVENTORY_REPLACE,inventory:[r]});var i=this.getWeaponData("smoke");this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:a.id,index:2,value:i.id,type:GameServer.INV_EQUIPMENT_SET,ammo:1}),this.pushObjectDataUpdate(t.data.id,["bVIP","bNoPickups"])}a.desiredAvatarData||(a.desiredAvatarData=a.avatarData);var s={body:Character.BODY_VIP,head:Character.HEAD_NONE,face:Character.FACE_DEFAULT,facewear:Character.FACEWEAR_NONE,eyewear:Character.EYEWEAR_NONE,hair:Character.HAIR_SHORT,hairColour:Character.HAIR_COLOUR_BROWN,beard:Character.BEARD_NONE,melee:"melee_knife"};a.avatarData=s,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:a.id,data:{team:a.team,bVIP:a.bVIP,avatarData:a.avatarData}})}}makePlayerJuggernaut(e,a){var t=this.getPlayerStateById(e);if(t){var r=this.getObjectById(t.id);if(r&&r.data.health){switch(r.data.bJuggernaut=!0,t.bJuggernaut=!0,this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:t.id,type:GameServer.INV_PERKS_SET,perks:[Perks.PERK_PLAYER_JUGGERNAUT,Perks.PERK_WEAPON_SHRAPNEL],bRemoveEquipment:!0}),a){case Killstreaks.KILLSTREAK_JUGGERNAUT:var i=this.getWeaponData("m240");i.ammo*=3,this.applyWeaponMods(i,{barrel:Mods.BARREL_GRIP});var s=[i],o=this.getWeaponData("frag"),l=2;break;case Killstreaks.KILLSTREAK_JUGGERNAUT_RECON:var n=this.getWeaponData("magnum");n.ammo=10*n.magSize,this.applyWeaponMods(n,{barrel:Mods.BARREL_LASER,ammo:Mods.AMMO_FMJ});s=[n,this.getWeaponData("riot_shield")];o=this.getWeaponData("smoke")}s&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:t.id,type:GameServer.INV_INVENTORY_REPLACE,inventory:s}),o&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:t.id,index:2,value:o.id,type:GameServer.INV_EQUIPMENT_SET,ammo:l}),this.pushObjectDataUpdate(r.data.id,["bJuggernaut"])}t.desiredAvatarData||(t.desiredAvatarData=t.avatarData);var d={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_BALD,beard:Character.BEARD_NONE,face:Character.FACE_DEFAULT,head:Character.HEAD_JUGGERNAUT_HELMET,body:Character.BODY_JUGGERNAUT,facewear:Character.FACEWEAR_MASK,melee:"melee_bowie"};t.avatarData=d,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:t.id,data:{team:t.team,bJuggernaut:t.bJuggernaut,avatarData:t.avatarData}})}}makePlayerInfected(e){if(s=this.getPlayerStateById(e)){s.team=1,s.bInfected=!0;var a=this.getObjectById(s.id);if(a&&a.data.health){a.data.team=1,a.data.bZombie=!0,a.data.zombieType=Zombie.TYPE_SPRINTER,this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:s.id,type:GameServer.INV_PERKS_SET,perks:this.localData.gameModeData.infectedPerks});var t=this.getWeaponData(this.localData.gameModeData.infectedWeapon.id);this.applyWeaponMods(t,this.localData.gameModeData.infectedWeapon.mods),this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:s.id,index:0,type:GameServer.INV_ITEM_REPLACE,item:t}),this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:s.id,index:2,value:this.localData.gameModeData.infectedEquipment,type:GameServer.INV_EQUIPMENT_SET}),this.pushObjectDataUpdate(a.data.id,["bZombie","zombieType","team","perks"])}s.avatarData={hairColour:Character.HAIR_COLOUR_BLACK,hair:Character.HAIR_BALD,beard:Character.BEARD_NONE,face:Character.FACE_ZOMBIE_SPRINTER,head:Character.HEAD_NONE,body:Character.BODY_ZOMBIE_SPRINTER},this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:s.id,data:{team:s.team,bInfected:s.bInfected,avatarData:s.avatarData}}),this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{bInfected:!0,playerId:s.id}})}var r=this.getNumInfected();if(this.localData.playerStates.length-r==1)for(var i=0;i<this.localData.playerStates.length;i++){var s;if((s=this.localData.playerStates[i])&&!s.bInfected){this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:s.id,type:GameServer.INV_PERKS_SET,perks:[Perks.PERK_PLAYER_LIGHTWEIGHT,Perks.PERK_PLAYER_SCAVENGER,Perks.PERK_WEAPON_RELOAD]});break}}}onWaveTimer(){var e=this.localData;if(!e.bPaused){var a=e.gameModeData;if(a.intermissionTimer--,a.intermissionTimer<0){var t=e.timer_wave;clearInterval(t),delete e.timer_wave,a.wave++,a.waveKills=0,a.waveHeadshots=0,a.waveMelees=0,a.enemiesSpawned=0;var r,i,s=1,o=a.wave,l=3e3,n=200;switch(a.id){case GameMode.SURVIVAL_STAKEOUT:if(5==o?(s=2,r="chopper"):o%5==0?(s=3*(o/5-1),r="juggernauts"):(s=10*o,8==o&&(r="claymores")),o>=5&&o%5!=0&&o%2==0){var d=this.localData.playerStates[this.Random(0,this.localData.playerStates.length-1)];if(d){var E=this.getRandomAirdropPosition();this.executePlayerKillstreak(d.id,Killstreaks.KILLSTREAK_ESCORT_AIRDROP_SURVIVAL,E[0],E[1]+200,!0)}}break;case GameMode.SURVIVAL_BASIC:l=4e3,15==o?(s=2,r="chopper"):o%10==0?(i=1e3,s=o/10*2,r="juggernauts"):5==o?(s=o/5,r="chopper"):(s=5*o,8==o&&(r="claymores"));break;case GameMode.SURVIVAL_UNDEAD:l=2500,s=3==o?2:5==o?8:10==o?10:15==o?2:5*o;break;case GameMode.SURVIVAL_CHAOS:l=2e3,n=100,20!==o&&25!==o&&o%5==0?(i=3e3-o/5*500,s=o/5*3,r="juggernauts"):(s=5*o,4==o&&(r="claymores"));break;case GameMode.SURVIVAL_PRO:l=1500,n=100,s=5*o}if(a.enemies=Math.ceil(Math.min(Math.max(1,s),100)),a.enemiesRemaining=a.enemies,!i){var h=this.getPlayerStates().length;h>1&&(l=Math.round(l/h)),i=Math.max(n,l-100*Math.min(100,a.wave))}t=setInterval(this.onWaveSpawnTimer.bind(this),i),e.timer_waveSpawn=t,this.onEvent({eventId:GameServer.EVENT_GAME_WAVE_START,waveType:r})}this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{intermissionTimer:a.intermissionTimer,wave:a.wave,enemies:a.enemies,enemiesRemaining:a.enemiesRemaining}})}}onWaveSpawnTimer(){var e=this.localData;if(!e.bPaused){var a=e.gameModeData;if(a.enemiesSpawned<a.enemies){if(e.deadswitchCooldownTimer>0)return;var t=this.getPawns(1),r=Math.min(8,a.wave-1+5);if(t.length>=r)return;a.enemiesSpawned++;var i=this.getCurrentMapData(),s=a.wave+"_"+a.enemiesSpawned,o=i.spawns_survival,l=this.Random(0,o.length-1),n=o[l][0],d=o[l][1],E=Math.min(101,a.wave),h={},c=null,m=null,p=1+Math.floor(E/10)+Math.floor(E/20);switch(E>10&&(p+=Math.max(0,.1*(E-10))),E>20&&(p+=Math.max(0,.1*(E-20))),a.id){case GameMode.SURVIVAL_STAKEOUT:p*=.75,5===E?h[SurvivalEnemyType.HELI_MH6]=1:E%5==0?(h[SurvivalEnemyType.JUGGERNAUT]=3,E>=10&&(h[SurvivalEnemyType.JUGGERNAUT_COMMANDER]=1),E>=15&&(h[SurvivalEnemyType.JUGGERNAUT_JAVELIN]=1,h[SurvivalEnemyType.INFESTOR_KING]=1),E>=20&&(h[SurvivalEnemyType.INFESTOR_KING]=1)):(h[SurvivalEnemyType.OPFOR_PISTOL]=E,h[SurvivalEnemyType.ZOMBIE_DEFAULT]=E,E>=2&&(h[SurvivalEnemyType.OPFOR_BASIC]=E),E>=3&&(h[SurvivalEnemyType.ZOMBIE_FAT]=.1*E,h[SurvivalEnemyType.OPFOR_HEAVY]=.5*E,h[SurvivalEnemyType.RUS_BASIC]=E),E>=5&&(h[SurvivalEnemyType.ZOMBIE_SPRINTER]=3*E,h[SurvivalEnemyType.RUS_HARD]=E,h[SurvivalEnemyType.HELI_DRAGONFIRE]=.5*E),E>=6&&(h[SurvivalEnemyType.ZOMBIE_EXPLODER]=E*E,h[SurvivalEnemyType.RUS_SNIPER]=E),E>=8&&(h[SurvivalEnemyType.RUS_CLAYMORE]=.5*E,h[SurvivalEnemyType.ZOMBIE_SPITTER]=E*E,h[SurvivalEnemyType.RUS_EXPERT]=E),E>=10&&(h[SurvivalEnemyType.INFESTOR]=E*E,h[SurvivalEnemyType.ZOMBIE_MELEE]=E,h[SurvivalEnemyType.ZOMBIE_SPRINTER_MELEE]=.5*E,h[SurvivalEnemyType.OPFOR_RPG]=.1*E,h[SurvivalEnemyType.HELI_MH6]=.5*E,h[SurvivalEnemyType.RUS_MELEE]=E),E>=12&&(h[SurvivalEnemyType.ZOMBIE_EXPLODER_BOSS]=2*E,h[SurvivalEnemyType.RUS_SHIELD]=3*E,h[SurvivalEnemyType.ZOMBIE_SPRINTER_BOSS]=E*E),E>=13&&(h[SurvivalEnemyType.ZOMBIE_SPITTER_BOSS]=E*E),E>=13&&(h[SurvivalEnemyType.ZOMBIE_FAT_THUMPER]=2*E),E>=15&&(h[SurvivalEnemyType.INFESTOR_KING]=.25*E,h[SurvivalEnemyType.JUGGERNAUT]=.5*E,h[SurvivalEnemyType.HELI_COBRA]=.5*E,h[SurvivalEnemyType.ZOMBIE_RPG]=.5*E,h[SurvivalEnemyType.RUS_EXPLOSIVES]=.1*E),E>=18&&(h[SurvivalEnemyType.HELI_PAVE_LOW]=E*E*.2,h[SurvivalEnemyType.JUGGERNAUT_COMMANDER]=.5*E),E>=20&&(h[SurvivalEnemyType.JUGGERNAUT_JAVELIN]=.5*E,h[SurvivalEnemyType.HELI_PAVE_LOW]+=.1*E,h[SurvivalEnemyType.HELI_COBRA]+=.1*E,h[SurvivalEnemyType.JUGGERNAUT_COMMANDER]+=.2*E,h[SurvivalEnemyType.ZOMBIE_RIFLE]=E),E>=21&&(h[SurvivalEnemyType.INFESTOR_KING]+=E,h[SurvivalEnemyType.INFESTOR]+=E*E)),c=this.getRandomProperty(h),m=SurvivalEnemyInfo[c];break;case GameMode.SURVIVAL_PRO:p*=2;var _=this.localData.gameModeData.enemiesSpawned,A=this.localData.gameModeData.enemies;_%Math.max(Math.round(.5*A),Math.round(.5*A-E*E))==0?(p*=10+E,h[Heroes.OBSV32]=1,h[Heroes.VALIANT25]=1,h[Heroes.ARI]=1,h[Heroes.KARAMBITGUY]=1,h[Heroes.ERIC]=1,h[Heroes.TWOPLAYER]=1,h[Heroes.MOUSSA]=1,E>=10&&(h[Heroes.XWILKINX]=1),c=this.getRandomProperty(h),m=SurvivalEnemyInfo[c]):(h[SurvivalEnemyType.OPFOR_BASIC]=1,h[SurvivalEnemyType.OPFOR_HEAVY]=1,h[SurvivalEnemyType.ZOMBIE_SPRINTER]=1,h[SurvivalEnemyType.INFESTOR]=1,h[SurvivalEnemyType.HELI_MH6]=1,h[SurvivalEnemyType.HELI_DRAGONFIRE]=1,E>=5&&(h[SurvivalEnemyType.ZOMBIE_MELEE]=1,h[SurvivalEnemyType.ZOMBIE_SPRINTER_MELEE]=1,h[SurvivalEnemyType.RUS_HARD]=1,h[SurvivalEnemyType.RUS_EXPERT]=1,h[SurvivalEnemyType.RUS_SNIPER]=1,h[SurvivalEnemyType.ZOMBIE_EXPLODER]=1,h[SurvivalEnemyType.ZOMBIE_SPITTER]=1,h[SurvivalEnemyType.HELI_COBRA]=1+.1*E,h[SurvivalEnemyType.OPFOR_RPG]=1,h[SurvivalEnemyType.ZOMBIE_RPG]=1,h[SurvivalEnemyType.JUGGERNAUT]=1,h[SurvivalEnemyType.RUS_MELEE]=1),E>=10&&(h[SurvivalEnemyType.RUS_SHIELD]=1,h[SurvivalEnemyType.RUS_CLAYMORE]=1,h[SurvivalEnemyType.RUS_EXPLOSIVES]=1,h[SurvivalEnemyType.ZOMBIE_EXPLODER_BOSS]=1,h[SurvivalEnemyType.ZOMBIE_SPITTER_BOSS]=1,h[SurvivalEnemyType.HELI_SCOUT]=1,h[SurvivalEnemyType.HELI_CHOPPER_GUNNER]=1,h[SurvivalEnemyType.JUGGERNAUT_COMMANDER]=1,h[SurvivalEnemyType.ZOMBIE_SPRINTER_BOSS]=E*E),E>=15&&(h[SurvivalEnemyType.INFESTOR_KING]=E,h[SurvivalEnemyType.HELI_PAVE_LOW]=.5*E,h[SurvivalEnemyType.HELI_SNIPER]=1,h[SurvivalEnemyType.JUGGERNAUT_JAVELIN]=.5*E),E>=20&&(h[SurvivalEnemyType.HELI_OSPREY]=1),E>=22&&(h[SurvivalEnemyType.HELI_REAPER]=1),c=this.getRandomProperty(h),m=SurvivalEnemyInfo[c]);break;case GameMode.SURVIVAL_CHAOS:p*=2,E%30==0?(h[SurvivalEnemyType.INFESTOR]=4,h[SurvivalEnemyType.INFESTOR_KING]=1,h[SurvivalEnemyType.JUGGERNAUT]=1,h[SurvivalEnemyType.JUGGERNAUT_COMMANDER]=1,h[SurvivalEnemyType.JUGGERNAUT_JAVELIN]=1,c=this.getRandomProperty(h)):E%25==0?(h[SurvivalEnemyType.JUGGERNAUT_COMMANDER]=1,h[SurvivalEnemyType.INFESTOR_KING]=1,h[SurvivalEnemyType.ZOMBIE_RPG]=1,h[SurvivalEnemyType.ZOMBIE_RIFLE]=1,h[SurvivalEnemyType.OPFOR_RPG]=1,c=this.getRandomProperty(h)):E%20==0?(h[SurvivalEnemyType.JUGGERNAUT_COMMANDER]=1,h[SurvivalEnemyType.ZOMBIE_SPITTER]=1,h[SurvivalEnemyType.ZOMBIE_SPITTER_BOSS]=1,h[SurvivalEnemyType.HELI_MH6]=2,h[SurvivalEnemyType.HELI_COBRA]=1,c=this.getRandomProperty(h)):E%5==0?5===E?c=SurvivalEnemyType.JUGGERNAUT:(h[SurvivalEnemyType.INFESTOR_KING]=3+.2*E,h[SurvivalEnemyType.JUGGERNAUT]=2,h[SurvivalEnemyType.JUGGERNAUT_COMMANDER]=1+.1*E,c=this.getRandomProperty(h)):(h[SurvivalEnemyType.ZOMBIE_SPRINTER]=E*E*.5,h[SurvivalEnemyType.RUS_BASIC]=3*E,h[SurvivalEnemyType.RUS_HARD]=2*E,E>=2&&(h[SurvivalEnemyType.ZOMBIE_EXPLODER]=3*E),E>=3&&(h[SurvivalEnemyType.ZOMBIE_SPITTER]=4*E+E),E>=4&&(h[SurvivalEnemyType.RUS_CLAYMORE]=E),E>=5&&(h[SurvivalEnemyType.HELI_MH6]=.5*Math.round(E*E)),E>=6&&(h[SurvivalEnemyType.INFESTOR]=E*E*.8),E>=7&&(h[SurvivalEnemyType.RUS_EXPERT]=2*E),E>=8&&(h[SurvivalEnemyType.RUS_SNIPER]=Math.round(1.5*E)),E>=9&&(h[SurvivalEnemyType.OPFOR_RPG]=E,h[SurvivalEnemyType.ZOMBIE_FAT_THUMPER]=2*E),E>=10&&(h[SurvivalEnemyType.ZOMBIE_MELEE]=E,h[SurvivalEnemyType.ZOMBIE_SPRINTER_MELEE]=.5*E,h[SurvivalEnemyType.ZOMBIE_SPITTER_BOSS]=5*E+E,h[SurvivalEnemyType.RUS_SHIELD]=3*E,h[SurvivalEnemyType.HELI_DRAGONFIRE]=E,h[SurvivalEnemyType.RUS_MELEE]=E,h[SurvivalEnemyType.ZOMBIE_SPRINTER_BOSS]=E*E),E>=11&&(h[SurvivalEnemyType.JUGGERNAUT]=E),E>=12&&(h[SurvivalEnemyType.INFESTOR_KING]=3*E),E>=13&&(h[SurvivalEnemyType.ZOMBIE_EXPLODER_BOSS]=E*E),E>=14&&(h[SurvivalEnemyType.ZOMBIE_RPG]=2*E),E>=15&&(h[SurvivalEnemyType.HELI_COBRA]=.5*Math.round(E*E),h[SurvivalEnemyType.HELI_CHOPPER_GUNNER]=E,h[SurvivalEnemyType.HELI_SCOUT]=E),E>=16&&(h[SurvivalEnemyType.OPFOR_RPG]+=E*E),E>=20&&(h[SurvivalEnemyType.JUGGERNAUT_COMMANDER]=E*E*.5,h[SurvivalEnemyType.JUGGERNAUT_JAVELIN]=E*E*.25,h[SurvivalEnemyType.HELI_PAVE_LOW]=2*E,h[SurvivalEnemyType.HELI_SNIPER]=E,h[SurvivalEnemyType.ZOMBIE_RIFLE]=E,h[SurvivalEnemyType.RUS_EXPLOSIVES]=E),E>=21&&(h[SurvivalEnemyType.HELI_COBRA]+=E),E>=22&&(h[SurvivalEnemyType.INFESTOR_KING]+=E*E*2),E>=23&&(h[SurvivalEnemyType.HELI_PAVE_LOW]+=E*E,h[SurvivalEnemyType.HELI_OSPREY]=1),E>=25&&(h[SurvivalEnemyType.HELI_REAPER]=1),c=this.getRandomProperty(h)),m=SurvivalEnemyInfo[c];break;case GameMode.SURVIVAL_BASIC:p*=.75,15==E?c=SurvivalEnemyType.HELI_COBRA:E%10==0?(h[SurvivalEnemyType.JUGGERNAUT]=E,h[SurvivalEnemyType.JUGGERNAUT_COMMANDER]=E*E,h[SurvivalEnemyType.JUGGERNAUT_JAVELIN]=E*E*.1,c=this.getRandomProperty(h)):5==E?c=SurvivalEnemyType.HELI_MH6:(h[SurvivalEnemyType.OPFOR_PISTOL]=E,E>=2&&(h[SurvivalEnemyType.OPFOR_BASIC]=2*E),E>=3&&(h[SurvivalEnemyType.OPFOR_HEAVY]=E),E>=5&&(h[SurvivalEnemyType.HELI_MH6]=.5*E),E>=6&&(h[SurvivalEnemyType.RUS_BASIC]=E*E),E>=7&&(h[SurvivalEnemyType.RUS_EXPERT]=2*E),E>=8&&(h[SurvivalEnemyType.RUS_CLAYMORE]=E),E>=10&&(h[SurvivalEnemyType.RUS_HARD]=E*E,h[SurvivalEnemyType.HELI_DRAGONFIRE]=E,h[SurvivalEnemyType.RUS_MELEE]=E*E),E>=11&&(h[SurvivalEnemyType.RUS_SNIPER]=1.5*E),E>=12&&(h[SurvivalEnemyType.JUGGERNAUT]=.5*E),E>=13&&(h[SurvivalEnemyType.OPFOR_RPG]=E*E*.2),E>=14&&(h[SurvivalEnemyType.JUGGERNAUT_COMMANDER]=E),E>=15&&(h[SurvivalEnemyType.HELI_COBRA]=E*E*.5,h[SurvivalEnemyType.JUGGERNAUT]+=E,h[SurvivalEnemyType.HELI_SCOUT]=E),E>=16&&(h[SurvivalEnemyType.RUS_SHIELD]=E*E*.5),E>=18&&(h[SurvivalEnemyType.RUS_EXPLOSIVES]=E*E*.1,h[SurvivalEnemyType.HELI_PAVE_LOW]=E*E,h[SurvivalEnemyType.HELI_CHOPPER_GUNNER]=E,h[SurvivalEnemyType.HELI_SNIPER]=E,h[SurvivalEnemyType.JUGGERNAUT_JAVELIN]=E),E>=20&&(h[SurvivalEnemyType.HELI_OSPREY]=E),E>=22&&(h[SurvivalEnemyType.HELI_REAPER]=E),c=this.getRandomProperty(h)),m=SurvivalEnemyInfo[c];break;case GameMode.SURVIVAL_UNDEAD:3==E?c=SurvivalEnemyType.ZOMBIE_FAT:5==E?c=SurvivalEnemyType.ZOMBIE_SPRINTER:10==E?c=SurvivalEnemyType.INFESTOR:15==E?c=SurvivalEnemyType.INFESTOR_KING:(h[SurvivalEnemyType.ZOMBIE_DEFAULT]=3*E,E>=3&&(h[SurvivalEnemyType.ZOMBIE_FAT]=.5*E),E>=4&&(h[SurvivalEnemyType.ZOMBIE_MELEE]=.1*E),E>=5&&(h[SurvivalEnemyType.ZOMBIE_SPRINTER]=E*E),E>=6&&(h[SurvivalEnemyType.ZOMBIE_EXPLODER]=E),E>=7&&(h[SurvivalEnemyType.ZOMBIE_SPRINTER_BOSS]=E*E),E>=8&&(h[SurvivalEnemyType.ZOMBIE_SPITTER]=2*E),E>=9&&(h[SurvivalEnemyType.ZOMBIE_FAT_THUMPER]=E),E>=10&&(h[SurvivalEnemyType.ZOMBIE_JUGGERNAUT]=E*E*.5,h[SurvivalEnemyType.ZOMBIE_MELEE]+=E,h[SurvivalEnemyType.ZOMBIE_SPRINTER_MELEE]=.5*E,h[SurvivalEnemyType.INFESTOR]=E*E),E>=11&&(h[SurvivalEnemyType.ZOMBIE_RPG]=E),E>=12&&(h[SurvivalEnemyType.ZOMBIE_EXPLODER_BOSS]=E*E),E>=15&&(h[SurvivalEnemyType.ZOMBIE_JUGGERNAUT_MERC]=E,h[SurvivalEnemyType.ZOMBIE_JUGGERNAUT]+=E*E,h[SurvivalEnemyType.ZOMBIE_SHIELD]=E*E*.5,h[SurvivalEnemyType.ZOMBIE_SPITTER_BOSS]=E*E,h[SurvivalEnemyType.ZOMBIE_RPG]+=E*E,h[SurvivalEnemyType.ZOMBIE_FAT_THUMPER]+=E*E),E>=20&&(h[SurvivalEnemyType.INFESTOR_KING]=E*E*2,h[SurvivalEnemyType.ZOMBIE_RPG]=2*E),E>=22&&(h[SurvivalEnemyType.INFESTOR]+=E*E),E>=23&&(h[SurvivalEnemyType.INFESTOR_KING]+=E*E),E>=25&&(h[SurvivalEnemyType.ZOMBIE_SPITTER_BOSS]=E*E,h[SurvivalEnemyType.ZOMBIE_RPG]+=E*E,h[SurvivalEnemyType.ZOMBIE_FAT_THUMPER]+=E*E),c=this.getRandomProperty(h)),m=SurvivalEnemyInfo[c]}var I=m.botSkill;a.id==GameMode.SURVIVAL_PRO&&(I+=2);var T=this.getPlayerStates().length>1?5:10;switch(E>T&&(I=Math.min(Math.max(BotSkill.SKILL_EASY,Math.floor(m.botSkill+E/T)),BotSkill.SKILL_INSANE)),m.type){case"helicopter":var R=this.createHelicopter([this.RandomBoolean()?0:i.width,0],1,{type:m.helicopterType,destination:[.5*i.width,.5*i.height],killReward:m.killReward});E>=15&&(R.data.health+=100*(E-15)),R.data.bControllable=!1,R.data.bBot=!0,R.data.bPlayerControlled=!1,R.data.bAirdrop=!1,R.data.bMaxLookRange=!0,R.data.bUnlimitedAmmo=!0,this.pushObjectDataUpdate(R.data.id,["health"]);break;case"infestor":this.requestEvent({eventId:GameServer.EVENT_CREATE_INFESTOR,data:{id:s,x:n,y:d,team:1,infestorType:m.infestorType,health:m.health+E*(25*p),botSkill:I,killReward:m.killReward,damageMultipliers:m.damageMultipliers}});break;case"character":default:var S=m.weapons[this.Random(0,m.weapons.length-1)],v=this.getWeaponData(S),u=m.health;if(m.zombieType){u+=E*(50*p);var b=[{id:S}]}else u+=E*(25*p),b=[{id:S,mods:m.mods?m.mods:this.getRandomMods(v)}];m.secondaryWeapons&&b.push({id:m.secondaryWeapons[this.Random(0,m.secondaryWeapons.length-1)]}),this.requestEvent({eventId:GameServer.EVENT_CREATE_GENERIC_CHARACTER,data:{id:s,x:n,y:d,team:1,health:u,inventory:b,equipment:m.equipment,avatarData:{hairColour:Character.HAIR_COLOUR_BLACK,hair:null!=m.zombieType?Character.HAIR_BALD:Character.HAIR_SHORT,beard:Character.BEARD_NONE,face:m.faces?m.faces[this.Random(0,m.faces.length-1)]:void 0,head:m.heads[this.Random(0,m.heads.length-1)],body:m.body,facewear:m.facewear,eyewear:m.eyewear},botSkill:I,killReward:m.killReward,bZombie:null!=m.zombieType,zombieType:m.zombieType,damageMultipliers:m.damageMultipliers,ai:{bPreferDistance:!0},maxSpeed:m.maxSpeed,bHero:m.bHero,pawnName:m.pawnName,bRegenHealth:m.bHero||m.bRegenHealth,perks:m.perks,baseSpeedMultiplier:m.baseSpeedMultiplier}})}}else{var y=e.timer_waveSpawn;y&&(clearInterval(y),delete e.timer_waveSpawn)}}}onRespawnTimer(e){var a=this.localData;if(a&&!a.bPaused){var t=this.getPlayerStateById(e);t.id==e&&(t.controllableId||(t.respawnTimer--,t.respawnTimer<0?(t.bCanRespawn=!0,t.bWaitingToRespawn=!1,t.bAutoRespawn&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_RESPAWN,playerId:t.id}),delete t.timer_respawn):t.timer_respawn=this.localData.settings.fps,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:t.id,data:{bWaitingSpawn:t.bWaitingToRespawn,bCanRespawn:t.bCanRespawn,respawnTimer:t.respawnTimer,bHasPawn:t.bHasPawn}})))}}onSpawnProtectionTimer(e){this.removeSpawnProtection(e)}addPlayerMoney(e,a){if(a||this.localData.bSandbox){var t=this.getPlayerStateById(e);if(t){var r=this.getSharedData("maxSurvivalMoney");t.money=Math.max(0,Math.min(r,Math.round(t.money+a))),this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:e,data:{money:t.money}})}}}revivePlayer(e,a,t){var r=this.getPlayerStateById(e);if(r){if(this.localData.bModeGame)i=[{id:"none"}];else var i=r.inventory;var s={x:a[0],y:a[1],inventory:i,perks:[]},o=r.equipment;o&&(s.equipment=o.id,s.equipmentAmmo=o.ammo),this.requestEvent({eventId:GameServer.EVENT_REQUEST_RANKED_CHARACTER,playerId:r.id,avatarData:r.avatarData,data:s}),this.localData.bModeGame||this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{bPlayerRevived:!0,reviverId:t,revivedId:e}})}}startInfectedIntermission(){var e=this.localData;e.gameModeData.intermissionTimer=Settings.INFECTED_INTERMISSION_TIMER,e.timer_wave=setInterval(this.onInfectedTimer.bind(this),1e3),this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{intermissionTimer:e.gameModeData.intermissionTimer}})}startWaveIntermission(){var e=this.localData;e.gameModeData.intermissionTimer=30,0==e.gameModeData.wave&&(e.gameModeData.intermissionTimer=15),e.timer_wave&&(clearInterval(e.timer_wave),delete e.timer_wave);var a=setInterval(this.onWaveTimer.bind(this),1e3);e.timer_wave=a,this.onEvent({eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:{intermissionTimer:e.gameModeData.intermissionTimer}})}getNearestFriendlyPawn(e,a){var t=this.getPawns(),r=null,i=!1,s=Number.MAX_VALUE,o=null,l=void 0,n=!1,d=!1,E=!1;a&&(null!=a.bLOS&&(i=a.bLOS),null!=a.maxRange&&(s=a.maxRange),null!=a.pawnTypes&&(o=a.pawnTypes),null!=a.scale&&(l=a.scale),null!=a.bPlayerOnly&&(n=a.bPlayerOnly),null!=a.bVIP&&(d=a.bVIP),null!=a.bInjured&&(E=a.bInjured));for(var h=0;h<t.length;h++){var c=t[h];if(c.data.health&&c.data.team==e.data.team){if(c.data.id==e.data.id)continue;if(n&&c.data.bBot)continue;if(d&&!c.data.bVIP)continue;if(E&&c.data.health>=c.data.maxHealth)continue;if(o&&o.indexOf(c.data.type)<0)continue;if(null!=l)if(l>0){if(c.position[0]<e.position[0])continue}else if(l<0&&c.position[0]>e.position[0])continue;if(i&&!this.checkLineOfSight(e.position,c.position))continue;if("helicopter"==c.data.type&&c.data.bDestroy)continue;var m=this.Dist(e.position[0],e.position[1],c.position[0],c.position[1]);m<s&&(s=m,r=c)}}return r}getPawnsInArea(e,a,t){for(var r=[],i=this.getPawns(),s=0;s<i.length;s++){var o=i[s];if(null==e||o.data.team!=e)this.Dist(a[0],a[1],o.position[0],o.position[1])<t&&r.push(o)}return r}isGuidingHostage(e){if(e)for(var a=this.getHostages(),t=0;t<a.length;t++){if(a[t].data.ai.followId==e.data.id)return!0}return!1}onHostageInteract(e){if(this.localData.bOperation&&!this.localData.gameModeData.bHostageHeli&&this.localData.difficulty>=3){var a=this.getRescueZone(),t=this.createHelicopter([a[0],-200],1,{type:Helicopter.TYPE_MH6_ATTACK,destination:a});t.data.bControllable=!1,t.data.bBot=!0,t.data.bPlayerControlled=!1,t.data.bAirdrop=!1,t.data.bUnlimitedAmmo=!0,this.localData.gameModeData.bHostageHeli=!0}}getNearestHostage(e){for(var a=[],t=this.getPawns(),r=0;r<t.length;r++){var i=t[r];i.data.bHostage&&a.push({pawn:i,dist:this.Dist(i.position[0],i.position[1],e.position[0],e.position[1]),bFollowing:null!=i.data.ai.followId})}return a.length>0?(a.sort((function(e,a){return e.bFollowing&&!a.bFollowing?1:!e.bFollowing&&a.bFollowing?-1:e.dist>a.dist?1:e.dist<a.dist?-1:0})),a[0]?a[0].pawn:null):null}getNearestEnemyPawn(e,a){var t=this.getPawns(),r=!0,i=!1,s=!1,o=!1,l=null,n=void 0,d=!0,E=Number.MAX_VALUE;a&&(null!=a.bLOS&&(r=a.bLOS),null!=a.maxRange&&(E=a.maxRange),null!=a.pawnTypes&&(l=a.pawnTypes),null!=a.scale&&(n=a.scale),null!=a.bTargetColdBlooded&&(d=a.bTargetColdBlooded),null!=a.bPreferDistance&&(i=a.bPreferDistance),null!=a.bIgnoreOutOfSight&&(s=a.bIgnoreOutOfSight),null!=a.bAllTypes&&(o=a.bAllTypes));for(var h=[],c=0;c<t.length;c++){var m=t[c],p=(r=!0,0);if(!m.data.bUntargetable&&((!m.data.bHostage||e.data.bZombie)&&m.data.health&&m.data.team!=e.data.team)){if(this.localData.bBattlezone)if((R=this.getPlayerStateById(m.data.id))&&R.bSpawnProtection)continue;var _=this.Dist(e.position[0],e.position[1],m.position[0],m.position[1]);switch(e.data.type){case"turret":case"helicopter":if(this.isInSmoke(m))continue;break;case"character":if(!e.data.bZombie&&this.isInSmoke(m)&&_>this.getSharedData("smokeSize")&&(this.localData.bBattlezone||e.data.ai.botSkill<=BotSkill.SKILL_NORMAL))continue}if(l&&-1==l.indexOf(m.data.type)){if(!o)continue;p=1}if(null!=n)if(n>0){if(m.position[0]<e.position[0])continue}else if(n<0&&m.position[0]>e.position[0])continue;if("helicopter"==m.data.type){if(m.data.bDestroy)continue}else if("character"==m.data.type&&!d&&this.characterHasPerk(m,Perks.PERK_PLAYER_COLD_BLOODED))continue;if(r){var A=!0;if(this.localData.bSurvival)0==e.data.team&&(A=!1);else switch(e.data.type){case"turret":A=!this.localData.bSurvival&&!e.data.bAutomated}if(_>100){var I=this.checkLineOfSight(this.getLOSStartPos(e),m.position,A);if(!I&&!this.localData.bSurvival)switch(e.data.type){case"character":I=this.checkLineOfSight(e.position,m.position,A);break;case"turret":this.localData.bOperation&&this.localData.difficulty>=3&&(I=this.checkLineOfSight([e.position[0],e.position[1]-30],[m.position[0],m.position[1]-30],A)),I||(I=this.checkLineOfSight(e.position,m.position,A))}if(!I){if(s)continue;r=!1}}}if(_<=E){var T={type:m.data.type,pawn:m,fallback:p,dist:_,bLOS:r};if(this.localData.bBattlezone)(R=this.getPlayerStateById(m.data.id))&&(T.shards=R.shards);else if(this.localData.gameModeData.id==GameMode.ASSASSINATION){var R;(R=this.getPlayerStateById(m.data.id))&&(T.bVIP=R.bVIP)}h.push(T)}}}return h.length>0?(this.localData.bBattlezone&&e.data.team==Battlezone.TEAM_MERCENARIES?h.sort((function(e,a){return e.shards>a.shards?-1:e.shards<a.shards?1:e.dist<a.dist?-1:e.dist>a.dist||e.bLOS<a.bLOS?1:e.bLOS>a.bLOS?-1:0})):this.localData.gameModeData.id==GameMode.ASSASSINATION?h.sort((function(e,a){return e.bVip<a.bVip?-1:e.bVip>a.bVip||e.bLOS<a.bLOS?1:e.bLOS>a.bLOS||e.dist<a.dist?-1:e.dist>a.dist?1:0})):i?h.sort((function(e,a){return e.fallback<a.fallback?-1:e.fallback>a.fallback?1:e.dist<a.dist?-1:e.dist>a.dist||e.bLOS<a.bLOS?1:e.bLOS>a.bLOS?-1:0})):h.sort((function(e,a){return e.bLOS<a.bLOS?1:e.bLOS>a.bLOS||e.dist<a.dist?-1:e.dist>a.dist?1:0})),h[0].pawn):null}getLOSStartPos(e){switch(e.data.type){case"turret":return this.getMuzzlePosition(e);case"character":return[e.position[0],e.position[1]-30];case"helicopter":return this.getMuzzlePosition(e);default:return e.position}return null}setPlayerLatency(e,a){if(a){var t=this.getPlayerStateById(e);t&&(t.latency=a,this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:t.id,data:{latency:t.latency}}))}}getSharedData(e){var a=this.data.shared;if(a){if(a[e])return this.clone(a[e]);console.warn("Invalid shared data:",e)}return null}getSpriteData(e){var a=this.data.sprites;return a?a[e]:null}getWorldWeaponData(e){var a=this.data.atlas_weapons_world;if(a){var t=a.frames[e];return t?t.frame:(console.warn("Missing frame data:",e),{x:0,y:0,w:32,h:32})}return null}getModData(e){for(var a=this.data.mods,t=0;t<a.length;t++)if(a[t].id==e)return this.clone(a[t]);return null}isMeleeWeapon(e){return!!e&&(e.type===Weapon.TYPE_MELEE||e.bMelee)}isEquipment(e){return!!e&&(e.type==Weapon.TYPE_EXPLOSIVE||e.type==Weapon.TYPE_GRENADE||e.type==Weapon.TYPE_TACTICAL||e.bMelee)}getWeaponData(e,a){for(var t=this.data.weapons,r=0;r<t.length;r++)if(t[r].id==e){var i=this.clone(t[r]);if(a)for(var s=Object.keys(a),o=0;o<s.length;o++)i[s[o]]=a[s[o]];return delete i.unlockLevel,delete i.unlockPrestige,delete i.desc,i}return null}getPerkData(e){for(var a=this.data.perks,t=0;t<a.length;t++){if(a[t].id==e)return this.clone(a[t])}return null}getRandomMods(e){if(e.bZombie||this.isMeleeWeapon(e)||this.isEquipment(e))return null;var a=[null,null,Mods.BASE_DAMPER,Mods.BASE_DEADEYE,Mods.BASE_RANGE,Mods.BASE_RAPID_FIRE,Mods.BASE_SPEED],t=[null,null,Mods.BARREL_LASER],r=[null,null];switch(e.type){case Weapon.TYPE_WEAPON_TACTICAL:break;case Weapon.TYPE_LAUNCHER:r.push(Mods.AMMO_LAUNCHER_EXPLOSIVE,Mods.AMMO_LAUNCHER_RADIUS);break;case Weapon.TYPE_SMG:case Weapon.TYPE_RIFLE:e.bSilenced||t.push(Mods.BARREL_SILENCER),t.push(Mods.BARREL_GRIP,Mods.BARREL_ACCELERATOR,Mods.BARREL_BOOSTER),e.type==Weapon.TYPE_RIFLE&&(e.id,t.push(Mods.BARREL_M203),t.push(Mods.BARREL_MASTERKEY)),r.push(Mods.AMMO_IMPACT,Mods.AMMO_FMJ,Mods.AMMO_PIERCING,Mods.AMMO_EXTENDED,Mods.AMMO_HOLLOW_POINT,Mods.AMMO_HIGH_CALIBER),e.fireMode==Weapon.MODE_AUTO&&a.push(Mods.BASE_BURST_FIRE);break;default:t.push(Mods.BARREL_ACCELERATOR,Mods.BARREL_BOOSTER),r.push(Mods.AMMO_FMJ,Mods.AMMO_PIERCING,Mods.AMMO_EXTENDED,Mods.AMMO_HOLLOW_POINT),e.bSingleRoundLoaded&&r.push(Mods.AMMO_SPEED_LOADER),e.type==Weapon.TYPE_PISTOL&&t.push(Mods.BARREL_COMPENSATOR),e.type==Weapon.TYPE_SHOTGUN&&e.bBoltAction&&r.push(Mods.AMMO_SLUG),e.type!=Weapon.TYPE_SHOTGUN&&r.push(Mods.AMMO_IMPACT,Mods.AMMO_HIGH_CALIBER)}return{base:a[this.Random(0,a.length-1)],barrel:t[this.Random(0,t.length-1)],ammo:r[this.Random(0,r.length-1)]}}getRandomWeapon(e=!1){for(var a=this.clone(this.data.weapons),t=a.length-1;t>=0;t--){var r=a[t];r.type==Weapon.TYPE_MELEE||"m202"==r.id||"smaw"==r.id||"smoke"==r.id||"sensor"==r.id||"jammer"==r.id||!e&&r.bEquipment?a.splice(t,1):"tac_insert"!=r.id||this.localData.bModeGame?r.bHidden&&a.splice(t,1):a.splice(t,1)}return a[this.Random(0,a.length-1)]}getRandomInfectedWeapon(){for(var e=this.clone(this.data.weapons),a=e.length-1;a>=0;a--){var t=e[a];(t.bEquipment||t.type==Weapon.TYPE_MELEE||t.type==Weapon.TYPE_LAUNCHER||t.type==Weapon.TYPE_WEAPON_TACTICAL||t.bHidden)&&e.splice(a,1)}return e[this.Random(0,e.length-1)]}getKillstreakData(e){for(var a=this.data.killstreaks,t=0;t<a.length;t++)if(a[t].id==e)return this.clone(a[t]);return null}getGameModeData(e){for(var a=this.data.modes,t=0;t<a.length;t++)if(a[t].id==e)return this.clone(a[t]);return null}getInitEventData(){return{eventId:GameServer.EVENT_GAME_INIT,mapId:this.localData.mapId,gameModeId:this.localData.gameModeData.id,settings:this.localData.settings}}getGameStartEventData(){return{eventId:GameServer.EVENT_GAME_START,timer:this.localData.gameTimer}}getGameModeEventData(){return{eventId:GameServer.EVENT_GAME_UPDATE,gameModeData:this.localData.gameModeData}}getObjectsEventData(){for(var e=[],a=this.getObstacles(),t=0;t<a.length;t++){let r=a[t];e.push({eventId:GameServer.EVENT_SPAWN_OBJECT,data:{id:r.data.id,position:r.position,rotation:r.angle,type:"obstacle",data:{id:r.data.id,position:[r.position[0],r.position[1]],obstacleId:r.data.obstacleId,scale:r.data.scale,rotation:r.data.rotation}}})}var r=this.getDoors();for(t=0;t<r.length;t++){let a=r[t];e.push({eventId:GameServer.EVENT_SPAWN_OBJECT,data:{id:a.data.id,position:a.position,type:"door",data:a.data}})}var i=this.getCharacters();for(t=0;t<i.length;t++){let a=i[t],r=this.getPlayerStateById(a.data.id);r?e.push({eventId:GameServer.EVENT_CREATE_RANKED_CHARACTER,playerId:a.data.id,avatarData:r.avatarData,data:{x:a.position[0]+50*t,y:a.position[1],inventory:a.data.inventory,equipment:a.data.equipment,perks:a.data.perks}}):e.push({eventId:GameServer.EVENT_CREATE_GENERIC_CHARACTER,data:{id:a.data.id,x:a.position[0],y:a.position[1],team:a.data.team,health:a.data.health,inventory:a.data.inventory,equipment:a.data.equipment,avatarData:a.data.avatarData,bZombie:a.data.bZombie,zombieType:a.data.zombieType,perks:a.data.perks}})}var s=this.getInfestors();for(t=0;t<s.length;t++){let a=s[t];e.push({eventId:GameServer.EVENT_CREATE_INFESTOR,data:{id:a.data.id,x:a.position[0],y:a.position[1],team:a.data.team,infestorType:a.data.infestorType,health:a.data.health,killReward:a.data.killReward,damageMultipliers:a.data.damageMultipliers}})}var o=this.getHelicopters();for(t=0;t<o.length;t++){let a=o[t];e.push({eventId:GameServer.EVENT_SPAWN_HELICOPTER,position:a.position,data:a.data})}var l=this.getTurrets();for(t=0;t<l.length;t++){let a=l[t];e.push({eventId:GameServer.EVENT_SPAWN_TURRET,position:a.position,velocity:a.velocity,angularVelocity:a.angularVelocity,rotation:a.angle,data:a.data})}var n=this.getAllFlags();for(t=0;t<n.length;t++){let a=n[t];e.push({eventId:GameServer.EVENT_SPAWN_FLAG,position:a.position,data:a.data})}var d=this.getAllCrates();for(t=0;t<d.length;t++){let a=d[t];e.push({eventId:GameServer.EVENT_SPAWN_CRATE,position:a.position,data:a.data,mass:a.mass})}var E=this.getGrenades();for(t=0;t<E.length;t++){let a=E[t];e.push({eventId:GameServer.EVENT_SPAWN_GRENADE,position:a.position,velocity:a.velocity,angularVelocity:a.angularVelocity,data:a.data})}var h=this.getEquipment();for(t=0;t<h.length;t++){let a=h[t];e.push({eventId:GameServer.EVENT_SPAWN_EQUIPMENT,position:a.position,data:a.data})}var c=this.getScavengerPacks();for(t=0;t<c.length;t++){let a=c[t];e.push({eventId:GameServer.EVENT_SPAWN_OBJECT,position:a.position,data:a.data})}var m=this.getLootPacks();for(t=0;t<m.length;t++){let a=m[t];e.push({eventId:GameServer.EVENT_SPAWN_OBJECT,position:a.position,data:a.data})}return e}getNewPlayerDesiredTeam(){if(this.localData.gameModeData.scoreLimit){var e=this.localData.gameModeData.scores;if(e){if(e[0]>e[1])return 1;if(e[0]<e[1])return 0}}if(this.isTeamGameMode()){var a=this.getNumPlayersOnTeam(0),t=this.getNumPlayersOnTeam(1);if(a>t)return 1;if(a<t)return 0}return this.Random(0,1)}checkAutoTeamBalance(){if(!this.isTeamGameMode()||!this.localData.bAutoBalance)return!1;if(this.localData.gameTimer<60)return!1;var e=this.localData.gameModeData.scoreLimit;if(e){var a=this.localData.gameModeData.scores;if(a)for(var t=0;t<a.length;t++)if(a[t]>=.9*e)return!1}if(this.localData.gameModeData.bAutoBalancing)return!1;this.log("Checking auto team balance...");var r=this.localData.playerStates;if(r.length>=4){var i=Math.floor(.5*r.length),s=[this.getNumPlayersOnTeam(0),this.getNumPlayersOnTeam(1)];for(t=0;t<2;t++){if(s[t]<i){var o=t;break}}if(null!=o)return this.localData.gameModeData.bAutoBalancing=!0,this.requestEvent({eventId:GameServer.EVENT_MESSAGE_ADD,data:{bInfofeed:!0,type:"message",message:"STR_TEAMS_WILL_BE_BALANCED"}}),setTimeout((()=>{if(!this.matchHasEnded()){for(var e=0,a=r.length-1;a>=0;a--){var t=r[a];if(t.team!=o&&!t.currentPartyId){if(e+1>=i)break;if(this.killPawn(t.id),t.team=o,this.localData.factions){var s=this.localData.factions[o];t.avatars&&t.avatars[s]?t.avatarData=t.avatars[s]:t.avatarData.body=s}this.onEvent({eventId:GameServer.EVENT_PLAYER_UPDATE,playerId:t.id,data:{team:t.team,avatarData:t.avatarData}}),e++}}e>0&&this.requestEvent({eventId:GameServer.EVENT_MESSAGE_ADD,data:{message:"STR_TEAMS_HAVE_BEEN_BALANCED"}}),delete this.localData.gameModeData.bAutoBalancing}}),5e3),!0}return!1}getNumPlayersOnTeam(e){var a=0,t=this.localData.playerStates;if(t)for(var r=0;r<t.length;r++)t[r].team==e&&a++;return a}canAcceptNewPlayers(){if(this.bGameEnded)return!1;if(this.localData){if(this.localData.bBattlezone)return this.localData.gameTimer>=120;if(this.localData.bSurvival)return this.localData.gameModeData.wave<=1;if(!this.localData.bModeGame)return!1;if(this.localData.gameTimer<60&&!this.localData.gameModeData.numRounds)return!1;var e=this.localData.gameModeData.scoreLimit;switch(this.localData.gameModeData.id){case GameMode.DEATHMATCH:var a=this.getPlayerStates();if(a.sort((function(e,a){return e.kills<a.kills?1:e.kills>a.kills?-1:0})),a.length>0&&a[0].kills>=.9*e)return!1;break;case GameMode.INFECTED:if(this.getNumInfected()>=this.localData.playerStates.length)return!1;if(!this.localData.gameModeData.bFirstInfected)return!1;break;default:if(e){var t=this.localData.gameModeData.scores;if(t)for(var r=0;r<t.length;r++)if(t[r]>=.9*e)return!1}}return!0}return!1}setGravity(e){this.localData.world.gravity=[0,e],this.onEvent({eventId:GameServer.EVENT_SANDBOX,data:{gravity:this.localData.world.gravity}})}handleSandboxEvent(e){try{switch(e.type){case"gravity":"number"==typeof e.value&&this.setGravity(e.value);break;case"friendly_fire":this.localData.bFriendlyFire=!this.localData.bFriendlyFire,e.bFriendlyFire=this.localData.bFriendlyFire;break;case"remove_units":for(var a=this.getPawns().concat(this.getTurrets()),t=0;t<a.length;t++){var r=a[t];switch(r.data.type){case"character":r.data.bBot&&this.removeNextStep(r);break;default:this.removeNextStep(r)}}break;case"remove_objects":var i=this.getDisposableCrates().concat(this.getEquipment()).concat(this.getGrenades());for(t=0;t<i.length;t++)this.removeNextStep(i[t]);break;case"remove_spawners":var s=this.getSpawners();for(t=0;t<s.length;t++)this.removeNextStep(s[t]);break;case"player":var o=this.getObjectById(e.playerId);if(o){e.bResetPerks&&this.requestEvent({eventId:GameServer.EVENT_PLAYER_UPDATE_INVENTORY,pawnId:e.playerId,type:GameServer.INV_PERKS_SET,perks:[]}),null!=e.bGodMode&&(o.data.bGodMode=e.bGodMode),null!=e.bUnlimitedAmmo&&(o.data.bUnlimitedAmmo=e.bUnlimitedAmmo,o.data.weapon.bUnlimitedAmmo=e.bUnlimitedAmmo),this.pushObjectDataUpdate(o.data.id,["bGodMode","bUnlimitedAmmo"]);var l=this.getHelicopters();for(t=0;t<l.length;t++){var n=l[t];n.data.heliData.playerId==e.playerId&&(null!=e.bGodMode&&(n.data.bGodMode=e.bGodMode),null!=e.bUnlimitedAmmo&&(n.data.bUnlimitedAmmo=e.bUnlimitedAmmo))}}break;case"spawn":var d=e.pos[0],E=e.pos[1];if(e.spawnerId)(s=this.getSpawners()).length>=Settings.SANDBOX_MAX_SPAWNERS&&this.removeNextStep(s[0]),this.createSpawner(d,E,e);else if(e.unitId)this.createSandboxUnit(e);else if(e.equipmentId)this.createEquipment([d,E],e.team,this.RandomBoolean()?1:-1,0==e.team?e.playerId:null,this.getWeaponData(e.equipmentId));else if(e.crateId)switch(e.crateId){case Crate.CRATE_DECOY:this.createDecoyCrate(d,E,0==e.team?e.playerId:null,e.team);break;case Crate.CRATE_AMMO:this.createAmmoCrate(d,E,0==e.team?e.playerId:null,e.team);break;case Crate.CRATE_KILLSTREAK:this.createKillstreakCrate(d,E,null,0==e.team?e.playerId:null,e.team);break;case Crate.CRATE_PERK:var h=this.getSurvivalPerks();this.createPerkCrate(d,E,0==e.team?e.playerId:null,h[this.Random(0,h.length-1)],e.team);break;case Crate.CRATE_BOMB_GENERIC:this.createGenericBombCrate(this.getRandomUniqueId(),d,E,e.team,null);break;case Crate.CRATE_WEAPON:var c=[],m=this.Random(1,3);for(t=0;t<m;t++){let e=this.getRandomWeapon(!0),a=this.getRandomMods(e);this.applyWeaponMods(e,a),c.push(e)}this.createItemCrate(d,E,0==e.team?e.playerId:null,c,e.team)}}}catch(e){console.error("Error while handling sandbox event:",e)}}createSandboxUnit(e){var a=this.getPawns(e.team).length;if(!(this.localData.bSandbox&&a>Settings.SANDBOX_MAX_PAWNS_PER_TEAM)&&e.unitId){var t=this.getCurrentMapData(),r=this.getRandomUniqueId(),i=e.team,s=e.pos[0],o=e.pos[1],l=SurvivalEnemyInfo[e.unitId];if(l)switch(l.type){case"turret":this.createTurret(r,[s,o],this.RandomBoolean()?1:-1,e.team,{type:l.turretType,playerId:null});break;case"helicopter":if(this.getHelicopters().length>10)return;var n=this.createHelicopter([s,l.helicopterType==Helicopter.TYPE_DRAGONFIRE?o:200],e.team,{type:l.helicopterType,destination:[.5*t.width,.5*t.height],killReward:l.killReward,avatarData:e.avatarData});n.data.bControllable=!1,n.data.bBot=!0,n.data.bPlayerControlled=!1,n.data.bAirdrop=!1,n.data.bMaxLookRange=!0,n.data.bUnlimitedAmmo=!0;break;case"infestor":var d=l.botSkill;this.requestEvent({eventId:GameServer.EVENT_CREATE_INFESTOR,data:{id:r,x:s,y:o,team:e.team,infestorType:l.infestorType,health:2*l.health,botSkill:d,killReward:l.killReward,damageMultipliers:l.damageMultipliers}});break;case"character":default:d=l.botSkill;var E=l.pawnName,h=l.weapons[this.Random(0,l.weapons.length-1)],c=this.getWeaponData(h),m=l.health;if(l.zombieType){var p=[{id:h}];d=Math.min(d+1,BotSkill.SKILL_INSANE),m*=4}else p=[{id:h,mods:l.bHero?l.mods:this.getRandomMods(c)}],l.bDummy||(m*=2);l.secondaryWeapons&&p.push({id:l.secondaryWeapons[this.Random(0,l.secondaryWeapons.length-1)]});var _={bPreferDistance:!0};if(this.localData.bBattlezone&&(d=Math.max(d,BotSkill.SKILL_HARD),!1!==e.bLOS&&(_.bLOS=!0,_.bCanInvestigate=!0,_.bIgnoreOutOfSight=!0,_.bUseActivityTimer=!0,i==Battlezone.TEAM_MERCENARIES&&(_.bCanInteract=!0,E="Mercenary",l.bRegenHealth=!0))),null!=e.patrolPoints&&(_.bPatrol=!0,_.patrolPoints=this.clone(e.patrolPoints)),l.bHostage){var A=[null,Character.EYEWEAR_GLASSES];l.eyewear=A[this.Random(0,A.length-1)],l.hair=this.getRandomHair(),l.beard=this.getRandomBeard()}this.requestEvent({eventId:GameServer.EVENT_CREATE_GENERIC_CHARACTER,data:{id:r,x:s,y:o,team:i,health:m,inventory:p,equipment:l.equipment,avatarData:{hairColour:l.hairColour?l.hairColour:this.getRandomHairColour(),hair:l.hair?l.hair:null!=l.zombieType?Character.HAIR_BALD:this.getRandomHair(),beard:l.beard?l.beard:Character.BEARD_NONE,face:l.faces?l.faces[this.Random(0,l.faces.length-1)]:void 0,head:l.heads[this.Random(0,l.heads.length-1)],body:l.body,facewear:l.facewear,eyewear:l.eyewear},botSkill:d,killReward:l.killReward,bZombie:null!=l.zombieType,zombieType:l.zombieType,damageMultipliers:l.damageMultipliers,ai:_,maxSpeed:l.maxSpeed,baseSpeedMultiplier:l.baseSpeedMultiplier,bRegenHealth:l.bHero||l.bRegenHealth,pawnName:E,bHero:l.bHero,perks:l.perks,bDummy:l.bDummy,bHostage:l.bHostage}})}}}isOutOfMap(e){if(e){var a=this.getCurrentMapData();if(a&&(e.position[0]<0||e.position[0]>a.width||e.position[1]>a.height))return!0}return!1}getCurrentMapData(){return this.getMapData(this.localData.mapId)}getHeliMaxY(){var e=this.getCurrentMapData();if(e){if(this.localData.bOperation&&e.heliMaxYOps)return e.heliMaxYOps;if(e.heliMaxY)return e.heliMaxY}return this.getSharedData("heliMaxY")}getMapData(e){for(var a=this.data.maps,t=0;t<a.length;t++)if(a[t].id==e)return a[t];return null}getSurfaceNormal(e){if(e)for(var a=this.localData.world,t=0;t<a.narrowphase.contactEquations.length;t++){var r=a.narrowphase.contactEquations[t];if(r.bodyA===e||r.bodyB===e)return r.normalA}return null}getSurfaceMaterial(e){if(e)for(var a=this.localData.world,t=a.narrowphase.contactEquations.length,r=0;r<t;r++){var i=a.narrowphase.contactEquations[r];if(i.bodyA===e||i.bodyB===e){var s=i.bodyA.data;if(s)return s.material?s.material:"default"}}return null}isOnGround(e){if(e){for(var a=p2.vec2.fromValues(0,-1),t=!1,r=this.localData.world,i=r.narrowphase.contactEquations.length,s=0;s<i;s++){var o=r.narrowphase.contactEquations[s];if(o.bodyA===e||o.bodyB===e){var l=p2.vec2.dot(o.normalA,a);o.bodyA===e&&(l*=-1),l>.5&&(t=!0)}}return t}return!1}checkExplosion(e,a,t,r,i,s,o,l=!1,n=null){var d=this.getPlayerStateById(i),E=this.getObjectById(s),h=r,c=!l,m=d?d.team:null;m||(m=E?E.team:null),this.emitAISound([e,a],m);var p=this.getPawns();p=(p=(p=(p=(p=p.concat(this.getEquipment())).concat(this.getGrenades())).concat(this.getDestructableObjects())).concat(this.getObstaclesWithHealth())).concat(this.getDoors());for(var _=0;_<p.length;_++){var A=p[_];if(A.data.bPendingRemoval)h=0;else if(!A.data.bInvisible){if("character"==A.data.type){var I=this.getPlayerStateById(A.data.id);if(I&&I.bSpawnProtection)continue}else if("door"==A.data.type){if(!A.data.bClosed)continue}else if("destructableObject"==A.data.type&&"deployable_cover"==A.data.destructableData.type&&this.localData.bSurvival&&m==A.data.team)continue;if(A.data.health){var T=1,R=this.Dist(e,a,A.position[0],A.position[1]);if(R<=t){if(c&&!this.checkLineOfSight([e,a],A.position))continue;var S=!1,v=!1;if(d?(v=A.data.id==d.id,S=A.data.team==d.team&&!v):E&&(v=A.data.id==E.id,S=A.data.team==E.team&&!v),this.localData.bFriendlyFire||(S=S||v),"bomb"==o&&(S=!1),"character"==A.data.type&&S)h=0;else if("turret"==A.data.type&&S)h=0;else if("helicopter"==A.data.type){if(S)h=0;else if(A.data.id==n)h=0;else if(h=r*(T=.5*(1-R/t)),A.data.bDrone)if("stun"==o||"m203"==o||"zombie_exploder_boss"==o){A.data.bStunned=!0;var u=Math.round(6*this.localData.settings.fps);A.data.stunTimer=Math.ceil(u*T),this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:A.data.id,type:GameServer.PAWN_STUN,bValue:!0,time:A.data.stunTimer})}else if("flashbang"==o||"m320"==o){A.data.bFlashed=!0;var b=Math.round(6*this.localData.settings.fps);A.data.flashTimer=Math.ceil(b*T),this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:A.data.id,type:GameServer.PAWN_FLASH,bValue:!0,flashIntensity:1,time:A.data.flashTimer})}}else{h=r*(T=1-R/t),R>.8*t&&(h*=.2),R>.5*t?h*=.5:R>.2*t&&(h*=.8);if("stun"==o||"m203"==o||"zombie_exploder_boss"==o){if(A.data.bStunned=!0,this.characterHasPerk(A,Perks.PERK_PLAYER_SITREP)){A.data.stunTimer=1;var y=!0}else{u=Math.round(6*this.localData.settings.fps);switch(A.data.type){case"turret":A.data.stunTimer=u;break;default:this.localData.bOperation&&1==A.data.team||A.data.bZombie?A.data.stunTimer=u:A.data.stunTimer=Math.ceil(u*T*1),A.data.stunTimer=Math.max(2*this.localData.settings.fps,A.data.stunTimer)}}A.data.aimRotation+=this.ToRad(this.Random(-30,30)),this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:A.data.id,type:GameServer.PAWN_STUN,bValue:!0,time:A.data.stunTimer})}else if("flashbang"==o||"m320"==o){if(A.data.bFlashed=!0,A.data.flashIntensity=Math.min(1,2*T),this.characterHasPerk(A,Perks.PERK_PLAYER_SITREP)){A.data.flashTimer=1;y=!0}else{b=Math.round(6*this.localData.settings.fps);switch(A.data.type){case"turret":A.data.flashTimer=b;break;default:this.localData.bOperation&&1==A.data.team||A.data.bZombie?A.data.flashTimer=b:A.data.flashTimer=Math.ceil(b*T*1)}}this.onEvent({eventId:GameServer.EVENT_PAWN_ACTION,pawnId:A.data.id,type:GameServer.PAWN_FLASH,bValue:!0,flashIntensity:A.data.flashIntensity,time:A.data.flashTimer})}}}else h=0;if(h>0)switch(A.data.type){case"equipment":A.data.id!=s&&(A.data.weaponData.bMine?(d&&(A.data.ownerId=d.id),A.data.bTriggered=!0,A.data.triggerTimer=2):this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_EXPLOSIVE,damageAmount:h,pawnId:A.data.id,attackerId:d?d.id:s,causerId:s,weaponId:o,bDirectlyCausedByPlayer:!0}));break;case"grenade":A.data.bRemoteDetonation&&(A.data.bDetonationTimerEnabled=!0,A.data.detonationTimer=2);break;default:this.requestEvent({eventId:GameServer.EVENT_PAWN_DAMAGE,damageType:DamageType.DAMAGE_EXPLOSIVE,damageAmount:h,pawnId:A.data.id,attackerId:d?d.id:s,causerId:s,weaponId:o,bSitrep:y,bDirectlyCausedByPlayer:!0})}}}}}isInLOS(e,a,t){var r=this.raycast(e[0],e[1],a[0],a[1]);if(r){if(0==r.length)return!1;for(var i=0;i<r.length;i++){var s=r[i].body;if(r[i].distance<1e3)switch(s.data.type){case"ground":return!1;case"character":return s==t}}}return!1}checkLineOfSight(e,a,t,r){var i=this.raycast(e[0],e[1],a[0],a[1]);if(i){if(0==i.length)return!0;for(var s=0;s<i.length;s++){var o=i[s].body;if(o===r)return!0;if(o.data)switch(o.data.type){case"ground":return!1;case"obstacle":if(t)return!1;break;case"door":if(t)return!1;if(o.data.bClosed)return!1}}}return!0}raycast(e,a,t,r){var i=[],s=new p2.Ray({mode:p2.Ray.ALL,from:[e,a],to:[t,r],callback(e){var a=p2.vec2.create();e.getHitPoint(a,s);var t=!1,r=!1;if(e.body.data)switch(e.body.data.type){case"infestor":t=a[1]>e.body.position[1];break;case"character":t=a[1]<e.body.position[1]-22,r=a[1]>e.body.position[1]+20}i.push({body:e.body,point:{x:a[0],y:a[1]},distance:e.getHitDistance(s),bHeadshot:t,bLegshot:r})}}),o=new p2.RaycastResult;return this.localData.world.raycast(o,s),i.sort((function(e,a){return e.distance<a.distance?-1:e.distance>a.distance?1:0})),i}getRandomAvatarData(){var e=[Character.HAIR_COLOUR_BROWN,Character.HAIR_COLOUR_BROWN_LIGHT,Character.HAIR_COLOUR_BLONDE,Character.HAIR_COLOUR_BLACK,Character.HAIR_COLOUR_GINGER],a=[Character.HAIR_SHORT,Character.HAIR_LONG,Character.HAIR_FLAT,Character.HAIR_PONYTAIL,Character.HAIR_BUZZED,Character.HAIR_UNDERCUT,Character.HAIR_STYLED,Character.HAIR_SPIKES],t=[Character.BEARD_NONE,Character.BEARD_STUBBLE,Character.BEARD_FULL,Character.BEARD_CIRCLE,Character.BEARD_GOATEE],r=[Character.BODY_USMC_STANDARD,Character.BODY_GSG9_STANDARD,Character.BODY_GIGN_STANDARD,Character.BODY_MILITIA_STANDARD];return{hairColour:e[this.Random(0,e.length-1)],hair:a[this.Random(0,a.length-1)],beard:t[this.Random(0,t.length-1)],head:Character.HEAD_NONE,body:r[this.Random(0,r.length-1)],facewear:Character.FACEWEAR_NONE,eyewear:Character.EYEWEAR_NONE}}clone(e){return JSON.parse(JSON.stringify(e))}arraysEqual(e,a){if(e===a)return!0;if(null==e||null==a)return!1;if(e.length!==a.length)return!1;for(var t=0;t<e.length;++t)if(e[t]!==a[t])return!1;return!0}shuffleArray(e){for(var a,t,r=e.length;0!==r;)t=Math.floor(Math.random()*r),a=e[r-=1],e[r]=e[t],e[t]=a;return e}pxmi(e){return e}loadPolygon(e,a,t,r,i,s){for(var o=this.getSpriteData(e),l=p2.vec2.create(),n=0;n<o.length;n++){for(var d=[],E=0;E<o[n].shape.length;E+=2)d.push([this.pxmi(1*o[n].shape[E]),this.pxmi(1*o[n].shape[E+1])]);var h=new p2.Convex({vertices:d});h.material=s.material,h.collisionGroup=s.collisionGroup,h.collisionMask=s.collisionMask;for(var c=0;c!==h.vertices.length;c++){var m=h.vertices[c];p2.vec2.sub(m,m,h.centerOfMass)}p2.vec2.scale(l,h.centerOfMass,1),l[0]-=this.pxmi(t/2),l[1]-=this.pxmi(r/2),h.updateTriangles(),h.updateCenterOfMass(),h.updateBoundingRadius(),a.addShape(h,l)}return a.aabbNeedsUpdate=!0,!0}GetBotDesiredClassData(e=0){var a=["m16a4","tar21","mp5","ump45","m3","m1014","ak47","m40a3","samr","mg4"],t=["m9","g17"],r=[null,null,null,"frag","sensor","jammer"];e>=BotSkill.SKILL_NORMAL&&(t.push("riot_shield","tazer","m203","m320","kard","mac11"),r.push("claymore","betty","tac_insert")),e>=BotSkill.SKILL_HARD&&(a.push("mp7","ak74u","arp"),a.push("m4a1","ak47","hk416","aug","fal"),a.push("spas12","aa12","m1216"),a.push("r700","rsass","sr25","dragunov"),a.push("m60e4","aughbar","m249","bren"),t.push("usp45","fiveseven","m1911","m93r","g18","mp9","smaw","javelin","vp70","mk22","snub"),r.push("stim","stun","flashbang","trophy")),e>=BotSkill.SKILL_INSANE&&(a.push("vector","p90","evo3","pdr","bizon"),a.push("ksg","db","saiga12","dp12","jackhammer"),a.push("famas","scarh","acr","g36c","an94","lvoa"),a.push("l115a3","msr","m82","intervention","sg550","pgm"),a.push("pecheneg","hamr","rpk","qbb95","m240","ultimax","mg42"),t.push("magnum","deagle","rhino","p320","kard","thumper","rpg","xm25","stinger","m202"),r.push("knife","semtex"));var i=[Perks.PERK_PLAYER_LIGHTWEIGHT,Perks.PERK_PLAYER_JUGGERNAUT,Perks.PERK_PLAYER_GHOST,Perks.PERK_PLAYER_COLD_BLOODED,Perks.PERK_PLAYER_SPECIALIST,Perks.PERK_PLAYER_MARTYRDOM,Perks.PERK_PLAYER_NINJA,Perks.PERK_PLAYER_SITREP,Perks.PERK_PLAYER_HELMET,Perks.PERK_PLAYER_ANTI_SNIPER],s=[Perks.PERK_WEAPON_AMMO,Perks.PERK_WEAPON_ACCURACY,Perks.PERK_WEAPON_QUICKDRAW,Perks.PERK_WEAPON_RELOAD,Perks.PERK_WEAPON_RECON,Perks.PERK_WEAPON_STOPPING_POWER,Perks.PERK_WEAPON_SHRAPNEL,Perks.PERK_WEAPON_AGGRESSION,Perks.PERK_WEAPON_VAMPIRE];e==BotSkill.SKILL_GOD&&(t=["riot_shield","rpg","stinger","m202"],i=[Perks.PERK_PLAYER_LIGHTWEIGHT,Perks.PERK_PLAYER_JUGGERNAUT,Perks.PERK_PLAYER_SPECIALIST,Perks.PERK_PLAYER_HELMET,Perks.PERK_PLAYER_ANTI_SNIPER],s=[Perks.PERK_WEAPON_RELOAD,Perks.PERK_WEAPON_STOPPING_POWER,Perks.PERK_WEAPON_SHRAPNEL,Perks.PERK_WEAPON_AGGRESSION,Perks.PERK_WEAPON_VAMPIRE]);var o=[null,null,Mods.BASE_DAMPER,Mods.BASE_DEADEYE,Mods.BASE_RANGE,Mods.BASE_RAPID_FIRE,Mods.BASE_SPEED],l=[null,null,Mods.BARREL_LASER],n=a[this.Random(0,a.length-1)],d=this.getWeaponData(n);switch(d.type){case Weapon.TYPE_SMG:case Weapon.TYPE_RIFLE:l.push(Mods.BARREL_SILENCER),d.fireMode==Weapon.MODE_AUTO&&o.push(Mods.BASE_BURST_FIRE);break;case Weapon.TYPE_SNIPER:"m82"!=d.id&&"intervention"!=d.id&&"pgm"!=d.id&&l.push(Mods.BARREL_SILENCER)}var E=[null,null,Mods.AMMO_FMJ,Mods.AMMO_PIERCING,Mods.AMMO_EXTENDED,Mods.AMMO_PIERCING];if(d.type!=Weapon.TYPE_LAUNCHER&&d.bSingleRoundLoaded&&E.push(Mods.AMMO_SPEED_LOADER),d.type==Weapon.TYPE_SHOTGUN&&d.bBoltAction&&E.push(Mods.AMMO_SLUG),e==BotSkill.SKILL_GOD)o=[Mods.BASE_RANGE];return{primary:{id:n,mods:{base:o[this.Random(0,o.length-1)],barrel:l[this.Random(0,l.length-1)],ammo:E[this.Random(0,E.length-1)]}},secondary:{id:t[this.Random(0,t.length-1)]},equipment:r[this.Random(0,r.length-1)],playerPerk:i[this.Random(0,i.length-1)],weaponPerk:s[this.Random(0,s.length-1)],killstreak:this.RandomBoolean()?Killstreaks.TYPE_ASSAULT:Killstreaks.TYPE_SUPPORT}}GetBotDesiredKillstreaks(e){var a={},t=[Killstreaks.KILLSTREAK_UAV,Killstreaks.KILLSTREAK_CARE_PACKAGE],r=[Killstreaks.KILLSTREAK_HELLFIRE,Killstreaks.KILLSTREAK_AIRSTRIKE,Killstreaks.KILLSTREAK_NAPALM,Killstreaks.KILLSTREAK_COBRA,Killstreaks.KILLSTREAK_SCOUT],i=[Killstreaks.KILLSTREAK_SENTRY_GUN,Killstreaks.KILLSTREAK_CHOPPER_GUNNER,Killstreaks.KILLSTREAK_PAVE_LOW,Killstreaks.KILLSTREAK_BOMBARDMENT,Killstreaks.KILLSTREAK_REAPER,Killstreaks.KILLSTREAK_MH6_GRENADE,Killstreaks.KILLSTREAK_COBRA_CONTROLLABLE,Killstreaks.KILLSTREAK_JUGGERNAUT];a[Killstreaks.TYPE_ASSAULT]=[t[this.Random(0,t.length-1)],r[this.Random(0,r.length-1)],i[this.Random(0,i.length-1)]];var s=[Killstreaks.KILLSTREAK_AMMO,Killstreaks.KILLSTREAK_COUNTER_UAV,Killstreaks.KILLSTREAK_UAV_SUPPORT],o=[Killstreaks.KILLSTREAK_DECOY,Killstreaks.KILLSTREAK_SUPPORT_AIRDROP,Killstreaks.KILLSTREAK_SAM_TURRET,Killstreaks.KILLSTREAK_REMOTE_TURRET,Killstreaks.KILLSTREAK_DRAGONFIRE,Killstreaks.KILLSTREAK_ADVANCED_TURRET],l=[Killstreaks.KILLSTREAK_STEALTH_BOMBER,Killstreaks.KILLSTREAK_HELI_SNIPER,Killstreaks.KILLSTREAK_EMP,Killstreaks.KILLSTREAK_ESCORT_AIRDROP,Killstreaks.KILLSTREAK_GRENADE_TURRET,Killstreaks.KILLSTREAK_JUGGERNAUT_RECON];return a[Killstreaks.TYPE_SUPPORT]=[s[this.Random(0,s.length-1)],o[this.Random(0,o.length-1)],l[this.Random(0,l.length-1)]],a}Random(e,a){return Math.floor(Math.random()*(a-e+1))+e}RandomBoolean(){return Math.random()>=.5}Dist(e,a,t,r){return Math.sqrt((e-t)*(e-t)+(a-r)*(a-r))}Angle(e,a,t,r){var i=t-e,s=r-a;return this.RoundDecimal(Math.atan2(s,i))}ToRad(e){return this.RoundDecimal(e*(Math.PI/180))}ToDeg(e){return e*(180/Math.PI)}WrapAngle(e,a){return this.RoundDecimalFine(a?this.Wrap(e,-Math.PI,Math.PI):this.Wrap(e,-180,180))}Wrap(e,a,t){var r=t-a;if(r<=0)return 0;var i=(e-a)%r;return i<0&&(i+=r),i+a}RoundToNearest(e){return 5*Math.ceil(e/5)}RoundDownToNearestEven(e){return 2*Math.floor(e/2)}RoundDecimal(e){return Math.trunc(100*e)/100}RoundDecimalOne(e){return Math.trunc(10*e)/10}RoundDecimalFine(e){return Math.trunc(1e4*e)/1e4}}"undefined"!=typeof module&&(module.exports={GameInstance:GameInstance});
